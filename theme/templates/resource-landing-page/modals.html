{% load crispy_forms_tags hydroshare_tags %}

{% for source in source_formset.initial %}
<div class="modal fade in" id="delete-source-element-dialog{{ source.id }}" tabindex="-1" role="dialog"
     aria-labelledby="delete-source" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="delete-source">Delete metadata element</h4></div>
            <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/source/{{ source.id }}/delete-metadata/">Delete</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="edit-source-dialog{{ source.id }}" tabindex="-1" role="dialog" aria-labelledby="edit-source"
     aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="id_source_{{ source.id }}" action="/hsapi/_internal/{{ cm.short_id }}/source/{{ source.id }}/update-metadata/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="edit-source"> Edit Source </h4></div>
                <div class="modal-body">
                    {% csrf_token %}
                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <legend>Source</legend>
                            <div id="div_id_derived_from" class="control-group">
                                <label for="id_derived_from" class="control-label requiredField">
                                Derived from<span class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_source-{{ forloop.counter0 }}-derived_from" maxlength="300" name="source-{{ forloop.counter0 }}-derived_from"
                                        type="text" value="{{ source.derived_from }}"></div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

{% for relation in relation_formset.initial %}
<div class="modal fade in" id="delete-relation-element-dialog{{ relation.id }}" tabindex="-1" role="dialog"
     aria-labelledby="delete-relation" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="delete-relation">Delete metadata element</h4></div>
            <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/relation/{{ relation.id }}/delete-metadata/">Delete</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="edit-relation-dialog_{{ relation.id }}" tabindex="-1" role="dialog"
     aria-labelledby="edit-relation" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/relation/{{ relation.id }}/update-metadata/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="edit-relation"> Edit Relation </h4></div>
                <div class="modal-body">
                    {% csrf_token %}

                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <legend>Relation</legend>
                            <div id="div_id_type" class="control-group">
                                <label for="id_type" class="control-label requiredField">
                                Relation type<span class="asteriskField">*</span></label>

                                <div class="controls">
                                    <select class="form-control input-sm select" id="id_relation-{{ forloop.counter0 }}-type" name="relation-{{ forloop.counter0 }}-type">
                                        <option value="">---------</option>
                                        {% for type_value, type_display in relation_source_types %}
                                            <option value={{ type_value }} {% if relation.type == type_value %}selected="selected"{% endif %}>{{ type_display }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div id="div_id_value" class="control-group">
                                <label for="id_value" class="control-label requiredField">
                                Related to<span class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput" id="id_relation-{{ forloop.counter0 }}-value"
                                        maxlength="500" name="relation-{{ forloop.counter0 }}-value" type="text"
                                        value="{{ relation.value }}"></div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

{% for contributor in contributor_formset.initial %}
<div class="modal fade" id="edit-contributor-dialog{{ contributor.id }}" tabindex="-1" role="dialog"
     aria-labelledby="edit-contributor" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="id_contributor_{{ contributor.id }}" action="/hsapi/_internal/{{ cm.short_id }}/contributor/{{ contributor.id }}/update-metadata/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">×
                    </button>
                    <h4 class="modal-title" id="edit-contributor"> Edit Contributor </h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <fieldset>
                            <div id="div_id_name" class="control-group">
                                <label class="control-label requiredField">Name<span
                                        class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_contributor-{{ contributor.order|add:"- 1" }}-name" maxlength="100" name="contributor-{{ contributor.order|add:"- 1" }}-name"
                                        required="required" type="text" value="{% if contributor.name %}{{ contributor.name }}{% endif %}"></div>
                            </div>
                            {% if contributor.description %}
                                <div id="div_id_description" class="control-group">
                                    <label class="control-label">HydroShare User Identifier (URL)</label>

                                    <div class="controls"><input
                                            class="form-control input-sm urlinput"
                                            id="id_creator-{{ contributor.order|add:"- 1" }}-description"
                                            maxlength="200"
                                            name="creator-{{ contributor.order|add:"- 1" }}-description" type="url"
                                            value="{{ contributor.description }}"
                                            readonly></div>
                                </div>
                            {% endif %}
                            <div id="div_id_organization" class="control-group">
                                <label class="control-label">Organization</label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_contributor-{{ contributor.order|add:"- 1" }}-organization" maxlength="200"
                                        name="contributor-{{ contributor.order|add:"- 1" }}-organization" type="text" value="{% if contributor.organization %}{{ contributor.organization }}{% endif %}"></div>
                            </div>
                            <div id="div_id_email" class="control-group">
                                <label class="control-label">Email</label>

                                <div class="controls">
                                    <input class="form-control input-sm emailinput"
                                           id="id_contributor-{{ contributor.order|add:"- 1" }}-email" maxlength="75" name="contributor-{{ contributor.order|add:"- 1" }}-email"
                                           type="email" value="{% if contributor.email %}{{ contributor.email }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_address" class="control-group">
                                <label class="control-label">Address</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                           id="id_contributor-{{ contributor.order|add:"- 1" }}-address" maxlength="250"
                                           name="contributor-{{ contributor.order|add:"- 1" }}-address"
                                           type="text" value="{% if contributor.address %}{{ contributor.address }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_phone" class="control-group">
                                <label class="control-label">Phone</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                           id="id_contributor-{{ contributor.order|add:"- 1" }}-phone" maxlength="25" name="contributor-{{ contributor.order|add:"- 1" }}-phone"
                                           type="text" value="{% if contributor.phone %}{{ contributor.phone }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_homepage" class="control-group">
                                <label class="control-label">Homepage</label>

                                <div class="controls"><input
                                        class="form-control input-sm urlinput"
                                        id="id_contributor-{{ contributor.order|add:"- 1" }}-homepage" maxlength="200" name="contributor-{{ contributor.order|add:"- 1" }}-homepage"
                                        type="url" value="{% if contributor.homepage %}{{ contributor.homepage }}{% endif %}"></div>
                            </div>

                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="delete-contributor-dialog{{ contributor.id }}" tabindex="-1" role="dialog"
     aria-labelledby="delete-contributor" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="delete-contributor">Delete metadata element</h4></div>
            <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/contributor/{{ contributor.id }}/delete-metadata/">Delete</a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% for author in creator_formset.initial %}
<div class="modal fade" id="edit-creator-dialog{{ author.id }}" tabindex="-1" role="dialog"
     aria-labelledby="edit-creator" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="id_creator_{{ author.id }}" action="/hsapi/_internal/{{ cm.short_id }}/creator/{{ author.id }}/update-metadata/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">×
                    </button>
                    <h4 class="modal-title" id="edit-creator"> Edit Author </h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <fieldset>
                            {% if author.name %}
                            <div id="div_id_name" class="control-group">
                                <label class="control-label requiredField">Name<span
                                        class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-name" maxlength="100" name="creator-{{ author.order|add:"- 1" }}-name"
                                        required="required" type="text" value="{% if author.name %}{{ author.name }}{% endif %}"></div>
                            </div>
                            {% else %}
                            <div id="div_id_name" class="control-group" style="display:none">
                                <label class="control-label requiredField">Name<span
                                        class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-name" maxlength="100" name="creator-{{ author.order|add:"- 1" }}-name"
                                        type="text" value="{% if author.name %}{{ author.name }}{% endif %}"></div>
                            </div>
                            {% endif %}
                            {% if author.description %}
                                <div id="div_id_description" class="control-group">
                                    <label class="control-label">HydroShare User Identifier (URL)</label>

                                    <div class="controls"><input
                                            class="form-control input-sm urlinput"
                                            id="id_creator-{{ author.order|add:"- 1" }}-description" maxlength="200"
                                            name="creator-{{ author.order|add:"- 1" }}-description" type="url"
                                            value="{{ author.description }}"
                                            readonly></div>
                                </div>
                            {% endif %}
                            <!--If you don't have an author name you need an organization-->
                            {% if author.name %}
                            <div id="div_id_organization" class="control-group">
                                <label class="control-label">Organization</label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-organization" maxlength="200"
                                        name="creator-{{ author.order|add:"- 1" }}-organization" type="text" value="{% if author.organization %}{{ author.organization }}{% endif %}"></div>
                            </div>
                            {% else %}
                            <div id="div_id_organization" class="control-group requiredField">
                                <label class="control-label">Organization<span
                                        class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-organization" maxlength="200"
                                        required="required" name="creator-{{ author.order|add:"- 1" }}-organization" type="text" value="{% if author.organization %}{{ author.organization }}{% endif %}"></div>
                            </div>
                            {% endif %}
                            <div id="div_id_email" class="control-group">
                                <label class="control-label">Email</label>

                                <div class="controls">
                                    <input class="form-control input-sm emailinput"
                                           id="id_creator-{{ author.order|add:"- 1" }}-email" maxlength="75" name="creator-{{ author.order|add:"- 1" }}-email"
                                           type="email" value="{% if author.email %}{{ author.email }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_address" class="control-group">
                                <label class="control-label">Address</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                           id="id_creator-{{ author.order|add:"- 1" }}-address" maxlength="250"
                                           name="creator-{{ author.order|add:"- 1" }}-address"
                                           type="text" value="{% if author.address %}{{ author.address }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_phone" class="control-group">
                                <label class="control-label">Phone</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                           id="id_creator-{{ author.order|add:"- 1" }}-phone" maxlength="25" name="creator-{{ author.order|add:"- 1" }}-phone"
                                           type="text" value="{% if author.phone %}{{ author.phone }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_homepage" class="control-group">
                                <label class="control-label">Homepage</label>

                                <div class="controls"><input
                                        class="form-control input-sm urlinput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-homepage" maxlength="200" name="creator-{{ author.order|add:"- 1" }}-homepage"
                                        type="url" value="{% if author.homepage %}{{ author.homepage }}{% endif %}"></div>
                            </div>
                            <div id="div_id_order" class="control-group">
                                <label class="control-label">Order<span class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm urlinput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-order" name="creator-{{ author.order|add:"- 1" }}-order" required="required"
                                        type="number" value="{% if author.order %}{{ author.order }}{% endif %}"></div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="delete-creator-dialog{{ author.id }}" tabindex="-1" role="dialog"
     aria-labelledby="delete-creator" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="delete-creator">Delete metadata element</h4></div>
            <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/creator/{{ author.id }}/delete-metadata/">Delete</a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% include "irods_signin.html" %}
{% include "irods_upload_add.html" %}

<div class="modal fade" id="large-file-download-alert" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="large-file-download-close">Download Alert</h4>
            </div>
            <div class="modal-body alert alert-warning alert-dismissible" role="alert">
                <p>
                    File larger than 1GB cannot be downloaded directly via HTTP. Please
                    create an iRODS account in your iRODS user zone from your profile page
                    if you have not done so already, and replicate the resource to your iRODS
                    user zone, then download the large file via iRODS clients such as
                    <a href="https://docs.irods.org/master/icommands/user/" target="_blank">
                    icommands</a> and
                    <a href="https://pages.hydroshare.org/accessing-hydroshare-irods-from-a-windows-pc-or-mac/"
                       target="_blank">Cyberduck</a>.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="submit-for-publication-dialog" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="submit-for-publication-title">Submit resource for publication</h4>
            </div>
            <div class="modal-body">
                <p>
                    Upon submitting the resource for publication it will be permanently published and assigned a
                    digital object identifier (DOI). This is <strong>final</strong> and changes can only be made
                    on a new version (copy) of the resource.
                </p>
                <p>
                     Please confirm that you accept the HydroShare Publication Agreement shown below.
                </p>
                <div class="iframe-border">
                    <iframe id="pub-agreement-frame" scrolling="no" src="https://www.hydroshare.org/publication-agreement/"></iframe>
                </div>
                <input type="checkbox" id="agree-chk"><label for="agree-chk" class="checkbox-label">I accept the HydroShare Publication Agreement.</label>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button class="btn btn-danger" id="publish-btn" data-toggle="modal" data-dismiss="modal" data-target="#submit-for-publication-dialog-2" disabled>Publish</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="submit-for-publication-dialog-2" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="submit-for-publication-title">Are you sure you want to formally publish this resource?</h4>
            </div>
            <div class="modal-body">
                <p>
                    <strong>Are you sure you want to formally publish this resource?</strong> You will <strong>NOT</strong>
                    be able to edit your resource or its metadata if you proceed. This is a permanent step and should only
                    be done when you are finished modifying your resource and you are ready to formally publish it.
                </p>
                <p>
                    If you want to make your resource public or share with specific HydroShare users without formally
                    publishing it, click <strong>"Cancel"</strong> and use the manage access panel or toggle your resource
                    to be public instead.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" id="publish-btn-2" class="btn btn-danger" href="/hsapi/_internal/{{ cm.short_id }}/publish/">Publish</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="new-version-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="new-version-resource-title">Create New Version of This Resource</h4>
            </div>
            <div class="modal-body">
                Creating a new version will obsolete this resource. This resource will be still available in HydroShare,
                but only the newer version will be discoverable via the HydroShare search interface. The new version is
                a complete new resource with new identifier. It will contain a link back to the previous version and the
                previous version will have a link to the next version. This can be repeated resulting in a sequence of
                multiple versions each linked to next and previous versions. Only the most recent version can be edited
                or deleted. If you delete the most recent version, the previous version becomes the most recent and editable.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/create-new-version-resource/">Create New Version</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="rep-resource-to-irods-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="rep-res-to-irods-title">Replicate resource bag to your iRODS user zone</h4>
            </div>
            <div class="modal-body">
                Are you sure you want to replicate this resource bag to your iRODS user zone?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   onclick="rep_res_to_irods_user_zone_ajax_submit('{{ cm.short_id }}');return false;">Replicate</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="add-source-dialog" tabindex="-1" role="dialog" aria-labelledby="add-source"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/source/add-metadata/" method="POST"
                  enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="add-source">Add Source</h4></div>
                <div class="modal-body">
                    {% csrf_token %}

                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <legend>Source</legend>
                            <div id="div_id_derived_from" class="control-group">
                                <label for="id_derived_from" class="control-label requiredField">Derived from<span class="asteriskField">*</span></label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                                             id="id_derived_from" maxlength="300"
                                                             name="derived_from" type="text">
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="add-relation-dialog" tabindex="-1" role="dialog" aria-labelledby="add-relation"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/relation/add-metadata/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="add-relation"> Add Relation </h4></div>
                <div class="modal-body">
                    {% csrf_token %}

                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <legend>Relation</legend>
                            <div id="div_id_type" class="control-group"><label for="id_type"
                                                                               class="control-label requiredField">
                                Relation type<span class="asteriskField">*</span></label>

                                <div class="controls"><select class="form-control input-sm select" id="id_type" name="type">
                                    <option value="" selected="selected">---------</option>
                                    {% for type_value, type_display in relation_source_types %}
                                        <option value={{ type_value }}>{{ type_display }}</option>
                                    {% endfor %}
                                </select></div>
                            </div>
                            <div id="div_id_value" class="control-group"><label for="id_value"
                                                                                class="control-label requiredField">
                                Related to<span class="asteriskField">*</span></label>

                                <div class="controls"><input class="form-control input-sm textinput textInput"
                                                             id="id_value" maxlength="500" name="value"
                                                             type="text"></div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% block modal_delete_resource %}
    <div class="modal fade" id="delete-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="delete-resource-title"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="delete-resource-title">Delete Resource</h4>
                </div>
                <div class="modal-body">
                    <strong>THIS IS A PERMANENT ACTION. </strong>
                    <ul>
                        <li>This will delete the resource file.</li>
                        <li>A copy of your resource file will not be retained by Hydroshare.</li>
                        <li>We highly recommend that you download the latest copy of your resource file before
                            confirming this action.
                        </li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger"
                       href="/hsapi/_internal/{{ cm.short_id }}/delete-resource/">Delete</a>
                </div>
            </div>
        </div>
    </div>
{%  endblock %}

{%  block delete-self-access-to-resource %}
    <div id="dialog-confirm-delete-self-access" title="Warning! Loss of access">
    <p><span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 50px 0;"></span>
        This action will remove your access to this resource and you will no longer be able to
        access it without someone else sharing it with you again. This is not reversible,
        so <strong>Remove</strong> with caution.
    </p>
</div>
{%  endblock %}

{%  block wait-for-process-to-complete %}
    <div id="wait-to-complete" title="Processing ...">
    <p><span style="float:left; margin:12px 12px 50px 0;"></span>
        Please wait for the process to complete.
    </p>
</div>
{%  endblock %}

<div class="modal fade" id="add-reference-dialog" tabindex="-1" role="dialog" aria-labelledby="add-reference"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/add-citation/">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="add-reference">Add reference</h4>
                </div>
                <div class="modal-body">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="add-citation-input">Citation text:</label>
                        <textarea class="form-control" name="content" id="add-citation-input" cols="30"
                                  rows="10"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="add-creator-dialog" tabindex="-1" role="dialog" aria-labelledby="add-creator" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="add-creator"> Add Author </h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-5 text-center">
                        <div class="radio-inline center-radio-inline text-center">
                            <label>
                                <div>Person</div>
                                <input type="radio" checked name="add_author_user_type" value="person">
                            </label>
                        </div>
                    </div>

                    <div class="col-sm-2 text-center or-separator">
                        <span class="text-muted">- Or -</span>
                    </div>

                    <div class="col-sm-5 text-center">
                        <div class="radio-inline center-radio-inline text-center">
                            <label>
                                <div>Organization</div>
                                <input type="radio" name="add_author_user_type" value="organization">
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12">
                        <hr>
                    </div>
                </div>
            </div>

            {# Person #}
            <div data-hs-user-type="person">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-5 text-center">
                            <div class="radio-inline center-radio-inline text-center">
                                <label>
                                    <div>Existing HydroShare User</div>
                                    <input type="radio" checked name="add_author_person" value="hs_user">
                                </label>
                            </div>
                        </div>

                        <div class="col-sm-2 text-center or-separator">
                            <span class="text-muted">- Or -</span>
                        </div>

                        <div class="col-sm-5 text-center">
                            <div class="radio-inline center-radio-inline text-center">
                                <label>
                                    <div>Other</div>
                                    <input type="radio" name="add_author_person" value="other_person">
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12">
                            <hr>
                        </div>
                    </div>
                </div>
                {#  Existing HydroShare User  #}
                <div data-hs-person-type="hs_user">
                    <div class="modal-body">
                        {{ add_view_user_form.user }}
                    </div>

                    <form action="/hsapi/_internal/{{ cm.short_id }}/creator/add-metadata/" method="POST"
                          enctype="multipart/form-data">
                        {% csrf_token %}
                        <input name="resource-mode" type="hidden" value="edit">
                        <div class="modal-body" style="display:none;">
                            <div class="form-group">
                                <fieldset>
                                    <div id="div_id_name" class="control-group">
                                        <label for="id_name" class="control-label requiredField">Name<span
                                                class="asteriskField">*</span></label>

                                        <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                     id="id_name" maxlength="100" name="name"
                                                                     type="text"></div>
                                    </div>

                                    <div id="div_id_description" class="control-group">
                                        <label for="id_description" class="control-label">HydroShare User Identifier
                                            (URL)</label>
                                        <div class="controls"><input class="form-control input-sm urlinput"
                                                                     id="id_description" maxlength="200"
                                                                     name="description" type="url"></div>
                                    </div>

                                    <div id="div_id_organization" class="control-group">
                                        <label for="id_organization" class="control-label">Organization</label>
                                        <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                     id="id_organization" maxlength="200"
                                                                     name="organization" type="text"></div>
                                    </div>

                                    <div id="div_id_email" class="control-group">
                                        <label for="id_email" class="control-label">Email</label>

                                        <div class="controls">
                                            <input class="form-control input-sm emailinput"
                                                   id="id_email" maxlength="75" name="email"
                                                   type="email">
                                        </div>
                                    </div>

                                    <div id="div_id_address" class="control-group">
                                        <label for="id_address" class="control-label">Address</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="id_address" maxlength="250" name="address"
                                                   type="text">
                                        </div>
                                    </div>

                                    <div id="div_id_phone" class="control-group">
                                        <label for="id_phone" class="control-label">Phone</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="id_phone" maxlength="25" name="phone"
                                                   type="text">
                                        </div>
                                    </div>

                                    <div id="div_id_homepage" class="control-group">
                                        <label for="id_homepage" class="control-label">Homepage</label>
                                        <div class="controls"><input class="form-control input-sm urlinput"
                                                                     id="id_homepage" maxlength="200" name="homepage"
                                                                     type="url"></div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary"
                                    onclick="get_user_info_ajax_submit('/hsapi/_internal/get-user-or-group-data/', this)">Save Changes</button>
                        </div>
                    </form>
                </div>
                {# Other Person #}
                <div data-hs-person-type="other_person", style="display:none;">
                    <form action="/hsapi/_internal/{{ cm.short_id }}/creator/add-metadata/" method="POST"
                          enctype="multipart/form-data">
                        {% csrf_token %}
                        <input name="resource-mode" type="hidden" value="edit">
                        <div class="modal-body">
                            {% csrf_token %}
                            <div class="form-group">
                                {% csrf_token %}
                                <fieldset>
                                    <div id="div_id_name" class="control-group">
                                        <label for="id_name" class="control-label requiredField" >Name<span
                                                class="asteriskField">*</span></label>

                                        <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                     id="id_name" maxlength="100" name="name"
                                                                     required="required" type="text" placeholder="e.g. 'Smith, John Arnold'">
                                        </div>
                                    </div>

                                    <div id="div_id_organization" class="control-group">
                                        <label for="id_organization" class="control-label">Organization</label>
                                        <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                     id="id_organization" maxlength="200"
                                                                     name="organization" type="text"></div>
                                    </div>
                                    <div id="div_id_email" class="control-group">
                                        <label for="id_email" class="control-label">Email</label>

                                        <div class="controls">
                                            <input class="form-control input-sm emailinput"
                                                   id="id_email" maxlength="75" name="email"
                                                   type="email">
                                        </div>
                                    </div>
                                    <div id="div_id_address" class="control-group">
                                        <label for="id_address" class="control-label">Address</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="id_address" maxlength="250" name="address"
                                                   type="text">
                                        </div>
                                    </div>
                                    <div id="div_id_phone" class="control-group">
                                        <label for="id_phone" class="control-label">Phone</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="id_phone" maxlength="25" name="phone"
                                                   type="text">
                                        </div>
                                    </div>
                                    <div id="div_id_homepage" class="control-group">
                                        <label for="id_homepage" class="control-label">Homepage</label>
                                        <div class="controls"><input class="form-control input-sm urlinput"
                                                                     id="id_homepage" maxlength="200" name="homepage"
                                                                     type="url"></div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>

            {#  Organization  #}
            <div data-hs-user-type="organization" style="display:none">
                {# This code block should be uncommented after the auto complete for Existing HS Groups is working #}
                <!--<div class="modal-body">
                    <div class="row">
                        <div class="col-sm-5 text-center">
                            <div class="radio-inline center-radio-inline text-center">
                                <label>
                                    <div>Existing HS Group</div>
                                    <input type="radio" checked name="choose_org_type" value="hs_group">
                                </label>
                            </div>
                        </div>

                        <div class="col-sm-2 text-center or-separator">
                            <span class="text-muted">- Or -</span>
                        </div>

                        <div class="col-sm-5 text-center">
                            <div class="radio-inline center-radio-inline text-center">
                                <label>
                                    <div>Other</div>
                                    <input type="radio" name="choose_org_type" value="other_organization">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                {# Existing HS Group#}
                <div data-hs-org-type="hs_group">
                    <div class="modal-body">
                        {{ add_view_group_form.group }}
                    </div>

                    <form action="/hsapi/_internal/{{ cm.short_id }}/creator/add-metadata/" method="POST"
                          enctype="multipart/form-data">
                        {% csrf_token %}
                        <input name="resource-mode" type="hidden" value="edit">
                        <div class="modal-body" style="display:none;">
                            <div class="form-group">
                                <fieldset>
                                    <div id="div_id_name" class="control-group">
                                        <label for="id_name" class="control-label requiredField">Name<span
                                                class="asteriskField">*</span></label>

                                        <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                     id="id_name" maxlength="100" name="name"
                                                                     required="required" type="text"></div>
                                    </div>

                                    <div id="div_id_description" class="control-group">
                                        <label for="id_description" class="control-label">HydroShare User Identifier
                                            (URL)</label>
                                        <div class="controls"><input class="form-control input-sm urlinput"
                                                                     id="id_description" maxlength="200"
                                                                     name="description" type="url"></div>
                                    </div>

                                    <div id="div_id_organization" class="control-group">
                                        <label for="id_organization" class="control-label">Organization</label>
                                        <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                     id="id_organization" maxlength="200"
                                                                     name="organization" type="text"></div>
                                    </div>

                                    <div id="div_id_email" class="control-group">
                                        <label for="id_email" class="control-label">Email</label>

                                        <div class="controls">
                                            <input class="form-control input-sm emailinput"
                                                   id="id_email" maxlength="75" name="email"
                                                   type="email">
                                        </div>
                                    </div>

                                    <div id="div_id_address" class="control-group">
                                        <label for="id_address" class="control-label">Address</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="id_address" maxlength="250" name="address"
                                                   type="text">
                                        </div>
                                    </div>

                                    <div id="div_id_phone" class="control-group">
                                        <label for="id_phone" class="control-label">Phone</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="id_phone" maxlength="25" name="phone"
                                                   type="text">
                                        </div>
                                    </div>

                                    <div id="div_id_homepage" class="control-group">
                                        <label for="id_homepage" class="control-label">Homepage</label>
                                        <div class="controls"><input class="form-control input-sm urlinput"
                                                                     id="id_homepage" maxlength="200" name="homepage"
                                                                     type="url"></div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary"
                                    onclick="get_user_info_ajax_submit('/hsapi/_internal/get-user-or-group-data/', this)">Save Changes</button>
                        </div>
                    </form>
                </div> -->
                {#  Other Organization  #}
                <div data-hs-org-type="other_organization">
                    <form action="/hsapi/_internal/{{ cm.short_id }}/creator/add-metadata/" method="POST"
                          enctype="multipart/form-data">
                        {% csrf_token %}
                        <input name="resource-mode" type="hidden" value="edit">
                        <div class="modal-body">
                            {% csrf_token %}
                            <div class="form-group">
                                {% csrf_token %}
                                <fieldset>
                                    <div id="div_id_name" class="control-group" style="display:none">
                                        <label for="id_name" class="control-label">Name</label>

                                        <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                     id="id_name" maxlength="100" name="name"
                                                                      type="text" placeholder="e.g. 'U.S. Army Corps of Engineers'">
                                        </div>
                                    </div>
                                    <div id="div_id_organization" class="control-group">
                                        <label for="id_organization" class="control-label requiredField">Organization Name<span
                                                class="asteriskField">*</span></label>
                                        <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                     id="id_organization" maxlength="200"
                                                                     name="organization" type="text" placeholder="e.g. 'U.S. Army Corps of Engineers'"
                                                                     required="required"></div>
                                    </div>
                                    <div id="div_id_email" class="control-group">
                                        <label for="id_email" class="control-label">Email</label>

                                        <div class="controls">
                                            <input class="form-control input-sm emailinput"
                                                   id="id_email" maxlength="75" name="email"
                                                   type="email">
                                        </div>
                                    </div>
                                    <div id="div_id_address" class="control-group">
                                        <label for="id_address" class="control-label">Address</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="id_address" maxlength="250" name="address"
                                                   type="text">
                                        </div>
                                    </div>
                                    <div id="div_id_phone" class="control-group">
                                        <label for="id_phone" class="control-label">Phone</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="id_phone" maxlength="25" name="phone"
                                                   type="text">
                                        </div>
                                    </div>
                                    <div id="div_id_homepage" class="control-group">
                                        <label for="id_homepage" class="control-label">Homepage</label>
                                        <div class="controls"><input class="form-control input-sm urlinput"
                                                                     id="id_homepage" maxlength="200" name="homepage"
                                                                     type="url"></div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="add-contributor-dialog" tabindex="-1" role="dialog"
     aria-labelledby="add-contributor" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="add-contributor"> Add Contributor </h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-5 text-center">
                        <div class="radio-inline center-radio-inline text-center">
                            <label>
                                <div>Existing HydroShare User</div>
                                <input type="radio" name="add_contributor_user_type" value="hs_user" checked>
                            </label>
                        </div>
                    </div>

                    <div class="col-sm-2 text-center or-separator">
                        <span class="text-muted">- Or -</span>
                    </div>

                    <div class="col-sm-5 text-center">
                        <div class="radio-inline center-radio-inline text-center">
                            <label>
                                <div>Other</div>
                                <input type="radio" name="add_contributor_user_type" value="other">
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12">
                        <hr>
                    </div>
                </div>

            </div>

            {#  Existing HydroShare User  #}
            <div data-hs-user-type="hs_user">
                <div class="modal-body">
                    {{ add_view_user_form.user }}
                </div>

                <form action="/hsapi/_internal/{{ cm.short_id }}/contributor/add-metadata/" method="POST"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-body" style="display:none;">
                        <div class="form-group">
                            <fieldset>
                                <div id="div_id_name" class="control-group">
                                    <label for="id_name" class="control-label requiredField">Name<span
                                            class="asteriskField">*</span></label>

                                    <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                 id="id_name" maxlength="100" name="name"
                                                                 required="required" type="text"></div>
                                </div>

                                <div id="div_id_description" class="control-group">
                                    <label for="id_description" class="control-label">HydroShare User Identifier
                                        (URL)</label>
                                    <div class="controls"><input class="form-control input-sm urlinput"
                                                                 id="id_description" maxlength="200"
                                                                 name="description" type="url"></div>
                                </div>

                                <div id="div_id_organization" class="control-group">
                                    <label for="id_organization" class="control-label">Organization</label>
                                    <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                 id="id_organization" maxlength="200"
                                                                 name="organization" type="text"></div>
                                </div>

                                <div id="div_id_email" class="control-group">
                                    <label for="id_email" class="control-label">Email</label>

                                    <div class="controls">
                                        <input class="form-control input-sm emailinput"
                                               id="id_email" maxlength="75" name="email"
                                               type="email">
                                    </div>
                                </div>

                                <div id="div_id_address" class="control-group">
                                    <label for="id_address" class="control-label">Address</label>
                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_address" maxlength="250" name="address"
                                               type="text">
                                    </div>
                                </div>

                                <div id="div_id_phone" class="control-group">
                                    <label for="id_phone" class="control-label">Phone</label>
                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_phone" maxlength="25" name="phone"
                                               type="text">
                                    </div>
                                </div>

                                <div id="div_id_homepage" class="control-group">
                                    <label for="id_homepage" class="control-label">Homepage</label>
                                    <div class="controls"><input class="form-control input-sm urlinput"
                                                                 id="id_homepage" maxlength="200" name="homepage"
                                                                 type="url"></div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary"
                           onclick="get_user_info_ajax_submit('/hsapi/_internal/get-user-or-group-data/', this)">Save Changes</button>
                    </div>
                </form>
            </div>

            {#  Other  #}
            <div data-hs-user-type="other" style="display:none">
                <form action="/hsapi/_internal/{{ cm.short_id }}/contributor/add-metadata/" method="POST"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-body">
                        <div class="form-group">
                            <fieldset>
                                <div id="div_id_name" class="control-group">
                                    <label for="id_name" class="control-label requiredField">Name<span
                                            class="asteriskField">*</span></label>

                                    <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                 id="id_name" maxlength="100" name="name"
                                                                 required="required" type="text"></div>
                                </div>

                                <div id="div_id_organization" class="control-group">
                                    <label for="id_organization" class="control-label">Organization</label>
                                    <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                 id="id_organization" maxlength="200"
                                                                 name="organization" type="text"></div>
                                </div>
                                <div id="div_id_email" class="control-group">
                                    <label for="id_email" class="control-label">Email</label>

                                    <div class="controls">
                                        <input class="form-control input-sm emailinput"
                                               id="id_email" maxlength="75" name="email"
                                               type="email">
                                    </div>
                                </div>
                                <div id="div_id_address" class="control-group">
                                    <label for="id_address" class="control-label">Address</label>
                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_address" maxlength="250" name="address"
                                               type="text">
                                    </div>
                                </div>
                                <div id="div_id_phone" class="control-group">
                                    <label for="id_phone" class="control-label">Phone</label>
                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_phone" maxlength="25" name="phone"
                                               type="text">
                                    </div>
                                </div>
                                <div id="div_id_homepage" class="control-group">
                                    <label for="id_homepage" class="control-label">Homepage</label>
                                    <div class="controls"><input class="form-control input-sm urlinput"
                                                                 id="id_homepage" maxlength="200" name="homepage"
                                                                 type="url"></div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="extraMetaDialog" tabindex="-1" role="dialog" aria-labelledby="add-extra-meta" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form enctype="multipart/form-data">
                <input name="resource-mode" type="hidden" value="edit">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="extra_meta_title"> Add/Edit Extended Metadata </h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <input id="edit_extra_meta_row_id" type="hidden" />
                        <input id="old_extra_meta_name" type="hidden" />
                        <div id="div_extra_meta_name" class="control-group">
                            <label for="extra_meta_name" class="control-label requiredField">Name</label>
                            <div class="controls">
                                <input class="form-control input-sm textinput textInput" id="extra_meta_name_input" maxlength="100" name="name" type="text">
                            </div>
                        </div>
                        <div id="div_extra_meta_value" class="control-group">
                            <label for="extra_meta_value" class="control-label">Value</label>
                            <div class="controls">
                                <textarea class="form-control input-sm textarea" cols="40"
                                                    id="extra_meta_value_input" name="value"
                                                    rows="10"></textarea>
                            </div>
                        </div>
                        <div id="extra_meta_msg" style="display: None"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addEditExtraMeta2Table()">OK</button>
                </div>
            </form>
        </div>
    </div>
</div>

 {% if show_manage_access %}
    {#======= Manage access modal window begins =======#}
    <div class="modal fade" id="manage-access">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Manage access</h4>
                </div>

                <div class="modal-body first-modal">
                    <div class="alert alert-info" role="alert">



                        <p><span class="glyphicon glyphicon-info-sign" aria-hidden="true" data-toggle="collapse" data-target="#usage-info">&nbsp;</span>Use this window to share your resource with specific HydroShare users. You can give other
                            users the ability to view or edit this resource. You can also add additional owners who
                            will
                            have full permissions.</p>

                        <p><a href="#" data-toggle="collapse" data-target="#usage-info">Show more/less</a></p>

                        <div id="usage-info" class="collapse">
                            <ul>
                                <li>
                                    <p><strong>Owners</strong> can perform all operations on a resource and set whether
                                        a
                                        resource is Public,
                                        Discoverable, or Private and Shareable. Resources that are Public have all their
                                        content
                                        visible to all users. Resources that are Discoverable have only their metadata
                                        public.
                                        Resources that are private are only accessible to specific users or groups that
                                        they
                                        have
                                        been shared with.</p>
                                </li>
                                <li>
                                    <p><strong>Editors</strong> can edit resource metadata and add and delete resource
                                        content files. If the resource
                                        is Shareable editors can use manage access to extend editing or viewing access
                                        to
                                        other
                                        users.</p>
                                </li>
                                <li><p><strong>Viewers</strong> can view resource metadata and download resource content
                                    files. If the resource is
                                    Shareable viewers can use manage access to extend viewing access to other users.</p>
                                </li>
                            </ul>
                        </div>


                    </div>

                    <p>Who has access</p>
                    <table class="table access-table">
                        <tbody>
                            {# Empty row used as template to generate subsequent rows #}
                            <tr id="templateRow">
                                <td>
                                    <div class="profile-pic-thumbnail round-image user-icon"></div>
                                    <div class="user-scope">
                                        <div class="group-image-wrapper extra-small">
                                            <div class="group-image-extra-small group-preview-image-default"
                                                 style="background-image: url({{ STATIC_URL }}img/home-page/step4.png)"></div>
                                        </div>
                                        <span data-col="name" class="user-name"></span>
                                        <span class="text-muted you-flag">(You)</span>
                                        <br>
                                        <span data-col="user-name"
                                              class="user-username-content"></span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li data-access-type="Can view">
                                                <form class="share-form-view" data-access-type="Can view"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a>Can view</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Can edit">
                                                <form class="share-form-edit" data-access-type="Can edit"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a>Can edit</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Is owner">
                                                <form class="share-form-owner" data-access-type="Is owner"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a>Is owner</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>

                                <td class="user-actions">
                                    <form class="remove-user-form" method="POST">
                                        {% csrf_token %}
                                        <span class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>

                            {# Owners with full permissions to do anything on this resource #}
                            {% for u in owners %}
                            <tr id="row-id-{{ u.pk }}" {% if owners|length == 1 or not is_owner_user %}class="hide-actions"{% endif %}>
                                <td>
                                    <div class="user-scope">

                                        {% if u.userprofile.picture %}
                                            <div style="background-image: url('{{ u.userprofile.picture.url }}');"
                                            class="profile-pic-thumbnail round-image"></div>
                                        {% else %}
                                             <div class="profile-pic-thumbnail round-image user-icon"></div>
                                        {% endif %}

                                        <span data-col="name"
                                              class="user-name">{{ u|best_name }}</span>
                                        {% if u.pk == current_user.pk %}
                                            <span class="text-muted you-flag">(You)</span>
                                        {% endif %}
                                        <br>
                                        <span data-col="user-name"
                                              class="user-username-content">{{ u.username }}</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                        <span class="dropdown role-dropdown">
                                            <span class="dropdown-toggle" data-col="current-access"
                                                  id="roles-menu"
                                                  data-toggle="dropdown"
                                                  aria-haspopup="true" aria-expanded="true">
                                                Is owner
                                                <span class="caret"></span>
                                            </span>
                                            <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                                <li data-access-type="Can view">
                                                    <form id="share-view-{{ u.pk }}"
                                                          class="share-form-view"
                                                          data-access-type="Can view"
                                                          action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/view/{{ u.pk }}/"
                                                          method="POST">
                                                        {% csrf_token %}
                                                        <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can
                                                            view</a>
                                                    </form>
                                                </li>
                                                <li data-access-type="Can edit">
                                                    <form id="share-edit-{{ u.pk }}"
                                                          class="share-form-edit"
                                                          data-access-type="Can edit"
                                                          action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/edit/{{ u.pk }}/"
                                                          method="POST">
                                                        {% csrf_token %}
                                                        <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can
                                                            edit</a>
                                                    </form>
                                                </li>
                                                <li class="active {% if not can_change_resource_flags %}disabled{% endif %}" data-access-type="Is owner">
                                                    <form id="share-owner-{{ u.pk }}"
                                                          class="share-form-owner"
                                                          data-access-type="Is owner"
                                                          action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/owner/{{ u.pk }}/"
                                                          method="POST">
                                                        {% csrf_token %}
                                                        <a onclick="change_share_permission_ajax_submit('share-owner-{{ u.pk }}')">Is
                                                            owner</a>
                                                    </form>
                                                </li>
                                            </ul>
                                        </span>
                                </td>

                                <td class="user-actions">
                                    <form id="form-remove-user-{{ u.pk }}"
                                          class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-user/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-user-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {# Users who can edit the content of this resource #}
                            {% for u in edit_users %}
                            <tr id="row-id-{{ u.pk }}">
                                <td>
                                    <div class="user-scope">
                                        <div
                                        {% if u.userprofile.picture %}
                                            style="background-image: url('{{ u.userprofile.picture.url }}');"
                                            class="profile-pic-thumbnail round-image"
                                        {% else %}
                                             class="profile-pic-thumbnail round-image user-icon"
                                        {% endif %}
                                        >
                                        </div>
                                        <span value="{{ u.pk }}" class="user-name">{{ u|best_name }}</span>
                                        {% if u.pk == current_user.pk %}
                                            <span class="text-muted">(You)</span>
                                        {% endif %}
                                        <br>
                                        <span class="user-username-content">{{ u.username }}</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            Can edit
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li data-access-type="Can view">
                                                <form id="share-view-{{ u.pk }}" class="share-form-view" data-access-type="Can view"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/view/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can view</a>
                                                </form>
                                            </li>
                                            <li class="active" data-access-type="Can edit" {% if not is_owner_user and not is_edit_user %}class="disabled"{% endif %}>
                                                <form id="share-edit-{{ u.pk }}" class="share-form-edit" data-access-type="Can edit"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/edit/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can edit</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Is owner" {% if not is_owner_user %}class="disabled"{% endif %}>
                                                <form id="share-owner-{{ u.pk }}" class="share-form-owner" data-access-type="Is owner"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/owner/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-owner-{{ u.pk }}')">Is owner</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>
                                <td class="user-actions">
                                    <form id="form-remove-user-{{ u.pk }}" class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-user/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-user-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {# Groups who can edit the content of this resource #}
                            {% for u in edit_groups %}
                            <tr id="row-id-{{ u.pk }}">
                                <td>
                                    <div class="user-scope">
                                        <div class="group-image-wrapper extra-small">
                                            {% if u.gaccess.picture and u.gaccess.picture.url %}
                                                <div class="group-image-extra-small group-preview-image-default"
                                                 style="background-image: url({{ u.gaccess.picture.url }})"></div>
                                            {% else %}
                                                <div class="group-image-extra-small group-preview-image-default"
                                                 style="background-image: url({{ STATIC_URL }}img/home-page/step4.png)"></div>
                                            {% endif %}
                                        </div>
                                        <span value="{{ u.pk }}" class="user-name">{{ u.name }}</span>
                                        <br>
                                        <span class="user-username-content">(Group)</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            Can edit
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li data-access-type="Can view">
                                                <form id="share-view-{{ u.pk }}" class="share-form-view" data-access-type="Can view"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-group/view/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can view</a>
                                                </form>
                                            </li>
                                            <li class="active" data-access-type="Can edit" {% if not is_owner_user and not is_edit_user %}class="disabled"{% endif %}>
                                                <form id="share-edit-{{ u.pk }}" class="share-form-edit" data-access-type="Can edit"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-group/edit/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can edit</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>
                                <td class="user-actions">
                                    <form id="form-remove-group-{{ u.pk }}" class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-group/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-group-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {# Users who can view the content of this resource #}
                            {% for u in view_groups %}
                            <tr id="row-id-{{ u.pk }}">
                                <td>
                                    <div class="user-scope">
                                        <div class="group-image-wrapper extra-small">
                                            {% if u.gaccess.picture and u.gaccess.picture.url %}
                                                <div class="group-image-extra-small group-preview-image-default"
                                                     style="background-image: url({{ u.gaccess.picture.url }})"></div>
                                            {% else %}
                                                <div class="group-image-extra-small group-preview-image-default"
                                                     style="background-image: url({{ STATIC_URL }}img/home-page/step4.png)"></div>
                                            {% endif %}
                                        </div>
                                        <span value="{{ u.pk }}" class="user-name">{{ u.name }}</span>
                                        <br>
                                        <span class="user-username-content">(Group)</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            Can view
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li class="active"  data-access-type="Can view">
                                                <form id="share-view-{{ u.pk }}" class="share-form-view" data-access-type="Can view"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-group/view/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can view</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Can edit" {% if not is_owner_user and not is_edit_user %}class="disabled"{% endif %}>
                                                <form id="share-edit-{{ u.pk }}" class="share-form-edit" data-access-type="Can edit"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-group/edit/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can edit</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>
                                <td class="user-actions">
                                    <form id="form-remove-group-{{ u.pk }}" class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-group/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-group-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {# Users who can view the content of this resource #}
                            {% for u in view_users %}
                            <tr id="row-id-{{ u.pk }}">
                                <td>
                                    <div class="user-scope">
                                        <div
                                            {% if u.userprofile.picture %}
                                                style="background-image: url('{{ u.userprofile.picture.url }}');"
                                                class="profile-pic-thumbnail round-image"
                                            {% else %}
                                                class="profile-pic-thumbnail round-image user-icon"
                                            {% endif %}
                                            >
                                        </div>
                                        <span value="{{ u.pk }}" class="user-name">{{ u|best_name }}</span>
                                        {% if u.pk == current_user.pk %}
                                            <span class="text-muted">(You)</span>
                                        {% endif %}
                                        <br>
                                        <span class="user-username-content">{{ u.username }}</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            Can view
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li class="active" data-access-type="Can view">
                                                <form id="share-view-{{ u.pk }}" class="share-form-view" data-access-type="Can view"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/view/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can view</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Can edit" {% if not is_owner_user and not is_edit_user %}class="disabled"{% endif %}>
                                                <form id="share-edit-{{ u.pk }}" class="share-form-edit" data-access-type="Can edit"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/edit/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can edit</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Is owner" {% if not is_owner_user %}class="disabled"{% endif %}>
                                                <form id="share-owner-{{ u.pk }}" class="share-form-owner" data-access-type="Is owner"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/owner/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-owner-{{ u.pk }}')">Is owner</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>

                                <td class="user-actions">
                                    <form id="form-remove-user-{{ u.pk }}" class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-user/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-user-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="modal-body">
                    <div id="div-invite-people">
                        <span>Invite:</span>

                        <div id="invite-flag" class="btn-group" role="group" aria-label="Share with users or groups">
                            <button type="button" class="btn btn-primary" data-value="users">Users</button>
                            <button type="button" class="btn btn-default" data-value="groups">Groups</button>
                        </div>

                        <div class="input-group" style="width:100%">
                            <form id="add-access-form" action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/"
                                  method="POST">
                                {% csrf_token %}

                                <div class="row">
                                    <div class="add-view-user-form col-xs-12 col-sm-6">
                                        {{ add_view_user_form.user }}
                                    </div>

                                    <div class="add-view-group-form col-xs-12 col-sm-6">
                                        {{ add_view_group_form.group }}
                                    </div>

                                    <div class="col-xs-12 col-sm-6">
                                        <div class="row">
                                            <div class="col-xs-6">
                                                <div class="dropdown custom-dropdown">
                                                    <button class="btn btn-default dropdown-toggle" type="button"
                                                            id="roles_list" data-toggle="dropdown"
                                                            aria-haspopup="true">
                                                        <span id="selected_role" data-role="view">Can view</span>
                                                        <span class="caret"></span>
                                                    </button>

                                                    <ul id="list-roles" class="dropdown-menu"
                                                        aria-labelledby="roles_list">
                                                        <li {% if not is_view_user and not is_edit_user and not is_owner_user %}class="disabled"{% endif %}>
                                                            <a data-role="view">Can view</a></li>
                                                        <li {% if not is_edit_user and not is_owner_user %}class="disabled"{% endif %}>
                                                            <a data-role="edit">Can edit</a></li>
                                                        <li {% if not is_owner_user %}class="disabled"{% endif %}><a
                                                                data-role="owner">Is owner</a></li>
                                                    </ul>
                                                </div>
                                            </div>


                                            <div class="col-xs-6">
                                                <a id="btn-invite"
                                                   onclick="share_resource_ajax_submit('add-access-form'); return false;"
                                                   class="btn btn-add-access btn-success glyphicon glyphicon-plus"><span
                                                        class="button-label">&nbspAdd</span></a>
                                            </div>

                                        </div>

                                    </div>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <a type="button" data-dismiss="modal" class="btn btn-primary">Close</a>
                </div>
            </div>
        </div>
    </div>
{#======= Manage access modal  window ends =======#}
{% endif %}

<!-- Add credit source Modal -->
<div class="modal fade" id="add-funding-agency" tabindex="-1" role="dialog" aria-labelledby="add-funding-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/fundingagency/add-metadata/" method="POST"
                  enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="add-funding-label"> Add Funding Agency</h4></div>
                <div class="modal-body">
                    <div class="form-group">
                        <fieldset>
                            {# Agency Name (Required) #}
                            <div id="div_id_agency_name" class="control-group">
                                <label for="agency_name" class="control-label requiredField">Agency Name<span class="asteriskField">*</span></label>

                                <div class="controls"><input class="form-control input-sm textInput" maxlength="250" name="agency_name"
                                                             required="required" type="text"></div>
                            </div>

                            {# Award Title #}
                            <div id="div_id_award_title" class="control-group">
                                <label for="award_title" class="control-label">Award Title</label>
                                <div class="controls"><input class="form-control input-sm" maxlength="250"
                                                             name="award_title"></div>
                            </div>

                            {# Award Number #}
                            <div id="div_id_award_number" class="control-group">
                                <label for="award_number" class="control-label">Award Number</label>
                                <div class="controls"><input class="form-control input-sm textinput textInput" maxlength="100"
                                                             name="award_number" type="text"></div>
                            </div>

                            {# Agency URL #}
                            <div id="div_id_agency_url" class="control-group">
                                <label for="agency_url" class="control-label">Agency URL</label>

                                <div class="controls">
                                    <input class="form-control input-sm urlinput" maxlength="200"
                                                             name="agency_url" type="url">
                                </div>
                            </div>

                        </fieldset>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary btn-save-funding-agency">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% for agency in fundingagnency_formset.initial %}
    <!-- Edit credit source Modal -->
    <div class="modal fade" id="edit-funding-agency-{{ agency.id }}" tabindex="-1" role="dialog"
         aria-labelledby="add-funding-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form data-index="{{ forloop.counter0 }}" action="/hsapi/_internal/{{ cm.short_id }}/fundingagency/{{ agency.id }}/update-metadata/"
                      method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="add-funding-label"> Edit Funding Agency</h4>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <fieldset>
                                {# Agency Name (Required) #}
                                <div id="div_id_agency_name" class="control-group">
                                    <label for="agency_name" class="control-label requiredField">Agency Name<span
                                            class="asteriskField">*</span></label>

                                    <div class="controls"><input class="form-control input-sm textInput" maxlength="250" name="agency_name"
                                                                 required="required" type="text"
                                                                 value="{{ agency.agency_name }}"></div>
                                </div>

                                {# Award Title #}
                                <div id="div_id_award_title" class="control-group">
                                    <label for="award_title" class="control-label">Award Title</label>

                                    <div class="controls"><input class="form-control input-sm" maxlength="250"
                                                                 name="award_title" value="{{ agency.award_title }}">
                                    </div>
                                </div>

                                {# Award Number #}
                                <div id="div_id_award_number" class="control-group">
                                    <label for="award_number" class="control-label">Award Number</label>

                                    <div class="controls"><input class="form-control input-sm textinput textInput" maxlength="100"
                                                                 name="award_number" type="text"
                                                                 value="{{ agency.award_number }}"></div>
                                </div>

                                {# Agency URL #}
                                <div id="div_id_agency_url" class="control-group">
                                    <label for="agency_url" class="control-label">Agency URL</label>

                                    <div class="controls">
                                        <input class="form-control input-sm urlinput" maxlength="200"
                                               name="agency_url" type="url" value="{{ agency.agency_url }}">
                                    </div>
                                </div>

                            </fieldset>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-save-funding-agency" data-index="{{ forloop.counter0 }}">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="delete-funding-agency-{{ agency.id }}" tabindex="-1" role="dialog"
         aria-labelledby="delete-source" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="delete-funding-agency">Delete Funding Agency</h4>
                </div>

                <div class="modal-body"><strong>Are you sure you want to delete this entry?</strong></div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger"
                       href="/hsapi/_internal/{{ cm.short_id }}/fundingagency/{{ agency.id }}/delete-metadata/">Delete</a>
                </div>
            </div>
        </div>
    </div>
{% endfor %}

<div class="modal fade in" id="create-folder-dialog" tabindex="-1" role="dialog"
     aria-labelledby="create-folder" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="create-folder">New Folder</h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    {# Folder Name #}
                    <fieldset class="col-sm-12">
                        <label>Folder Name *</label>
                        <input id="txtFolderName" class="form-control modal-only-required">
                    </fieldset>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="btn-create-folder" class="btn btn-primary disabled" data-dismiss="modal">Create
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="rename-dialog" tabindex="-1" role="dialog"
     aria-labelledby="rename" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="rename">Rename</h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <fieldset class="col-sm-12">
                        <label>Name *</label>
                        <div class="input-group">
                            <input id="txtName" class="form-control modal-only-required">
                            {% if cm|resource_type == "Time Series" %}
                            <span class="input-group-addon" id="file-type-addon"></span>
                            {% endif %}
                        </div>
                    </fieldset>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="btn-rename" class="btn btn-primary" data-dismiss="modal">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="zip-folder-dialog" tabindex="-1" role="dialog"
     aria-labelledby="rename" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="rename">Zip Folder</h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <fieldset class="col-sm-12">
                        <label>Name *</label>
                        <div class="input-group">
                            <input id="txtZipName" type="text" class="form-control modal-only-required" placeholder="File name"
                                   aria-describedby="file-type-addon">
                            <span class="input-group-addon">.zip</span>
                        </div>
                    </fieldset>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="btn-confirm-zip" class="btn btn-primary" data-dismiss="modal">Confirm</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade in" id="get-file-url-dialog" tabindex="-1" role="dialog"
     aria-labelledby="rename" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Get file URL</h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <fieldset class="col-sm-12">
                        <div class="input-group">
                            <input readonly id="txtFileURL" type="text" class="form-control click-select-all">
                            <span class="input-group-addon"><span class="fa fa-link"></span></span>
                        </div>
                    </fieldset>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" id="btn-confirm-zip" class="btn btn-default" data-dismiss="modal">Dismiss</button>
            </div>
        </div>
    </div>
</div>


{% block extra_js %}
    <script type="text/javascript">
        function rep_res_to_irods_user_zone_ajax_submit(res_id) {
            setPointerEvents(false);
            $.ajax({
                url: "/hsapi/_internal/" + res_id + "/rep-res-bag-to-irods-user-zone/",
                type: "POST",
                data: {},
                success: function(json) {
                    if (json.success) {
                        $("#rep-alert-success").show();
                        $("#rep-status-success").text(json.success);
                    }
                    if (json.error) {
                        $("#rep-alert-error").show();
                        $("#rep-status-error").text(json.error);
                    }
                    $('#rep-resource-to-irods-dialog').modal('hide');
                },
                error: function(xhr, errmsg, err) {
                    status_error = xhr.status + ": " + xhr.responseText + ". Error message: " + errmsg;
                    console.log(status_error);
                    $("#rep-status-error").text(status_error);
                    $('#rep-resource-to-irods-dialog').modal('hide');
                }
            });
        }
    </script>
{% endblock %}
