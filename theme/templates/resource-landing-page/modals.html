{% load crispy_forms_tags hydroshare_tags %}

{% for source in source_formset.initial %}
<div class="modal fade in" id="delete-source-element-dialog{{ source.id }}" tabindex="-1" role="dialog"
     aria-labelledby="delete-source" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="delete-source">Delete metadata element</h4></div>
            <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/source/{{ source.id }}/delete-metadata/">Delete</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="edit-source-dialog{{ source.id }}" tabindex="-1" role="dialog" aria-labelledby="edit-source"
     aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="id_source_{{ source.id }}" action="/hsapi/_internal/{{ cm.short_id }}/source/{{ source.id }}/update-metadata/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="edit-source"> Edit Source </h4></div>
                <div class="modal-body">
                    {% csrf_token %}
                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <legend>Source</legend>
                            <div id="div_id_derived_from" class="control-group">
                                <label for="id_derived_from" class="control-label requiredField">
                                Derived from<span class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_source-{{ forloop.counter0 }}-derived_from" maxlength="300" name="source-{{ forloop.counter0 }}-derived_from"
                                        type="text" value="{{ source.derived_from }}"></div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

{% for relation in relation_formset.initial %}
<div class="modal fade in" id="delete-relation-element-dialog{{ relation.id }}" tabindex="-1" role="dialog"
     aria-labelledby="delete-relation" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="delete-relation">Delete metadata element</h4></div>
            <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/relation/{{ relation.id }}/delete-metadata/">Delete</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="edit-relation-dialog_{{ relation.id }}" tabindex="-1" role="dialog"
     aria-labelledby="edit-relation" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/relation/{{ relation.id }}/update-metadata/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="edit-relation"> Edit Relation </h4></div>
                <div class="modal-body">
                    {% csrf_token %}

                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <legend>Relation</legend>
                            <div id="div_id_type" class="control-group">
                                <label for="id_type" class="control-label requiredField">
                                Relation type<span class="asteriskField">*</span></label>

                                <div class="controls">
                                    <select class="form-control input-sm select" id="id_relation-{{ forloop.counter0 }}-type" name="relation-{{ forloop.counter0 }}-type">
                                        <option value="">---------</option>
                                        {% for type_value, type_display in relation_source_types %}
                                            <option value={{ type_value }} {% if relation.type == type_value %}selected="selected"{% endif %}>{{ type_display }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div id="div_id_value" class="control-group">
                                <label for="id_value" class="control-label requiredField">
                                Related to<span class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput" id="id_relation-{{ forloop.counter0 }}-value"
                                        maxlength="500" name="relation-{{ forloop.counter0 }}-value" type="text"
                                        value="{{ relation.value }}"></div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

{% for contributor in contributor_formset.initial %}
<div class="modal fade" id="edit-contributor-dialog{{ contributor.id }}" tabindex="-1" role="dialog"
     aria-labelledby="edit-contributor" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="id_contributor_{{ contributor.id }}" action="/hsapi/_internal/{{ cm.short_id }}/contributor/{{ contributor.id }}/update-metadata/"
                  method="POST"
                  enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">×
                    </button>
                    <h4 class="modal-title" id="edit-contributor"> Edit contributor </h4></div>
                <div class="modal-body">
                    {% csrf_token %}
                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <div id="div_id_name" class="control-group">
                                <label class="control-label requiredField">Name<span
                                        class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_contributor-{{ contributor.order|add:"- 1" }}-name" maxlength="100" name="contributor-{{ contributor.order|add:"- 1" }}-name"
                                        required="required" type="text" value="{% if contributor.name %}{{ contributor.name }}{% endif %}"></div>
                            </div>
                            <div id="div_id_description" class="control-group">
                                <label class="control-label">HydroShare User Identifier (URL)</label>

                                <div class="controls"><input
                                        class="form-control input-sm urlinput"
                                        id="id_contributor-{{ contributor.order|add:"- 1" }}-description" maxlength="200"
                                        name="contributor-{{ contributor.order|add:"- 1" }}-description" type="url"
                                        value="{% if contributor.description %}{{ contributor.description }}{% endif %}"
                                        {% if contributor.description %} readonly {% endif %}></div>
                            </div>
                            <div id="div_id_organization" class="control-group">
                                <label class="control-label">Organization</label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_contributor-{{ contributor.order|add:"- 1" }}-organization" maxlength="200"
                                        name="contributor-{{ contributor.order|add:"- 1" }}-organization" type="text" value="{% if contributor.organization %}{{ contributor.organization }}{% endif %}"></div>
                            </div>
                            <div id="div_id_email" class="control-group">
                                <label class="control-label">Email</label>

                                <div class="controls">
                                    <input class="form-control input-sm emailinput"
                                           id="id_contributor-{{ contributor.order|add:"- 1" }}-email" maxlength="75" name="contributor-{{ contributor.order|add:"- 1" }}-email"
                                           type="email" value="{% if contributor.email %}{{ contributor.email }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_address" class="control-group">
                                <label class="control-label">Address</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                           id="id_contributor-{{ contributor.order|add:"- 1" }}-address" maxlength="250"
                                           name="contributor-{{ contributor.order|add:"- 1" }}-address"
                                           type="text" value="{% if contributor.address %}{{ contributor.address }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_phone" class="control-group">
                                <label class="control-label">Phone</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                           id="id_contributor-{{ contributor.order|add:"- 1" }}-phone" maxlength="25" name="contributor-{{ contributor.order|add:"- 1" }}-phone"
                                           type="text" value="{% if contributor.phone %}{{ contributor.phone }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_homepage" class="control-group">
                                <label class="control-label">Homepage</label>

                                <div class="controls"><input
                                        class="form-control input-sm urlinput"
                                        id="id_contributor-{{ contributor.order|add:"- 1" }}-homepage" maxlength="200" name="contributor-{{ contributor.order|add:"- 1" }}-homepage"
                                        type="url" value="{% if contributor.homepage %}{{ contributor.homepage }}{% endif %}"></div>
                            </div>

                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="delete-contributor-dialog{{ contributor.id }}" tabindex="-1" role="dialog"
     aria-labelledby="delete-contributor" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="delete-contributor">Delete metadata element</h4></div>
            <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/contributor/{{ contributor.id }}/delete-metadata/">Delete</a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% for author in creator_formset.initial %}
<div class="modal fade" id="edit-creator-dialog{{ author.id }}" tabindex="-1" role="dialog"
     aria-labelledby="edit-creator" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="id_creator_{{ author.id }}" action="/hsapi/_internal/{{ cm.short_id }}/creator/{{ author.id }}/update-metadata/"
                  method="POST"
                  enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">×
                    </button>
                    <h4 class="modal-title" id="edit-creator"> Edit author </h4></div>
                <div class="modal-body">
                    {% csrf_token %}
                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <div id="div_id_name" class="control-group">
                                <label class="control-label requiredField">Name<span
                                        class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-name" maxlength="100" name="creator-{{ author.order|add:"- 1" }}-name"
                                        required="required" type="text" value="{% if author.name %}{{ author.name }}{% endif %}"></div>
                            </div>
                            <div id="div_id_description" class="control-group">
                                <label class="control-label">HydroShare User Identifier (URL)</label>

                                <div class="controls"><input
                                        class="form-control input-sm urlinput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-description" maxlength="200"
                                        name="creator-{{ author.order|add:"- 1" }}-description" type="url"
                                        value="{% if author.description %}{{ author.description }}{% endif %}"
                                        {% if author.description %} readonly {% endif %}></div>
                            </div>
                            <div id="div_id_organization" class="control-group">
                                <label class="control-label">Organization</label>

                                <div class="controls"><input
                                        class="form-control input-sm textinput textInput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-organization" maxlength="200"
                                        name="creator-{{ author.order|add:"- 1" }}-organization" type="text" value="{% if author.organization %}{{ author.organization }}{% endif %}"></div>
                            </div>
                            <div id="div_id_email" class="control-group">
                                <label class="control-label">Email</label>

                                <div class="controls">
                                    <input class="form-control input-sm emailinput"
                                           id="id_creator-{{ author.order|add:"- 1" }}-email" maxlength="75" name="creator-{{ author.order|add:"- 1" }}-email"
                                           type="email" value="{% if author.email %}{{ author.email }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_address" class="control-group">
                                <label class="control-label">Address</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                           id="id_creator-{{ author.order|add:"- 1" }}-address" maxlength="250"
                                           name="creator-{{ author.order|add:"- 1" }}-address"
                                           type="text" value="{% if author.address %}{{ author.address }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_phone" class="control-group">
                                <label class="control-label">Phone</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                           id="id_creator-{{ author.order|add:"- 1" }}-phone" maxlength="25" name="creator-{{ author.order|add:"- 1" }}-phone"
                                           type="text" value="{% if author.phone %}{{ author.phone }}{% endif %}">
                                </div>
                            </div>
                            <div id="div_id_homepage" class="control-group">
                                <label class="control-label">Homepage</label>

                                <div class="controls"><input
                                        class="form-control input-sm urlinput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-homepage" maxlength="200" name="creator-{{ author.order|add:"- 1" }}-homepage"
                                        type="url" value="{% if author.homepage %}{{ author.homepage }}{% endif %}"></div>
                            </div>
                            <div id="div_id_order" class="control-group">
                                <label class="control-label">Order<span class="asteriskField">*</span></label>

                                <div class="controls"><input
                                        class="form-control input-sm urlinput"
                                        id="id_creator-{{ author.order|add:"- 1" }}-order" name="creator-{{ author.order|add:"- 1" }}-order" required="required"
                                        type="number" value="{% if author.order %}{{ author.order }}{% endif %}"></div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="delete-creator-dialog{{ author.id }}" tabindex="-1" role="dialog"
     aria-labelledby="delete-creator" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="delete-creator">Delete metadata element</h4></div>
            <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/creator/{{ author.id }}/delete-metadata/">Delete</a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% include "irods_signin.html" %}
{% include "irods_upload_add.html" %}

<div class="modal fade" id="submit-for-publication-dialog" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="submit-for-publication-title">Submit resource for publication</h4>
            </div>
            <div class="modal-body">
                <p>
                    Upon submitting the resource for publication it will be permanently published and assigned a
                    digital object identifier (DOI). This is <strong>final</strong> and changes can only be made
                    on a new version (copy) of the resource.
                </p>
                <p>
                     Please confirm that you accept the HydroShare Publication Agreement shown below.
                </p>
                <div class="iframe-border">
                    <iframe id="pub-agreement-frame" scrolling="no" src="https://www.hydroshare.org/publication-agreement/"></iframe>
                </div>
                <input type="checkbox" id="agree-chk"><label for="agree-chk" class="checkbox-label">I accept the HydroShare Publication Agreement.</label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" id="publish-btn" class="btn btn-danger" href="/hsapi/_internal/{{ cm.short_id }}/publish/" disabled>Publish</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="new-version-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="new-version-resource-title">Create New Version of This Resource</h4>
            </div>
            <div class="modal-body">
                Creating a new version will obsolete this resource. This resource will be still available in HydroShare,
                but only the newer version will be discoverable via the HydroShare search interface. A link to this
                resource will be created on the landing page of the new version. Only one newer version
                is allowed for each resource.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-danger"
                   href="/hsapi/_internal/{{ cm.short_id }}/create-new-version-resource/">Create New Version</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="add-source-dialog" tabindex="-1" role="dialog" aria-labelledby="add-source"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/source/add-metadata/" method="POST"
                  enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="add-source">Add Source</h4></div>
                <div class="modal-body">
                    {% csrf_token %}

                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <legend>Source</legend>
                            <div id="div_id_derived_from" class="control-group">
                                <label for="id_derived_from" class="control-label requiredField">Derived from<span class="asteriskField">*</span></label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                                             id="id_derived_from" maxlength="300"
                                                             name="derived_from" type="text">
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="add-relation-dialog" tabindex="-1" role="dialog" aria-labelledby="add-relation"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/relation/add-metadata/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="add-relation"> Add Relation </h4></div>
                <div class="modal-body">
                    {% csrf_token %}

                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <legend>Relation</legend>
                            <div id="div_id_type" class="control-group"><label for="id_type"
                                                                               class="control-label requiredField">
                                Relation type<span class="asteriskField">*</span></label>

                                <div class="controls"><select class="form-control input-sm select" id="id_type" name="type">
                                    <option value="" selected="selected">---------</option>
                                    {% for type_value, type_display in relation_source_types %}
                                        <option value={{ type_value }}>{{ type_display }}</option>
                                    {% endfor %}
                                </select></div>
                            </div>
                            <div id="div_id_value" class="control-group"><label for="id_value"
                                                                                class="control-label requiredField">
                                Related to<span class="asteriskField">*</span></label>

                                <div class="controls"><input class="form-control input-sm textinput textInput"
                                                             id="id_value" maxlength="500" name="value"
                                                             type="text"></div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% block modal_delete_resource %}
    <div class="modal fade" id="delete-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="delete-resource-title"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="delete-resource-title">Delete Resource</h4>
                </div>
                <div class="modal-body">
                    <strong>THIS IS A PERMANENT ACTION. </strong>
                    <ul>
                        <li>This will delete the resource file.</li>
                        <li>A copy of your resource file will not be retained by Hydroshare.</li>
                        <li>We highly recommend that you download the latest copy of your resource file before
                            confirming this action.
                        </li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger"
                       href="/hsapi/_internal/{{ cm.short_id }}/delete-resource/">Delete</a>
                </div>
            </div>
        </div>
    </div>
{%  endblock %}


<div class="modal fade" id="add-reference-dialog" tabindex="-1" role="dialog" aria-labelledby="add-reference"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/add-citation/">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="add-reference">Add reference</h4>
                </div>
                <div class="modal-body">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="add-citation-input">Citation text:</label>
                        <textarea class="form-control" name="content" id="add-citation-input" cols="30"
                                  rows="10"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="add-creator-dialog" tabindex="-1" role="dialog" aria-labelledby="add-creator" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="add-creator"> Add author </h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-5 text-center">
                        <div class="radio-inline center-radio-inline text-center">
                            <label>
                                <div>Existing HydroShare User</div>
                                <input type="radio" name="add_form_user_type" value="hs_user" checked>
                            </label>
                        </div>
                    </div>

                    <div class="col-sm-2 text-center or-separator">
                        <span class="text-muted">- Or -</span>
                    </div>

                    <div class="col-sm-5 text-center">
                        <div class="radio-inline center-radio-inline text-center">
                            <label>
                                <div>Other</div>
                                <input type="radio" name="add_form_user_type" value="other">
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div data-hs-user-type="hs_user">
                <div class="modal-body">
                    {{ add_view_user_form.user }}
                </div>


                <form action="/hsapi/_internal/{{ cm.short_id }}/creator/add-metadata/" method="POST"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-body">
                        <div class="form-group">
                            <fieldset>
                                <div id="div_id_name" class="control-group">
                                    <label for="id_name" class="control-label requiredField">Name<span
                                            class="asteriskField">*</span></label>

                                    <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                 id="id_name" maxlength="100" name="name"
                                                                 required="required" type="text"></div>
                                </div>

                                <div id="div_id_description" class="control-group">
                                    <label for="id_description" class="control-label">HydroShare User Identifier
                                        (URL)</label>
                                    <div class="controls"><input class="form-control input-sm urlinput"
                                                                 id="id_description" maxlength="200"
                                                                 name="description" type="url"></div>
                                </div>

                                <div id="div_id_organization" class="control-group">
                                    <label for="id_organization" class="control-label">Organization</label>
                                    <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                 id="id_organization" maxlength="200"
                                                                 name="organization" type="text"></div>
                                </div>

                                <div id="div_id_email" class="control-group">
                                    <label for="id_email" class="control-label">Email</label>

                                    <div class="controls">
                                        <input class="form-control input-sm emailinput"
                                               id="id_email" maxlength="75" name="email"
                                               type="email">
                                    </div>
                                </div>

                                <div id="div_id_address" class="control-group">
                                    <label for="id_address" class="control-label">Address</label>
                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_address" maxlength="250" name="address"
                                               type="text">
                                    </div>
                                </div>

                                <div id="div_id_phone" class="control-group">
                                    <label for="id_phone" class="control-label">Phone</label>
                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_phone" maxlength="25" name="phone"
                                               type="text">
                                    </div>
                                </div>

                                <div id="div_id_homepage" class="control-group">
                                    <label for="id_homepage" class="control-label">Homepage</label>
                                    <div class="controls"><input class="form-control input-sm urlinput"
                                                                 id="id_homepage" maxlength="200" name="homepage"
                                                                 type="url"></div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <a class="btn btn-primary"
                           onclick="get_user_info_ajax_submit('/hsapi/_internal/get-user-data/', this)">Add</a>
                    </div>
                </form>
            </div>


            <div data-hs-user-type="other" style="display:none">
                <form action="/hsapi/_internal/{{ cm.short_id }}/creator/add-metadata/" method="POST"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-body">
                        {% csrf_token %}
                        <div class="form-group">
                            {% csrf_token %}
                            <fieldset>
                                <div id="div_id_name" class="control-group">
                                    <label for="id_name" class="control-label requiredField">Name<span
                                            class="asteriskField">*</span></label>

                                    <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                 id="id_name" maxlength="100" name="name"
                                                                 required="required" type="text"></div>
                                </div>

                                <div id="div_id_description" class="control-group">
                                    <label for="id_description" class="control-label">HydroShare User Identifier
                                        (URL)</label>
                                    <div class="controls"><input class="form-control input-sm urlinput"
                                                                 id="id_description" maxlength="200"
                                                                 name="description" type="url"></div>
                                </div>

                                <div id="div_id_organization" class="control-group">
                                    <label for="id_organization" class="control-label">Organization</label>
                                    <div class="controls"><input class="form-control input-sm textinput textInput"
                                                                 id="id_organization" maxlength="200"
                                                                 name="organization" type="text"></div>
                                </div>
                                <div id="div_id_email" class="control-group">
                                    <label for="id_email" class="control-label">Email</label>

                                    <div class="controls">
                                        <input class="form-control input-sm emailinput"
                                               id="id_email" maxlength="75" name="email"
                                               type="email">
                                    </div>
                                </div>
                                <div id="div_id_address" class="control-group">
                                    <label for="id_address" class="control-label">Address</label>
                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_address" maxlength="250" name="address"
                                               type="text">
                                    </div>
                                </div>
                                <div id="div_id_phone" class="control-group">
                                    <label for="id_phone" class="control-label">Phone</label>
                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_phone" maxlength="25" name="phone"
                                               type="text">
                                    </div>
                                </div>
                                <div id="div_id_homepage" class="control-group">
                                    <label for="id_homepage" class="control-label">Homepage</label>
                                    <div class="controls"><input class="form-control input-sm urlinput"
                                                                 id="id_homepage" maxlength="200" name="homepage"
                                                                 type="url"></div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="add-contributor-dialog" tabindex="-1" role="dialog"
     aria-labelledby="add-contributor" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/contributor/add-metadata/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="add-contributor"> Add Contributor </h4></div>
                <div class="modal-body">
                    {% csrf_token %}
                    <div class="form-group">
                        {% csrf_token %}
                        <fieldset>
                            <div id="div_id_name" class="control-group">
                                <label for="id_name" class="control-label requiredField">Name<span class="asteriskField">*</span></label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                                             id="id_name" maxlength="100" name="name"
                                                             type="text">
                                </div>
                            </div>
                            <div id="div_id_description" class="control-group">
                                <label for="id_description" class="control-label">HydroShare User Identifier (URL)</label>

                                <div class="controls">
                                    <input class="form-control input-sm urlinput"
                                                             id="id_description" maxlength="200"
                                                             name="description" type="url">
                                </div>
                            </div>
                            <div id="div_id_organization" class="control-group">
                                <label for="id_organization" class="control-label">Organization</label>

                                <div class="controls"><input class="form-control input-sm textinput textInput"
                                                             id="id_organization" maxlength="200"
                                                             name="organization" type="text">
                                </div>
                            </div>
                            <div id="div_id_email" class="control-group">
                                <label for="id_email" class="control-label">Email</label>

                                <div class="controls">
                                    <input class="form-control input-sm emailinput"
                                                             id="id_email" maxlength="75" name="email"
                                                             type="email">
                                </div>
                            </div>
                            <div id="div_id_address" class="control-group">
                                <label for="id_address" class="control-label">Address</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                                             id="id_address" maxlength="250" name="address"
                                                             type="text">
                                </div>
                            </div>
                            <div id="div_id_phone" class="control-group">
                                <label for="id_phone" class="control-label">Phone</label>

                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput"
                                                             id="id_phone" maxlength="25" name="phone"
                                                             type="text">
                                </div>
                            </div>
                            <div id="div_id_homepage" class="control-group">
                                <label for="id_homepage" class="control-label">Homepage</label>

                                <div class="controls">
                                    <input class="form-control input-sm urlinput"
                                                             id="id_homepage" maxlength="200" name="homepage"
                                                             type="url">
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade in" id="extraMetaDialog" tabindex="-1" role="dialog" aria-labelledby="add-extra-meta" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form enctype="multipart/form-data">
                <input name="resource-mode" type="hidden" value="edit">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="extra_meta_title"> Add/Edit Extended Metadata </h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <input id="edit_extra_meta_row_id" type="hidden" />
                        <input id="old_extra_meta_name" type="hidden" />
                        <div id="div_extra_meta_name" class="control-group">
                            <label for="extra_meta_name" class="control-label requiredField">Name</label>
                            <div class="controls">
                                <input class="form-control input-sm textinput textInput" id="extra_meta_name_input" maxlength="100" name="name" type="text">
                            </div>
                        </div>
                        <div id="div_extra_meta_value" class="control-group">
                            <label for="extra_meta_value" class="control-label">Value</label>
                            <div class="controls">
                                <input class="form-control input-sm urlinput" id="extra_meta_value_input" maxlength="100" name="value" type="text">
                            </div>
                        </div>
                        <div id="extra_meta_msg" style="display: None"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addEditExtraMeta2Table()">OK</button>
                </div>
            </form>
        </div>
    </div>
</div>

 {% if show_manage_access %}
    {#======= Manage access modal window begins =======#}
    <div class="modal fade" id="manage-access">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Manage access</h4>
                </div>

                <div class="modal-body first-modal">
                    <div class="alert alert-info" role="alert">
                        <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
                        <span>Use this window to share your resource with specific HydroShare users. You can give other
                            users the ability to view or edit this resource. You can also add additional owners who
                            will have full permissions.</span>
                    </div>

                    <p>Who has access</p>
                    <table class="table access-table">
                        <tbody>
                            {# Empty row used as template to generate subsequent rows #}
                            <tr id="templateRow">
                                <td>
                                    <div class="profile-pic-thumbnail round-image user-icon"></div>
                                    <div class="user-scope">
                                        <div class="group-image-wrapper extra-small">
                                            <div class="group-image-extra-small group-preview-image-default"
                                                 style="background-image: url({{ STATIC_URL }}img/home-page/step4.png)"></div>
                                        </div>
                                        <span data-col="name" class="user-name"></span>
                                        <span class="text-muted you-flag">(You)</span>
                                        <br>
                                        <span data-col="user-name"
                                              class="user-username-content"></span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li data-access-type="Can view">
                                                <form class="share-form-view" data-access-type="Can view"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a>Can view</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Can edit">
                                                <form class="share-form-edit" data-access-type="Can edit"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a>Can edit</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Is owner">
                                                <form class="share-form-owner" data-access-type="Is owner"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a>Is owner</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>

                                <td class="user-actions">
                                    <form class="remove-user-form" method="POST">
                                        {% csrf_token %}
                                        <span class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>

                            {# Owners with full permissions to do anything on this resource #}
                            {% for u in owners %}
                            <tr id="row-id-{{ u.pk }}" {% if owners|length == 1 or not is_owner_user %}class="hide-actions"{% endif %}>
                                <td>
                                    <div class="user-scope">

                                        {% if u.userprofile.picture %}
                                            <div style="background-image: url('{{ u.userprofile.picture.url }}');"
                                            class="profile-pic-thumbnail round-image"></div>
                                        {% else %}
                                             <div class="profile-pic-thumbnail round-image user-icon"></div>
                                        {% endif %}

                                        <span data-col="name"
                                              class="user-name">{{ u|best_name }}</span>
                                        {% if u.pk == current_user.pk %}
                                            <span class="text-muted you-flag">(You)</span>
                                        {% endif %}
                                        <br>
                                        <span data-col="user-name"
                                              class="user-username-content">{{ u.username }}</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                        <span class="dropdown role-dropdown">
                                            <span class="dropdown-toggle" data-col="current-access"
                                                  id="roles-menu"
                                                  data-toggle="dropdown"
                                                  aria-haspopup="true" aria-expanded="true">
                                                Is owner
                                                <span class="caret"></span>
                                            </span>
                                            <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                                <li data-access-type="Can view">
                                                    <form id="share-view-{{ u.pk }}"
                                                          class="share-form-view"
                                                          data-access-type="Can view"
                                                          action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/view/{{ u.pk }}/"
                                                          method="POST">
                                                        {% csrf_token %}
                                                        <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can
                                                            view</a>
                                                    </form>
                                                </li>
                                                <li data-access-type="Can edit">
                                                    <form id="share-edit-{{ u.pk }}"
                                                          class="share-form-edit"
                                                          data-access-type="Can edit"
                                                          action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/edit/{{ u.pk }}/"
                                                          method="POST">
                                                        {% csrf_token %}
                                                        <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can
                                                            edit</a>
                                                    </form>
                                                </li>
                                                <li class="active {% if not can_change_resource_flags %}disabled{% endif %}" data-access-type="Is owner">
                                                    <form id="share-owner-{{ u.pk }}"
                                                          class="share-form-owner"
                                                          data-access-type="Is owner"
                                                          action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/owner/{{ u.pk }}/"
                                                          method="POST">
                                                        {% csrf_token %}
                                                        <a onclick="change_share_permission_ajax_submit('share-owner-{{ u.pk }}')">Is
                                                            owner</a>
                                                    </form>
                                                </li>
                                            </ul>
                                        </span>
                                </td>

                                <td class="user-actions">
                                    <form id="form-remove-user-{{ u.pk }}"
                                          class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-user/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-user-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {# Users who can edit the content of this resource #}
                            {% for u in edit_users %}
                            <tr id="row-id-{{ u.pk }}">
                                <td>
                                    <div class="user-scope">
                                        <div
                                        {% if u.userprofile.picture %}
                                            style="background-image: url('{{ u.userprofile.picture.url }}');"
                                            class="profile-pic-thumbnail round-image"
                                        {% else %}
                                             class="profile-pic-thumbnail round-image user-icon"
                                        {% endif %}
                                        >
                                        </div>
                                        <span value="{{ u.pk }}" class="user-name">{{ u|best_name }}</span>
                                        {% if u.pk == current_user.pk %}
                                            <span class="text-muted">(You)</span>
                                        {% endif %}
                                        <br>
                                        <span class="user-username-content">{{ u.username }}</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            Can edit
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li data-access-type="Can view">
                                                <form id="share-view-{{ u.pk }}" class="share-form-view" data-access-type="Can view"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/view/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can view</a>
                                                </form>
                                            </li>
                                            <li class="active" data-access-type="Can edit" {% if not is_owner_user and not is_edit_user %}class="disabled"{% endif %}>
                                                <form id="share-edit-{{ u.pk }}" class="share-form-edit" data-access-type="Can edit"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/edit/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can edit</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Is owner" {% if not is_owner_user %}class="disabled"{% endif %}>
                                                <form id="share-owner-{{ u.pk }}" class="share-form-owner" data-access-type="Is owner"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/owner/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-owner-{{ u.pk }}')">Is owner</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>
                                <td class="user-actions">
                                    <form id="form-remove-user-{{ u.pk }}" class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-user/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-user-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {# Groups who can edit the content of this resource #}
                            {% for u in edit_groups %}
                            <tr id="row-id-{{ u.pk }}">
                                <td>
                                    <div class="user-scope">
                                        <div class="group-image-wrapper extra-small">
                                            {% if u.gaccess.picture and u.gaccess.picture.url %}
                                                <div class="group-image-extra-small group-preview-image-default"
                                                 style="background-image: url({{ u.gaccess.picture.url }})"></div>
                                            {% else %}
                                                <div class="group-image-extra-small group-preview-image-default"
                                                 style="background-image: url({{ STATIC_URL }}img/home-page/step4.png)"></div>
                                            {% endif %}
                                        </div>
                                        <span value="{{ u.pk }}" class="user-name">{{ u.name }}</span>
                                        <br>
                                        <span class="user-username-content">(Group)</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            Can edit
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li data-access-type="Can view">
                                                <form id="share-view-{{ u.pk }}" class="share-form-view" data-access-type="Can view"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-group/view/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can view</a>
                                                </form>
                                            </li>
                                            <li class="active" data-access-type="Can edit" {% if not is_owner_user and not is_edit_user %}class="disabled"{% endif %}>
                                                <form id="share-edit-{{ u.pk }}" class="share-form-edit" data-access-type="Can edit"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-group/edit/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can edit</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>
                                <td class="user-actions">
                                    <form id="form-remove-group-{{ u.pk }}" class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-group/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-group-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {# Users who can view the content of this resource #}
                            {% for u in view_groups %}
                            <tr id="row-id-{{ u.pk }}">
                                <td>
                                    <div class="user-scope">
                                        <div class="group-image-wrapper extra-small">
                                            {% if u.gaccess.picture and u.gaccess.picture.url %}
                                                <div class="group-image-extra-small group-preview-image-default"
                                                     style="background-image: url({{ u.gaccess.picture.url }})"></div>
                                            {% else %}
                                                <div class="group-image-extra-small group-preview-image-default"
                                                     style="background-image: url({{ STATIC_URL }}img/home-page/step4.png)"></div>
                                            {% endif %}
                                        </div>
                                        <span value="{{ u.pk }}" class="user-name">{{ u.name }}</span>
                                        <br>
                                        <span class="user-username-content">(Group)</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            Can view
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li class="active"  data-access-type="Can view">
                                                <form id="share-view-{{ u.pk }}" class="share-form-view" data-access-type="Can view"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-group/view/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can view</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Can edit" {% if not is_owner_user and not is_edit_user %}class="disabled"{% endif %}>
                                                <form id="share-edit-{{ u.pk }}" class="share-form-edit" data-access-type="Can edit"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-group/edit/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can edit</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>
                                <td class="user-actions">
                                    <form id="form-remove-group-{{ u.pk }}" class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-group/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-group-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}

                            {# Users who can view the content of this resource #}
                            {% for u in view_users %}
                            <tr id="row-id-{{ u.pk }}">
                                <td>
                                    <div class="user-scope">
                                        <div
                                            {% if u.userprofile.picture %}
                                                style="background-image: url('{{ u.userprofile.picture.url }}');"
                                                class="profile-pic-thumbnail round-image"
                                            {% else %}
                                                class="profile-pic-thumbnail round-image user-icon"
                                            {% endif %}
                                            >
                                        </div>
                                        <span value="{{ u.pk }}" class="user-name">{{ u|best_name }}</span>
                                        {% if u.pk == current_user.pk %}
                                            <span class="text-muted">(You)</span>
                                        {% endif %}
                                        <br>
                                        <span class="user-username-content">{{ u.username }}</span>
                                    </div>
                                </td>

                                <td class="user-roles">
                                    <span class="dropdown role-dropdown">
                                        <span class="dropdown-toggle" data-col="current-access"
                                              id="roles-menu" data-toggle="dropdown"
                                              aria-haspopup="true" aria-expanded="true">
                                            Can view
                                            <span class="caret"></span>
                                        </span>
                                        <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                            <li class="active" data-access-type="Can view">
                                                <form id="share-view-{{ u.pk }}" class="share-form-view" data-access-type="Can view"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/view/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-view-{{ u.pk }}')">Can view</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Can edit" {% if not is_owner_user and not is_edit_user %}class="disabled"{% endif %}>
                                                <form id="share-edit-{{ u.pk }}" class="share-form-edit" data-access-type="Can edit"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/edit/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-edit-{{ u.pk }}')">Can edit</a>
                                                </form>
                                            </li>
                                            <li data-access-type="Is owner" {% if not is_owner_user %}class="disabled"{% endif %}>
                                                <form id="share-owner-{{ u.pk }}" class="share-form-owner" data-access-type="Is owner"
                                                      action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/owner/{{ u.pk }}/"
                                                      method="POST">
                                                    {% csrf_token %}
                                                    <a onclick="change_share_permission_ajax_submit('share-owner-{{ u.pk }}')">Is owner</a>
                                                </form>
                                            </li>
                                        </ul>
                                    </span>
                                </td>

                                <td class="user-actions">
                                    <form id="form-remove-user-{{ u.pk }}" class="remove-user-form"
                                          action="/hsapi/_internal/{{ cm.short_id }}/unshare-resource-with-user/{{ u.pk }}/"
                                          method="POST">
                                        {% csrf_token %}
                                        <span onclick="unshare_resource_ajax_submit('form-remove-user-{{ u.pk }}')"
                                              class="glyphicon glyphicon-remove btn-remove-row"></span>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="modal-body">
                    <div id="div-invite-people">
                        <p>Invite:</p>

                        <label class="radio-inline">
                            <input type="radio" name="chkInvite" value="users" checked>Users
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="chkInvite" value="groups">Groups
                        </label>

                        <div class="input-group" style="width:100%">
                            <form id="add-access-form" action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/"
                                  method="POST">
                                {% csrf_token %}

                                <div class="add-view-user-form">
                                    {{ add_view_user_form.user }}
                                </div>

                                <div class="add-view-group-form">
                                    {{ add_view_group_form.group }}
                                </div>

                                <div class="dropdown custom-dropdown">
                                    <button class="btn btn-default dropdown-toggle" type="button"
                                            id="roles_list" data-toggle="dropdown"
                                            aria-haspopup="true">
                                        <span id="selected_role" data-role="view">Can view</span>
                                        <span class="caret"></span>
                                    </button>

                                    <ul id="list-roles" class="dropdown-menu"
                                        aria-labelledby="roles_list">
                                        <li {% if not is_view_user and not is_edit_user and not is_owner_user %}class="disabled"{% endif %}><a data-role="view">Can view</a></li>
                                        <li {% if not is_edit_user and not is_owner_user %}class="disabled"{% endif %}><a data-role="edit">Can edit</a></li>
                                        <li {% if not is_owner_user %}class="disabled"{% endif %}><a data-role="owner">Is owner</a></li>
                                    </ul>
                                </div>

                                <a id="btn-invite" onclick="share_resource_ajax_submit('add-access-form'); return false;"
                                        class="btn btn-add-access btn-success pull-left glyphicon glyphicon-plus"><span
                                        class="button-label">&nbspAdd</span></a>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <a type="button" data-dismiss="modal" class="btn btn-primary">Close</a>
                </div>
            </div>
        </div>
    </div>
{#======= Manage access modal  window ends =======#}
{% endif %}

<!-- Add credit source Modal -->
<div class="modal fade" id="add-funding-agency" tabindex="-1" role="dialog" aria-labelledby="add-funding-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/hsapi/_internal/{{ cm.short_id }}/fundingagency/add-metadata/" method="POST"
                  enctype="multipart/form-data">
                {% csrf_token %}
                <input name="resource-mode" type="hidden" value="edit">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="add-funding-label"> Add Funding Agency</h4></div>
                <div class="modal-body">
                    <div class="form-group">
                        <fieldset>
                            {# Agency Name (Required) #}
                            <div id="div_id_agency_name" class="control-group">
                                <label for="agency_name" class="control-label requiredField">Agency Name<span class="asteriskField">*</span></label>

                                <div class="controls"><input class="form-control input-sm textInput" maxlength="250" name="agency_name"
                                                             required="required" type="text"></div>
                            </div>

                            {# Award Title #}
                            <div id="div_id_award_title" class="control-group">
                                <label for="award_title" class="control-label">Award Title</label>
                                <div class="controls"><input class="form-control input-sm" maxlength="250"
                                                             name="award_title"></div>
                            </div>

                            {# Award Number #}
                            <div id="div_id_award_number" class="control-group">
                                <label for="award_number" class="control-label">Award Number</label>
                                <div class="controls"><input class="form-control input-sm textinput textInput" maxlength="100"
                                                             name="award_number" type="text"></div>
                            </div>

                            {# Agency URL #}
                            <div id="div_id_agency_url" class="control-group">
                                <label for="agency_url" class="control-label">Agency URL</label>

                                <div class="controls">
                                    <input class="form-control input-sm urlinput" maxlength="200"
                                                             name="agency_url" type="url">
                                </div>
                            </div>

                        </fieldset>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary btn-save-funding-agency">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% for agency in fundingagnency_formset.initial %}
    <!-- Edit credit source Modal -->
    <div class="modal fade" id="edit-funding-agency-{{ agency.id }}" tabindex="-1" role="dialog"
         aria-labelledby="add-funding-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form data-index="{{ forloop.counter0 }}" action="/hsapi/_internal/{{ cm.short_id }}/fundingagency/{{ agency.id }}/update-metadata/"
                      method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="add-funding-label"> Edit Funding Agency</h4>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <fieldset>
                                {# Agency Name (Required) #}
                                <div id="div_id_agency_name" class="control-group">
                                    <label for="agency_name" class="control-label requiredField">Agency Name<span
                                            class="asteriskField">*</span></label>

                                    <div class="controls"><input class="form-control input-sm textInput" maxlength="250" name="agency_name"
                                                                 required="required" type="text"
                                                                 value="{{ agency.agency_name }}"></div>
                                </div>

                                {# Award Title #}
                                <div id="div_id_award_title" class="control-group">
                                    <label for="award_title" class="control-label">Award Title</label>

                                    <div class="controls"><input class="form-control input-sm" maxlength="250"
                                                                 name="award_title" value="{{ agency.award_title }}">
                                    </div>
                                </div>

                                {# Award Number #}
                                <div id="div_id_award_number" class="control-group">
                                    <label for="award_number" class="control-label">Award Number</label>

                                    <div class="controls"><input class="form-control input-sm textinput textInput" maxlength="100"
                                                                 name="award_number" type="text"
                                                                 value="{{ agency.award_number }}"></div>
                                </div>

                                {# Agency URL #}
                                <div id="div_id_agency_url" class="control-group">
                                    <label for="agency_url" class="control-label">Agency URL</label>

                                    <div class="controls">
                                        <input class="form-control input-sm urlinput" maxlength="200"
                                               name="agency_url" type="url" value="{{ agency.agency_url }}">
                                    </div>
                                </div>

                            </fieldset>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-save-funding-agency" data-index="{{ forloop.counter0 }}">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="delete-funding-agency-{{ agency.id }}" tabindex="-1" role="dialog"
         aria-labelledby="delete-source" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="delete-funding-agency">Delete Funding Agency</h4>
                </div>

                <div class="modal-body"><strong>Are you sure you want to delete this entry?</strong></div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger"
                       href="/hsapi/_internal/{{ cm.short_id }}/fundingagency/{{ agency.id }}/delete-metadata/">Delete</a>
                </div>
            </div>
        </div>
    </div>

{% endfor %}