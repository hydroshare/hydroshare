{% load crispy_forms_tags hydroshare_tags %}

<input id="resID" type="hidden" value="{{ cm.short_id }}"/>
{% if page.perms.change and resource_edit_mode %}
    <div class="modal fade" id="add-reference-dialog" tabindex="-1" role="dialog" aria-labelledby="add-reference"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/hsapi/_internal/{{ cm.short_id }}/add-citation/">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="add-reference">Add reference</h4>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="add-citation-input">Citation text:</label>
                            <textarea class="form-control" name="content" id="add-citation-input" cols="30"
                                      rows="10"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <script id="add-author-modal-template" type="text/x-template">
        <div class="modal fade" id="add-author-modal" tabindex="-1" role="dialog"
             aria-labelledby="add-creator" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="add-creator"> Add Author </h4>
                    </div>

                    <div class="modal-body">
                        <div class="btn-group flex author-types" role="group" aria-label="Author type">
                            <button @click="authorType = authorTypes.EXISTING_HS_USER"
                                    :class="{'btn-primary': authorType === authorTypes.EXISTING_HS_USER, 'btn-default': authorType !== authorTypes.EXISTING_HS_USER}"
                                    type="button" class="btn">Existing<br>HydroShare User
                            </button>
                            <button @click="authorType = authorTypes.OTHER_PERSON"
                                    :class="{'btn-primary': authorType === authorTypes.OTHER_PERSON, 'btn-default': authorType !== authorTypes.OTHER_PERSON}"
                                    type="button" class="btn">Other Person
                            </button>
                            <button @click="authorType = authorTypes.ORGANIZATION"
                                    :class="{'btn-primary': authorType === authorTypes.ORGANIZATION, 'btn-default': authorType !== authorTypes.ORGANIZATION}"
                                    type="button" class="btn">Organization
                            </button>
                        </div>
                    </div>

                    <hr>

                    {# Person #}
                    <div>
                        {#  Existing HydroShare User  #}
                        <div v-show="authorType === authorTypes.EXISTING_HS_USER">
                            <div class="modal-body">
                                {{ add_view_hs_user_form.user }}

                                <div v-if="addAuthorError" class="alert alert-danger has-space-top">
                                    ${addAuthorError}
                                </div>
                            </div>

                            <div class="modal-footer">
                                <button :disabled="isAddingAuthor" type="button"
                                        class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button @click="addAuthorExistingUser"
                                        :disabled="isAddingAuthor"
                                    type="button" class="btn btn-primary">
                                    <template v-if="isAddingAuthor">Saving Changes...</template>
                                    <template v-else>Save Changes</template>
                                </button>
                            </div>
                        </div>

                        {# Other Person or Organization #}
                        <div v-show="authorType === authorTypes.OTHER_PERSON || authorType === authorTypes.ORGANIZATION">
                            <div class="modal-body">
                                <div class="form-group">
                                    <fieldset>
                                        {# NAME #}
                                        <div v-if="authorType === authorTypes.OTHER_PERSON"
                                             class="control-group control-group--name">
                                            <label for="creator-name"
                                                   class="control-label requiredField">Name<span
                                                class="asteriskField">*</span>
                                            </label>

                                            <div class="controls">
                                                <input v-model="author.name"
                                                       id="creator-name"
                                                       placeholder="e.g. 'Smith, John Arnold'"
                                                       required="required"
                                                       class="form-control input-sm textinput textInput"
                                                       maxlength="100">
                                            </div>
                                        </div>

                                        {# ORGANIZATION #}
                                        <div class="control-group">
                                            <label for="creator-organization"
                                                   class="control-label">Organization
                                                <span v-if="authorType === authorTypes.ORGANIZATION">*</span>
                                            </label>

                                            <div class="controls">
                                                <input v-model="author.organization" id="creator-organization"
                                                       required="authorType === authorTypes.ORGANIZATION"
                                                       type="text" maxlength="200"
                                                       class="form-control input-sm textinput textInput">
                                            </div>
                                        </div>

                                        {# EMAIL #}
                                        <div class="control-group">
                                            <label for="creator-email" class="control-label">Email</label>

                                            <div class="controls">
                                                <input v-model="author.email" id="creator-email"
                                                       class="form-control input-sm emailinput"
                                                       maxlength="75" type="email">
                                            </div>
                                        </div>

                                        {# ADDRESS #}
                                        <div class="control-group">
                                            <label for="creator-address" class="control-label">Address</label>

                                            <div class="controls">
                                                <input v-model="author.address" id="creator-address"
                                                       class="form-control input-sm textinput textInput"
                                                       maxlength="250" type="text">
                                            </div>
                                        </div>

                                        {# PHONE #}
                                        <div class="control-group">
                                            <label for="creator-phone" class="control-label">Phone</label>

                                            <div class="controls">
                                                <input v-model="author.phone" id="creator-phone"
                                                       class="form-control input-sm textinput textInput"
                                                       maxlength="25" type="text">
                                            </div>
                                        </div>

                                        {# HOMEPAGE #}
                                        <div class="control-group">
                                            <label for="creator-homepage" class="control-label">Homepage</label>

                                            <div class="controls">
                                                <input v-model="author.homepage" id="creator-homepage"
                                                       class="form-control input-sm urlinput"
                                                       maxlength="200" type="url">
                                            </div>
                                        </div>
                                    </fieldset>

                                    {# AUTHOR IDENTIFIERS #}
                                    <template v-if="authorType !== authorTypes.ORGANIZATION">
                                        <label class="control-label">Author Identifiers</label>

                                        <div class="modal-identifiers-container height-fix">
                                            <div class="edit-identifiers-container">
                                                <div v-for="(identifier, index) in author.identifiers" class="well">
                                                    <div style="height:22px;">
                                                        <button @click="onDeleteIdentifier(index)" type="button"
                                                                class="close">&times;</button>
                                                    </div>
                                                    <fieldset class="select-identifier-fieldset">
                                                        <label>Identifier Name</label>
                                                        <select v-model="identifier.identifierName"
                                                                class="form-control select-identifier">
                                                            <option v-for="ident in identifierDict"
                                                                    :disabled="hasIdentifier(ident.value)"
                                                                    :value="ident.value">
                                                                ${ident.title}
                                                            </option>
                                                        </select>
                                                    </fieldset>

                                                    <fieldset>
                                                        <label>Identifier Link</label>
                                                        <input v-model="identifier.identifierLink"
                                                               class="form-control identifier-link">
                                                    </fieldset>
                                                </div>
                                            </div>

                                            <button @click="onAddIdentifier"
                                                    type="button" class="btn btn-success">
                                                <i class="fa fa-plus" aria-hidden="true"></i> Add New
                                            </button>
                                        </div>
                                    </template>
                                </div>
                                <div v-if="addAuthorError" v-html="addAuthorError" class="alert alert-danger has-space-top"></div>
                            </div>

                            <div class="modal-footer">
                                <button :disabled="isAddingAuthor"
                                        type="button" class="btn btn-default" data-dismiss="modal">Cancel
                                </button>
                                <button @click="addAuthorOtherPerson" :disabled="isAddingAuthor"
                                        type="button" class="btn btn-primary">
                                    <template v-if="isAddingAuthor">Saving changes...</template>
                                    <template v-else>Save changes</template>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <script id="edit-author-modal-template" type="text/x-template">
        <div class="modal fade" id="edit-author-modal"
             tabindex="-1" role="dialog" aria-labelledby="edit-creator" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="edit-creator"> Edit Author</h4>
                    </div>

                    <div v-if="can_remove" class="modal-body">
                        <div class="flex">
                            <span @click="showConfirmDelete = !showConfirmDelete" title="Remove author"
                                  class="glyphicon glyphicon-trash icon-button table-icon btn-remove has-space-right">
                            </span>

                            <transition name="fade">
                                <div v-if="showConfirmDelete">
                                    <div>
                                        <strong>Are you sure you want to delete this metadata element?</strong>
                                    </div>

                                    <div class="space-top">
                                        <button :disabled="is_deleting_author"
                                                @click="showConfirmDelete = false"
                                                type="button" class="btn btn-default">Cancel
                                        </button>
                                        <a :disabled="is_deleting_author"
                                           @click="onDeleteAuthor()" type="button" class="btn btn-danger">
                                            <template v-if="is_deleting_author">Deleting...</template>
                                            <template v-else>Delete</template>
                                        </a>
                                    </div>
                                </div>
                            </transition>
                        </div>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <fieldset>
                                {# NAME #}
                                <div v-if="is_person" class="control-group">
                                    <label for="creator-name" class="control-label requiredField">Name<span
                                        class="asteriskField">*</span>
                                    </label>

                                    <div class="controls">
                                        <input v-model="author.name"
                                               :required="is_person ? 'required' : 'false'"
                                               id="creator-name"
                                               placeholder="e.g. 'Smith, John Arnold'"
                                               class="form-control input-sm textinput textInput"
                                               maxlength="100">
                                    </div>
                                </div>

                                {# PROFILE URL #}
                                <div v-if="author.profileUrl && author.is_active" class="control-group">
                                    <label class="control-label has-space-right">HydroShare Profile</label>
                                    <div class="space-bottom"><a :href="author.profileUrl">View Profile</a></div>
                                </div>

                                {# ORGANIZATION #}
                                <div class="control-group">
                                    <label for="creator-organization" class="control-label">Organization
                                        <span v-if="!is_person" class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <input v-model="author.organization" id="creator-organization"
                                               :class="{requiredField: !is_person}"
                                               :required="is_person ? false : 'required'"
                                               type="text" maxlength="200"
                                               class="form-control input-sm textinput textInput">
                                    </div>
                                </div>

                                {# EMAIL #}
                                <div class="control-group">
                                    <label for="creator-email" class="control-label">Email</label>

                                    <div class="controls">
                                        <input v-model="author.email" id="creator-email"
                                               class="form-control input-sm emailinput"
                                               maxlength="75" type="email">
                                    </div>
                                </div>

                                {# ADDRESS #}
                                <div class="control-group">
                                    <label for="creator-address" class="control-label">Address</label>

                                    <div class="controls">
                                        <input v-model="author.address" id="creator-address"
                                               class="form-control input-sm textinput textInput"
                                               maxlength="250" type="text">
                                    </div>
                                </div>

                                {# PHONE #}
                                <div class="control-group">
                                    <label for="creator-phone" class="control-label">Phone</label>

                                    <div class="controls">
                                        <input v-model="author.phone" id="creator-phone"
                                               class="form-control input-sm textinput textInput"
                                               maxlength="25" type="text">
                                    </div>
                                </div>

                                {# HOMEPAGE #}
                                <div class="control-group">
                                    <label for="creator-homepage" class="control-label">Homepage</label>

                                    <div class="controls">
                                        <input v-model="author.homepage" id="creator-homepage"
                                               class="form-control input-sm urlinput"
                                               maxlength="200" type="url">
                                    </div>
                                </div>
                            </fieldset>

                            {# AUTHOR IDENTIFIERS #}
                            <template v-if="is_person">
                                <label class="control-label">Author Identifiers</label>
                                <div class="modal-identifiers-container height-fix">
                                    <div class="edit-identifiers-container">
                                        <div v-for="(identifier, index) in author.identifiers" class="well">
                                            <div style="height:22px;">
                                                <button @click="onDeleteIdentifier(index)" type="button"
                                                        class="close">&times;</button>
                                            </div>
                                            <fieldset class="select-identifier-fieldset">
                                                <label>Identifier Name</label>
                                                <select v-model="identifier.identifierName"
                                                        class="form-control select-identifier">
                                                    <option v-for="ident in identifierDict"
                                                            :disabled="hasIdentifier(ident.value)"
                                                            :value="ident.value">
                                                        ${ident.title}
                                                    </option>
                                                </select>
                                            </fieldset>

                                            <fieldset>
                                                <label>Identifier Link</label>
                                                <input v-model="identifier.identifierLink"
                                                       class="form-control identifier-link">
                                            </fieldset>
                                        </div>
                                    </div>

                                    <button @click="onAddIdentifier"
                                            type="button" class="btn btn-success">
                                        <i class="fa fa-plus" aria-hidden="true"></i> Add New
                                    </button>
                                </div>
                            </template>
                        </div>
                        <div v-if="edit_author_error" v-html="edit_author_error" class="alert alert-danger has-space-top"></div>
                    </div>

                    <div class="modal-footer">
                        <button :disabled="is_updating_author || is_deleting_author"
                                type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button @click="onSaveAuthor"
                                :disabled="is_updating_author || is_deleting_author"
                                type="button" class="btn btn-primary">
                            <template v-if="is_updating_author">Saving changes...</template>
                            <template v-else>Save changes</template>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <div class="modal fade in" id="add-contributor-dialog" tabindex="-1" role="dialog"
         aria-labelledby="add-contributor" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="add-contributor"> Add Contributor </h4>
                </div>

                <div class="modal-body">
                    <div class="btn-group flex author-types" role="group"
                         aria-label="Author type">
                        <button class="btn btn-primary" data-contributor-type="hs_user" type="button">
                            Existing<br>HydroShare User
                        </button>
                        <button class="btn btn-default" data-contributor-type="other" type="button">
                            Other Person
                        </button>
                    </div>
                </div>
                <hr>

                {#  Existing HydroShare User  #}
                {% with "user-type-hs-user" as div_id %}
                <div data-contributor-type="hs_user">
                    <div class="modal-body">
                        {{ add_view_contrib_user_form.user }}
                    </div>

                    <form action="/hsapi/_internal/{{ cm.short_id }}/contributor/add-metadata/" method="POST"
                          enctype="multipart/form-data">
                        {% csrf_token %}
                        <input name="resource-mode" type="hidden" value="edit">
                        <div class="modal-body" style="display:none;">
                            <div class="form-group">
                                <fieldset>
                                    <div id="{{ div_id }}_name" class="control-group">
                                        <label for="{{ div_id }}_input_name"
                                               class="control-label requiredField">Name<span
                                                class="asteriskField">*</span></label>

                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_name" maxlength="100" name="name"
                                                   required="required" type="text"></div>
                                    </div>

                                    <div id="{{ div_id }}_hydroshare_user_id" class="control-group">
                                        <label for="{{ div_id }}_input_hydroshare_user_id"
                                               class="control-label">HydroShare User Identifier</label>
                                        <div class="controls">
                                            <input class="form-control input-sm urlinput"
                                                   id="{{ div_id }}_input_hydroshare_user_id" maxlength="200"
                                                   name="hydroshare_user_id" type="number">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_organization" class="control-group">
                                        <label for="{{ div_id }}_input_organization"
                                               class="control-label">Organization</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_organization" maxlength="200"
                                                   name="organization" type="text">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_email" class="control-group">
                                        <label for="{{ div_id }}_input_email" class="control-label">Email</label>

                                        <div class="controls">
                                            <input class="form-control input-sm emailinput"
                                                   id="{{ div_id }}_input_email" maxlength="75" name="email"
                                                   type="email">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_address" class="control-group">
                                        <label for="{{ div_id }}_input_address"
                                               class="control-label">Address</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_address" maxlength="250"
                                                   name="address"
                                                   type="text">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_phone" class="control-group">
                                        <label for="{{ div_id }}_input_phone" class="control-label">Phone</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_phone" maxlength="25" name="phone"
                                                   type="text">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_homepage" class="control-group">
                                        <label for="{{ div_id }}_input_homepage"
                                               class="control-label">Homepage</label>
                                        <div class="controls">
                                            <input class="form-control input-sm urlinput"
                                                   id="{{ div_id }}_input_homepage" maxlength="200"
                                                   name="homepage" type="url">
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button id="btn-add-hydroshare-user" type="button" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
                {% endwith %}

                {#  Other Person #}
                {% with "user-type-other-user" as div_id %}
                <div data-contributor-type="other" style="display:none">
                    <form action="/hsapi/_internal/{{ cm.short_id }}/contributor/add-metadata/" method="POST"
                          enctype="multipart/form-data">
                        {% csrf_token %}
                        <input name="resource-mode" type="hidden" value="edit">
                        <div class="modal-body">
                            <div class="form-group">
                                <fieldset>
                                    <div id="{{ div_id }}_name" class="control-group">
                                        <label for="{{ div_id }}_input_name"
                                               class="control-label requiredField">Name<span
                                                class="asteriskField">*</span></label>

                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   placeholder="e.g. 'Smith, John Arnold'"
                                                   id="{{ div_id }}_input_name" maxlength="100" name="name"
                                                   required="required" type="text">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_organization" class="control-group">
                                        <label for="{{ div_id }}_input_organization"
                                               class="control-label">Organization</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_organization" maxlength="200"
                                                   name="organization" type="text">
                                        </div>
                                    </div>
                                    <div id="{{ div_id }}_email" class="control-group">
                                        <label for="{{ div_id }}_input_email"
                                               class="control-label">Email</label>

                                        <div class="controls">
                                            <input class="form-control input-sm emailinput"
                                                   id="{{ div_id }}_input_email" maxlength="75" name="email"
                                                   type="email">
                                        </div>
                                    </div>
                                    <div id="{{ div_id }}_address" class="control-group">
                                        <label for="{{ div_id }}_input_address"
                                               class="control-label">Address</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_address" maxlength="250"
                                                   name="address" type="text">
                                        </div>
                                    </div>
                                    <div id="{{ div_id }}_phone" class="control-group">
                                        <label for="{{ div_id }}_input_phone"
                                               class="control-label">Phone</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_phone" maxlength="25" name="phone"
                                                   type="text">
                                        </div>
                                    </div>
                                    <div id="{{ div_id }}_homepage" class="control-group">
                                        <label for="{{ div_id }}_input_homepage"
                                               class="control-label">Homepage</label>
                                        <div class="controls">
                                            <input class="form-control input-sm urlinput"
                                                   id="{{ div_id }}_input_homepage" maxlength="200"
                                                   name="homepage" type="url">
                                        </div>
                                    </div>
                                </fieldset>

                                <label class="control-label">Author Identifiers</label>
                                <div class="modal-identifiers-container height-fix">
                                    {% include "includes/identifiers-form.html" %}
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary btn-disable-after-valid">Save Changes</button>
                        </div>
                    </form>
                </div>
                {% endwith %}
            </div>
        </div>
    </div>

    <div class="modal fade in" id="extraMetaDialog" tabindex="-1" role="dialog" aria-labelledby="add-extra-meta" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form enctype="multipart/form-data">
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="extra_meta_title"> Add/Edit Additional Metadata </h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <input id="edit_extra_meta_row_id" type="hidden" />
                            <input id="old_extra_meta_name" type="hidden" />
                            <div id="div_extra_meta_name" class="control-group">
                                <label for="extra_meta_name" class="control-label requiredField">Name</label>
                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput" required
                                           id="extra_meta_name_input" maxlength="100" name="name" type="text">
                                </div>
                            </div>
                            <div id="div_extra_meta_value" class="control-group">
                                <label for="extra_meta_value" class="control-label">Value</label>
                                <div class="controls">
                                    <textarea required class="form-control input-sm textarea" cols="40"
                                                        id="extra_meta_value_input" name="value"
                                                        rows="10"></textarea>
                                </div>
                            </div>
                            <div id="extra_meta_msg" style="display: None"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button id="btn-confirm-extended-metadata" type="button" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="deleteExtraMetaDialog" tabindex="-1" role="dialog" aria-labelledby="add-extra-meta" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form enctype="multipart/form-data">
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="extra_meta_title"> Delete Additional Metadata </h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <input id="delete_extra_meta_row_id" type="hidden" />
                            <input id="old_extra_meta_name" type="hidden" />
                            <div id="div_extra_meta_name" class="control-group">
                                <label for="delete_extra_meta_name" class="control-label requiredField">Name</label>
                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput" readonly required
                                           id="delete_extra_meta_name_input" maxlength="100" name="name" type="text">
                                </div>
                            </div>
                            <div id="div_extra_meta_value" class="control-group">
                                <label for="delete_extra_meta_value" class="control-label">Value</label>
                                <div class="controls">
                                    <textarea readonly required class="form-control input-sm textarea" cols="40"
                                                        id="delete_extra_meta_value_input" name="value"
                                                        rows="10"></textarea>
                                </div>
                            </div>
                            <div id="extra_meta_msg" style="display: None"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button id="btn-confirm-delete-extended-metadata" type="button" class="btn btn-danger">Delete</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="create-folder-dialog" tabindex="-1" role="dialog"
     aria-labelledby="create-folder" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="create-folder">New Folder</h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    {# Folder Name #}
                    <fieldset class="col-sm-12">
                        <label>Folder Name *</label>
                        <input id="txtFolderName" class="form-control modal-only-required">
                    </fieldset>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="btn-create-folder" class="btn btn-primary disabled" data-dismiss="modal">Create
                </button>
            </div>
        </div>
    </div>
</div>

    <div class="modal fade in" id="move-override-confirm-dialog" tabindex="-1" role="dialog"
         aria-labelledby="move-override-confirm" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="move-override-confirm-title">Confirm whether to override existing files</h4>
                </div>
                <div class="modal-body">
                    <p id="resp-message"></p>
                    <p>
                        click <strong>Proceed</strong> to confirm to override files. Otherwise, click <strong>Cancel</strong>.
                    </p>
                    <input type="hidden" id="source_paths" value=""/>
                    <input type="hidden" id="target_path" value=""/>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-file-override-proceed" class="btn btn-default"
                            data-dismiss="modal">Proceed
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="move-aggr-override-confirm-dialog" tabindex="-1" role="dialog"
         aria-labelledby="move-aggr-override-confirm" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="move-override-confirm-title">Confirm whether to override existing files</h4>
                </div>
                <div class="modal-body">
                    <p id="aggr-move-resp-message"></p>
                    <p>
                        click <strong>Proceed</strong> to confirm to override files. Otherwise, click <strong>Cancel</strong>.
                    </p>
                    <input type="hidden" id="file_type" value=""/>
                    <input type="hidden" id="file_type_id" value=""/>
                    <input type="hidden" id="target_path" value=""/>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-aggr-file-override-proceed" class="btn btn-default"
                            data-dismiss="modal">Proceed
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="validate-reference-url-dialog" tabindex="-1" role="dialog"
         aria-labelledby="validate-reference-url" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="validate-url-title">Unable to validate URL</h4>
                </div>
                <div class="modal-body">
                    <p>
                        Unable to validate URL link. This may be due to an error in the URL or password or automated bot
                        protection at the hosting site. If you still want to create referenced content using this invalid URL
                        link, click <strong>Proceed</strong>. Otherwise, click <strong>Cancel</strong>.
                    </p>
                    <input type="hidden" id="ref_name_passover" value=""/>
                    <input type="hidden" id="ref_url_passover" value=""/>
                    <input type="hidden" id="new_ref_url_passover" value=""/>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-reference-url-without-validation" class="btn btn-default"
                            data-dismiss="modal">Proceed
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="add-reference-url-dialog" tabindex="-1" role="dialog"
         aria-labelledby="add-reference" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="create-folder">Add Content From The Web</h4>
                </div>

                <div class="modal-body">
                    <div class="form-group">
                        <fieldset>
                        {# Reference Name #}
                            <label class="col-sm-12">Create a name for the referenced content. This name will be displayed in the file content area of the resource</label>
                            <label for="txtRefName" class="col-sm-2 control-label">Name: *</label>
                            <input id="txtRefName" class="col-sm-10 modal-only-required" placeholder="Untitled">
                        </fieldset>
                    </div>
                    {# Reference URL #}
                    <div class="form-group">
                        <fieldset>
                            <label class="col-sm-12">Specify the HTTP or FTP URL of a file or website</label>
                            <label for="txtRefURL" class="col-sm-2 control-label">URL: *</label>
                            <input id="txtRefURL" class="col-sm-10 modal-only-required" placeholder="HTTP or FTP URL">
                        </fieldset>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-add-reference-url" class="btn btn-primary btn-disable-after disabled"
                            data-dismiss="modal">Add Content
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="rename-dialog" tabindex="-1" role="dialog"
         aria-labelledby="rename" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="rename">Rename</h4>
                </div>

                <div class="modal-body">

                    <div class="row">
                        <fieldset class="col-sm-12">
                            <label>Name *</label>
                            <div class="input-group">
                                <input id="txtName" class="form-control modal-only-required">
                                {% if cm|resource_type == "Time Series" %}
                                <span class="input-group-addon" id="file-type-addon"></span>
                                {% endif %}
                            </div>
                        </fieldset>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-rename" class="btn btn-primary btn-disable-after">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="zip-folder-dialog" tabindex="-1" role="dialog"
         aria-labelledby="rename" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="rename">Zip Folder</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <fieldset class="col-sm-12">
                            <label>Name *</label>
                            <div class="input-group">
                                <input id="txtZipName" type="text" class="form-control modal-only-required" placeholder="File name"
                                       aria-describedby="file-type-addon">
                                <span class="input-group-addon">.zip</span>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-confirm-zip" class="btn btn-primary" data-dismiss="modal">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="edit-referenced-url-dialog" tabindex="-1" role="dialog" aria-labelledby="edit-ref-label"
         aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="edit-referenced-url-title">Edit the referenced URL</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <fieldset class="col-sm-12">
                            <label>Reference URL *</label>
                            <input id="txtNewRefURL" class="form-control modal-only-required">
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-edit-url" class="btn btn-primary" data-dismiss="modal">Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    {% for source in sources %}
    <div class="modal fade in" id="delete-source-element-dialog{{ source.id }}" tabindex="-1" role="dialog"
         aria-labelledby="delete-source" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="delete-source">Delete metadata element</h4></div>
                <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger btn-disable-after"
                       href="/hsapi/_internal/{{ cm.short_id }}/source/{{ source.id }}/delete-metadata/">Delete</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="edit-source-dialog{{ source.id }}" tabindex="-1" role="dialog" aria-labelledby="edit-source"
         aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="id_source_{{ source.id }}" method="POST" enctype="multipart/form-data"
                      action="/hsapi/_internal/{{ cm.short_id }}/source/{{ source.id }}/update-metadata/">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="edit-source"> Edit Source </h4></div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <div class="form-group">
                            {% csrf_token %}
                            <fieldset>
                                <legend>Source</legend>
                                <div id="div_id_derived_from" class="control-group">
                                    <label for="id_source-{{ forloop.counter0 }}-derived_from"
                                           class="control-label">Derived from*</label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput" required="required"
                                               id="id_source-{{ forloop.counter0 }}-derived_from" maxlength="300"
                                               name="source-{{ forloop.counter0 }}-derived_from"
                                               type="text" value="{{ source.derived_from }}">
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}

    {% for relation in relations %}
    <div class="modal fade in" id="delete-relation-element-dialog{{ relation.id }}" tabindex="-1" role="dialog"
         aria-labelledby="delete-relation" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="delete-relation">Delete metadata element</h4></div>
                <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger btn-disable-after"
                       href="/hsapi/_internal/{{ cm.short_id }}/relation/{{ relation.id }}/delete-metadata/">Delete</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="edit-relation-dialog_{{ relation.id }}" tabindex="-1" role="dialog"
         aria-labelledby="edit-relation" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/hsapi/_internal/{{ cm.short_id }}/relation/{{ relation.id }}/update-metadata/"
                      method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="edit-relation"> Edit Relation </h4>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}

                        <div class="form-group">
                            {% csrf_token %}
                            <fieldset>
                                <div id="div_id_edit_type" class="control-group has-space-bottom">
                                    <label for="id_type" class="control-label requiredField">
                                    Relation type<span class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <select class="form-control input-sm select" id="id_relation-{{ forloop.counter0 }}-type" name="relation-{{ forloop.counter0 }}-type">
                                            <option value="">---------</option>
                                            {% for type_value, type_display in relation_source_types %}
                                                <option value={{ type_value }} {% if relation.type == type_value %}selected="selected"{% endif %}>{{ type_display }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div id="div_id_value" class="control-group">
                                    <label for="id_value" class="control-label requiredField">
                                    Related to<span class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_relation-{{ forloop.counter0 }}-value"
                                               name="relation-{{ forloop.counter0 }}-value"
                                               type="text" value="{{ relation.value }}">
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}

    {% for contributor in contributors %}
    <div class="modal fade" id="edit-contributor-dialog{{ contributor.id }}" tabindex="-1" role="dialog"
         aria-labelledby="edit-contributor" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="id_contributor_{{ contributor.id }}" action="/hsapi/_internal/{{ cm.short_id }}/contributor/{{ contributor.id }}/update-metadata/"
                      method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-hidden="true">×
                        </button>
                        <h4 class="modal-title" id="edit-contributor"> Edit Contributor </h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <fieldset>
                                <div id="div_id_name" class="control-group">
                                    <label class="control-label requiredField">Name<span
                                            class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_contributor-{{ contributor.order|add:"-1" }}-name"
                                               placeholder="e.g. 'Smith, John Arnold'"
                                               maxlength="100" name="contributor-{{ contributor.order|add:"-1" }}-name"
                                               required="required" type="text"
                                               value="{% if contributor.name %}{{ contributor.name }}{% endif %}">
                                    </div>
                                </div>
                                {% if contributor.relative_uri and contributor.is_active_user %}
                                    <div id="div_id_hydroshare_user_id" class="control-group">
                                        <label class="control-label">HydroShare Profile</label>
                                        <div class="space-bottom">
                                            <a href="{{ contributor.relative_uri }}">View Profile</a>
                                        </div>

                                        <div class="controls hidden">
                                            <input class="form-control input-sm urlinput"
                                                   id="id_creator-{{ contributor.order|add:"-1" }}-hydroshare_user_id"
                                                   maxlength="200"
                                                   name="creator-{{ contributor.order|add:"-1" }}-hydroshare_user_id"
                                                   type="number"
                                                   value="{{ contributor.hydroshare_user_id }}"
                                                   readonly>
                                        </div>
                                    </div>
                                {% endif %}
                                <div id="div_id_organization" class="control-group">
                                    <label class="control-label">Organization</label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput" type="text"
                                               id="id_contributor-{{ contributor.order|add:"-1" }}-organization"
                                               maxlength="200"
                                               name="contributor-{{ contributor.order|add:"-1" }}-organization"
                                               value="{% if contributor.organization %}{{ contributor.organization }}{% endif %}">
                                    </div>
                                </div>
                                <div id="div_id_email" class="control-group">
                                    <label class="control-label">Email</label>

                                    <div class="controls">
                                        <input class="form-control input-sm emailinput"
                                               id="id_contributor-{{ contributor.order|add:"-1" }}-email"
                                               maxlength="75" name="contributor-{{ contributor.order|add:"- 1" }}-email"
                                               type="email" value="{% if contributor.email %}{{ contributor.email }}{% endif %}">
                                    </div>
                                </div>
                                <div id="div_id_address" class="control-group">
                                    <label class="control-label">Address</label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_contributor-{{ contributor.order|add:"-1" }}-address" maxlength="250"
                                               name="contributor-{{ contributor.order|add:"-1" }}-address"
                                               type="text" value="{% if contributor.address %}{{ contributor.address }}{% endif %}">
                                    </div>
                                </div>
                                <div id="div_id_phone" class="control-group">
                                    <label class="control-label">Phone</label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_contributor-{{ contributor.order|add:"-1" }}-phone" maxlength="25"
                                               name="contributor-{{ contributor.order|add:"- 1" }}-phone"
                                               type="text" value="{% if contributor.phone %}{{ contributor.phone }}{% endif %}">
                                    </div>
                                </div>
                                <div id="div_id_homepage" class="control-group">
                                    <label class="control-label">Homepage</label>

                                    <div class="controls">
                                        <input class="form-control input-sm urlinput" type="url"
                                            id="id_contributor-{{ contributor.order|add:"-1" }}-homepage"
                                            maxlength="200" name="contributor-{{ contributor.order|add:"-1" }}-homepage"
                                            value="{% if contributor.homepage %}{{ contributor.homepage }}{% endif %}">
                                    </div>
                                </div>
                            </fieldset>
                            <label class="control-label">Author Identifiers</label>
                            <div class="modal-identifiers-container height-fix">
                                {% include "includes/identifiers-form.html" with identifiers=contributor.identifiers %}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="delete-contributor-dialog{{ contributor.id }}" tabindex="-1" role="dialog"
         aria-labelledby="delete-contributor" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="delete-contributor">Delete metadata element</h4></div>
                <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger btn-disable-after"
                       href="/hsapi/_internal/{{ cm.short_id }}/contributor/{{ contributor.id }}/delete-metadata/">Delete</a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    <div class="modal fade" id="add-relation-dialog" tabindex="-1" role="dialog" aria-labelledby="add-relation"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/hsapi/_internal/{{ cm.short_id }}/relation/add-metadata/"
                      method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="add-relation"> Add Relation </h4>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}

                        <div class="form-group">
                            {% csrf_token %}
                            <fieldset>
                                <div id="div_id_add_type" class="control-group has-space-bottom">
                                    <label for="id_type" class="control-label requiredField">
                                    Type of relationship<span class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <select class="form-control input-sm select" id="id_type" name="type">
                                            {% for type_value, type_display in relation_source_types %}
                                                {% if type_value != "relation" %}
                                                    <option value={{ type_value }}>{{ type_display }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div id="div_id_value" class="control-group">
                                    <label for="id_related_to_input" class="control-label requiredField">
                                         Full text citation of the related resource, including URL if there is one.
                                        To relate to a HydroShare Resource go to the HydroShare resource landing page
                                        'How to Cite' section and Copy Citation then paste
                                        <span class="asteriskField">*</span>
                                    </label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_related_to_input" name="value" required="required"
                                               type="text">
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="customize-citation-dialog" tabindex="-1" role="dialog" aria-labelledby="customize-citation"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                {% if custom_citation %}
                    <form action="/hsapi/_internal/{{ cm.short_id }}/citation/{{ citation_id }}/update-metadata/" method="POST"
                          enctype="multipart/form-data">
                {% else %}
                    <form action="/hsapi/_internal/{{ cm.short_id }}/citation/add-metadata/" method="POST"
                          enctype="multipart/form-data">
                {% endif %}
                <input type="hidden" name="resource-mode">
                    {% csrf_token %}
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="customize-citation">Custom Citation</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="custom-citation-input">Provide the full text of how you would like this resource to be cited:</label>
                            <textarea class="form-control" name="content" id="custom-citation-input" cols="30"
                                      rows="3">{% if custom_citation %}{{ custom_citation }}{% endif %}</textarea>
                            Suggested Format: Creator(s) (Publication Year). Title,  Version, Publisher, Resource Type, Identifier (preferably encoded as a URL)
                        </div>

                    </div>
                    <div class="modal-footer">
                        {% if custom_citation %}
                        <script language="JavaScript">
                          function AsyncRevertCitation() {
                            $('#customize-citation-dialog').toggle();
                            document.body.style.cursor = 'wait';
                            $.ajax({
                              type: "POST",
                              url: "/hsapi/_internal/{{cm.short_id}}/citation/{{citation_id}}/delete-metadata/",
                            }).complete(function() {
                              document.body.style.cursor = 'default';
                              if (window.location.href.includes('?resource-mode=edit')) {
                                location.reload();
                              } else {
                                window.location.href = window.location.href + '?resource-mode=edit';
                              }
                            });
                          }
                        </script>
                        <a id="remove-citation-link" href="javascript:AsyncRevertCitation()"><i class="glyphicon glyphicon-trash table-icon icon-button btn-remove"></i>Remove Custom Citation</a>
                        {% endif %}
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="remove-aggregation-dialog" tabindex="-1" role="dialog"
         aria-labelledby="remove-aggregation" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">Remove content type</h4>
                </div>
                <div class="modal-body">
                    <p>Removing the content type will remove the metadata associated with this
                    content.</p>
                    <p>Are you sure you want to do this?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnCancelRemoveAggregation" class="btn btn-default"
                            data-dismiss="modal">Cancel
                    </button>
                    <button type="button" id="btnRemoveAggregation" class="btn btn-danger"
                            data-dismiss="modal">Remove
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="unzip-override-confirm-dialog" tabindex="-1" role="dialog"
                         aria-labelledby="unzip-override-confirm" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="unzip-override-confirm-title">Confirm whether to override existing files</h4>
                </div>
                <div class="modal-body">
                    <p id="unzip-resp-message"></p>
                    <p>
                        Click <strong>Proceed</strong> to confirm to override files. Otherwise, click <strong>Cancel</strong>.
                    </p>
                    <input type="hidden" id="unzip_res_id" value=""/>
                    <input type="hidden" id="zip_with_rel_path" value=""/>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-unzip-file-override-proceed" class="btn btn-default"
                            data-dismiss="modal">Proceed
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% include "irods_signin.html" %}
    {% include "irods_upload_add.html" %}

{% endif %}

<div class="modal fade in" id="deleteCommentDialog" tabindex="-1" role="dialog" aria-labelledby="add-extra-meta" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form enctype="multipart/form-data">
                <input name="resource-mode" type="hidden" value="edit">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="extra_meta_title"> Delete Comment </h4>
                </div>
                <div class="modal-body">
                <p id="delete_comment_message">
                    Confirm to delete the comment and any threaded reply messages
                </p>
                </div>
                <div class="modal-footer">
                    <input id="delete_comment_id" type="hidden" />
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button id="btn-confirm-delete-comment" type="button" class="btn btn-danger">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% if not resource_edit_mode and not is_replaced_by %}
    {% if page.perms.change or self_access_level == 'owner' and cm.raccess.published %}
        {% if page.perms.delete or cm.raccess.published %}
            <div class="modal fade" id="new-version-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="new-version-resource-title">Create New Version of This Resource</h4>
                        </div>
                        <div class="modal-body">
                            Creating a new version will obsolete this resource. This resource will be still available in HydroShare,
                            but only the newer version will be discoverable via the HydroShare search interface. The new version is
                            a complete new resource with new identifier. It will contain a link back to the previous version and the
                            previous version will have a link to the next version. This can be repeated resulting in a sequence of
                            multiple versions each linked to next and previous versions. Only the most recent version can be edited
                            or deleted. If you delete the most recent version, the previous version becomes the most recent and editable.
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button id="new-version-btn" class="btn btn-danger">Create New Version</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        {% if page.perms.delete and cm.can_be_submitted_for_metadata_review %}
            <div class="modal fade" id="submit-for-publication-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        {% if not missing_metadata_elements_for_publication %}
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title" id="submit-for-publication-title">Submit resource for permanent publication</h4>
                            </div>
                            <div class="modal-body">
                                <p>
                                    <strong>Are you sure you want to permanently publish this resource?</strong> You will <strong>NOT</strong>
                                    be able to edit the content, title or authorship once this resource is permanently published.
                                    Limited editing of other metadata will still be possible to add new information, or correct current information.
                                    This publication is <strong>permanent</strong> and you should only continue when you are finished adding or modifying the content of this resource.
                                </p>
                                <hr>
                                {% if recommended_missing_elements %}
                                    <p>
                                        Currently your resource is missing the following recommended elements:
                                        <ul>
                                            {% for missing in recommended_missing_elements %}
                                                <li>{{ missing }}</li>
                                            {% endfor %}
                                        </ul>
                                    <p>
                                {% endif %}
                                <p>
                                    If you <strong>"Continue"</strong>, this resource will be reviewed for appropriate
                                    <a href="https://help.hydroshare.org/publishing-in-hydroshare/minimum-metadata-requirements-for-publishing-in-hydroshare/" target="_blank">minimum metadata</a>
                                    and to ensure that it adheres to
                                    <a href="https://help.hydroshare.org/publishing-in-hydroshare/terms-of-use-and-community-guidelines/" target="_blank">community guidelines</a>
                                    for publication.
                                </p>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button class="btn btn-success" id="publish-btn" data-toggle="modal" data-dismiss="modal" data-target="#submit-for-publication-dialog-2">Continue</button>
                            </div>
                        {% else %}
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title" id="submit-for-publication-title">Modifications necessary before publication</h4>
                            </div>
                            <div class="modal-body">
                                <p>
                                    This resource doesn't meet the
                                    <a href="https://help.hydroshare.org/publishing-in-hydroshare/minimum-metadata-requirements-for-publishing-in-hydroshare/" target="_blank">minimum metadata standards</a>
                                    for publication and adherence to 
                                    <a href="https://help.hydroshare.org/publishing-in-hydroshare/terms-of-use-and-community-guidelines/" target="_blank">community guidelines</a>:
                                    <ul>
                                        {% for missing in missing_metadata_elements_for_publication %}
                                            <li>{{ missing }}</li>
                                        {% endfor %}
                                    </ul>
                                </p>
                                {% if recommended_missing_elements %}
                                    <p>
                                        We also recommend the following items:
                                        <ul>
                                            {% for missing in recommended_missing_elements %}
                                                <li>{{ missing }}</li>
                                            {% endfor %}
                                        </ul>
                                    <p>
                                {% endif %}
                                    You can submit your publication request after updating the resource metadata.
                                </p>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal">OK</button>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="modal fade" id="submit-for-publication-dialog-2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="submit-for-publication-title2">Submit resource for publication</h4>
                        </div>
                        <div class="modal-body">
                            <p>
                                Please confirm that you accept the HydroShare Publication Agreement shown below.
                            </p>
                            <div class="iframe-border">
                                <iframe id="pub-agreement-frame" scrolling="no" src="https://www.hydroshare.org/publication-agreement/"></iframe>
                            </div>
                            <input type="checkbox" id="agree-chk"><label for="agree-chk" class="checkbox-label">I accept the HydroShare Publication Agreement.</label>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <a type="button" id="publish-btn-2" class="btn btn-success" href="/hsapi/_internal/{{ cm.short_id }}/submit-for-review/" disabled>Submit For Publication</a>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        {% if page.perms.delete %}
            {% block modal_delete_resource %}
                {% if page.perms.change %}
                    <div class="modal fade" id="delete-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="delete-resource-title"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="delete-resource-title">Delete Resource</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="alert alert-danger">
                                        <strong>WARNING! DELETING A RESOURCE IS A PERMANENT ACTION!</strong>
                                        <ul>
                                            <li>This will delete the resource and all of the content files.</li>
                                            <li>A copy of the resource will NOT be retained by HydroShare.</li>
                                            <li>We highly recommend that you download the latest copy of your resource
                                                before confirming this action so that you do not lose any content you
                                                might need later.
                                            </li>
                                        </ul>
                                        <p>If you are sure you want to delete your resource, type the word "DELETE"
                                            in the following text box and then click the "Delete" button below.
                                        </p>
                                    </div>
                                    <input type="text" id="confirm-res-id-text" />
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                    <button id="btn-delete-resource" class="btn btn-danger" disabled="">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {%  endblock %}
        {% endif %}
    {% endif %}

    {% if user.is_authenticated and rights.statement %}
        {% if permissions_allow_copy %}
            {% if rights_allow_copy %}
                <div class="modal fade" id="copy-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title" id="copy-resource-title">Copy This Resource</h4>
                            </div>
                            <div class="modal-body">
                                {% if rights.statement|length > 1000 %}
                                    <div class="pre-scrollable">
                                        <span>{{ rights.statement|linebreaks }}</span>
                                    </div>
                                {% else %}
                                    <span>{{ rights.statement|linebreaks }}</span>
                                {% endif %}
                                <span class="rights-url"><a href="{{ rights.url }}" target="_blank">&nbsp;{{ rights.url }}</a></span>
                                <p>
                                In copying this resource you are ethically bound to respect the terms of this license.
                                Please confirm that you accept the terms of this license below before you can copy this resource.
                                </p>
                                <input type="checkbox" id="agree-chk-copy">
                                <label for="agree-chk-copy" class="checkbox-label">
                                    I accept the terms of this license.
                                </label>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="copy-btn" class="btn btn-success" disabled>Copy this resource</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endif %}
    {% endif %}
{% endif %}

<div class="modal fade" id="license-agree-dialog-bag" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="license-agree-title">Resource License Agreement</h4>
            </div>
            <div class="modal-body">
                {% if rights.statement|length > 1000 %}
                    <div class="pre-scrollable">
                        <span>{{ rights.statement|linebreaks }}</span>
                    </div>
                {% else %}
                    <span>{{ rights.statement|linebreaks }}</span>
                {% endif %}
                <span class="rights-url"><a href="{{ rights.url }}" target="_blank">&nbsp;{{ rights.url }}</a></span>
                <p style="margin-top: 5px">
                In downloading this resource contents you are ethically bound to respect the terms of this license.
                Please confirm that you accept the terms of this license below before you can do any downloads for this resource.
                </p>
                <input type="checkbox" id="agree-chk-download-bag">
                <label for="agree-chk-download-bag" class="checkbox-label">
                    I accept the terms of this license.
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="download-bag-cancel">Cancel</button>
                <button type="button" class="btn btn-success disabled" id="download-bag-btn"
                   data-bag-url="{{ cm.bag_url }}">Download</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="license-agree-dialog-file" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="license-agree-title">Resource License Agreement</h4>
            </div>
            <div class="modal-body">
                {% if rights.statement|length > 1000 %}
                    <div class="pre-scrollable">
                        <span>{{ rights.statement|linebreaks }}</span>
                    </div>
                {% else %}
                    <span>{{ rights.statement|linebreaks }}</span>
                {% endif %}
                <span class="rights-url"><a href="{{ rights.url }}" target="_blank">&nbsp;{{ rights.url }}</a></span>
                <p style="margin-top: 5px">
                In downloading this resource contents you are ethically bound to respect the terms of this license.
                Please confirm that you accept the terms of this license below before you can do any downloads for this resource.
                </p>
                <input type="checkbox" id="agree-chk-download-file">
                <label for="agree-chk-download-file" class="checkbox-label">
                    I accept the terms of this license.
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="download-file-btn"
                   disabled>Download</button>
            </div>
        </div>
    </div>
</div>

{% block wait-for-process-to-complete %}
    <div id="wait-to-complete" title="Processing ..." style="display: none;">
        <p><span style="float:left; margin:12px 12px 50px 0;"></span>
            Please wait for the process to complete.
        </p>
    </div>
{% endblock %}

{% if show_manage_access %}
    {% include "resource-landing-page/manage-access.html" %}

    <div id="dialog-confirm-delete-self-access" class="access-dialog-title" title="Warning! Loss of access">
        <p><span class="ui-icon ui-icon-alert access-warning"></span>
            This action will remove your access to this resource and you will no longer be able to
            access it without someone else sharing it with you again. This is not reversible,
            so <strong>Remove</strong> with caution.
        </p>
    </div>

    <div id="dialog-confirm-change-share-permission" class="access-dialog-title" title="Warning! Loss of owner access">
        <p><span class="ui-icon ui-icon-alert access-warning"></span>
        This action will remove your owner access to this resource. This removal is not reversible. Owner
        access can only be retrieved by another owner later granting you owner access. <strong>Remove</strong> with caution.
        </p>
    </div>

{% endif %}

<div class="modal fade" id="redirect-referenced-url-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="redirect-referenced-url-title">Redirecting to the referenced web URL</h4>
            </div>
            <div class="modal-body">
                The content you have requested to access is not stored in HydroShare, and we can’t guarantee its availability,
                quality, security, or size. If the externally linked content is large, access may take time.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a id="file_redirect_url" type="button" class="btn btn-primary" href="#" target="_blank">Redirect</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="get-file-url-dialog" tabindex="-1" role="dialog"
     aria-labelledby="rename" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Get file URL</h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div id="warnTxtFileURL" class="col-sm-12" style="display:none">
                        <span class="alert alert-warning group-title" role="alert">
                            <div class="flex">
                                <i class="glyphicon glyphicon-info-sign" style="margin-right: 20px;"></i>
                                <em style="padding-right:20px;">
                                    <p class="discoverable_sharing">
                                        You have requested the URL for a file that is within a Discoverable resource.
                                        This resource has Private Link Sharing enabled.
                                        This means that anyone with the link will be able to access the file,
                                        but users without the link will not be permitted unless they have "view" permission on this resource.
                                    </p>
                                    <p class="discoverable">
                                        You have requested the URL for a file that is within a Discoverable resource.
                                        Only you and other HydroShare users who have been granted at least "view" permission will be able to access this URL.
                                        If you want this URL to be publicly available, 
                                        change the sharing status of your resource to "public" or enable Private Link Sharing.
                                    </p>
                                    <p class="private_sharing">
                                        You have requested the URL for a file that is within a Private resource.
                                        This resource has Private Link Sharing enabled.
                                        This means that anyone with the link will be able to access the file,
                                        but users without the link will not be permitted unless they have "view" permission on this resource.
                                    </p>
                                    <p class="private">
                                        You have requested the URL for a file that is within a Private resource.
                                        Only you and other HydroShare users who have been granted at least "view" permission will be able to access this URL.
                                        If you want this URL to be publicly available, change the sharing status of your resource to "public" or enable Private Link Sharing.
                                    </p>
                                </em>
                            </div>
                        </span>
                    </div>
                    <fieldset class="col-sm-12">
                        <div class="input-group">
                            <input readonly id="txtFileURL" type="text" class="form-control click-select-all">
                            <span class="input-group-btn">
                                <button class="btn btn-default clipboard-copy" data-target="txtFileURL"
                                        type="button">
                                    <i class="fa fa-clipboard" aria-hidden="true"></i> Copy
                                </button>
                            </span>
                        </div>
                    </fieldset>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
    <script type="text/javascript" src="{% static 'js/modals.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/identifiers-form.js' %}"></script>
{% endblock %}
