{% load crispy_forms_tags hydroshare_tags %}

<input id="resID" type="hidden" value="{{ cm.short_id }}"/>

{% if page.perms.change and resource_edit_mode %}
    <div class="modal fade" id="add-reference-dialog" tabindex="-1" role="dialog" aria-labelledby="add-reference"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/hsapi/_internal/{{ cm.short_id }}/add-citation/">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="add-reference">Add reference</h4>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="add-citation-input">Citation text:</label>
                            <textarea class="form-control" name="content" id="add-citation-input" cols="30"
                                      rows="10"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="add-creator-dialog" tabindex="-1" role="dialog" aria-labelledby="add-creator" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="add-creator"> Add Author </h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-5 text-center">
                            <div class="radio-inline center-radio-inline text-center">
                                <label>
                                    <div>Person</div>
                                    <input type="radio" checked name="add_author_user_type" value="person">
                                </label>
                            </div>
                        </div>

                        <div class="col-sm-2 text-center or-separator">
                            <span class="text-muted">- Or -</span>
                        </div>

                        <div class="col-sm-5 text-center">
                            <div class="radio-inline center-radio-inline text-center">
                                <label>
                                    <div>Organization</div>
                                    <input type="radio" name="add_author_user_type" value="organization">
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12">
                            <hr>
                        </div>
                    </div>
                </div>

                {# Person #}
                <div data-hs-user-type="person">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-sm-5 text-center">
                                <div class="radio-inline center-radio-inline text-center">
                                    <label>
                                        <div>Existing HydroShare User</div>
                                        <input type="radio" checked name="add_author_person" value="hs_user">
                                    </label>
                                </div>
                            </div>

                            <div class="col-sm-2 text-center or-separator">
                                <span class="text-muted">- Or -</span>
                            </div>

                            <div class="col-sm-5 text-center">
                                <div class="radio-inline center-radio-inline text-center">
                                    <label>
                                        <div>Other</div>
                                        <input type="radio" name="add_author_person" value="other_person">
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-12">
                                <hr>
                            </div>
                        </div>
                    </div>
                    {#  Existing HydroShare User  #}
                    <div data-hs-person-type="hs_user">
                        <div class="modal-body">
                            {{ add_view_hs_user_form.user }}
                        </div>

                        <form action="/hsapi/_internal/{{ cm.short_id }}/creator/add-metadata/" method="POST"
                              enctype="multipart/form-data">
                            {% csrf_token %}
                            <input name="resource-mode" type="hidden" value="edit">

                            <div class="modal-body" style="display:none;">
                                <input maxlength="100" name="name" type="text">
                                <input name="description" type="url">
                                <input name="organization" type="text">
                                <input name="email" type="email">
                                <input maxlength="250" name="address" type="text">
                                <input maxlength="25" name="phone" type="text">
                                <input maxlength="200" name="homepage" type="url">
                                <div id="identifiers"></div>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button id="btn-add-author" type="button" class="btn btn-primary">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>

                    {# Other Person #}
                    {% with "person-type-other-person" as div_id %}
                        <div data-hs-person-type="other_person" style="display:none;">
                            <form action="/hsapi/_internal/{{ cm.short_id }}/creator/add-metadata/" method="POST"
                                  enctype="multipart/form-data">
                                {% csrf_token %}
                                <input name="resource-mode" type="hidden" value="edit">
                                <div class="modal-body">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        {% csrf_token %}
                                        <fieldset>
                                            <div id="{{ div_id }}_name" class="control-group">
                                                <label for="{{ div_id }}_input_name"
                                                       class="control-label requiredField" >Name<span
                                                        class="asteriskField">*</span>
                                                </label>

                                                <div class="controls">
                                                    <input class="form-control input-sm textinput textInput"
                                                           id="{{ div_id }}_input_name" maxlength="100" name="name"
                                                           required="required" type="text"
                                                           placeholder="e.g. 'Smith, John Arnold'">
                                                </div>
                                            </div>

                                            <div id="{{ div_id }}_organization" class="control-group">
                                                <label for="{{ div_id }}_input_organization"
                                                       class="control-label">Organization</label>
                                                <div class="controls">
                                                    <input class="form-control input-sm textinput textInput"
                                                           id="{{ div_id }}_input_organization" maxlength="200"
                                                           name="organization" type="text">
                                                </div>
                                            </div>
                                            <div id="{{ div_id }}_email" class="control-group">
                                                <label for="{{ div_id }}_input_email"
                                                       class="control-label">Email</label>

                                                <div class="controls">
                                                    <input class="form-control input-sm emailinput"
                                                           id="{{ div_id }}_input_email" maxlength="75" name="email"
                                                           type="email">
                                                </div>
                                            </div>
                                            <div id="{{ div_id }}_address" class="control-group">
                                                <label for="{{ div_id }}_input_address"
                                                       class="control-label">Address</label>
                                                <div class="controls">
                                                    <input class="form-control input-sm textinput textInput"
                                                           id="{{ div_id }}_input_address" maxlength="250"
                                                           name="address"
                                                           type="text">
                                                </div>
                                            </div>
                                            <div id="{{ div_id }}_phone" class="control-group">
                                                <label for="{{ div_id }}_input_phone"
                                                       class="control-label">Phone</label>
                                                <div class="controls">
                                                    <input class="form-control input-sm textinput textInput"
                                                           id="{{ div_id }}_input_phone" maxlength="25" name="phone"
                                                           type="text">
                                                </div>
                                            </div>
                                            <div id="{{ div_id }}_homepage" class="control-group">
                                                <label for="{{ div_id }}_input_homepage"
                                                       class="control-label">Homepage</label>
                                                <div class="controls">
                                                    <input class="form-control input-sm urlinput"
                                                           id="{{ div_id }}_input_homepage" maxlength="200"
                                                           name="homepage"
                                                           type="url">
                                                </div>
                                            </div>
                                        </fieldset>
                                        <label class="control-label">Author Identifiers</label>
                                        <div class="modal-identifiers-container height-fix">
                                            {% include "includes/identifiers-form.html" %}
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary btn-disable-after-valid">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    {% endwith %}
                </div>

                {#  Organization  #}
                <div data-hs-user-type="organization" style="display:none">
                    {#  Other Organization  #}
                    {% with "org-type-other-org" as div_id %}
                    <div data-hs-org-type="other_organization">
                        <form action="/hsapi/_internal/{{ cm.short_id }}/creator/add-metadata/" method="POST"
                              enctype="multipart/form-data">
                            {% csrf_token %}
                            <input name="resource-mode" type="hidden" value="edit">
                            <div class="modal-body">
                                {% csrf_token %}
                                <div class="form-group">
                                    {% csrf_token %}
                                    <fieldset>
                                        <div id="{{ div_id }}_name" class="control-group" style="display:none">
                                            <label for="{{ div_id }}_input_name" class="control-label">Name</label>

                                            <div class="controls">
                                                <input class="form-control input-sm textinput textInput"
                                                       id="{{ div_id }}_input_name" maxlength="100" name="name"
                                                       type="text" placeholder="e.g. 'U.S. Army Corps of Engineers'">
                                            </div>
                                        </div>
                                        <div id="{{ div_id }}_organization" class="control-group">
                                            <label for="{{ div_id }}_input_organizatio"
                                                   class="control-label requiredField">Organization Name<span
                                                    class="asteriskField">*</span>
                                            </label>
                                            <div class="controls">
                                                <input class="form-control input-sm textinput textInput"
                                                       id="{{ div_id }}_input_organizatio" maxlength="200"
                                                       name="organization" type="text"
                                                       placeholder="e.g. 'U.S. Army Corps of Engineers'"
                                                       required="required">
                                            </div>
                                        </div>
                                        <div id="{{ div_id }}_email" class="control-group">
                                            <label for="{{ div_id }}_input_email" class="control-label">Email</label>
                                            <div class="controls">
                                                <input class="form-control input-sm emailinput"
                                                       id="{{ div_id }}_input_email" maxlength="75" name="email"
                                                       type="email">
                                            </div>
                                        </div>
                                        <div id="{{ div_id }}_address" class="control-group">
                                            <label for="{{ div_id }}_input_address"
                                                   class="control-label">Address</label>
                                            <div class="controls">
                                                <input class="form-control input-sm textinput textInput"
                                                       id="{{ div_id }}_input_address" maxlength="250" name="address"
                                                       type="text">
                                            </div>
                                        </div>
                                        <div id="{{ div_id }}_phone" class="control-group">
                                            <label for="{{ div_id }}_input_phone" class="control-label">Phone</label>
                                            <div class="controls">
                                                <input class="form-control input-sm textinput textInput"
                                                       id="{{ div_id }}_input_phone" maxlength="25" name="phone"
                                                       type="text">
                                            </div>
                                        </div>
                                        <div id="{{ div_id }}_homepage" class="control-group">
                                            <label for="{{ div_id }}_input_homepage"
                                                   class="control-label">Homepage</label>
                                            <div class="controls">
                                                <input class="form-control input-sm urlinput"
                                                       id="{{ div_id }}_input_homepage" maxlength="200"
                                                       name="homepage" type="url">
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary btn-disable-after-valid">Save Changes</button>
                            </div>
                        </form>
                    </div>
                    {% endwith %}
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="add-contributor-dialog" tabindex="-1" role="dialog"
         aria-labelledby="add-contributor" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="add-contributor"> Add Contributor </h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-5 text-center">
                            <div class="radio-inline center-radio-inline text-center">
                                <label>
                                    <div>Existing HydroShare User</div>
                                    <input type="radio" name="add_contributor_user_type" value="hs_user" checked>
                                </label>
                            </div>
                        </div>

                        <div class="col-sm-2 text-center or-separator">
                            <span class="text-muted">- Or -</span>
                        </div>

                        <div class="col-sm-5 text-center">
                            <div class="radio-inline center-radio-inline text-center">
                                <label>
                                    <div>Other</div>
                                    <input type="radio" name="add_contributor_user_type" value="other">
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12">
                            <hr>
                        </div>
                    </div>
                </div>

                {#  Existing HydroShare User  #}
                {% with "user-type-hs-user" as div_id %}
                <div data-hs-user-type="hs_user">
                    <div class="modal-body">
                        {{ add_view_contrib_user_form.user }}
                    </div>

                    <form action="/hsapi/_internal/{{ cm.short_id }}/contributor/add-metadata/" method="POST"
                          enctype="multipart/form-data">
                        {% csrf_token %}
                        <input name="resource-mode" type="hidden" value="edit">
                        <div class="modal-body" style="display:none;">
                            <div class="form-group">
                                <fieldset>
                                    <div id="{{ div_id }}_name" class="control-group">
                                        <label for="{{ div_id }}_input_name"
                                               class="control-label requiredField">Name<span
                                                class="asteriskField">*</span></label>

                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_name" maxlength="100" name="name"
                                                   required="required" type="text"></div>
                                    </div>

                                    <div id="{{ div_id }}_description" class="control-group">
                                        <label for="{{ div_id }}_input_description"
                                               class="control-label">HydroShare User Identifier (URL)</label>
                                        <div class="controls">
                                            <input class="form-control input-sm urlinput"
                                                   id="{{ div_id }}_input_description" maxlength="200"
                                                   name="description" type="url">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_organization" class="control-group">
                                        <label for="{{ div_id }}_input_organization"
                                               class="control-label">Organization</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_organization" maxlength="200"
                                                   name="organization" type="text">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_email" class="control-group">
                                        <label for="{{ div_id }}_input_email" class="control-label">Email</label>

                                        <div class="controls">
                                            <input class="form-control input-sm emailinput"
                                                   id="{{ div_id }}_input_email" maxlength="75" name="email"
                                                   type="email">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_address" class="control-group">
                                        <label for="{{ div_id }}_input_address"
                                               class="control-label">Address</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_address" maxlength="250"
                                                   name="address"
                                                   type="text">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_phone" class="control-group">
                                        <label for="{{ div_id }}_input_phone" class="control-label">Phone</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_phone" maxlength="25" name="phone"
                                                   type="text">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_homepage" class="control-group">
                                        <label for="{{ div_id }}_input_homepage"
                                               class="control-label">Homepage</label>
                                        <div class="controls">
                                            <input class="form-control input-sm urlinput"
                                                   id="{{ div_id }}_input_homepage" maxlength="200"
                                                   name="homepage" type="url">
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button id="btn-add-hydroshare-user" type="button" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
                {% endwith %}

                {#  Other Person #}
                {% with "user-type-other-user" as div_id %}
                <div data-hs-user-type="other" style="display:none">
                    <form action="/hsapi/_internal/{{ cm.short_id }}/contributor/add-metadata/" method="POST"
                          enctype="multipart/form-data">
                        {% csrf_token %}
                        <input name="resource-mode" type="hidden" value="edit">
                        <div class="modal-body">
                            <div class="form-group">
                                <fieldset>
                                    <div id="{{ div_id }}_name" class="control-group">
                                        <label for="{{ div_id }}_input_name"
                                               class="control-label requiredField">Name<span
                                                class="asteriskField">*</span></label>

                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_name" maxlength="100" name="name"
                                                   required="required" type="text">
                                        </div>
                                    </div>

                                    <div id="{{ div_id }}_organization" class="control-group">
                                        <label for="{{ div_id }}_input_organization"
                                               class="control-label">Organization</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_organization" maxlength="200"
                                                   name="organization" type="text">
                                        </div>
                                    </div>
                                    <div id="{{ div_id }}_email" class="control-group">
                                        <label for="{{ div_id }}_input_email"
                                               class="control-label">Email</label>

                                        <div class="controls">
                                            <input class="form-control input-sm emailinput"
                                                   id="{{ div_id }}_input_email" maxlength="75" name="email"
                                                   type="email">
                                        </div>
                                    </div>
                                    <div id="{{ div_id }}_address" class="control-group">
                                        <label for="{{ div_id }}_input_address"
                                               class="control-label">Address</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_address" maxlength="250"
                                                   name="address" type="text">
                                        </div>
                                    </div>
                                    <div id="{{ div_id }}_phone" class="control-group">
                                        <label for="{{ div_id }}_input_phone"
                                               class="control-label">Phone</label>
                                        <div class="controls">
                                            <input class="form-control input-sm textinput textInput"
                                                   id="{{ div_id }}_input_phone" maxlength="25" name="phone"
                                                   type="text">
                                        </div>
                                    </div>
                                    <div id="{{ div_id }}_homepage" class="control-group">
                                        <label for="{{ div_id }}_input_homepage"
                                               class="control-label">Homepage</label>
                                        <div class="controls">
                                            <input class="form-control input-sm urlinput"
                                                   id="{{ div_id }}_input_homepage" maxlength="200"
                                                   name="homepage" type="url">
                                        </div>
                                    </div>
                                </fieldset>

                                <label class="control-label">Author Identifiers</label>
                                <div class="modal-identifiers-container height-fix">
                                    {% include "includes/identifiers-form.html" %}
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary btn-disable-after-valid">Save Changes</button>
                        </div>
                    </form>
                </div>
                {% endwith %}
            </div>
        </div>
    </div>

    <div class="modal fade in" id="extraMetaDialog" tabindex="-1" role="dialog" aria-labelledby="add-extra-meta" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form enctype="multipart/form-data">
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title" id="extra_meta_title"> Add/Edit Extended Metadata </h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <input id="edit_extra_meta_row_id" type="hidden" />
                            <input id="old_extra_meta_name" type="hidden" />
                            <div id="div_extra_meta_name" class="control-group">
                                <label for="extra_meta_name" class="control-label requiredField">Name</label>
                                <div class="controls">
                                    <input class="form-control input-sm textinput textInput" required
                                           id="extra_meta_name_input" maxlength="100" name="name" type="text">
                                </div>
                            </div>
                            <div id="div_extra_meta_value" class="control-group">
                                <label for="extra_meta_value" class="control-label">Value</label>
                                <div class="controls">
                                    <textarea required class="form-control input-sm textarea" cols="40"
                                                        id="extra_meta_value_input" name="value"
                                                        rows="10"></textarea>
                                </div>
                            </div>
                            <div id="extra_meta_msg" style="display: None"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button id="btn-confirm-extended-metadata" type="button" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="create-folder-dialog" tabindex="-1" role="dialog"
     aria-labelledby="create-folder" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h4 class="modal-title" id="create-folder">New Folder</h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    {# Folder Name #}
                    <fieldset class="col-sm-12">
                        <label>Folder Name *</label>
                        <input id="txtFolderName" class="form-control modal-only-required">
                    </fieldset>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" id="btn-create-folder" class="btn btn-primary disabled" data-dismiss="modal">Create
                </button>
            </div>
        </div>
    </div>
</div>

    <div class="modal fade in" id="validate-reference-url-dialog" tabindex="-1" role="dialog"
         aria-labelledby="validate-reference-url" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="validate-url-title">Unable to validate URL</h4>
                </div>
                <div class="modal-body">
                    <p>
                        Unable to validate URL link. This may be due to an error in the URL or password or automated bot
                        protection at the hosting site. If you still want to create referenced content using this invalid URL
                        link, click <strong>Proceed</strong>. Otherwise, click <strong>Cancel</strong>.
                    </p>
                    <input type="hidden" id="ref_name_passover" value=""/>
                    <input type="hidden" id="ref_url_passover" value=""/>
                    <input type="hidden" id="new_ref_url_passover" value=""/>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-reference-url-without-validation" class="btn btn-default"
                            data-dismiss="modal">Proceed
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="add-reference-url-dialog" tabindex="-1" role="dialog"
         aria-labelledby="add-reference" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="create-folder">Add Content From The Web</h4>
                </div>

                <div class="modal-body">
                    <div class="form-group">
                        <fieldset>
                        {# Reference Name #}
                            <label class="col-sm-12">Create a name for the referenced content. This name will be displayed in the file content area of the resource</label>
                            <label for="txtRefName" class="col-sm-2 control-label">Name: *</label>
                            <input id="txtRefName" class="col-sm-10 modal-only-required" placeholder="Untitled">
                        </fieldset>
                    </div>
                    {# Reference URL #}
                    <div class="form-group">
                        <fieldset>
                            <label class="col-sm-12">Specify the HTTP or FTP URL of a file or website</label>
                            <label for="txtRefURL" class="col-sm-2 control-label">URL: *</label>
                            <input id="txtRefURL" class="col-sm-10 modal-only-required" placeholder="HTTP or FTP URL">
                        </fieldset>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-add-reference-url" class="btn btn-primary btn-disable-after disabled"
                            data-dismiss="modal">Add Content
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="rename-dialog" tabindex="-1" role="dialog"
         aria-labelledby="rename" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="rename">Rename</h4>
                </div>

                <div class="modal-body">

                    <div class="row">
                        <fieldset class="col-sm-12">
                            <label>Name *</label>
                            <div class="input-group">
                                <input id="txtName" class="form-control modal-only-required">
                                {% if cm|resource_type == "Time Series" %}
                                <span class="input-group-addon" id="file-type-addon"></span>
                                {% endif %}
                            </div>
                        </fieldset>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-rename" class="btn btn-primary" data-dismiss="modal">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="zip-folder-dialog" tabindex="-1" role="dialog"
         aria-labelledby="rename" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="rename">Zip Folder</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <fieldset class="col-sm-12">
                            <label>Name *</label>
                            <div class="input-group">
                                <input id="txtZipName" type="text" class="form-control modal-only-required" placeholder="File name"
                                       aria-describedby="file-type-addon">
                                <span class="input-group-addon">.zip</span>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-confirm-zip" class="btn btn-primary" data-dismiss="modal">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="edit-referenced-url-dialog" tabindex="-1" role="dialog" aria-labelledby="edit-ref-label"
         aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="edit-referenced-url-title">Edit the referenced URL</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <fieldset class="col-sm-12">
                            <label>Reference URL *</label>
                            <input id="txtNewRefURL" class="form-control modal-only-required">
                        </fieldset>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btn-edit-url" class="btn btn-primary" data-dismiss="modal">Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add credit source Modal -->
    <div class="modal fade" id="add-funding-agency" tabindex="-1" role="dialog" aria-labelledby="add-funding-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/hsapi/_internal/{{ cm.short_id }}/fundingagency/add-metadata/" method="POST"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title" id="add-funding-label"> Add Funding Agency</h4></div>
                    <div class="modal-body">
                        <div class="form-group">
                            <fieldset>
                                {# Agency Name (Required) #}
                                <div id="div_id_agency_name" class="control-group">
                                    <label for="agency_name" class="control-label requiredField">
                                        Agency Name<span class="asteriskField">*</span>
                                    </label>

                                    <div class="controls">
                                        <input class="form-control input-sm textInput"
                                               maxlength="250" name="agency_name" required="required" type="text">
                                    </div>
                                </div>

                                {# Award Title #}
                                <div id="div_id_award_title" class="control-group">
                                    <label for="award_title" class="control-label">Award Title</label>
                                    <div class="controls">
                                        <input class="form-control input-sm" maxlength="250"
                                               name="award_title">
                                    </div>
                                </div>

                                {# Award Number #}
                                <div id="div_id_award_number" class="control-group">
                                    <label for="award_number" class="control-label">Award Number</label>
                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput" maxlength="100"
                                               name="award_number" type="text">
                                    </div>
                                </div>

                                {# Agency URL #}
                                <div id="div_id_agency_url" class="control-group">
                                    <label for="agency_url" class="control-label">Agency URL</label>

                                    <div class="controls">
                                        <input class="form-control input-sm urlinput" maxlength="200"
                                               name="agency_url" type="url">
                                    </div>
                                </div>

                            </fieldset>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-save-funding-agency btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit credit source Modal -->
    {% for agency in fundingagnency_formset.initial %}
        <div class="modal fade" id="edit-funding-agency-{{ agency.id }}" tabindex="-1" role="dialog"
             aria-labelledby="add-funding-label" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form data-index="{{ forloop.counter0 }}" action="/hsapi/_internal/{{ cm.short_id }}/fundingagency/{{ agency.id }}/update-metadata/"
                          method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input name="resource-mode" type="hidden" value="edit">

                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                            <h4 class="modal-title" id="add-funding-label"> Edit Funding Agency</h4>
                        </div>

                        <div class="modal-body">
                            <div class="form-group">
                                <fieldset>
                                    {# Agency Name (Required) #}
                                    <div id="div_id_agency_name" class="control-group">
                                        <label for="agency_name" class="control-label requiredField">Agency Name<span
                                                class="asteriskField">*</span></label>

                                        <div class="controls"><input class="form-control input-sm textInput" maxlength="250" name="agency_name"
                                                                     required="required" type="text"
                                                                     value="{{ agency.agency_name }}"></div>
                                    </div>

                                    {# Award Title #}
                                    <div id="div_id_award_title" class="control-group">
                                        <label for="award_title" class="control-label">Award Title</label>

                                        <div class="controls"><input class="form-control input-sm" maxlength="250"
                                                                     name="award_title" value="{{ agency.award_title }}">
                                        </div>
                                    </div>

                                    {# Award Number #}
                                    <div id="div_id_award_number" class="control-group">
                                        <label for="award_number" class="control-label">Award Number</label>

                                        <div class="controls"><input class="form-control input-sm textinput textInput" maxlength="100"
                                                                     name="award_number" type="text"
                                                                     value="{{ agency.award_number }}"></div>
                                    </div>

                                    {# Agency URL #}
                                    <div id="div_id_agency_url" class="control-group">
                                        <label for="agency_url" class="control-label">Agency URL</label>

                                        <div class="controls">
                                            <input class="form-control input-sm urlinput" maxlength="200"
                                                   name="agency_url" type="url" value="{{ agency.agency_url }}">
                                        </div>
                                    </div>

                                </fieldset>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary btn-save-funding-agency btn-disable-after-valid"
                                    data-index="{{ forloop.counter0 }}">Save changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade in" id="delete-funding-agency-{{ agency.id }}" tabindex="-1" role="dialog"
             aria-labelledby="delete-source" aria-hidden="false">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title" id="delete-funding-agency">Delete Funding Agency</h4>
                    </div>

                    <div class="modal-body"><strong>Are you sure you want to delete this entry?</strong></div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <a type="button" class="btn btn-danger btn-disable-after"
                           href="/hsapi/_internal/{{ cm.short_id }}/fundingagency/{{ agency.id }}/delete-metadata/">Delete</a>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}

    {% for source in source_formset.initial %}
    <div class="modal fade in" id="delete-source-element-dialog{{ source.id }}" tabindex="-1" role="dialog"
         aria-labelledby="delete-source" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="delete-source">Delete metadata element</h4></div>
                <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger btn-disable-after"
                       href="/hsapi/_internal/{{ cm.short_id }}/source/{{ source.id }}/delete-metadata/">Delete</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="edit-source-dialog{{ source.id }}" tabindex="-1" role="dialog" aria-labelledby="edit-source"
         aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="id_source_{{ source.id }}" method="POST" enctype="multipart/form-data"
                      action="/hsapi/_internal/{{ cm.short_id }}/source/{{ source.id }}/update-metadata/">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title" id="edit-source"> Edit Source </h4></div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <div class="form-group">
                            {% csrf_token %}
                            <fieldset>
                                <legend>Source</legend>
                                <div id="div_id_derived_from" class="control-group">
                                    <label for="id_source-{{ forloop.counter0 }}-derived_from"
                                           class="control-label">Derived from*</label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput" required="required"
                                               id="id_source-{{ forloop.counter0 }}-derived_from" maxlength="300"
                                               name="source-{{ forloop.counter0 }}-derived_from"
                                               type="text" value="{{ source.derived_from }}">
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}

    {% for relation in relation_formset.initial %}
    <div class="modal fade in" id="delete-relation-element-dialog{{ relation.id }}" tabindex="-1" role="dialog"
         aria-labelledby="delete-relation" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="delete-relation">Delete metadata element</h4></div>
                <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger btn-disable-after"
                       href="/hsapi/_internal/{{ cm.short_id }}/relation/{{ relation.id }}/delete-metadata/">Delete</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="edit-relation-dialog_{{ relation.id }}" tabindex="-1" role="dialog"
         aria-labelledby="edit-relation" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/hsapi/_internal/{{ cm.short_id }}/relation/{{ relation.id }}/update-metadata/"
                      method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title" id="edit-relation"> Edit Relation </h4>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}

                        <div class="form-group">
                            {% csrf_token %}
                            <fieldset>
                                <div id="div_id_type" class="control-group space-bottom">
                                    <label for="id_type" class="control-label requiredField">
                                    Relation type<span class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <select class="form-control input-sm select" id="id_relation-{{ forloop.counter0 }}-type" name="relation-{{ forloop.counter0 }}-type">
                                            <option value="">---------</option>
                                            {% for type_value, type_display in relation_source_types %}
                                                <option value={{ type_value }} {% if relation.type == type_value %}selected="selected"{% endif %}>{{ type_display }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div id="div_id_value" class="control-group">
                                    <label for="id_value" class="control-label requiredField">
                                    Related to<span class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_relation-{{ forloop.counter0 }}-value"
                                               maxlength="500" name="relation-{{ forloop.counter0 }}-value"
                                               type="text" value="{{ relation.value }}">
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}

    {% for contributor in contributor_formset.initial %}
    <div class="modal fade" id="edit-contributor-dialog{{ contributor.id }}" tabindex="-1" role="dialog"
         aria-labelledby="edit-contributor" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="id_contributor_{{ contributor.id }}" action="/hsapi/_internal/{{ cm.short_id }}/contributor/{{ contributor.id }}/update-metadata/"
                      method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-hidden="true">Ã—
                        </button>
                        <h4 class="modal-title" id="edit-contributor"> Edit Contributor </h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <fieldset>
                                <div id="div_id_name" class="control-group">
                                    <label class="control-label requiredField">Name<span
                                            class="asteriskField">*</span></label>

                                    <div class="controls"><input
                                            class="form-control input-sm textinput textInput"
                                            id="id_contributor-{{ contributor.order|add:"-1" }}-name" maxlength="100" name="contributor-{{ contributor.order|add:"-1" }}-name"
                                            required="required" type="text" value="{% if contributor.name %}{{ contributor.name }}{% endif %}"></div>
                                </div>
                                {% if contributor.description %}
                                    <div id="div_id_description" class="control-group">
                                        <label class="control-label">HydroShare User Identifier (URL)</label>

                                        <div class="controls"><input
                                                class="form-control input-sm urlinput"
                                                id="id_creator-{{ contributor.order|add:"-1" }}-description"
                                                maxlength="200"
                                                name="creator-{{ contributor.order|add:"-1" }}-description" type="url"
                                                value="{{ contributor.description }}"
                                                readonly></div>
                                    </div>
                                {% endif %}
                                <div id="div_id_organization" class="control-group">
                                    <label class="control-label">Organization</label>

                                    <div class="controls"><input
                                            class="form-control input-sm textinput textInput"
                                            id="id_contributor-{{ contributor.order|add:"-1" }}-organization" maxlength="200"
                                            name="contributor-{{ contributor.order|add:"-1" }}-organization" type="text" value="{% if contributor.organization %}{{ contributor.organization }}{% endif %}"></div>
                                </div>
                                <div id="div_id_email" class="control-group">
                                    <label class="control-label">Email</label>

                                    <div class="controls">
                                        <input class="form-control input-sm emailinput"
                                               id="id_contributor-{{ contributor.order|add:"-1" }}-email" maxlength="75" name="contributor-{{ contributor.order|add:"- 1" }}-email"
                                               type="email" value="{% if contributor.email %}{{ contributor.email }}{% endif %}">
                                    </div>
                                </div>
                                <div id="div_id_address" class="control-group">
                                    <label class="control-label">Address</label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_contributor-{{ contributor.order|add:"-1" }}-address" maxlength="250"
                                               name="contributor-{{ contributor.order|add:"-1" }}-address"
                                               type="text" value="{% if contributor.address %}{{ contributor.address }}{% endif %}">
                                    </div>
                                </div>
                                <div id="div_id_phone" class="control-group">
                                    <label class="control-label">Phone</label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_contributor-{{ contributor.order|add:"-1" }}-phone" maxlength="25" name="contributor-{{ contributor.order|add:"- 1" }}-phone"
                                               type="text" value="{% if contributor.phone %}{{ contributor.phone }}{% endif %}">
                                    </div>
                                </div>
                                <div id="div_id_homepage" class="control-group">
                                    <label class="control-label">Homepage</label>

                                    <div class="controls"><input
                                            class="form-control input-sm urlinput"
                                            id="id_contributor-{{ contributor.order|add:"-1" }}-homepage" maxlength="200" name="contributor-{{ contributor.order|add:"-1" }}-homepage"
                                            type="url" value="{% if contributor.homepage %}{{ contributor.homepage }}{% endif %}"></div>
                                </div>
                            </fieldset>
                            <label class="control-label">Author Identifiers</label>
                            <div class="modal-identifiers-container height-fix">
                                {% include "includes/identifiers-form.html" with identifiers=contributor.identifiers %}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="delete-contributor-dialog{{ contributor.id }}" tabindex="-1" role="dialog"
         aria-labelledby="delete-contributor" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title" id="delete-contributor">Delete metadata element</h4></div>
                <div class="modal-body"><strong>Are you sure you want to delete this metadata element?</strong>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a type="button" class="btn btn-danger btn-disable-after"
                       href="/hsapi/_internal/{{ cm.short_id }}/contributor/{{ contributor.id }}/delete-metadata/">Delete</a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

    <div class="modal fade" id="edit-creator-dialog" tabindex="-1" role="dialog"
         aria-labelledby="edit-creator" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">Ã—
                    </button>
                    <h4 class="modal-title" id="edit-creator"> Edit Author</h4>
                </div>

                <div class="modal-body modal-body--delete">
                    <span title="Remove"
                       data-toggle="collapse" data-target="#confirm-delete-author"
                       class="glyphicon glyphicon-trash icon-button table-icon btn-remove"></span>

                    <div id="confirm-delete-author" class="collapse row" style="margin-top: 35px;">
                        <div class="col-xs-6">
                            <strong>Are you sure you want to delete this metadata element?</strong>
                        </div>
                        <div class="col-xs-6">
                            <button type="button" class="btn btn-default" data-toggle="collapse"
                                    style="margin-right: 5px;"
                                    data-target="#confirm-delete-author">Cancel
                            </button>
                            <a type="button" class="btn btn-danger btn-disable-after"
                               href="/hsapi/_internal/{{ cm.short_id }}/creator/{{ author.id }}/delete-metadata/">
                                Delete
                            </a>
                        </div>
                    </div>
                </div>

                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">

                    <div class="modal-body">
                        <div class="form-group">
                            <fieldset>
                                <div class="control-group control-group--name">
                                    <label for="creator-name" class="control-label requiredField">Name<span
                                            class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <input id="creator-name" class="form-control input-sm textinput textInput"
                                               maxlength="100">
                                    </div>
                                </div>

                                <div class="control-group control-group--description">
                                    <label for="creator-description" class="control-label">HydroShare User Identifier (URL)</label>

                                    <div class="controls">
                                        <input id="creator-description" class="form-control input-sm urlinput"
                                               maxlength="200" type="url" readonly>
                                    </div>
                                </div>

                                <div class="control-group control-group--organization">
                                    <label for="creator-organization" class="control-label">Organization<span class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <input id="creator-organization" type="text"
                                               class="form-control input-sm textinput textInput" maxlength="200">
                                    </div>
                                </div>

                                <div class="control-group control-group--email">
                                    <label for="creator-email" class="control-label">Email</label>

                                    <div class="controls">
                                        <input id="creator-email" class="form-control input-sm emailinput" maxlength="75"
                                               type="email">
                                    </div>
                                </div>

                                <div class="control-group control-group--address">
                                    <label for="creator-address" class="control-label">Address</label>

                                    <div class="controls">
                                        <input id="creator-address" class="form-control input-sm textinput textInput"
                                               maxlength="250" type="text">
                                    </div>
                                </div>

                                <div class="control-group control-group--phone">
                                    <label for="creator-phone" class="control-label">Phone</label>

                                    <div class="controls">
                                        <input id="creator-phone" class="form-control input-sm textinput textInput"
                                               maxlength="25" type="text">
                                    </div>
                                </div>

                                <div class="control-group control-group--homepage">
                                    <label for="creator-homepage" class="control-label">Homepage</label>

                                    <div class="controls">
                                        <input class="form-control input-sm urlinput"
                                               id="creator-homepage" maxlength="200" type="url">
                                    </div>
                                </div>
                            </fieldset>

                            <label class="control-label">Author Identifiers</label>
                            <div class="modal-identifiers-container height-fix">
                                {% include "includes/identifiers-form.html" with identifiers=author.identifiers %}
                            </div>
                        </div>
                    </div>

                    {# Hidden in replacement for drag and drop, but still needed for form submission here #}
                    <input class="hidden-form input-order" type="number">

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="add-source-dialog" tabindex="-1" role="dialog" aria-labelledby="add-source"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/hsapi/_internal/{{ cm.short_id }}/source/add-metadata/" method="POST"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title" id="add-source">Add Source</h4></div>
                    <div class="modal-body">
                        {% csrf_token %}

                        <div class="form-group">
                            {% csrf_token %}
                            <fieldset>
                                <legend>Source</legend>
                                <div id="div_id_derived_from" class="control-group">
                                    <label for="id_derived_from" class="control-label">Derived from*</label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput" id="id_derived_from"
                                               required="required" maxlength="300" name="derived_from" type="text">
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="add-relation-dialog" tabindex="-1" role="dialog" aria-labelledby="add-relation"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/hsapi/_internal/{{ cm.short_id }}/relation/add-metadata/"
                      method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input name="resource-mode" type="hidden" value="edit">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                        <h4 class="modal-title" id="add-relation"> Add Relation </h4>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}

                        <div class="form-group">
                            {% csrf_token %}
                            <fieldset>
                                <div id="div_id_type" class="control-group space-bottom">
                                    <label for="id_type" class="control-label requiredField">
                                    Type of relationship<span class="asteriskField">*</span></label>

                                    <div class="controls">
                                        <select class="form-control input-sm select" id="id_type" name="type">
                                            {% for type_value, type_display in relation_source_types %}
                                                <option value={{ type_value }}>{{ type_display }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div id="div_id_value" class="control-group">
                                    <label for="id_related_to_input" class="control-label requiredField">
                                        Full text citation, URL link for, or description of the related resource
                                        <span class="asteriskField">*</span>
                                    </label>

                                    <div class="controls">
                                        <input class="form-control input-sm textinput textInput"
                                               id="id_related_to_input" maxlength="500" name="value" required="required"
                                               type="text">
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary btn-disable-after-valid">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade in" id="remove-aggregation-dialog" tabindex="-1" role="dialog"
         aria-labelledby="remove-aggregation" aria-hidden="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h4 class="modal-title">Remove content type</h4>
                </div>
                <div class="modal-body">
                    <p>Removing the content type will remove the metadata associated with this
                    content.</p>
                    <p>Are you sure you want to do this?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnCancelRemoveAggregation" class="btn btn-default"
                            data-dismiss="modal">Cancel
                    </button>
                    <button type="button" id="btnRemoveAggregation" class="btn btn-danger"
                            data-dismiss="modal">Remove
                    </button>
                </div>
            </div>
        </div>
    </div>

    {% include "irods_signin.html" %}
    {% include "irods_upload_add.html" %}

{% endif %}

<div class="modal fade" id="large-file-download-alert" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="large-file-download-close">Download Alert</h4>
            </div>
            <div class="modal-body alert alert-warning alert-dismissible" role="alert">
                <p>
                    File larger than 1GB cannot be downloaded directly via HTTP. Please
                    create an iRODS account in your iRODS user zone from your profile page
                    if you have not done so already, and replicate the resource to your iRODS
                    user zone, then download the large file via iRODS clients such as
                    <a href="https://docs.irods.org/master/icommands/user/" target="_blank">
                    icommands</a> and
                    <a href="https://help.hydroshare.org/accessing-hydroshare-irods-from-a-windows-pc-or-mac/"
                       target="_blank">Cyberduck</a>.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% if not resource_edit_mode and not is_replaced_by %}
    {% if page.perms.change or is_owner_user and cm.raccess.published %}
        {% if page.perms.delete or cm.raccess.published %}
            <div class="modal fade" id="new-version-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="new-version-resource-title">Create New Version of This Resource</h4>
                        </div>
                        <div class="modal-body">
                            Creating a new version will obsolete this resource. This resource will be still available in HydroShare,
                            but only the newer version will be discoverable via the HydroShare search interface. The new version is
                            a complete new resource with new identifier. It will contain a link back to the previous version and the
                            previous version will have a link to the next version. This can be repeated resulting in a sequence of
                            multiple versions each linked to next and previous versions. Only the most recent version can be edited
                            or deleted. If you delete the most recent version, the previous version becomes the most recent and editable.
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <a type="button" class="btn btn-danger"
                               href="/hsapi/_internal/{{ cm.short_id }}/create-new-version-resource/">Create New Version</a>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        {% if page.perms.delete and cm.can_be_published %}
            <div class="modal fade" id="submit-for-publication-dialog" tabindex="-1" role="dialog"
                 aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="submit-for-publication-title">Submit resource for publication</h4>
                        </div>
                        <div class="modal-body">
                            <p>
                                Upon submitting the resource for publication it will be permanently published and assigned a
                                digital object identifier (DOI). This is <strong>final</strong> and changes can only be made
                                on a new version (copy) of the resource.
                            </p>
                            <p>
                                 Please confirm that you accept the HydroShare Publication Agreement shown below.
                            </p>
                            <div class="iframe-border">
                                <iframe id="pub-agreement-frame" scrolling="no" src="https://www.hydroshare.org/publication-agreement/"></iframe>
                            </div>
                            <input type="checkbox" id="agree-chk"><label for="agree-chk" class="checkbox-label">I accept the HydroShare Publication Agreement.</label>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button class="btn btn-danger" id="publish-btn" data-toggle="modal" data-dismiss="modal" data-target="#submit-for-publication-dialog-2" disabled>Publish</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="submit-for-publication-dialog-2" tabindex="-1" role="dialog"
                 aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="submit-for-publication-title">Are you sure you want to formally publish this resource?</h4>
                        </div>
                        <div class="modal-body">
                            <p>
                                <strong>Are you sure you want to formally publish this resource?</strong> You will <strong>NOT</strong>
                                be able to edit your resource or its metadata if you proceed. This is a permanent step and should only
                                be done when you are finished modifying your resource and you are ready to formally publish it.
                            </p>
                            <p>
                                If you want to make your resource public or share with specific HydroShare users without formally
                                publishing it, click <strong>"Cancel"</strong> and use the manage access panel or toggle your resource
                                to be public instead.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <a type="button" id="publish-btn-2" class="btn btn-danger" href="/hsapi/_internal/{{ cm.short_id }}/publish/">Publish</a>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        {% if page.perms.delete %}
            {% block modal_delete_resource %}
                {% if page.perms.change %}
                    <div class="modal fade" id="delete-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="delete-resource-title"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="delete-resource-title">Delete Resource</h4>
                                </div>
                                <div class="modal-body">
                                    <strong>THIS IS A PERMANENT ACTION. </strong>
                                    <ul>
                                        <li>This will delete the resource file.</li>
                                        <li>A copy of your resource file will not be retained by Hydroshare.</li>
                                        <li>We highly recommend that you download the latest copy of your resource file before
                                            confirming this action.
                                        </li>
                                    </ul>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                    <a type="button" class="btn btn-danger"
                                       href="/hsapi/_internal/{{ cm.short_id }}/delete-resource/">Delete</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {%  endblock %}
        {% endif %}
    {% endif %}

    {% if user.is_authenticated and rights.statement %}
        {% if cm.raccess.public or is_view_user or is_edit_user or is_owner_user %}
            {% if allow_resource_copy %}
                <div class="modal fade" id="copy-resource-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title" id="copy-resource-title">Copy This Resource</h4>
                            </div>
                            <div class="modal-body">
                                {% if rights.statement|length > 1000 %}
                                    <div class="pre-scrollable">
                                        <span>{{ rights.statement|linebreaks }}</span>
                                    </div>
                                {% else %}
                                    <span>{{ rights.statement|linebreaks }}</span>
                                {% endif %}
                                <span class="rights-url"><a href="{{ rights.url }}">&nbsp{{ rights.url }}</a></span>
                                <p>
                                In copying this resource you are ethically bound to respect the terms of this license.
                                Please confirm that you accept the terms of this license below before you can copy this resource.
                                </p>
                                <input type="checkbox" id="agree-chk-copy">
                                <label for="agree-chk-copy" class="checkbox-label">
                                    I accept the terms of this license.
                                </label>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <a type="button" class="btn btn-success" id="copy-btn"
                                   href="/hsapi/_internal/{{ cm.short_id }}/copy-resource/" disabled>Copy this resource</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endif %}
    {% endif %}
{% endif %}

<div class="modal fade" id="license-agree-dialog-bag" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="license-agree-title">Resource License Agreement</h4>
            </div>
            <div class="modal-body">
                {% if rights.statement|length > 1000 %}
                    <div class="pre-scrollable">
                        <span>{{ rights.statement|linebreaks }}</span>
                    </div>
                {% else %}
                    <span>{{ rights.statement|linebreaks }}</span>
                {% endif %}
                <span class="rights-url"><a href="{{ rights.url }}">&nbsp{{ rights.url }}</a></span>
                <p style="margin-top: 5px">
                In downloading this resource contents you are ethically bound to respect the terms of this license.
                Please confirm that you accept the terms of this license below before you can do any downloads for this resource.
                </p>
                <input type="checkbox" id="agree-chk-download-bag">
                <label for="agree-chk-download-bag" class="checkbox-label">
                    I accept the terms of this license.
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a type="button" class="btn btn-success" id="download-bag-btn"
                   href="{{ cm.bag_url }}" disabled>Download</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="license-agree-dialog-file" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="license-agree-title">Resource License Agreement</h4>
            </div>
            <div class="modal-body">
                {% if rights.statement|length > 1000 %}
                    <div class="pre-scrollable">
                        <span>{{ rights.statement|linebreaks }}</span>
                    </div>
                {% else %}
                    <span>{{ rights.statement|linebreaks }}</span>
                {% endif %}
                <span class="rights-url"><a href="{{ rights.url }}">&nbsp{{ rights.url }}</a></span>
                <p style="margin-top: 5px">
                In downloading this resource contents you are ethically bound to respect the terms of this license.
                Please confirm that you accept the terms of this license below before you can do any downloads for this resource.
                </p>
                <input type="checkbox" id="agree-chk-download-file">
                <label for="agree-chk-download-file" class="checkbox-label">
                    I accept the terms of this license.
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="download-file-btn"
                   disabled>Download</button>
            </div>
        </div>
    </div>
</div>

{% if cm.resource_type != "ToolResource" %}
    <div class="modal fade" id="rep-resource-to-irods-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="rep-res-to-irods-title">Copy resource bag to your iRODS user zone</h4>
                </div>
                <div class="modal-body">
                    Are you sure you want to copy this resource bag to your iRODS user zone?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a id="btn-replicate" class="btn btn-danger">Copy</a>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% block wait-for-process-to-complete %}
    <div id="wait-to-complete" title="Processing ..." style="display: none;">
        <p><span style="float:left; margin:12px 12px 50px 0;"></span>
            Please wait for the process to complete.
        </p>
    </div>
{% endblock %}

{% if show_manage_access %}
    {#======= Manage access modal window begins =======#}
    <div class="modal fade" id="manage-access">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Manage access</h4>
                </div>

                <div class="modal-body">
                    <div class="alert alert-info" role="alert">
                        <p><span class="glyphicon glyphicon-info-sign" aria-hidden="true" data-toggle="collapse"
                                 data-target="#usage-info">&nbsp;</span>
                            Use this window to share your resource with specific HydroShare users. You can give other
                            users the ability to view or edit this resource. You can also add additional owners who
                            will have full permissions.</p>
                        <br>

                        <div id="usage-info" class="collapse">
                            <ul>
                                <li>
                                    <p><strong>Owners</strong> can perform all operations on a resource and set whether
                                        a resource is Public,
                                        Discoverable, or Private and Shareable. Resources that are Public have all their
                                        content
                                        visible to all users. Resources that are Discoverable have only their metadata
                                        public.
                                        Resources that are private are only accessible to specific users or groups that
                                        they have been shared with.</p>
                                </li>
                                <li>
                                    <p><strong>Editors</strong> can edit resource metadata and add and delete resource
                                        content files. If the resource
                                        is Shareable editors can use manage access to extend editing or viewing access
                                        to other users.</p>
                                </li>
                                <li><p><strong>Viewers</strong> can view resource metadata and download resource content
                                    files. If the resource is
                                    Shareable viewers can use manage access to extend viewing access to other users.</p>
                                </li>
                            </ul>
                        </div>
                        <div data-toggle="collapse" data-target="#usage-info"
                           class="btn-show-more btn btn-default btn-xs">Show More</div>
                        <br>
                    </div>

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Who has access</h3>
                        </div>
                        <div class="panel-body panel-access ">
                            <table class="table access-table">
                                <tbody>
                                    {# Empty row used as template to generate subsequent rows #}
                                    <tr id="templateRow">
                                        <td>
                                            <table class="user-scope">
                                                <td>
                                                    <div class="profile-pic-thumbnail round-image user-icon"></div>
                                                    <div class="group-image-wrapper extra-small">
                                                        <div class="group-image-extra-small group-preview-image-default"
                                                             style="background-image: url({{ STATIC_URL }}img/home-page/step4.png)"></div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div data-col="name" class="user-name">
                                                        <a href="#"></a>
                                                    </div>
                                                    <div class="badge you-flag">You</div>
                                                    <div data-col="user-name" class="user-username-content"></div>
                                                </td>
                                            </table>
                                        </td>

                                        <td class="user-roles">
                                            <span class="dropdown role-dropdown">
                                                <span class="dropdown-toggle" data-col="current-access"
                                                      id="roles-menu" data-toggle="dropdown"
                                                      aria-haspopup="true" aria-expanded="true">
                                                    <span class="caret"></span>
                                                </span>
                                                <ul class="dropdown-menu" aria-labelledby="roles-menu">
                                                    <li data-access-type="Can view">
                                                        <form class="share-form-view" data-access-type="Can view"
                                                              method="POST">
                                                            {% csrf_token %}
                                                            <a class="btn-change-share-permission">Can view</a>
                                                        </form>
                                                    </li>
                                                    <li data-access-type="Can edit">
                                                        <form class="share-form-edit" data-access-type="Can edit"
                                                              method="POST">
                                                            {% csrf_token %}
                                                            <a class="btn-change-share-permission">Can edit</a>
                                                        </form>
                                                    </li>
                                                    <li data-access-type="Is owner">
                                                        <form class="share-form-owner" data-access-type="Is owner"
                                                              method="POST">
                                                            {% csrf_token %}
                                                            <a class="btn-change-share-permission">Is owner</a>
                                                        </form>
                                                    </li>
                                                </ul>
                                            </span>
                                        </td>

                                        <td class="user-actions">
                                            <form class="undo-share-form" method="POST"
                                                  action="/hsapi/_internal/{{ cm.short_id }}/undo-share-resource-with-user/">
                                                {% csrf_token %}
                                                <i class="fa fa-undo btn-undo-share" aria-hidden="true"
                                                data-toggle="tooltip" title="Undo Share"></i>
                                            </form>
                                        </td>

                                        <td class="user-actions">
                                            {% if is_owner_user %}
                                            <form class="remove-user-form" method="POST">
                                                {% csrf_token %}
                                                <span class="btn-unshare-resource glyphicon glyphicon-remove btn-remove-row"
                                                data-toggle="tooltip" title="Remove"></span>
                                            </form>
                                            {% endif %}
                                        </td>
                                    </tr>

                                    {# Owners with full permissions to do anything on this resource #}
                                    {% include "includes/access-row.html" with entries=owners access="Is owner" access_type="user" %}

                                    {# Users who can edit the content of this resource #}
                                    {% include "includes/access-row.html" with entries=edit_users access="Can edit" access_type="user" %}

                                    {# Groups who can edit the content of this resource #}
                                    {% include "includes/access-row.html" with entries=view_users access="Can view" access_type="user" %}

                                    {# Groups who can edit the content of this resource #}
                                    {% include "includes/access-row.html" with entries=edit_groups access="Can edit" access_type="group" %}

                                    {# Users who can view the content of this resource #}
                                    {% include "includes/access-row.html" with entries=view_groups access="Can view" access_type="group" %}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Invite</h3>
                        </div>
                        <div id="div-invite-people" class="panel-body">
                            <div id="invite-flag" class="btn-group" role="group"
                                 aria-label="Share with users or groups">
                                <button type="button" class="btn btn-primary" data-value="users">Users</button>
                                <button type="button" class="btn btn-default" data-value="groups">Groups</button>
                            </div>
                            <br><br>
                            <form id="add-access-form" action="/hsapi/_internal/{{ cm.short_id }}/share-resource-with-user/"
                                  method="POST">
                                {% csrf_token %}

                                <div class="row">
                                    <div class="add-view-user-form col-xs-12">
                                        {{ add_view_invite_user_form.user }}
                                    </div>

                                    <div class="add-view-group-form col-xs-12">
                                        {{ add_view_group_form.group }}
                                    </div>

                                    <div class="col-xs-12">
                                        <div class="row">
                                            <div class="col-xs-6">
                                                <div class="dropdown custom-dropdown">
                                                    <button class="btn btn-default dropdown-toggle" type="button"
                                                            id="roles_list" data-toggle="dropdown"
                                                            aria-haspopup="true">
                                                        <span id="selected_role" data-role="view">Can view</span>
                                                        <span class="caret"></span>
                                                    </button>

                                                    <ul id="list-roles" class="dropdown-menu"
                                                        aria-labelledby="roles_list">
                                                        <li {% if not is_view_user and not is_edit_user and not is_owner_user %}class="disabled"{% endif %}>
                                                            <a data-role="view">Can view</a></li>
                                                        <li {% if not is_edit_user and not is_owner_user %}class="disabled"{% endif %}>
                                                            <a data-role="edit">Can edit</a></li>
                                                        <li {% if not is_owner_user %}class="disabled"{% endif %}><a
                                                                data-role="owner">Is owner</a></li>
                                                    </ul>
                                                </div>
                                            </div>

                                            <div class="col-xs-6">
                                                <a id="btn-confirm-add-access"
                                                   class="btn btn-add-access btn-success glyphicon glyphicon-plus"><span
                                                        class="button-label">&nbspAdd</span></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <br>
                        </div>
                    </div>

                    <div id="sharing-status">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Sharing status</h3>
                            </div>
                            <div class="panel-body">
                                {% if is_owner_user %}
                                    <div class="alert alert-info" role="alert"><i class="fa fa-lock" aria-hidden="true"></i>
                                        You are the owner of this resource.
                                    </div>
                                {% elif is_edit_user %}
                                    <div class="alert alert-info" role="alert">You have been given specific permission to
                                        {% if cm.raccess.published %} view{% else %} edit{% endif %} this resource.
                                    </div>
                                {% elif is_view_user %}
                                    <div class="alert alert-info" role="alert">You have been given specific permission to
                                        view this resource.
                                    </div>
                                {% endif %}

                                {% if can_change_resource_flags %}
                                    {# -------- PUBLIC -------- #}
                                    <form id="form-change-access" class="disabled"
                                          action="/hsapi/_internal/{{ cm.short_id }}/set-resource-flag/"
                                          method="POST">
                                        <div class="btn-group" role="group">
                                            {% csrf_token %}
                                            <input name="flag" type="hidden" value=""/>
                                            <input name="resource-mode" type="hidden" value="{{ resource_mode }}">

                                            <button {% if not cm.can_be_public_or_discoverable or cm.raccess.public %}disabled {% endif %}
                                                    id="btn-public" data-toggle="tooltip" data-placement="auto"
                                                    data-flag="make_public"
                                                    title='Can be viewed and downloaded by anyone.' type="button"
                                                    class="btn btn-default {% if cm.raccess.public %}active{% endif %}">
                                                Public
                                            </button>

                                            {# -------- DISCOVERABLE -------- #}
                                            <button {% if not cm.can_be_public_or_discoverable %}disabled {% endif %}
                                                    id="btn-discoverable" data-toggle="tooltip" data-placement="auto"
                                                    data-flag="make_discoverable"
                                                    type="button" title='Metadata is public but data are protected.'
                                                    class="btn btn-default {% if cm.raccess.discoverable and not cm.raccess.public %}active{% endif %}">
                                                Discoverable
                                            </button>

                                            {# -------- PRIVATE -------- #}
                                            <button {% if not cm.raccess.public and not cm.raccess.discoverable %}disabled {% endif %}
                                                    id="btn-private" data-toggle="tooltip" data-placement="auto"
                                                    data-flag="make_private"
                                                    title='Can be viewed and downloaded only by designated users or research groups.'
                                                    type="button"
                                                    class="btn btn-default {% if not cm.raccess.public and not cm.raccess.discoverable %}active{% endif %}">
                                                Private
                                            </button>
                                        </div>
                                    </form>

                                    {% if is_owner_user and cm.resource_type == "NetcdfResource" and not cm.raccess.public %}
                                        <div class="label-public">Note that making the resource public may take a little extra time
                                            to update
                                            Hyrax server in order to provide OPeNDAP service for this resource.
                                        </div>
                                    {% endif %}

                                    {% if is_owner_user %}
                                        <div id="shareable-container">
                                            {#   Shareable flag    #}
                                            <form action="/hsapi/_internal/{{ cm.short_id }}/set-resource-flag/"
                                                  method="POST">
                                                {% csrf_token %}

                                                <div class="checkbox">
                                                    <label>
                                                        <input id="btn-shareable" type="checkbox"
                                                               {% if cm.raccess.shareable %}checked{% endif %}>
                                                        Shareable
                                                    </label>
                                                </div>
                                                <p id="shareable-description" class="text-muted small">
                                                    {% if cm.raccess.shareable %}
                                                        Uncheck the box to prevent others from sharing the resource
                                                        without the owner's permission.
                                                    {% else %}
                                                        Check this box to allow others to share the resource without the
                                                        owner's permission.
                                                    {% endif %}
                                                </p>

                                                <input name="flag" type="hidden"
                                                       {% if cm.raccess.shareable %}value="make_not_shareable"
                                                       {% else %}value="make_shareable"{% endif %}/>
                                            </form>
                                        </div>
                                        <br>
                                    {% endif %}
                                {% endif %}
                             </div>
                        </div>
                    </div>

                    <div>
                        {# ======= Change quota holder ======= #}
                        {% include "resource-landing-page/quota.html" %}
                    </div>
                </div>

                <div class="modal-footer">
                    <a type="button" data-dismiss="modal" class="btn btn-default">Close</a>
                </div>
            </div>
        </div>
    </div>
    {#======= Manage access modal  window ends =======#}

    {% block delete-self-access-to-resource %}
        <div id="dialog-confirm-delete-self-access" title="Warning! Loss of access" style="display:none">
            <p><span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 50px 0;"></span>
                This action will remove your access to this resource and you will no longer be able to
                access it without someone else sharing it with you again. This is not reversible,
                so <strong>Remove</strong> with caution.
            </p>
        </div>
    {% endblock %}
{% endif %}

<div class="modal fade" id="redirect-referenced-url-dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="redirect-referenced-url-title">Redirecting to the referenced web URL</h4>
            </div>
            <div class="modal-body">
                The content you have requested to access is not stored in HydroShare, and we canâ€™t guarantee its availability,
                quality, security, or size. If the externally linked content is large, access may take time.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a id="file_redirect_url" type="button" class="btn btn-primary" href="#" target="_blank">Redirect</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="get-file-url-dialog" tabindex="-1" role="dialog"
     aria-labelledby="rename" aria-hidden="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h4 class="modal-title">Get file URL</h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <fieldset class="col-sm-12">
                        <div class="input-group">
                            <input readonly id="txtFileURL" type="text" class="form-control click-select-all">
                            <span class="input-group-btn">
                                <button class="btn btn-default clipboard-copy" data-target="txtFileURL"
                                        type="button">
                                    <i class="fa fa-clipboard" aria-hidden="true"></i> Copy
                                </button>
                            </span>
                        </div>
                    </fieldset>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" id="btn-confirm-zip" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/modals.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/identifiers-form.js"></script>
{% endblock %}
