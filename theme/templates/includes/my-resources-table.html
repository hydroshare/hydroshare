{% load pages_tags mezzanine_tags keyword_tags comment_tags hydroshare_tags %}
<div id="my-resources-table">
    <div class="pagination">
        {% if collection.has_previous %}
            <a href="?{% param_replace page=1 %}">First</a>
            {% if collection.previous_page_number != 1 %}
            <a href="?{% param_replace page=collection.previous_page_number %}">Previous</a>
            {% endif %}
        {% endif %}

        Page {{ collection.number }} of {{ collection.paginator.num_pages }}

        {% if collection.has_next %}
            {% if collection.next_page_number != collection.paginator.num_pages %}
            <a href="?{% param_replace page=collection.next_page_number %}">Next</a>
            {% endif %}
            <a href="?{% param_replace page=collection.paginator.num_pages %}">Last</a>
        {% endif %}

        <p>Objects {{ collection.start_index }}—{{ collection.end_index }}</p>
    </div>


    <!-- /input-group -->
    <table id="item-selectors" class="table-hover table-striped resource-custom-table">
        <thead>
        <tr>
            <th><input class="all-rows-selector" type="checkbox"></th>
            <th>Type</th>
            <th>Title</th>
            <th>First Author</th>
            <th>Date Created</th>
            <th>Last Modified</th>
            <th>Subject</th>            {# Used in table processing #}
            <th>Authors</th>            {# Used in table processing #}
            <th>Permission Level</th>   {# Used in table processing #}
            <th>Labels</th>             {# Used in table processing #}
            <th>Favorite</th>           {# Used in table processing #}
            <th>Last Modified</th>      {# Used in table processing #}
            <th>Sharing Status</th>     {# Used in table processing #}
            <th>Date Created</th>       {# Used in table processing #}
        </tr>
        </thead>
        <tbody>
            {% for res in collection %}
                <tr class="data-row">
                    {# Selection controls #}
                    <td  data-col="actions">
                        <input class="row-selector" type="checkbox">
                        {# Delete resource forms #}
                        <form class="hidden-form" data-id="form-delete-{{ res.short_id }}"
                                data-form-type="delete-resource" method="POST"
                                action="/hsapi/_internal/{{ res.short_id }}/delete-resource/">
                            {% csrf_token %}
                        </form>
                        {% if res.is_favorite %}
                            <span data-form-id="form-favorite-{{ res.short_id }}"
                                    data-form-type="toggle-favorite"
                                    class="glyphicon glyphicon-star btn-inline-favorite isfavorite"></span>

                            <form class="hidden-form" data-id="form-favorite-{{ res.short_id }}"
                                    action="/hsapi/_internal/{{ res.short_id }}/label-resource-action/"
                                    method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="DELETE">
                                <input type="hidden" name="label_type" value="FAVORITE">
                            </form>
                        {% else %}
                            <span data-form-id="form-favorite-{{ res.short_id }}"
                                    data-form-type="toggle-favorite"
                                    class="glyphicon glyphicon-star btn-inline-favorite"></span>

                            <form class="hidden-form" data-id="form-favorite-{{ res.short_id }}"
                                    action="/hsapi/_internal/{{ res.short_id }}/label-resource-action/"
                                    method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="CREATE">
                                <input type="hidden" name="label_type" value="FAVORITE">
                            </form>
                        {% endif %}

                        <span class="glyphicon glyphicon-tag btn-inline-label" data-toggle="dropdown"
                                aria-expanded="false"></span>

                        <div class="dropdown-menu inline-dropdown" role="menu">
                            <div class="panel-body" role="form">
                                <ul data-resource-id="{{ res.short_id }}" class="list-group list-labels">
                                </ul>
                            </div>
                        </div>
                    </td>
                    {# Type #}
                    <td data-col="resource-type">
                        {% include "includes/res_type_col.html" with resource=res %}
                    </td>
                    {# Title #}
                    {% with metadata=res.metadata %}
                        <td>
                            <strong><a href="{{ res.get_absolute_url }}">{{ metadata.title|escape }}</a>
                            </strong>
                        </td>
                        {# First Author #}
                        <td>{{ res|resource_first_author }}</td>

                        {# Date Created #}
                        <td>{{ res.created|date:"M d, Y" }} at {{ res.created|time }}</td>
                        {# Last Modified #}
                        {% with last_updated=res.last_updated %}
                            <td>{{ last_updated|date:"M d, Y" }} at {{ last_updated|time }}</td>
                            {# Subject #}
                            <td>
                                {% for kw in metadata.subjects.all %}
                                    {% if forloop.counter0 > 0 %},{% endif %}{{ kw.value}}
                                {% endfor %}
                            </td>
                            {# Authors #}
                            <td>
                                {% for creator in metadata.creators.all %}
                                    {% if forloop.counter0 != 0 %}<span> · </span>{% endif %}
                                    {% if creator.relative_uri %}
                                        <a href="{{ creator.relative_uri }}">{{ creator.name }}</a>
                                    {% else %}
                                        <span>{{ creator.name }}</span>
                                    {% endif %}
                                {% endfor %}
                            </td>
                            {# Permission Level #}
                            {% if res.owned %}
                                <td>Owned</td>
                            {% elif res.discovered %}
                                <td>Discovered</td>
                            {% else %}
                                <td></td>
                            {% endif %}
                            {# Labels #}
                            <td class="col-labels">
                                {% for label in res|user_resource_labels:user %}
                                    {% if forloop.counter0 > 0 %},{% endif %}{{ label }}
                                {% endfor %}
                            </td>
                            {# Favorite #}
                            <td class="col-is-favorite">
                                {% if res.is_favorite %}
                                    Favorite
                                {% endif %}
                            </td>
                            {# Last Modified #}
                            <td>{{ last_updated|date:"U" }}</td>
                        {% endwith %}
                    {% endwith %}
                    {# Sharing Status #}
                    <td>
                        {% if res.raccess.published %}
                            Published
                        {% elif res.raccess.public %}
                            Public
                        {% elif res.raccess.discoverable %}
                            Discoverable
                        {% else %}
                            Private
                        {% endif %}
                    </td>
                    {# Date Created #}
                    <td>{{ res.created|date:"U" }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>