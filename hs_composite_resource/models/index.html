
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../views/">
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Models - HydroShare Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hs_composite_resource.models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="HydroShare Documentation" class="md-header__button md-logo" aria-label="HydroShare Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HydroShare Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Models
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="HydroShare Documentation" class="md-nav__button md-logo" aria-label="HydroShare Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    HydroShare Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Control
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dev Environment
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devcommunication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dev Communication
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Design Docs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Design Docs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DesignDocs/API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DesignDocs/UserNameEmailRules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UserNameEmailRules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Code Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    HS Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    HS Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hs_core/views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Views
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hs_core/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" checked>
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Composite Resource
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Composite Resource
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Views
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hs_composite_resource.models" class="md-nav__link">
    <span class="md-ellipsis">
      
        models
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource" class="md-nav__link">
    <span class="md-ellipsis">
      
        CompositeResource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CompositeResource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.aggregation_type_names" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_type_names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.aggregation_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.has_logical_spatial_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_spatial_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.has_logical_temporal_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_temporal_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.has_required_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_required_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.logical_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        logical_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_folders" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_folders
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.add_file_to_aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_file_to_aggregation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.can_add_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_add_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.cleanup_aggregations" class="md-nav__link">
    <span class="md-ellipsis">
      
        cleanup_aggregations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.create_aggregation_meta_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_aggregation_meta_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.dangling_aggregations_exist" class="md-nav__link">
    <span class="md-ellipsis">
      
        dangling_aggregations_exist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.delete_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_aggregation_by_aggregation_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_aggregation_by_aggregation_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_aggregation_by_meta_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_aggregation_by_meta_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_aggregation_by_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_aggregation_by_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_data_services_urls" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_data_services_urls
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_file_aggregation_object" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_file_aggregation_object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_fileset_aggregation_in_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_fileset_aggregation_in_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_folder_aggregation_in_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_folder_aggregation_in_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_folder_aggregation_object" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_folder_aggregation_object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_logical_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_logical_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_model_aggregation_in_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_model_aggregation_in_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.is_aggregation_xml_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_aggregation_xml_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.remove_aggregation_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_aggregation_from_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.set_flag_to_recreate_aggregation_meta_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_flag_to_recreate_aggregation_meta_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_delete_folder_on_zip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_delete_folder_on_zip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_rename_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_rename_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_zip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_zip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.update_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.update_spatial_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_spatial_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.update_temporal_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_temporal_coverage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hs_composite_resource.models" class="md-nav__link">
    <span class="md-ellipsis">
      
        models
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource" class="md-nav__link">
    <span class="md-ellipsis">
      
        CompositeResource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CompositeResource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.aggregation_type_names" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_type_names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.aggregation_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.has_logical_spatial_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_spatial_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.has_logical_temporal_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_temporal_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.has_required_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_required_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.logical_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        logical_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_folders" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_folders
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.add_file_to_aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_file_to_aggregation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.can_add_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_add_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.cleanup_aggregations" class="md-nav__link">
    <span class="md-ellipsis">
      
        cleanup_aggregations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.create_aggregation_meta_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_aggregation_meta_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.dangling_aggregations_exist" class="md-nav__link">
    <span class="md-ellipsis">
      
        dangling_aggregations_exist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.delete_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_aggregation_by_aggregation_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_aggregation_by_aggregation_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_aggregation_by_meta_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_aggregation_by_meta_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_aggregation_by_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_aggregation_by_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_data_services_urls" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_data_services_urls
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_file_aggregation_object" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_file_aggregation_object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_fileset_aggregation_in_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_fileset_aggregation_in_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_folder_aggregation_in_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_folder_aggregation_in_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_folder_aggregation_object" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_folder_aggregation_object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_logical_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_logical_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.get_model_aggregation_in_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_model_aggregation_in_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.is_aggregation_xml_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_aggregation_xml_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.remove_aggregation_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_aggregation_from_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.set_flag_to_recreate_aggregation_meta_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_flag_to_recreate_aggregation_meta_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_delete_folder_on_zip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_delete_folder_on_zip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_rename_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_rename_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.supports_zip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_zip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.update_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.update_spatial_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_spatial_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_composite_resource.models.CompositeResource.update_temporal_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_temporal_coverage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Models</h1>

<div class="doc doc-object doc-module">



<a id="hs_composite_resource.models"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="hs_composite_resource.models.CompositeResource" class="doc doc-heading">
            <code>CompositeResource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseResource (hs_core.models.BaseResource)" href="../../hs_core/models/#hs_core.models.BaseResource">BaseResource</a></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CompositeResource</span><span class="p">(</span><span class="n">BaseResource</span><span class="p">):</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">ResourceManager</span><span class="p">(</span><span class="s2">&quot;CompositeResource&quot;</span><span class="p">)</span>

    <span class="c1"># used during discovery as well as in all other places in UI where resource type is displayed</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Resource&#39;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Composite Resource&#39;</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">can_be_public_or_discoverable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># resource level metadata check</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompositeResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">can_be_public_or_discoverable</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># logical file level metadata check</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lf</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">has_all_required_elements</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_required_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True only if all required metadata is present.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompositeResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">has_required_metadata</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">has_all_required_elements</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logical_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A generator to access each of the logical files of this resource&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesetlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genericlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">geofeaturelogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netcdflogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">georasterlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reftimeserieslogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeserieslogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelprogramlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelinstancelogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">csvlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lf</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aggregation_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets a list of all aggregation types that currently exist in this resource&quot;&quot;&quot;</span>
        <span class="n">aggr_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">aggr_type_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">type_name</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aggr_type_names</span><span class="p">:</span>
                <span class="n">aggr_type_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">type_name</span><span class="p">())</span>
                <span class="n">aggr_type</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">get_aggregation_display_name</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">aggr_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aggr_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aggr_types</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aggregation_type_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets a list of all aggregation type names that currently exist in this resource</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aggr_type_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">type_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aggr_type_names</span><span class="p">:</span>
                <span class="n">aggr_type_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">type_name</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">aggr_type_names</span>

    <span class="k">def</span> <span class="nf">get_logical_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logical_file_class_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of logical files (aggregations) for a specified logical file class name.&quot;&quot;&quot;</span>

        <span class="n">class_name_to_query_mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">FileSetLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesetlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">GenericLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">genericlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">GeoFeatureLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">geofeaturelogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">GeoRasterLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">georasterlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">ModelInstanceLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelinstancelogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">ModelProgramLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelprogramlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">NetCDFLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">netcdflogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">TimeSeriesLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeserieslogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">RefTimeseriesLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">reftimeserieslogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="n">CSVLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">csvlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">logical_file_class_name</span> <span class="ow">in</span> <span class="n">class_name_to_query_mappings</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">class_name_to_query_mappings</span><span class="p">[</span><span class="n">logical_file_class_name</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid logical file type name:</span><span class="si">{</span><span class="n">logical_file_class_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_logical_spatial_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if any of the logical files has spatial coverage&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_logical_temporal_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if any of the logical files has temporal coverage&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">temporal_coverage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">can_be_submitted_for_metadata_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># resource level metadata check</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompositeResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">can_be_submitted_for_metadata_review</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># logical file level metadata check</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lf</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">has_all_required_elements</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># url file cannot be published</span>
            <span class="k">if</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">lf</span><span class="o">.</span><span class="n">extra_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">remove_aggregation_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moved_res_file</span><span class="p">,</span> <span class="n">src_folder</span><span class="p">,</span> <span class="n">tgt_folder</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;removes association with aggregation (fileset or model program) from a resource file that has been moved</span>
<span class="sd">        :param  moved_res_file: an instance of a ResourceFile which has been moved to a different folder</span>
<span class="sd">        :param  src_folder: folder from which the file got moved from</span>
<span class="sd">        :param  tgt_folder: folder to which the file got moved into</span>
<span class="sd">        :param aggregations:   list of all aggregations in self (this resource)</span>
<span class="sd">        :param cleanup: if True, cleanup aggregation if aggregation is empty after the file removal</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span><span class="p">:</span>
            <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aggregation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># aggregation must be one of &#39;fileset&#39;, &#39;model instance&#39; or &#39;model program&#39;</span>
            <span class="k">if</span> <span class="n">aggregation</span> <span class="o">==</span> <span class="n">moved_res_file</span><span class="o">.</span><span class="n">logical_file</span><span class="p">:</span>
                <span class="c1"># remove aggregation association with the file</span>
                <span class="c1"># the removed aggregation is a fileset aggregation or a model program or a model instance</span>
                <span class="c1"># aggregation based on folder (note: model program/instance aggregation can also be</span>
                <span class="c1"># created from a single file)</span>
                <span class="n">moved_res_file</span><span class="o">.</span><span class="n">logical_file_content_object</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">moved_res_file</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="c1"># delete any instance of ModelProgramResourceFileType associated with this moved file</span>
                <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">is_model_program</span><span class="p">:</span>
                    <span class="c1"># if the file is getting moved within a model program folder hierarchy then no need</span>
                    <span class="c1"># to delete any associated ModelProgramResourceFileType object</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">tgt_folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">src_folder</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">src_folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tgt_folder</span><span class="p">):</span>
                        <span class="n">ModelProgramResourceFileType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">res_file</span><span class="o">=</span><span class="n">moved_res_file</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">cleanup</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_aggregations</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_file_to_aggregation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moved_res_file</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;adds the moved file to the aggregation (fileset or model program/instance) into which the file has been moved</span>
<span class="sd">        :param  moved_res_file: an instance of ResourceFile which has been moved into a folder that represents</span>
<span class="sd">        a fileset, a model program, or a model instance aggregation</span>
<span class="sd">        :param aggregations:   list of all aggregations in self (this resource)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">moved_res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
            <span class="c1"># first check for model program/instance aggregation</span>
            <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_aggregation_in_path</span><span class="p">(</span><span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aggregation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># then check for fileset aggregation</span>
                <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fileset_aggregation_in_path</span><span class="p">(</span><span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span><span class="p">,</span>
                                                                   <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aggregation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># make the moved file part of the fileset or model program aggregation unless the file is</span>
                <span class="c1"># already part of another aggregation (single file aggregation)</span>
                <span class="n">aggregation</span><span class="o">.</span><span class="n">add_resource_file</span><span class="p">(</span><span class="n">moved_res_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_folder_aggregation_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an aggregation (file type) object if the specified folder *dir_path* represents a</span>
<span class="sd">         file type aggregation (logical file), otherwise None.</span>

<span class="sd">         :param dir_path: Resource file directory path (full folder path starting with resource id)</span>
<span class="sd">         for which the aggregation object to be retrieved</span>
<span class="sd">         :param aggregations:   list of all aggregations in self (this resource)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">aggregation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="n">logical_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_aggregations</span><span class="p">(</span><span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="s1">&#39;folder&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">folder</span> <span class="o">==</span> <span class="n">aggregation_path</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">lf</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_folder_aggregation_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets any aggregation that is based on folder and exists in the specified path</span>
<span class="sd">        Searches for a folder based aggregation moving towards the root of the specified path</span>
<span class="sd">        :param  dir_path: directory path in which to search for a folder based aggregation</span>
<span class="sd">        :param aggregations: a list of all aggregations in self (this resource)</span>
<span class="sd">        :return a folder based aggregation if found otherwise, None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="n">aggregations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_aggregations</span><span class="p">(</span><span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aggregations</span><span class="p">:</span>
            <span class="c1"># no aggregations exist in this resource</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">get_aggregation</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">aggregation</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">while</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">dir_path</span><span class="p">:</span>
            <span class="n">aggr</span> <span class="o">=</span> <span class="n">get_aggregation</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">aggr</span>
            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_aggregation</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_file_aggregation_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an aggregation (file type) object if the specified file *file_path* represents a</span>
<span class="sd">         file type aggregation (logical file), otherwise None.</span>

<span class="sd">         :param file_path: Resource file path (full file path starting with resource id)</span>
<span class="sd">         for which the aggregation object to be retrieved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">relative_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">relative_file_path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">res_file</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supports_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; allow folders for CompositeResources &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supports_logical_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; if this resource allows associating resource file objects with logical file&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">create_aggregation_meta_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates aggregation meta files (resource map, metadata xml files and schema json files) for each of the</span>
<span class="sd">        contained aggregations</span>
<span class="sd">        :param  path: (optional) file or folder path for which meta files need to be created for</span>
<span class="sd">        all associated aggregations of that path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="c1"># create xml docs far all aggregation of this resource</span>
            <span class="k">for</span> <span class="n">aggregation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span><span class="p">:</span>
                    <span class="n">aggregation</span><span class="o">.</span><span class="n">create_aggregation_xml_documents</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># first check if the path is a folder path or file path</span>
            <span class="n">is_path_a_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_path_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_path_a_folder</span><span class="p">:</span>
                <span class="c1"># need to create xml files for all aggregations that exist under path</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">aggregation_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lf</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span><span class="p">:</span>
                        <span class="n">lf</span><span class="o">.</span><span class="n">create_aggregation_xml_documents</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># path is a file path</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="c1"># need to create xml docs only for this aggregation</span>
                    <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span><span class="p">:</span>
                        <span class="n">aggregation</span><span class="o">.</span><span class="n">create_aggregation_xml_documents</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                    <span class="c1"># file path is not an aggregation - nothing to do</span>
                    <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_aggregation_by_aggregation_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregation_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an aggregation that matches the aggregation dataset_name specified by *dataset_name*</span>
<span class="sd">        :param  aggregation_name: aggregation_name (aggregation path) of the aggregation to find</span>
<span class="sd">        :return an aggregation object if found</span>
<span class="sd">        :raises ObjectDoesNotExist if no matching aggregation is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">aggregation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">aggregation_name</span> <span class="o">==</span> <span class="n">aggregation_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">aggregation</span>

        <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span><span class="s2">&quot;No matching aggregation was found for &quot;</span>
                                 <span class="s2">&quot;name:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aggregation_name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_aggregation_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an aggregation that matches the aggregation name specified by *name*</span>
<span class="sd">        :param  name: name (aggregation path) of the aggregation to find</span>
<span class="sd">        :param  aggregations:   a list of aggregations in the resource (self)</span>
<span class="sd">        :return an aggregation object if found</span>
<span class="sd">        :raises ObjectDoesNotExist if no matching aggregation is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if aggregation path *name* is a file path or a folder</span>
        <span class="n">is_aggr_path_a_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_path_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_aggr_path_a_folder</span><span class="p">:</span>
            <span class="n">folder_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_object</span><span class="p">(</span><span class="n">folder_full_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aggregation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span>
                    <span class="s2">&quot;No matching aggregation was found for name:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">aggregation</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">res_file</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span>

            <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span>
                <span class="s2">&quot;No matching aggregation was found for name:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_aggregation_by_meta_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AggregationType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an aggregation that matches the specified meta xml/json file path</span>
<span class="sd">        :param  meta_file_path: directory path of the meta xml/json file</span>
<span class="sd">        :return an aggregation object if found</span>
<span class="sd">        :raises ObjectDoesNotExist if no matching aggregation is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="n">meta_file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">AggregationMetaFilePath</span><span class="p">)</span>

        <span class="n">meta_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">meta_file_path</span><span class="p">)</span>
        <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">meta_file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">METADATA_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
            <span class="n">base_file_name_to_match</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">METADATA_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">base</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">RESMAP_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
            <span class="n">base_file_name_to_match</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">RESMAP_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_file_name_to_match</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">SCHEMA_JSON_FILE_ENDSWITH</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">res_file</span> <span class="ow">in</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">list_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">sub_folders</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
                <span class="n">file_name_to_match</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_file_name_to_match</span><span class="si">}{</span><span class="n">res_file</span><span class="o">.</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">file_name</span> <span class="o">==</span> <span class="n">file_name_to_match</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span>
        <span class="c1"># check for folder aggregation</span>
        <span class="k">if</span> <span class="n">folder</span> <span class="ow">and</span> <span class="n">folder</span> <span class="o">==</span> <span class="n">base_file_name_to_match</span><span class="p">:</span>
            <span class="n">folder_aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_object</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">folder_aggregation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">folder_aggregation</span>

        <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span><span class="s2">&quot;No matching aggregation was found for &quot;</span>
                                 <span class="s2">&quot;meta file path:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta_file_path</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_fileset_aggregation_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the first fileset aggregation in the path moving up (towards the root)in the path</span>
<span class="sd">        :param  path: directory path in which to search for a fileset aggregation</span>
<span class="sd">        :param  aggregations: a list of aggregations in the resource (self)</span>
<span class="sd">        :return a fileset aggregation object if found, otherwise None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">aggregations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_aggregations</span><span class="p">(</span><span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aggregations</span><span class="p">:</span>
            <span class="c1"># no aggregations exist in this resource</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">get_fileset</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">is_fileset</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">aggregation</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">while</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">fileset</span> <span class="o">=</span> <span class="n">get_fileset</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fileset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">fileset</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_fileset</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model_aggregation_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the model program or model instance aggregation in the path moving up (towards the root)in the path</span>
<span class="sd">        :param  path: directory path in which to search for a model program or model instance aggregation</span>
<span class="sd">        :param  aggregations: a list of aggregations in the resource (self)</span>
<span class="sd">        :return a model program or model instance aggregation object if found, otherwise None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">aggregations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_aggregations</span><span class="p">(</span><span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aggregations</span><span class="p">:</span>
            <span class="c1"># no aggregations exist in this resource</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">get_aggregation</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">aggregation</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">while</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">aggr</span> <span class="o">=</span> <span class="n">get_aggregation</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">aggr</span><span class="o">.</span><span class="n">is_model_program</span> <span class="ow">or</span> <span class="n">aggr</span><span class="o">.</span><span class="n">is_model_instance</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">aggr</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aggr</span> <span class="o">=</span> <span class="n">get_aggregation</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">aggr</span><span class="o">.</span><span class="n">is_model_program</span> <span class="ow">or</span> <span class="n">aggr</span><span class="o">.</span><span class="n">is_model_instance</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">aggr</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">set_flag_to_recreate_aggregation_meta_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When a folder or file representing an aggregation is renamed or moved,</span>
<span class="sd">        the associated meta files (resource map, metadata xml files as well as schema json files) are deleted</span>
<span class="sd">        and then aggregation metadata is set to dirty so that these meta files will be regenerated as part of</span>
<span class="sd">        aggregation or bag download</span>
<span class="sd">        :param  orig_path: original file/folder path prior to move/rename</span>
<span class="sd">        :param  new_path: new file/folder path after move/rename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aggregations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">set_parent_aggregation_dirty</span><span class="p">(</span><span class="n">path_to_search</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path_to_search</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path_to_search</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">parent_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
                    <span class="n">parent_aggr</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="n">new_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
        <span class="n">orig_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">orig_path</span><span class="p">)</span>
        <span class="n">is_new_path_a_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_path_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">new_path</span><span class="p">)</span>
        <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>

        <span class="c1"># remove file extension from aggregation name (note: aggregation name is a file path</span>
        <span class="c1"># for all aggregation types except fileset/model aggregation</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">orig_path</span><span class="p">)</span>
        <span class="n">schema_json_file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">SCHEMA_JSON_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span>
        <span class="n">meta_xml_file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">METADATA_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span>
        <span class="n">map_xml_file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">RESMAP_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_new_path_a_folder</span><span class="p">:</span>
            <span class="c1"># case of file rename/move for single file aggregation</span>
            <span class="n">schema_json_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">schema_json_file_name</span><span class="p">)</span>
            <span class="n">meta_xml_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">meta_xml_file_name</span><span class="p">)</span>
            <span class="n">map_xml_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">map_xml_file_name</span><span class="p">)</span>
            <span class="c1"># for single file aggregations, compute the metadata JSON file path using original path</span>
            <span class="n">metadata_json_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">orig_path</span> <span class="o">+</span> <span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">METADATA_JSON_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># case of folder rename - fileset/model aggregation</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">schema_json_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">schema_json_file_name</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">meta_xml_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">meta_xml_file_name</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">map_xml_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">map_xml_file_name</span><span class="p">)</span>
            <span class="n">schema_json_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">schema_json_file_name</span><span class="p">)</span>
            <span class="n">meta_xml_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">meta_xml_file_name</span><span class="p">)</span>
            <span class="n">map_xml_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">map_xml_file_name</span><span class="p">)</span>
            <span class="c1"># No need to delete metadata JSON files for folder rename cases as metadata JSON filename</span>
            <span class="c1"># is not affected by folder rename</span>
            <span class="n">metadata_json_file_full_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">schema_json_file_full_path</span><span class="p">):</span>
            <span class="n">istorage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">schema_json_file_full_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">meta_xml_file_full_path</span><span class="p">):</span>
            <span class="n">istorage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">meta_xml_file_full_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">map_xml_file_full_path</span><span class="p">):</span>
            <span class="n">istorage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">map_xml_file_full_path</span><span class="p">)</span>

        <span class="c1"># delete metadata JSON file only for single file aggregations</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">is_new_path_a_folder</span>
            <span class="ow">and</span> <span class="n">metadata_json_file_full_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">metadata_json_file_full_path</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">istorage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">metadata_json_file_full_path</span><span class="p">)</span>

        <span class="c1"># set affected logical file metadata to dirty so that xml meta files will be regenerated at the time of</span>
        <span class="c1"># aggregation or bag download</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">aggregations</span><span class="p">:</span>
            <span class="c1"># set metadata dirty for any folder based aggregations under the orig_path</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="s1">&#39;folder&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lf</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">orig_path</span><span class="p">):</span>
                    <span class="n">lf</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">lf</span><span class="o">.</span><span class="n">folder</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">orig_path</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                    <span class="n">lf</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;folder&quot;</span><span class="p">])</span>
                    <span class="n">lf</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>
                    <span class="k">continue</span>

            <span class="c1"># set metadata dirty for any non-folder based aggregation under the orig_path</span>
            <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">aggregation_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">orig_path</span><span class="p">):</span>
                <span class="n">lf</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>

            <span class="c1"># set metadata to dirty for non-folder based aggregation under the new_path</span>
            <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">aggregation_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
                <span class="n">lf</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>

        <span class="c1"># set metadata to dirty for any parent aggregation that may exist relative to path *orig_path*</span>
        <span class="n">set_parent_aggregation_dirty</span><span class="p">(</span><span class="n">orig_path</span><span class="p">)</span>

        <span class="c1"># set metadata to dirty for any parent aggregation that may exist relative to path *new_path*</span>
        <span class="n">set_parent_aggregation_dirty</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
            <span class="n">aggregation</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="c1"># the file path *new_path* does not represent an aggregation - no more</span>
            <span class="c1"># action is needed</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">is_aggregation_xml_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; determine whether a given file in the file hierarchy is metadata.</span>

<span class="sd">        This is true if it is listed as metadata in any logical file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_metadata_xml_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">logical_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">logical_file</span><span class="o">.</span><span class="n">metadata_file_path</span> <span class="o">==</span> <span class="n">file_path</span> <span class="ow">or</span> \
                    <span class="n">logical_file</span><span class="o">.</span><span class="n">map_file_path</span> <span class="o">==</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">supports_rename_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_full_path</span><span class="p">,</span> <span class="n">tgt_full_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;checks if file/folder rename/move is allowed</span>
<span class="sd">        :param  src_full_path: name of the file/folder storage path to be renamed (path starts with resource id)</span>
<span class="sd">        :param  tgt_full_path: new name for file/folder storage path (path starts with resource id)</span>
<span class="sd">        :return True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">src_full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">tgt_full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>

        <span class="c1"># need to find out which of the following actions the user is trying to do:</span>
        <span class="c1"># renaming a file</span>
        <span class="c1"># renaming a folder</span>
        <span class="c1"># moving a file</span>
        <span class="c1"># moving a folder</span>
        <span class="n">is_renaming_file</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">is_moving_file</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">is_moving_folder</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">tgt_full_path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">:</span>
            <span class="c1"># at the root of the resource all file operations are allowed</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="n">scr_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src_full_path</span><span class="p">)</span>
        <span class="n">src_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_full_path</span><span class="p">)</span>
        <span class="n">tgt_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tgt_full_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">src_full_path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tgt_full_path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tgt_full_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">scr_base_name</span><span class="p">):</span>
                <span class="n">is_moving_file</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">tgt_full_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">scr_base_name</span><span class="p">):</span>
                    <span class="n">tgt_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tgt_full_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tgt_dir_path</span> <span class="o">=</span> <span class="n">tgt_full_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">is_renaming_file</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># src path is a directory</span>
            <span class="k">if</span> <span class="n">src_dir_path</span> <span class="o">==</span> <span class="n">tgt_dir_path</span><span class="p">:</span>
                <span class="c1"># renaming folder - no restriction</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">is_moving_folder</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">check_src_aggregation</span><span class="p">(</span><span class="n">src_aggr</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;checks if the aggregation at the source allows file rename/move action&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">src_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_renaming_file</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">src_aggr</span><span class="o">.</span><span class="n">supports_resource_file_rename</span>
                <span class="k">elif</span> <span class="n">is_moving_file</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">src_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">is_renaming_file</span> <span class="ow">or</span> <span class="n">is_moving_file</span><span class="p">:</span>
            <span class="c1"># see if the folder containing the file represents an aggregation</span>
            <span class="n">src_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_file_aggregation_object</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">src_full_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">check_src_aggregation</span><span class="p">(</span><span class="n">src_aggr</span><span class="p">):</span>
                <span class="c1"># check target</span>
                <span class="k">if</span> <span class="n">is_moving_file</span><span class="p">:</span>
                    <span class="n">tgt_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">tgt_dir_path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tgt_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">src_aggr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">can_contain_aggregation</span><span class="p">(</span><span class="n">src_aggr</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">is_moving_folder</span><span class="p">:</span>
            <span class="n">src_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">src_full_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">src_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">src_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span><span class="p">:</span>
                    <span class="n">tgt_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">tgt_full_path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tgt_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span> <span class="ow">and</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">can_contain_aggregation</span><span class="p">(</span><span class="n">src_aggr</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="n">tgt_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">tgt_full_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tgt_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">can_add_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_full_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks if file(s) can be uploaded to the specified *target_full_path*</span>
<span class="sd">        :param target_full_path: full folder path name where file needs to be uploaded to</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_to_check</span> <span class="o">=</span> <span class="n">target_full_path</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path_to_check</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;data/contents&quot;</span><span class="p">):</span>
            <span class="c1"># it is not the base directory - it must be a directory under base dir</span>
            <span class="n">aggregation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">path_to_check</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">aggregation_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">supports_resource_file_add</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="c1"># target path doesn&#39;t represent an aggregation - so it is OK to add a file</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">supports_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_to_zip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check if the given folder can be zipped or not&quot;&quot;&quot;</span>

        <span class="c1"># find all the resource files in the folder to be zipped</span>
        <span class="c1"># this is being passed both qualified and unqualified paths!</span>

        <span class="n">full_path</span> <span class="o">=</span> <span class="n">folder_to_zip</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>
        <span class="c1"># get all resource files at full_path and its sub-folders</span>
        <span class="n">res_file_objects</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">list_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>

        <span class="c1"># check any logical file associated with the resource file supports zip functionality</span>
        <span class="k">for</span> <span class="n">res_file</span> <span class="ow">in</span> <span class="n">res_file_objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span><span class="o">.</span><span class="n">supports_zip</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">supports_delete_folder_on_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_folder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check if the specified folder can be deleted at the end of zipping that folder&quot;&quot;&quot;</span>

        <span class="c1"># find all the resource files in the folder to be deleted</span>
        <span class="c1"># this is being passed both qualified and unqualified paths!</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">original_folder</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>

        <span class="c1"># get all resource files at full_path and its sub-folders</span>
        <span class="n">res_file_objects</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">list_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>

        <span class="c1"># check any logical file associated with the resource file supports deleting the folder</span>
        <span class="c1"># after its zipped</span>
        <span class="k">for</span> <span class="n">res_file</span> <span class="ow">in</span> <span class="n">res_file_objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span><span class="o">.</span><span class="n">supports_delete_folder_on_zip</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_missing_file_type_metadata_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this is used in page pre-processor to build the context</span>
        <span class="c1"># so that the landing page can show what metadata items are missing for each</span>
        <span class="c1"># logical file/aggregation</span>
        <span class="n">metadata_missing_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lfo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lfo</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">has_all_required_elements</span><span class="p">():</span>
                <span class="n">missing_elements</span> <span class="o">=</span> <span class="n">lfo</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get_required_missing_elements</span><span class="p">()</span>
                <span class="n">metadata_missing_info</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">lfo</span><span class="o">.</span><span class="n">aggregation_name</span><span class="p">,</span>
                                              <span class="s1">&#39;missing_elements&#39;</span><span class="p">:</span> <span class="n">missing_elements</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">metadata_missing_info</span>

    <span class="k">def</span> <span class="nf">get_data_services_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates data services URLs for the resource.</span>
<span class="sd">        If the resource contains any GeoFeature or GeoRaster content, and if it&#39;s public,</span>
<span class="sd">        generate data service endpoints.</span>
<span class="sd">        If the resource contains any multidimensional content and it&#39;s public,</span>
<span class="sd">        generate THREDDS catalog service endpoint as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wfs_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">wms_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">wcs_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thredds_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resource_data_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">lf</span><span class="o">.</span><span class="n">data_type</span> <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">]</span>
                <span class="n">service_url</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">HSWS_GEOSERVER_URL</span><span class="si">}</span><span class="s1">/HS-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s1">/&#39;</span>
                    <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">?request=GetCapabilities&#39;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;GeographicFeature&#39;</span> <span class="ow">in</span> <span class="n">resource_data_types</span><span class="p">:</span>
                    <span class="n">wfs_url</span> <span class="o">=</span> <span class="n">service_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;wfs&#39;</span><span class="p">)</span>
                    <span class="n">wms_url</span> <span class="o">=</span> <span class="n">service_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;wms&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;GeographicRaster&#39;</span> <span class="ow">in</span> <span class="n">resource_data_types</span><span class="p">:</span>
                    <span class="n">wcs_url</span> <span class="o">=</span> <span class="n">service_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;wcs&#39;</span><span class="p">)</span>
                    <span class="n">wms_url</span> <span class="o">=</span> <span class="n">service_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;wms&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;get_data_services_urls: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

            <span class="k">if</span> <span class="s1">&#39;Multidimensional&#39;</span> <span class="ow">in</span> <span class="n">resource_data_types</span><span class="p">:</span>
                <span class="n">thredds_url</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">THREDDS_SERVER_URL</span><span class="si">}</span><span class="s1">catalog/hydroshare/resources/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s1">/data/contents/&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;catalog.html&#39;</span>
                <span class="p">)</span>
        <span class="n">data_services_urls</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;wms_url&#39;</span><span class="p">:</span> <span class="n">wms_url</span><span class="p">,</span>
            <span class="s1">&#39;wfs_url&#39;</span><span class="p">:</span> <span class="n">wfs_url</span><span class="p">,</span>
            <span class="s1">&#39;wcs_url&#39;</span><span class="p">:</span> <span class="n">wcs_url</span><span class="p">,</span>
            <span class="s1">&#39;thredds_url&#39;</span><span class="p">:</span> <span class="n">thredds_url</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">data_services_urls</span>

    <span class="k">def</span> <span class="nf">delete_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coverage_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes coverage data for the resource</span>
<span class="sd">        :param coverage_type: A value of either &#39;spatial&#39; or &#39;temporal</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coverage_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;spatial&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">coverage_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;temporal&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">temporal_coverage</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">temporal_coverage</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update resource spatial and temporal coverage based on the corresponding coverages</span>
<span class="sd">        from all the contained aggregations (logical file) only if the resource coverage is not</span>
<span class="sd">        already set&quot;&quot;&quot;</span>

        <span class="c1"># update resource spatial coverage only if there is no spatial coverage already</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_spatial_coverage</span><span class="p">()</span>

        <span class="c1"># update resource temporal coverage only if there is no temporal coverage already</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">temporal_coverage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_temporal_coverage</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_spatial_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates resource spatial coverage based on the contained spatial coverages of</span>
<span class="sd">        aggregations (file type). Note: This action will overwrite any existing resource spatial</span>
<span class="sd">        coverage data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">update_target_spatial_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_temporal_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates resource temporal coverage based on the contained temporal coverages of</span>
<span class="sd">        aggregations (file type). Note: This action will overwrite any existing resource temporal</span>
<span class="sd">        coverage data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">update_target_temporal_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup_aggregations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes any dangling aggregations (aggregation without resource files or folder) the resource may have&quot;&quot;&quot;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">is_dangling</span><span class="p">:</span>
                <span class="n">agg_cls_name</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">type_name</span><span class="p">()</span>
                <span class="n">lf</span><span class="o">.</span><span class="n">remove_aggregation</span><span class="p">()</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Deleted a dangling aggregation of type:</span><span class="si">{}</span><span class="s2"> for resource:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">agg_cls_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">count</span>

    <span class="k">def</span> <span class="nf">dangling_aggregations_exist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if there are any dangling aggregations in this resource</span>
<span class="sd">        Note: This function used only in tests</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">is_dangling</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">is_path_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">istorage</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cache_aggregations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregations</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A helper function to cache aggregations to avoid repeated database queries&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">aggregations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">aggregations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">aggregations</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="hs_composite_resource.models.CompositeResource.aggregation_type_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregation_type_names</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Gets a list of all aggregation type names that currently exist in this resource</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_composite_resource.models.CompositeResource.aggregation_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregation_types</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Gets a list of all aggregation types that currently exist in this resource</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_composite_resource.models.CompositeResource.has_logical_spatial_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_logical_spatial_coverage</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if any of the logical files has spatial coverage</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_composite_resource.models.CompositeResource.has_logical_temporal_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_logical_temporal_coverage</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if any of the logical files has temporal coverage</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_composite_resource.models.CompositeResource.has_required_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_required_metadata</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return True only if all required metadata is present.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_composite_resource.models.CompositeResource.logical_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logical_files</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>A generator to access each of the logical files of this resource</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_composite_resource.models.CompositeResource.supports_folders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_folders</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>allow folders for CompositeResources</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_composite_resource.models.CompositeResource.supports_logical_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_logical_file</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>if this resource allows associating resource file objects with logical file</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.add_file_to_aggregation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_file_to_aggregation</span><span class="p">(</span><span class="n">moved_res_file</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>adds the moved file to the aggregation (fileset or model program/instance) into which the file has been moved
:param  moved_res_file: an instance of ResourceFile which has been moved into a folder that represents
a fileset, a model program, or a model instance aggregation
:param aggregations:   list of all aggregations in self (this resource)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_file_to_aggregation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moved_res_file</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;adds the moved file to the aggregation (fileset or model program/instance) into which the file has been moved</span>
<span class="sd">    :param  moved_res_file: an instance of ResourceFile which has been moved into a folder that represents</span>
<span class="sd">    a fileset, a model program, or a model instance aggregation</span>
<span class="sd">    :param aggregations:   list of all aggregations in self (this resource)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">moved_res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
        <span class="c1"># first check for model program/instance aggregation</span>
        <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_aggregation_in_path</span><span class="p">(</span><span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aggregation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># then check for fileset aggregation</span>
            <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fileset_aggregation_in_path</span><span class="p">(</span><span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span><span class="p">,</span>
                                                               <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aggregation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># make the moved file part of the fileset or model program aggregation unless the file is</span>
            <span class="c1"># already part of another aggregation (single file aggregation)</span>
            <span class="n">aggregation</span><span class="o">.</span><span class="n">add_resource_file</span><span class="p">(</span><span class="n">moved_res_file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.can_add_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_add_files</span><span class="p">(</span><span class="n">target_full_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>checks if file(s) can be uploaded to the specified <em>target_full_path</em>
:param target_full_path: full folder path name where file needs to be uploaded to
:return: True or False</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_add_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_full_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    checks if file(s) can be uploaded to the specified *target_full_path*</span>
<span class="sd">    :param target_full_path: full folder path name where file needs to be uploaded to</span>
<span class="sd">    :return: True or False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_to_check</span> <span class="o">=</span> <span class="n">target_full_path</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">path_to_check</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;data/contents&quot;</span><span class="p">):</span>
        <span class="c1"># it is not the base directory - it must be a directory under base dir</span>
        <span class="n">aggregation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">path_to_check</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">aggregation_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">supports_resource_file_add</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="c1"># target path doesn&#39;t represent an aggregation - so it is OK to add a file</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.cleanup_aggregations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cleanup_aggregations</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Deletes any dangling aggregations (aggregation without resource files or folder) the resource may have</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cleanup_aggregations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deletes any dangling aggregations (aggregation without resource files or folder) the resource may have&quot;&quot;&quot;</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">is_dangling</span><span class="p">:</span>
            <span class="n">agg_cls_name</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">type_name</span><span class="p">()</span>
            <span class="n">lf</span><span class="o">.</span><span class="n">remove_aggregation</span><span class="p">()</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Deleted a dangling aggregation of type:</span><span class="si">{}</span><span class="s2"> for resource:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">agg_cls_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.create_aggregation_meta_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_aggregation_meta_files</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates aggregation meta files (resource map, metadata xml files and schema json files) for each of the
contained aggregations
:param  path: (optional) file or folder path for which meta files need to be created for
all associated aggregations of that path</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_aggregation_meta_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates aggregation meta files (resource map, metadata xml files and schema json files) for each of the</span>
<span class="sd">    contained aggregations</span>
<span class="sd">    :param  path: (optional) file or folder path for which meta files need to be created for</span>
<span class="sd">    all associated aggregations of that path</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="c1"># create xml docs far all aggregation of this resource</span>
        <span class="k">for</span> <span class="n">aggregation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span><span class="p">:</span>
                <span class="n">aggregation</span><span class="o">.</span><span class="n">create_aggregation_xml_documents</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># first check if the path is a folder path or file path</span>
        <span class="n">is_path_a_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_path_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_path_a_folder</span><span class="p">:</span>
            <span class="c1"># need to create xml files for all aggregations that exist under path</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">aggregation_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lf</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span><span class="p">:</span>
                    <span class="n">lf</span><span class="o">.</span><span class="n">create_aggregation_xml_documents</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># path is a file path</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="c1"># need to create xml docs only for this aggregation</span>
                <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span><span class="p">:</span>
                    <span class="n">aggregation</span><span class="o">.</span><span class="n">create_aggregation_xml_documents</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="c1"># file path is not an aggregation - nothing to do</span>
                <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.dangling_aggregations_exist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dangling_aggregations_exist</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if there are any dangling aggregations in this resource
Note: This function used only in tests</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dangling_aggregations_exist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if there are any dangling aggregations in this resource</span>
<span class="sd">    Note: This function used only in tests</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">is_dangling</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.delete_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_coverage</span><span class="p">(</span><span class="n">coverage_type</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Deletes coverage data for the resource
:param coverage_type: A value of either 'spatial' or 'temporal
:return:</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coverage_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deletes coverage data for the resource</span>
<span class="sd">    :param coverage_type: A value of either &#39;spatial&#39; or &#39;temporal</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">coverage_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;spatial&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">coverage_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;temporal&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">temporal_coverage</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">temporal_coverage</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_dirty</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_aggregation_by_aggregation_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_aggregation_by_aggregation_name</span><span class="p">(</span><span class="n">aggregation_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get an aggregation that matches the aggregation dataset_name specified by <em>dataset_name</em>
:param  aggregation_name: aggregation_name (aggregation path) of the aggregation to find
:return an aggregation object if found
:raises ObjectDoesNotExist if no matching aggregation is found</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_aggregation_by_aggregation_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregation_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an aggregation that matches the aggregation dataset_name specified by *dataset_name*</span>
<span class="sd">    :param  aggregation_name: aggregation_name (aggregation path) of the aggregation to find</span>
<span class="sd">    :return an aggregation object if found</span>
<span class="sd">    :raises ObjectDoesNotExist if no matching aggregation is found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">aggregation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">aggregation_name</span> <span class="o">==</span> <span class="n">aggregation_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">aggregation</span>

    <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span><span class="s2">&quot;No matching aggregation was found for &quot;</span>
                             <span class="s2">&quot;name:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aggregation_name</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_aggregation_by_meta_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_aggregation_by_meta_file</span><span class="p">(</span><span class="n">meta_file_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get an aggregation that matches the specified meta xml/json file path
:param  meta_file_path: directory path of the meta xml/json file
:return an aggregation object if found
:raises ObjectDoesNotExist if no matching aggregation is found</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_aggregation_by_meta_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AggregationType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an aggregation that matches the specified meta xml/json file path</span>
<span class="sd">    :param  meta_file_path: directory path of the meta xml/json file</span>
<span class="sd">    :return an aggregation object if found</span>
<span class="sd">    :raises ObjectDoesNotExist if no matching aggregation is found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="n">meta_file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">AggregationMetaFilePath</span><span class="p">)</span>

    <span class="n">meta_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">meta_file_path</span><span class="p">)</span>
    <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">meta_file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">METADATA_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
        <span class="n">base_file_name_to_match</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">METADATA_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">base</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">RESMAP_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
        <span class="n">base_file_name_to_match</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">RESMAP_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base_file_name_to_match</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">SCHEMA_JSON_FILE_ENDSWITH</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">res_file</span> <span class="ow">in</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">list_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">sub_folders</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
            <span class="n">file_name_to_match</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_file_name_to_match</span><span class="si">}{</span><span class="n">res_file</span><span class="o">.</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">file_name</span> <span class="o">==</span> <span class="n">file_name_to_match</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span>
    <span class="c1"># check for folder aggregation</span>
    <span class="k">if</span> <span class="n">folder</span> <span class="ow">and</span> <span class="n">folder</span> <span class="o">==</span> <span class="n">base_file_name_to_match</span><span class="p">:</span>
        <span class="n">folder_aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_object</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">folder_aggregation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">folder_aggregation</span>

    <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span><span class="s2">&quot;No matching aggregation was found for &quot;</span>
                             <span class="s2">&quot;meta file path:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta_file_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_aggregation_by_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get an aggregation that matches the aggregation name specified by <em>name</em>
:param  name: name (aggregation path) of the aggregation to find
:param  aggregations:   a list of aggregations in the resource (self)
:return an aggregation object if found
:raises ObjectDoesNotExist if no matching aggregation is found</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_aggregation_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an aggregation that matches the aggregation name specified by *name*</span>
<span class="sd">    :param  name: name (aggregation path) of the aggregation to find</span>
<span class="sd">    :param  aggregations:   a list of aggregations in the resource (self)</span>
<span class="sd">    :return an aggregation object if found</span>
<span class="sd">    :raises ObjectDoesNotExist if no matching aggregation is found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check if aggregation path *name* is a file path or a folder</span>
    <span class="n">is_aggr_path_a_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_path_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_aggr_path_a_folder</span><span class="p">:</span>
        <span class="n">folder_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_object</span><span class="p">(</span><span class="n">folder_full_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aggregation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span>
                <span class="s2">&quot;No matching aggregation was found for name:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">aggregation</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">res_file</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span>

        <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span>
            <span class="s2">&quot;No matching aggregation was found for name:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_data_services_urls" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_data_services_urls</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generates data services URLs for the resource.
If the resource contains any GeoFeature or GeoRaster content, and if it's public,
generate data service endpoints.
If the resource contains any multidimensional content and it's public,
generate THREDDS catalog service endpoint as well.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_data_services_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates data services URLs for the resource.</span>
<span class="sd">    If the resource contains any GeoFeature or GeoRaster content, and if it&#39;s public,</span>
<span class="sd">    generate data service endpoints.</span>
<span class="sd">    If the resource contains any multidimensional content and it&#39;s public,</span>
<span class="sd">    generate THREDDS catalog service endpoint as well.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wfs_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">wms_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">wcs_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">thredds_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resource_data_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">lf</span><span class="o">.</span><span class="n">data_type</span> <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">]</span>
            <span class="n">service_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">HSWS_GEOSERVER_URL</span><span class="si">}</span><span class="s1">/HS-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s1">/&#39;</span>
                <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">?request=GetCapabilities&#39;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;GeographicFeature&#39;</span> <span class="ow">in</span> <span class="n">resource_data_types</span><span class="p">:</span>
                <span class="n">wfs_url</span> <span class="o">=</span> <span class="n">service_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;wfs&#39;</span><span class="p">)</span>
                <span class="n">wms_url</span> <span class="o">=</span> <span class="n">service_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;wms&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;GeographicRaster&#39;</span> <span class="ow">in</span> <span class="n">resource_data_types</span><span class="p">:</span>
                <span class="n">wcs_url</span> <span class="o">=</span> <span class="n">service_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;wcs&#39;</span><span class="p">)</span>
                <span class="n">wms_url</span> <span class="o">=</span> <span class="n">service_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;wms&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;get_data_services_urls: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;Multidimensional&#39;</span> <span class="ow">in</span> <span class="n">resource_data_types</span><span class="p">:</span>
            <span class="n">thredds_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">THREDDS_SERVER_URL</span><span class="si">}</span><span class="s1">catalog/hydroshare/resources/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s1">/data/contents/&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;catalog.html&#39;</span>
            <span class="p">)</span>
    <span class="n">data_services_urls</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;wms_url&#39;</span><span class="p">:</span> <span class="n">wms_url</span><span class="p">,</span>
        <span class="s1">&#39;wfs_url&#39;</span><span class="p">:</span> <span class="n">wfs_url</span><span class="p">,</span>
        <span class="s1">&#39;wcs_url&#39;</span><span class="p">:</span> <span class="n">wcs_url</span><span class="p">,</span>
        <span class="s1">&#39;thredds_url&#39;</span><span class="p">:</span> <span class="n">thredds_url</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data_services_urls</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_file_aggregation_object" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_file_aggregation_object</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns an aggregation (file type) object if the specified file <em>file_path</em> represents a
file type aggregation (logical file), otherwise None.</p>
<p>:param file_path: Resource file path (full file path starting with resource id)
for which the aggregation object to be retrieved</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_file_aggregation_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns an aggregation (file type) object if the specified file *file_path* represents a</span>
<span class="sd">     file type aggregation (logical file), otherwise None.</span>

<span class="sd">     :param file_path: Resource file path (full file path starting with resource id)</span>
<span class="sd">     for which the aggregation object to be retrieved</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">relative_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">relative_file_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res_file</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_fileset_aggregation_in_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_fileset_aggregation_in_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the first fileset aggregation in the path moving up (towards the root)in the path
:param  path: directory path in which to search for a fileset aggregation
:param  aggregations: a list of aggregations in the resource (self)
:return a fileset aggregation object if found, otherwise None</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_fileset_aggregation_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the first fileset aggregation in the path moving up (towards the root)in the path</span>
<span class="sd">    :param  path: directory path in which to search for a fileset aggregation</span>
<span class="sd">    :param  aggregations: a list of aggregations in the resource (self)</span>
<span class="sd">    :return a fileset aggregation object if found, otherwise None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">aggregations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_aggregations</span><span class="p">(</span><span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">aggregations</span><span class="p">:</span>
        <span class="c1"># no aggregations exist in this resource</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_fileset</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">is_fileset</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">aggregation</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">while</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">fileset</span> <span class="o">=</span> <span class="n">get_fileset</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fileset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fileset</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_fileset</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_folder_aggregation_in_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets any aggregation that is based on folder and exists in the specified path
Searches for a folder based aggregation moving towards the root of the specified path
:param  dir_path: directory path in which to search for a folder based aggregation
:param aggregations: a list of all aggregations in self (this resource)
:return a folder based aggregation if found otherwise, None</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_folder_aggregation_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets any aggregation that is based on folder and exists in the specified path</span>
<span class="sd">    Searches for a folder based aggregation moving towards the root of the specified path</span>
<span class="sd">    :param  dir_path: directory path in which to search for a folder based aggregation</span>
<span class="sd">    :param aggregations: a list of all aggregations in self (this resource)</span>
<span class="sd">    :return a folder based aggregation if found otherwise, None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
    <span class="n">aggregations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_aggregations</span><span class="p">(</span><span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">aggregations</span><span class="p">:</span>
        <span class="c1"># no aggregations exist in this resource</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_aggregation</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">aggregation</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">while</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">dir_path</span><span class="p">:</span>
        <span class="n">aggr</span> <span class="o">=</span> <span class="n">get_aggregation</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">aggr</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_aggregation</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_folder_aggregation_object" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_folder_aggregation_object</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns an aggregation (file type) object if the specified folder <em>dir_path</em> represents a
file type aggregation (logical file), otherwise None.</p>
<p>:param dir_path: Resource file directory path (full folder path starting with resource id)
for which the aggregation object to be retrieved
:param aggregations:   list of all aggregations in self (this resource)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_folder_aggregation_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns an aggregation (file type) object if the specified folder *dir_path* represents a</span>
<span class="sd">     file type aggregation (logical file), otherwise None.</span>

<span class="sd">     :param dir_path: Resource file directory path (full folder path starting with resource id)</span>
<span class="sd">     for which the aggregation object to be retrieved</span>
<span class="sd">     :param aggregations:   list of all aggregations in self (this resource)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aggregation_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
    <span class="n">logical_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_aggregations</span><span class="p">(</span><span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">logical_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="s1">&#39;folder&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">folder</span> <span class="o">==</span> <span class="n">aggregation_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lf</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_logical_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_logical_files</span><span class="p">(</span><span class="n">logical_file_class_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a list of logical files (aggregations) for a specified logical file class name.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_logical_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logical_file_class_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of logical files (aggregations) for a specified logical file class name.&quot;&quot;&quot;</span>

    <span class="n">class_name_to_query_mappings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">FileSetLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesetlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">GenericLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">genericlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">GeoFeatureLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">geofeaturelogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">GeoRasterLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">georasterlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">ModelInstanceLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelinstancelogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">ModelProgramLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelprogramlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">NetCDFLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">netcdflogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">TimeSeriesLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeserieslogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">RefTimeseriesLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">reftimeserieslogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">CSVLogicalFile</span><span class="o">.</span><span class="n">type_name</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">csvlogicalfile_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">logical_file_class_name</span> <span class="ow">in</span> <span class="n">class_name_to_query_mappings</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">class_name_to_query_mappings</span><span class="p">[</span><span class="n">logical_file_class_name</span><span class="p">]</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid logical file type name:</span><span class="si">{</span><span class="n">logical_file_class_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.get_model_aggregation_in_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_model_aggregation_in_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the model program or model instance aggregation in the path moving up (towards the root)in the path
:param  path: directory path in which to search for a model program or model instance aggregation
:param  aggregations: a list of aggregations in the resource (self)
:return a model program or model instance aggregation object if found, otherwise None</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_model_aggregation_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the model program or model instance aggregation in the path moving up (towards the root)in the path</span>
<span class="sd">    :param  path: directory path in which to search for a model program or model instance aggregation</span>
<span class="sd">    :param  aggregations: a list of aggregations in the resource (self)</span>
<span class="sd">    :return a model program or model instance aggregation object if found, otherwise None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">aggregations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_aggregations</span><span class="p">(</span><span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">aggregations</span><span class="p">:</span>
        <span class="c1"># no aggregations exist in this resource</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_aggregation</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">aggregation</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">while</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">aggr</span> <span class="o">=</span> <span class="n">get_aggregation</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">aggr</span><span class="o">.</span><span class="n">is_model_program</span> <span class="ow">or</span> <span class="n">aggr</span><span class="o">.</span><span class="n">is_model_instance</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">aggr</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">aggr</span> <span class="o">=</span> <span class="n">get_aggregation</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">aggr</span><span class="o">.</span><span class="n">is_model_program</span> <span class="ow">or</span> <span class="n">aggr</span><span class="o">.</span><span class="n">is_model_instance</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">aggr</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.is_aggregation_xml_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_aggregation_xml_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>determine whether a given file in the file hierarchy is metadata.</p>
<p>This is true if it is listed as metadata in any logical file.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_aggregation_xml_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; determine whether a given file in the file hierarchy is metadata.</span>

<span class="sd">    This is true if it is listed as metadata in any logical file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_metadata_xml_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">logical_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">logical_file</span><span class="o">.</span><span class="n">metadata_file_path</span> <span class="o">==</span> <span class="n">file_path</span> <span class="ow">or</span> \
                <span class="n">logical_file</span><span class="o">.</span><span class="n">map_file_path</span> <span class="o">==</span> <span class="n">file_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.remove_aggregation_from_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_aggregation_from_file</span><span class="p">(</span><span class="n">moved_res_file</span><span class="p">,</span> <span class="n">src_folder</span><span class="p">,</span> <span class="n">tgt_folder</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>removes association with aggregation (fileset or model program) from a resource file that has been moved
:param  moved_res_file: an instance of a ResourceFile which has been moved to a different folder
:param  src_folder: folder from which the file got moved from
:param  tgt_folder: folder to which the file got moved into
:param aggregations:   list of all aggregations in self (this resource)
:param cleanup: if True, cleanup aggregation if aggregation is empty after the file removal</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_aggregation_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moved_res_file</span><span class="p">,</span> <span class="n">src_folder</span><span class="p">,</span> <span class="n">tgt_folder</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;removes association with aggregation (fileset or model program) from a resource file that has been moved</span>
<span class="sd">    :param  moved_res_file: an instance of a ResourceFile which has been moved to a different folder</span>
<span class="sd">    :param  src_folder: folder from which the file got moved from</span>
<span class="sd">    :param  tgt_folder: folder to which the file got moved into</span>
<span class="sd">    :param aggregations:   list of all aggregations in self (this resource)</span>
<span class="sd">    :param cleanup: if True, cleanup aggregation if aggregation is empty after the file removal</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span><span class="p">:</span>
        <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">moved_res_file</span><span class="o">.</span><span class="n">file_folder</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aggregation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># aggregation must be one of &#39;fileset&#39;, &#39;model instance&#39; or &#39;model program&#39;</span>
        <span class="k">if</span> <span class="n">aggregation</span> <span class="o">==</span> <span class="n">moved_res_file</span><span class="o">.</span><span class="n">logical_file</span><span class="p">:</span>
            <span class="c1"># remove aggregation association with the file</span>
            <span class="c1"># the removed aggregation is a fileset aggregation or a model program or a model instance</span>
            <span class="c1"># aggregation based on folder (note: model program/instance aggregation can also be</span>
            <span class="c1"># created from a single file)</span>
            <span class="n">moved_res_file</span><span class="o">.</span><span class="n">logical_file_content_object</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">moved_res_file</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c1"># delete any instance of ModelProgramResourceFileType associated with this moved file</span>
            <span class="k">if</span> <span class="n">aggregation</span><span class="o">.</span><span class="n">is_model_program</span><span class="p">:</span>
                <span class="c1"># if the file is getting moved within a model program folder hierarchy then no need</span>
                <span class="c1"># to delete any associated ModelProgramResourceFileType object</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tgt_folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">src_folder</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">src_folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tgt_folder</span><span class="p">):</span>
                    <span class="n">ModelProgramResourceFileType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">res_file</span><span class="o">=</span><span class="n">moved_res_file</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cleanup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_aggregations</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.set_flag_to_recreate_aggregation_meta_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_flag_to_recreate_aggregation_meta_files</span><span class="p">(</span><span class="n">orig_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>When a folder or file representing an aggregation is renamed or moved,
the associated meta files (resource map, metadata xml files as well as schema json files) are deleted
and then aggregation metadata is set to dirty so that these meta files will be regenerated as part of
aggregation or bag download
:param  orig_path: original file/folder path prior to move/rename
:param  new_path: new file/folder path after move/rename</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_flag_to_recreate_aggregation_meta_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When a folder or file representing an aggregation is renamed or moved,</span>
<span class="sd">    the associated meta files (resource map, metadata xml files as well as schema json files) are deleted</span>
<span class="sd">    and then aggregation metadata is set to dirty so that these meta files will be regenerated as part of</span>
<span class="sd">    aggregation or bag download</span>
<span class="sd">    :param  orig_path: original file/folder path prior to move/rename</span>
<span class="sd">    :param  new_path: new file/folder path after move/rename</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aggregations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logical_files</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_parent_aggregation_dirty</span><span class="p">(</span><span class="n">path_to_search</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path_to_search</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path_to_search</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parent_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
                <span class="n">parent_aggr</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="n">new_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
    <span class="n">orig_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relative_path</span><span class="p">(</span><span class="n">orig_path</span><span class="p">)</span>
    <span class="n">is_new_path_a_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_path_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">new_path</span><span class="p">)</span>
    <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>

    <span class="c1"># remove file extension from aggregation name (note: aggregation name is a file path</span>
    <span class="c1"># for all aggregation types except fileset/model aggregation</span>
    <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">orig_path</span><span class="p">)</span>
    <span class="n">schema_json_file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">SCHEMA_JSON_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span>
    <span class="n">meta_xml_file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">METADATA_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span>
    <span class="n">map_xml_file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">RESMAP_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_new_path_a_folder</span><span class="p">:</span>
        <span class="c1"># case of file rename/move for single file aggregation</span>
        <span class="n">schema_json_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">schema_json_file_name</span><span class="p">)</span>
        <span class="n">meta_xml_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">meta_xml_file_name</span><span class="p">)</span>
        <span class="n">map_xml_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">map_xml_file_name</span><span class="p">)</span>
        <span class="c1"># for single file aggregations, compute the metadata JSON file path using original path</span>
        <span class="n">metadata_json_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">orig_path</span> <span class="o">+</span> <span class="n">AggregationMetaFilePath</span><span class="o">.</span><span class="n">METADATA_JSON_FILE_ENDSWITH</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># case of folder rename - fileset/model aggregation</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">schema_json_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">schema_json_file_name</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">meta_xml_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">meta_xml_file_name</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">map_xml_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">map_xml_file_name</span><span class="p">)</span>
        <span class="n">schema_json_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">schema_json_file_name</span><span class="p">)</span>
        <span class="n">meta_xml_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">meta_xml_file_name</span><span class="p">)</span>
        <span class="n">map_xml_file_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">map_xml_file_name</span><span class="p">)</span>
        <span class="c1"># No need to delete metadata JSON files for folder rename cases as metadata JSON filename</span>
        <span class="c1"># is not affected by folder rename</span>
        <span class="n">metadata_json_file_full_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">schema_json_file_full_path</span><span class="p">):</span>
        <span class="n">istorage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">schema_json_file_full_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">meta_xml_file_full_path</span><span class="p">):</span>
        <span class="n">istorage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">meta_xml_file_full_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">map_xml_file_full_path</span><span class="p">):</span>
        <span class="n">istorage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">map_xml_file_full_path</span><span class="p">)</span>

    <span class="c1"># delete metadata JSON file only for single file aggregations</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="n">is_new_path_a_folder</span>
        <span class="ow">and</span> <span class="n">metadata_json_file_full_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">metadata_json_file_full_path</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">istorage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">metadata_json_file_full_path</span><span class="p">)</span>

    <span class="c1"># set affected logical file metadata to dirty so that xml meta files will be regenerated at the time of</span>
    <span class="c1"># aggregation or bag download</span>
    <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">aggregations</span><span class="p">:</span>
        <span class="c1"># set metadata dirty for any folder based aggregations under the orig_path</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="s1">&#39;folder&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lf</span><span class="o">.</span><span class="n">folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">orig_path</span><span class="p">):</span>
                <span class="n">lf</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">lf</span><span class="o">.</span><span class="n">folder</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">orig_path</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="n">lf</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;folder&quot;</span><span class="p">])</span>
                <span class="n">lf</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>
                <span class="k">continue</span>

        <span class="c1"># set metadata dirty for any non-folder based aggregation under the orig_path</span>
        <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">aggregation_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">orig_path</span><span class="p">):</span>
            <span class="n">lf</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>

        <span class="c1"># set metadata to dirty for non-folder based aggregation under the new_path</span>
        <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">aggregation_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
            <span class="n">lf</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>

    <span class="c1"># set metadata to dirty for any parent aggregation that may exist relative to path *orig_path*</span>
    <span class="n">set_parent_aggregation_dirty</span><span class="p">(</span><span class="n">orig_path</span><span class="p">)</span>

    <span class="c1"># set metadata to dirty for any parent aggregation that may exist relative to path *new_path*</span>
    <span class="n">set_parent_aggregation_dirty</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">aggregation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aggregation_by_name</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">aggregations</span><span class="o">=</span><span class="n">aggregations</span><span class="p">)</span>
        <span class="n">aggregation</span><span class="o">.</span><span class="n">set_metadata_dirty</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
        <span class="c1"># the file path *new_path* does not represent an aggregation - no more</span>
        <span class="c1"># action is needed</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.supports_delete_folder_on_zip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_delete_folder_on_zip</span><span class="p">(</span><span class="n">original_folder</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>check if the specified folder can be deleted at the end of zipping that folder</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">supports_delete_folder_on_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;check if the specified folder can be deleted at the end of zipping that folder&quot;&quot;&quot;</span>

    <span class="c1"># find all the resource files in the folder to be deleted</span>
    <span class="c1"># this is being passed both qualified and unqualified paths!</span>
    <span class="n">full_path</span> <span class="o">=</span> <span class="n">original_folder</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>

    <span class="c1"># get all resource files at full_path and its sub-folders</span>
    <span class="n">res_file_objects</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">list_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>

    <span class="c1"># check any logical file associated with the resource file supports deleting the folder</span>
    <span class="c1"># after its zipped</span>
    <span class="k">for</span> <span class="n">res_file</span> <span class="ow">in</span> <span class="n">res_file_objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span><span class="o">.</span><span class="n">supports_delete_folder_on_zip</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.supports_rename_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_rename_path</span><span class="p">(</span><span class="n">src_full_path</span><span class="p">,</span> <span class="n">tgt_full_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>checks if file/folder rename/move is allowed
:param  src_full_path: name of the file/folder storage path to be renamed (path starts with resource id)
:param  tgt_full_path: new name for file/folder storage path (path starts with resource id)
:return True or False</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">supports_rename_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_full_path</span><span class="p">,</span> <span class="n">tgt_full_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;checks if file/folder rename/move is allowed</span>
<span class="sd">    :param  src_full_path: name of the file/folder storage path to be renamed (path starts with resource id)</span>
<span class="sd">    :param  tgt_full_path: new name for file/folder storage path (path starts with resource id)</span>
<span class="sd">    :return True or False</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">src_full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">tgt_full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>

    <span class="c1"># need to find out which of the following actions the user is trying to do:</span>
    <span class="c1"># renaming a file</span>
    <span class="c1"># renaming a folder</span>
    <span class="c1"># moving a file</span>
    <span class="c1"># moving a folder</span>
    <span class="n">is_renaming_file</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">is_moving_file</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">is_moving_folder</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">tgt_full_path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">:</span>
        <span class="c1"># at the root of the resource all file operations are allowed</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
    <span class="n">scr_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">src_full_path</span><span class="p">)</span>
    <span class="n">src_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_full_path</span><span class="p">)</span>
    <span class="n">tgt_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tgt_full_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">src_full_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tgt_full_path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tgt_full_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">scr_base_name</span><span class="p">):</span>
            <span class="n">is_moving_file</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">tgt_full_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">scr_base_name</span><span class="p">):</span>
                <span class="n">tgt_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tgt_full_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tgt_dir_path</span> <span class="o">=</span> <span class="n">tgt_full_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_renaming_file</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># src path is a directory</span>
        <span class="k">if</span> <span class="n">src_dir_path</span> <span class="o">==</span> <span class="n">tgt_dir_path</span><span class="p">:</span>
            <span class="c1"># renaming folder - no restriction</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_moving_folder</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">check_src_aggregation</span><span class="p">(</span><span class="n">src_aggr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;checks if the aggregation at the source allows file rename/move action&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">src_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_renaming_file</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">src_aggr</span><span class="o">.</span><span class="n">supports_resource_file_rename</span>
            <span class="k">elif</span> <span class="n">is_moving_file</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">src_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">is_renaming_file</span> <span class="ow">or</span> <span class="n">is_moving_file</span><span class="p">:</span>
        <span class="c1"># see if the folder containing the file represents an aggregation</span>
        <span class="n">src_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_file_aggregation_object</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">src_full_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_src_aggregation</span><span class="p">(</span><span class="n">src_aggr</span><span class="p">):</span>
            <span class="c1"># check target</span>
            <span class="k">if</span> <span class="n">is_moving_file</span><span class="p">:</span>
                <span class="n">tgt_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">tgt_dir_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tgt_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">src_aggr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">can_contain_aggregation</span><span class="p">(</span><span class="n">src_aggr</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">is_moving_folder</span><span class="p">:</span>
        <span class="n">src_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">src_full_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">src_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">src_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span><span class="p">:</span>
                <span class="n">tgt_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">tgt_full_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tgt_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span> <span class="ow">and</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">can_contain_aggregation</span><span class="p">(</span><span class="n">src_aggr</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="n">tgt_aggr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_aggregation_in_path</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">tgt_full_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tgt_aggr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tgt_aggr</span><span class="o">.</span><span class="n">supports_resource_file_move</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.supports_zip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_zip</span><span class="p">(</span><span class="n">folder_to_zip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>check if the given folder can be zipped or not</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">supports_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_to_zip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;check if the given folder can be zipped or not&quot;&quot;&quot;</span>

    <span class="c1"># find all the resource files in the folder to be zipped</span>
    <span class="c1"># this is being passed both qualified and unqualified paths!</span>

    <span class="n">full_path</span> <span class="o">=</span> <span class="n">folder_to_zip</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>
    <span class="c1"># get all resource files at full_path and its sub-folders</span>
    <span class="n">res_file_objects</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">list_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>

    <span class="c1"># check any logical file associated with the resource file supports zip functionality</span>
    <span class="k">for</span> <span class="n">res_file</span> <span class="ow">in</span> <span class="n">res_file_objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">res_file</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">res_file</span><span class="o">.</span><span class="n">logical_file</span><span class="o">.</span><span class="n">supports_zip</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.update_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_coverage</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update resource spatial and temporal coverage based on the corresponding coverages
from all the contained aggregations (logical file) only if the resource coverage is not
already set</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update resource spatial and temporal coverage based on the corresponding coverages</span>
<span class="sd">    from all the contained aggregations (logical file) only if the resource coverage is not</span>
<span class="sd">    already set&quot;&quot;&quot;</span>

    <span class="c1"># update resource spatial coverage only if there is no spatial coverage already</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_spatial_coverage</span><span class="p">()</span>

    <span class="c1"># update resource temporal coverage only if there is no temporal coverage already</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">temporal_coverage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_temporal_coverage</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.update_spatial_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_spatial_coverage</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Updates resource spatial coverage based on the contained spatial coverages of
aggregations (file type). Note: This action will overwrite any existing resource spatial
coverage data.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_spatial_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates resource spatial coverage based on the contained spatial coverages of</span>
<span class="sd">    aggregations (file type). Note: This action will overwrite any existing resource spatial</span>
<span class="sd">    coverage data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">update_target_spatial_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_composite_resource.models.CompositeResource.update_temporal_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_temporal_coverage</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Updates resource temporal coverage based on the contained temporal coverages of
aggregations (file type). Note: This action will overwrite any existing resource temporal
coverage data.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_composite_resource/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_temporal_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates resource temporal coverage based on the contained temporal coverages of</span>
<span class="sd">    aggregations (file type). Note: This action will overwrite any existing resource temporal</span>
<span class="sd">    coverage data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">update_target_temporal_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>