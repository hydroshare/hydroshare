{% extends "pages/page.html" %}

{% load mezzanine_tags pages_tags hydroshare_tags %}

{% block extra_head %}
      <link href="{{ STATIC_URL }}css/site_base_irods.css" rel="stylesheet"/>
{% endblock %}

{% block title %}

    Create resource

{% endblock %}

{% block main %}
    <div class="container">
        <div class="row">
            {% block error %}
                {%  if validation_error %}
                    <div class="alert alert-danger alert-dismissible" role="alert">
                          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                          <strong>Validation Error: {{ validation_error }}</strong>
                     </div>
                {%  endif %}
                {%  if file_size_error %}
                    <div class="alert alert-danger alert-dismissible" role="alert">
                          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                          <strong>Uploaded File Size Error: {{ file_size_error }}</strong>
                     </div>
                {%  endif %}
                {%  if resource_creation_error %}
                    <div class="alert alert-danger alert-dismissible" role="alert">
                          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                          <strong>Failed to Create Resource: {{ resource_creation_error }}</strong>
                     </div>
                {%  endif %}
            {% endblock %}

            <h2>Select a resource type and upload files as needed to create a new resource</h2>

            <ul>
            <li>Files you upload here will be grouped together into a "Resource" in HydroShare.</li>
            <li>File size is limited to 1 GB per file for direct browser upload from your local disk.</li>
            <li>Files larger than 1GB can be imported directly from any iRODS account. You can create
                a HydroShare iRODS account from your <a href="/user/{{ user.id }}/">user profile</a> page.
                See help for information on working with iRODS directly.
            </li>
            <li> You can also add files directly from any iRODS server regardless of the file size. </li>
            </ul>

            <form class="form-horizontal" role="form" method="POST" enctype="multipart/form-data" action="/hsapi/_internal/create-resource/do/">
                {% csrf_token %}
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">Select a resource type</label>

                    <div class="col-sm-10">
                        <select class="form-control" name="resource-type" id="resource-type">
                            <option value="GenericResource">Generic</option>
                            <option value="NetcdfResource">Multidimensional (NetCDF)</option>
                            <option value="ToolResource">Web App</option>
                            <option value="CollectionResource">Collection Resource</option>
                            <option value="CompositeResource">Composite Resource</option>

                            <optgroup label="Geographic Resources">
                                <option value="RasterResource">Geographic Raster</option>
                                <option value="GeographicFeatureResource">Geographic Feature (ESRI Shapefiles)</option>
                            </optgroup>

                            <optgroup label="Time Series Resources">
                                <option value="TimeSeriesResource">Time Series</option>
                                <option value="RefTimeSeriesResource">HIS Referenced Time Series</option>
                            </optgroup>

                            <optgroup label="Modeling">
                                <option value="ModelProgramResource">Model Program</option>
                                <option value="ModelInstanceResource">Model Instance</option>
                                <option value="SWATModelInstanceResource">SWAT Model Instance</option>
                                <option value="MODFLOWModelInstanceResource">MODFLOW Model Instance</option>
                                <option value="ScriptResource">Script</option>
                            </optgroup>

                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-sm-2 control-label">Title</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" name="title" id="title" placeholder="Untitled resource">
                    </div>
                </div>
                <div id="upload-file">
                    <h3>Add your files here:</h3>
                    <table class="table" id="file-list">
                    <tbody id="files">
                        <tr>
                            <td>To load files from your local disk with file size limited to 1GB per file:
                                <input type="file" class="btn-add-access" name="files" id="select-file" multiple/>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                To load files from an iRODS server including your iRODS user HydroShare server:
                                <div id="irods-browse">
                                    <span id="log-into-irods">
                                        <a id="btn-signin-irods" type="button" class="btn-link" data-toggle="modal" data-target="#irodsSignin">log in to iRODS</a>
                                    </span>
                                    <input type="hidden" id="irods-username" name="irods-username" value="">
                                    <input type="hidden" id="irods-password" name="irods-password" value="">
                                    <input type="hidden" id="irods-host" name="irods-host" value="">
                                    <input type="hidden" id="irods-port" name="irods-port" value="">
                                    <input type="hidden" id="irods-zone" name="irods-zone" value="">
                                    <input type="hidden" id="irods_file_names" name="irods_file_names" value="">
                                    <input type="hidden" id="irods_federated" name="irods_federated" value="">
                                    <span id="sign-in-info"></span>
                                    <a id="btn-select-irods-file" type="button" class="btn btn-default hidden-form"
                                       data-toggle="modal" data-target="#irodsContent">
                                        Browse iRODS...
                                    </a>
                                    <span id="irods-sel-file"></span>
                                    <input type="hidden" id="copy-or-move" name="copy-or-move" value='copy'>
                                    <span id="irods-copy-move" class="hidden-form">
                                        <input type="radio" id='copy-radio' name="copy-move" value="copy" checked="checked"> Copy
                                        <input type="radio" id='move-radio' name="copy-move" value="move"> Move
                                    </span>
                                    <a id="btn-signout-irods" type="button" class="btn-link hidden-form">log out of iRODS</a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    <div id="file-types">Any file type can be uploaded.</div>
                    <div id="file-multiple">Multiple file upload is allowed.</div>
                    </table>
                    <h2 id="file-move-warning" class="text-red hidden-form">You selected move option which will move
                        the selected files out of your iRODS account into a HydroShare resource once created. </h2>
                    <h2 class="text-red">{{ file_size_error }}</h2>
                    <h2 id="file-type-error" class="text-red">{{ validation_error }}</h2>
                </div>

                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-primary btn-lg btn-block">Create Resource</button>
                    </div>
                </div>
            </form>
            {% block modal %}
                {% include "irods_signin.html" %}
                {% include "irods_upload_create.html" %}
            {% endblock %}
        </div>
    </div>

    {% block extra_js %}
        {{ block.super }}
        <script type="text/javascript" src="{{ STATIC_URL }}js/create-resource.js"></script>
    {% endblock %}
{% endblock %}