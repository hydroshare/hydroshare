
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../views/">
      
      
        <link rel="next" href="../../hs_composite_resource/views/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Models - HydroShare Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hs_core.models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="HydroShare Documentation" class="md-header__button md-logo" aria-label="HydroShare Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HydroShare Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Models
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="HydroShare Documentation" class="md-nav__button md-logo" aria-label="HydroShare Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    HydroShare Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Control
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dev Environment
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devcommunication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dev Communication
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Design Docs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Design Docs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DesignDocs/API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DesignDocs/UserNameEmailRules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UserNameEmailRules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Code Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" checked>
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    HS Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    HS Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Views
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hs_core.models" class="md-nav__link">
    <span class="md-ellipsis">
      
        models
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbstractMetaDataElement
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractMetaDataElement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __str__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbstractRelation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractRelation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __str__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbstractResource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractResource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.aggregation_type_names" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_type_names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.aggregation_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.can_be_public_or_discoverable" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_be_public_or_discoverable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.first_creator" class="md-nav__link">
    <span class="md-ellipsis">
      
        first_creator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.has_logical_spatial_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_spatial_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.has_logical_temporal_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_temporal_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.has_required_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_required_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.last_updated" class="md-nav__link">
    <span class="md-ellipsis">
      
        last_updated
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.logical_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        logical_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.readme_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        readme_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_folders" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_folders
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.allow_multiple_file_upload" class="md-nav__link">
    <span class="md-ellipsis">
      
        allow_multiple_file_upload
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.can_have_multiple_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_have_multiple_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.extra_capabilites" class="md-nav__link">
    <span class="md-ellipsis">
      
        extra_capabilites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.getAVU" class="md-nav__link">
    <span class="md-ellipsis">
      
        getAVU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_citation" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_citation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_custom_citation" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_custom_citation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_logical_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_logical_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_metadata_xml" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_metadata_xml
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_readme_file_content" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_readme_file_content
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_s3_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_s3_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_supported_upload_file_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_supported_upload_file_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_url_of_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_url_of_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.has_required_content_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_required_content_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_aggregation_xml_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_aggregation_xml_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_collection_list_csv" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_collection_list_csv
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_folder" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_folder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_metadata_json_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_metadata_json_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_metadata_xml_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_metadata_xml_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_schema_json_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_schema_json_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_schema_json_values_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_schema_json_values_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.parse_citation_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_citation_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.resmap_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        resmap_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.save" class="md-nav__link">
    <span class="md-ellipsis">
      
        save
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.scimeta_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        scimeta_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.setAVU" class="md-nav__link">
    <span class="md-ellipsis">
      
        setAVU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_discoverable" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_discoverable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_private_sharing_link" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_private_sharing_link
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_public" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_public
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_published" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_published
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_quota_holder" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_quota_holder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_require_download_agreement" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_require_download_agreement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_delete_folder_on_zip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_delete_folder_on_zip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_folder_creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_folder_creation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_rename_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_rename_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_unzip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_unzip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_zip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_zip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.sysmeta_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        sysmeta_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.update_all_cached_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_all_cached_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.update_cached_metadata_field" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_cached_metadata_field
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.update_index" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_index
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.update_public_and_discoverable" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_public_and_discoverable
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaseResource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseResource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.bag_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        bag_checksum
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.bag_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        bag_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.bag_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        bag_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_be_submitted_for_metadata_review" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_be_submitted_for_metadata_review
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.discovery_content_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        discovery_content_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.file_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        file_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.resmap_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        resmap_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.root_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        root_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.scimeta_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        scimeta_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.show_in_discover" class="md-nav__link">
    <span class="md-ellipsis">
      
        show_in_discover
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.size" class="md-nav__link">
    <span class="md-ellipsis">
      
        size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.verbose_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        verbose_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_add" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_add
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_change" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_have_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_have_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_have_multiple_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_have_multiple_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_view" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_view
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_datacite_deposit_json" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_datacite_deposit_json
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_dates_for_doi" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dates_for_doi
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_funding_references" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_funding_references
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_hs_term_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_hs_term_dict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_non_preferred_path_names" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_non_preferred_path_names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_related_items" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_related_items
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_relation_version_res_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_relation_version_res_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_s3_storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_s3_storage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_supported_upload_file_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_supported_upload_file_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.replaced_by" class="md-nav__link">
    <span class="md-ellipsis">
      
        replaced_by
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.update_relation_meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_relation_meta
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Citation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Citation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Citation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Citation.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Citation.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Citation.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Citation.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Contributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contributor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData" class="md-nav__link">
    <span class="md-ellipsis">
      
        CoreMetaData
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CoreMetaData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.description" class="md-nav__link">
    <span class="md-ellipsis">
      
        description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.language" class="md-nav__link">
    <span class="md-ellipsis">
      
        language
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.publisher" class="md-nav__link">
    <span class="md-ellipsis">
      
        publisher
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.resource" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.rights" class="md-nav__link">
    <span class="md-ellipsis">
      
        rights
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.serializer" class="md-nav__link">
    <span class="md-ellipsis">
      
        serializer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.title" class="md-nav__link">
    <span class="md-ellipsis">
      
        title
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.type" class="md-nav__link">
    <span class="md-ellipsis">
      
        type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.copy_all_elements_from" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy_all_elements_from
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.create_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.delete_all_elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_all_elements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.delete_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.get_form_errors_as_string" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_form_errors_as_string
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.get_recommended_missing_elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_recommended_missing_elements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.get_required_missing_elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_required_missing_elements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.get_supported_element_names" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_supported_element_names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.has_all_required_elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_all_required_elements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.ignored_generic_relations" class="md-nav__link">
    <span class="md-ellipsis">
      
        ignored_generic_relations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.parse_for_bulk_update" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_for_bulk_update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.set_dirty" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_dirty
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.update_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.update_non_repeatable_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_non_repeatable_element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.update_repeatable_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_repeatable_element
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coverage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coverage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.value" class="md-nav__link">
    <span class="md-ellipsis">
      
        value
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.add_to_xml_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_to_xml_container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.get_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_html
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.get_spatial_html_form" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_spatial_html_form
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.get_temporal_html_form" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_temporal_html_form
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.validate_coverage_type_value_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_coverage_type_value_attributes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Creator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creator
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Creator.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Date" class="md-nav__link">
    <span class="md-ellipsis">
      
        Date
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Date">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Description
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.DiscoverableResourceManager" class="md-nav__link">
    <span class="md-ellipsis">
      
        DiscoverableResourceManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiscoverableResourceManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.DiscoverableResourceManager.get_queryset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_queryset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Format
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Format.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Format.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.FundingAgency" class="md-nav__link">
    <span class="md-ellipsis">
      
        FundingAgency
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FundingAgency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.FundingAgency.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.FundingAgency.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.FundingAgency.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.GroupOwnership" class="md-nav__link">
    <span class="md-ellipsis">
      
        GroupOwnership
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.HSAdaptorEditInline" class="md-nav__link">
    <span class="md-ellipsis">
      
        HSAdaptorEditInline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HSAdaptorEditInline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.HSAdaptorEditInline.can_edit" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_edit
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Identifier" class="md-nav__link">
    <span class="md-ellipsis">
      
        Identifier
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Identifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Identifier.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Identifier.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Identifier.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Identifier.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Language" class="md-nav__link">
    <span class="md-ellipsis">
      
        Language
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Language">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Language.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Language.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Language.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Language.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Party" class="md-nav__link">
    <span class="md-ellipsis">
      
        Party
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Party">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.ingest_rdf" class="md-nav__link">
    <span class="md-ellipsis">
      
        ingest_rdf
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.validate_identifiers" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_identifiers
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.PublicResourceManager" class="md-nav__link">
    <span class="md-ellipsis">
      
        PublicResourceManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PublicResourceManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.PublicResourceManager.get_queryset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_queryset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Publisher" class="md-nav__link">
    <span class="md-ellipsis">
      
        Publisher
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Publisher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.RangedFileReader" class="md-nav__link">
    <span class="md-ellipsis">
      
        RangedFileReader
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RangedFileReader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.RangedFileReader.parse_range_header" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_range_header
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Relation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile" class="md-nav__link">
    <span class="md-ellipsis">
      
        ResourceFile
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResourceFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.aggregation_display_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_display_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        checksum
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.dir_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        dir_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.extension" class="md-nav__link">
    <span class="md-ellipsis">
      
        extension
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.file_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        file_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.full_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        full_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.has_generic_logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_generic_logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.has_logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.logical_file_type_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        logical_file_type_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.mime_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        mime_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.modified_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        modified_time
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.public_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        public_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.resource" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.s3_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        s3_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.short_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        short_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.size" class="md-nav__link">
    <span class="md-ellipsis">
      
        size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.storage_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        storage_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.url" class="md-nav__link">
    <span class="md-ellipsis">
      
        url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.banned_symbols" class="md-nav__link">
    <span class="md-ellipsis">
      
        banned_symbols
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.calculate_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_checksum
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.calculate_modified_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_modified_time
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.calculate_size" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.check_for_preferred_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        check_for_preferred_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.create_folder" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_folder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.get_short_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_short_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.get_storage_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_storage_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.is_filename_valid" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_filename_valid
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.is_folder_name_valid" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_folder_name_valid
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.list_folder" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_folder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.parse" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.path_is_acceptable" class="md-nav__link">
    <span class="md-ellipsis">
      
        path_is_acceptable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.remove_folder" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_folder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.resource_path_is_acceptable" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource_path_is_acceptable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.set_short_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_short_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.set_storage_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_storage_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.set_system_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_system_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.system_meta_fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        system_meta_fields
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.validate_new_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_new_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.ResourceManager" class="md-nav__link">
    <span class="md-ellipsis">
      
        ResourceManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResourceManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceManager.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceManager.get_queryset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_queryset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin" class="md-nav__link">
    <span class="md-ellipsis">
      
        ResourcePermissionsMixin
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResourcePermissionsMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.permissions_store" class="md-nav__link">
    <span class="md-ellipsis">
      
        permissions_store
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.can_add" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_add
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.can_change" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.can_delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.can_view" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_view
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Rights" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rights
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Rights.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Rights.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Rights.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Subject" class="md-nav__link">
    <span class="md-ellipsis">
      
        Subject
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Subject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Subject.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Subject.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Subject.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Subject.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Title" class="md-nav__link">
    <span class="md-ellipsis">
      
        Title
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Title">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Title.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Title.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Title.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Type" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Type.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Type.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Type.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.clean_abstract" class="md-nav__link">
    <span class="md-ellipsis">
      
        clean_abstract
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.clean_for_xml" class="md-nav__link">
    <span class="md-ellipsis">
      
        clean_for_xml
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.get_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_path
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.get_resource_file_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_resource_file_path
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.get_user" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_user
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.new_get_content_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        new_get_content_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.page_permissions_page_processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        page_permissions_page_processor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.path_is_allowed" class="md-nav__link">
    <span class="md-ellipsis">
      
        path_is_allowed
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.resource_creation_signal_handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource_creation_signal_handler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.resource_processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource_processor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.resource_update_signal_handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource_update_signal_handler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.short_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        short_id
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.validate_abstract" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_abstract
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.validate_hydroshare_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_hydroshare_user_id
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.validate_user_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_user_url
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Composite Resource
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Composite Resource
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hs_composite_resource/views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Views
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hs_composite_resource/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hs_core.models" class="md-nav__link">
    <span class="md-ellipsis">
      
        models
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbstractMetaDataElement
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractMetaDataElement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __str__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractMetaDataElement.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbstractRelation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractRelation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __str__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractRelation.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbstractResource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractResource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.aggregation_type_names" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_type_names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.aggregation_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.can_be_public_or_discoverable" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_be_public_or_discoverable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.first_creator" class="md-nav__link">
    <span class="md-ellipsis">
      
        first_creator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.has_logical_spatial_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_spatial_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.has_logical_temporal_coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_temporal_coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.has_required_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_required_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.last_updated" class="md-nav__link">
    <span class="md-ellipsis">
      
        last_updated
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.logical_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        logical_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.readme_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        readme_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_folders" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_folders
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.allow_multiple_file_upload" class="md-nav__link">
    <span class="md-ellipsis">
      
        allow_multiple_file_upload
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.can_have_multiple_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_have_multiple_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.extra_capabilites" class="md-nav__link">
    <span class="md-ellipsis">
      
        extra_capabilites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.getAVU" class="md-nav__link">
    <span class="md-ellipsis">
      
        getAVU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_citation" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_citation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_custom_citation" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_custom_citation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_logical_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_logical_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_metadata_xml" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_metadata_xml
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_readme_file_content" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_readme_file_content
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_s3_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_s3_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_supported_upload_file_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_supported_upload_file_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.get_url_of_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_url_of_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.has_required_content_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_required_content_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_aggregation_xml_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_aggregation_xml_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_collection_list_csv" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_collection_list_csv
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_folder" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_folder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_metadata_json_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_metadata_json_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_metadata_xml_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_metadata_xml_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_schema_json_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_schema_json_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.is_schema_json_values_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_schema_json_values_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.parse_citation_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_citation_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.resmap_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        resmap_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.save" class="md-nav__link">
    <span class="md-ellipsis">
      
        save
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.scimeta_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        scimeta_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.setAVU" class="md-nav__link">
    <span class="md-ellipsis">
      
        setAVU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_discoverable" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_discoverable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_private_sharing_link" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_private_sharing_link
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_public" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_public
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_published" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_published
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_quota_holder" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_quota_holder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.set_require_download_agreement" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_require_download_agreement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_delete_folder_on_zip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_delete_folder_on_zip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_folder_creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_folder_creation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_rename_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_rename_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_unzip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_unzip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.supports_zip" class="md-nav__link">
    <span class="md-ellipsis">
      
        supports_zip
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.sysmeta_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        sysmeta_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.update_all_cached_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_all_cached_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.update_cached_metadata_field" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_cached_metadata_field
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.update_index" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_index
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.AbstractResource.update_public_and_discoverable" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_public_and_discoverable
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaseResource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseResource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.bag_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        bag_checksum
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.bag_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        bag_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.bag_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        bag_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_be_submitted_for_metadata_review" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_be_submitted_for_metadata_review
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.discovery_content_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        discovery_content_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.file_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        file_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.resmap_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        resmap_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.root_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        root_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.scimeta_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        scimeta_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.show_in_discover" class="md-nav__link">
    <span class="md-ellipsis">
      
        show_in_discover
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.size" class="md-nav__link">
    <span class="md-ellipsis">
      
        size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.verbose_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        verbose_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_add" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_add
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_change" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_have_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_have_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_have_multiple_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_have_multiple_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.can_view" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_view
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_datacite_deposit_json" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_datacite_deposit_json
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_dates_for_doi" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dates_for_doi
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_funding_references" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_funding_references
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_hs_term_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_hs_term_dict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_non_preferred_path_names" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_non_preferred_path_names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_related_items" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_related_items
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_relation_version_res_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_relation_version_res_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_s3_storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_s3_storage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.get_supported_upload_file_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_supported_upload_file_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.replaced_by" class="md-nav__link">
    <span class="md-ellipsis">
      
        replaced_by
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.BaseResource.update_relation_meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_relation_meta
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Citation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Citation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Citation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Citation.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Citation.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Citation.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Citation.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Contributor" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contributor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData" class="md-nav__link">
    <span class="md-ellipsis">
      
        CoreMetaData
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CoreMetaData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.description" class="md-nav__link">
    <span class="md-ellipsis">
      
        description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.language" class="md-nav__link">
    <span class="md-ellipsis">
      
        language
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.publisher" class="md-nav__link">
    <span class="md-ellipsis">
      
        publisher
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.resource" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.rights" class="md-nav__link">
    <span class="md-ellipsis">
      
        rights
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.serializer" class="md-nav__link">
    <span class="md-ellipsis">
      
        serializer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.title" class="md-nav__link">
    <span class="md-ellipsis">
      
        title
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.type" class="md-nav__link">
    <span class="md-ellipsis">
      
        type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.copy_all_elements_from" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy_all_elements_from
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.create_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.delete_all_elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_all_elements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.delete_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.get_form_errors_as_string" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_form_errors_as_string
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.get_recommended_missing_elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_recommended_missing_elements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.get_required_missing_elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_required_missing_elements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.get_supported_element_names" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_supported_element_names
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.has_all_required_elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_all_required_elements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.ignored_generic_relations" class="md-nav__link">
    <span class="md-ellipsis">
      
        ignored_generic_relations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.parse_for_bulk_update" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_for_bulk_update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.set_dirty" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_dirty
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.update_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.update_non_repeatable_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_non_repeatable_element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.CoreMetaData.update_repeatable_element" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_repeatable_element
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coverage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coverage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.value" class="md-nav__link">
    <span class="md-ellipsis">
      
        value
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.add_to_xml_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_to_xml_container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.get_html" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_html
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.get_spatial_html_form" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_spatial_html_form
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.get_temporal_html_form" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_temporal_html_form
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Coverage.validate_coverage_type_value_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_coverage_type_value_attributes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Creator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creator
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Creator.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Date" class="md-nav__link">
    <span class="md-ellipsis">
      
        Date
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Date">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Date.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Description
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Description.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.DiscoverableResourceManager" class="md-nav__link">
    <span class="md-ellipsis">
      
        DiscoverableResourceManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiscoverableResourceManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.DiscoverableResourceManager.get_queryset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_queryset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Format
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Format.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Format.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.FundingAgency" class="md-nav__link">
    <span class="md-ellipsis">
      
        FundingAgency
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FundingAgency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.FundingAgency.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.FundingAgency.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.FundingAgency.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.GroupOwnership" class="md-nav__link">
    <span class="md-ellipsis">
      
        GroupOwnership
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.HSAdaptorEditInline" class="md-nav__link">
    <span class="md-ellipsis">
      
        HSAdaptorEditInline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HSAdaptorEditInline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.HSAdaptorEditInline.can_edit" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_edit
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Identifier" class="md-nav__link">
    <span class="md-ellipsis">
      
        Identifier
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Identifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Identifier.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Identifier.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Identifier.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Identifier.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Language" class="md-nav__link">
    <span class="md-ellipsis">
      
        Language
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Language">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Language.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Language.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Language.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Language.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Party" class="md-nav__link">
    <span class="md-ellipsis">
      
        Party
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Party">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.ingest_rdf" class="md-nav__link">
    <span class="md-ellipsis">
      
        ingest_rdf
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Party.validate_identifiers" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_identifiers
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.PublicResourceManager" class="md-nav__link">
    <span class="md-ellipsis">
      
        PublicResourceManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PublicResourceManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.PublicResourceManager.get_queryset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_queryset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Publisher" class="md-nav__link">
    <span class="md-ellipsis">
      
        Publisher
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Publisher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Publisher.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.RangedFileReader" class="md-nav__link">
    <span class="md-ellipsis">
      
        RangedFileReader
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RangedFileReader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.RangedFileReader.parse_range_header" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_range_header
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Relation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile" class="md-nav__link">
    <span class="md-ellipsis">
      
        ResourceFile
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResourceFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.aggregation_display_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        aggregation_display_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        checksum
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.dir_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        dir_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.extension" class="md-nav__link">
    <span class="md-ellipsis">
      
        extension
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.file_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        file_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.full_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        full_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.has_generic_logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_generic_logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.has_logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.logical_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        logical_file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.logical_file_type_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        logical_file_type_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.mime_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        mime_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.modified_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        modified_time
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.public_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        public_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.resource" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.s3_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        s3_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.short_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        short_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.size" class="md-nav__link">
    <span class="md-ellipsis">
      
        size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.storage_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        storage_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.url" class="md-nav__link">
    <span class="md-ellipsis">
      
        url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.banned_symbols" class="md-nav__link">
    <span class="md-ellipsis">
      
        banned_symbols
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.calculate_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_checksum
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.calculate_modified_time" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_modified_time
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.calculate_size" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.check_for_preferred_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        check_for_preferred_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.create_folder" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_folder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.get_short_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_short_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.get_storage_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_storage_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.is_filename_valid" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_filename_valid
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.is_folder_name_valid" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_folder_name_valid
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.list_folder" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_folder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.parse" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.path_is_acceptable" class="md-nav__link">
    <span class="md-ellipsis">
      
        path_is_acceptable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.remove_folder" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_folder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.resource_path_is_acceptable" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource_path_is_acceptable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.set_short_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_short_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.set_storage_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_storage_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.set_system_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_system_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.system_meta_fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        system_meta_fields
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceFile.validate_new_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_new_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.ResourceManager" class="md-nav__link">
    <span class="md-ellipsis">
      
        ResourceManager
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResourceManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceManager.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourceManager.get_queryset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_queryset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin" class="md-nav__link">
    <span class="md-ellipsis">
      
        ResourcePermissionsMixin
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResourcePermissionsMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.permissions_store" class="md-nav__link">
    <span class="md-ellipsis">
      
        permissions_store
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.can_add" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_add
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.can_change" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.can_delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.ResourcePermissionsMixin.can_view" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_view
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Rights" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rights
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Rights.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Rights.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Rights.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Subject" class="md-nav__link">
    <span class="md-ellipsis">
      
        Subject
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Subject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Subject.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Subject.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Subject.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Subject.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Title" class="md-nav__link">
    <span class="md-ellipsis">
      
        Title
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Title">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Title.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Title.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Title.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.Type" class="md-nav__link">
    <span class="md-ellipsis">
      
        Type
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Type.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Type.__unicode__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __unicode__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hs_core.models.Type.remove" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.clean_abstract" class="md-nav__link">
    <span class="md-ellipsis">
      
        clean_abstract
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.clean_for_xml" class="md-nav__link">
    <span class="md-ellipsis">
      
        clean_for_xml
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.get_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_path
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.get_resource_file_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_resource_file_path
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.get_user" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_user
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.new_get_content_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        new_get_content_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.page_permissions_page_processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        page_permissions_page_processor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.path_is_allowed" class="md-nav__link">
    <span class="md-ellipsis">
      
        path_is_allowed
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.resource_creation_signal_handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource_creation_signal_handler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.resource_processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource_processor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.resource_update_signal_handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        resource_update_signal_handler
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.short_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        short_id
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.validate_abstract" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_abstract
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.validate_hydroshare_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_hydroshare_user_id
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hs_core.models.validate_user_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_user_url
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Models</h1>

<div class="doc doc-object doc-module">



<a id="hs_core.models"></a>
    <div class="doc doc-contents first">

        <p>Declare critical models for Hydroshare hs_core app.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="hs_core.models.AbstractMetaDataElement" class="doc doc-heading">
            <code>AbstractMetaDataElement</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.db.models.Model">Model</span></code>, <code><span title="hs_core.hs_rdf.RDF_Term_MixIn">RDF_Term_MixIn</span></code></p>



        <p>Define abstract class for all metadata elements.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AbstractMetaDataElement</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">RDF_Term_MixIn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define abstract class for all metadata elements.&quot;&quot;&quot;</span>

    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="c1"># see the following link the reason for having the related_name setting</span>
    <span class="c1"># for the content_type attribute</span>
    <span class="c1"># https://docs.djangoproject.com/en/1.6/topics/db/models/#abstract-related-name</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                                     <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(app_label)s</span><span class="s2">_</span><span class="si">%(class)s</span><span class="s2">_related&quot;</span><span class="p">)</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return unicode for python 3 compatibility in templates&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unicode__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return content object that describes metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_object</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass through kwargs to object.create method.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass through kwargs to update specific metadata object.&quot;&quot;&quot;</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">element</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">element</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass through element id to objects.get and then delete() method.</span>

<span class="sd">        Could not name this method as &#39;delete&#39; since the parent &#39;Model&#39; class has such a method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
        <span class="n">element</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for AbstractMetaDataElement class.&quot;&quot;&quot;</span>

        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractMetaDataElement.metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metadata</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return content object that describes metadata.</p>

    </div>

</div>



<div class="doc doc-object doc-class">



<h3 id="hs_core.models.AbstractMetaDataElement.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for AbstractMetaDataElement class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for AbstractMetaDataElement class.&quot;&quot;&quot;</span>

    <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractMetaDataElement.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return unicode for python 3 compatibility in templates</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return unicode for python 3 compatibility in templates&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unicode__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractMetaDataElement.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Pass through kwargs to object.create method.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through kwargs to object.create method.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractMetaDataElement.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Pass through element id to objects.get and then delete() method.</p>
<p>Could not name this method as 'delete' since the parent 'Model' class has such a method</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through element id to objects.get and then delete() method.</span>

<span class="sd">    Could not name this method as &#39;delete&#39; since the parent &#39;Model&#39; class has such a method</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">element</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
    <span class="n">element</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractMetaDataElement.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Pass through kwargs to update specific metadata object.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through kwargs to update specific metadata object.&quot;&quot;&quot;</span>
    <span class="n">element</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">element</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">element</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.AbstractRelation" class="doc doc-heading">
            <code>AbstractRelation</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Abstract Relation class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AbstractRelation</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Abstract Relation class.&quot;&quot;&quot;</span>
    <span class="n">SOURCE_TYPES</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Relation&#39;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">SOURCE_TYPES</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return {type} {value} for string representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return {type} {value} for unicode representation (deprecated).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_supported_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">SOURCE_TYPES</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">type_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SOURCE_TYPES</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for Relation class.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type of relation element is missing.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value of relation element is missing.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">SOURCE_TYPES</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid relation type:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

        <span class="c1"># ensure isHostedBy and isCopiedFrom are mutually exclusive</span>
        <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
        <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>

        <span class="c1"># avoid creating duplicate element (same type and same value)</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                              <span class="n">value</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                              <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                              <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Relation element of the same type &#39;</span>
                                  <span class="s1">&#39;and value already exists.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AbstractRelation</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update method for Relation class.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type of relation element is missing.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value of relation element is missing.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">SOURCE_TYPES</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid relation type:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

        <span class="c1"># avoid changing this relation to an existing relation of same type and same value</span>
        <span class="n">rel</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
        <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
        <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                                <span class="n">value</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                                <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">qs</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">qs</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rel</span><span class="p">:</span>
            <span class="c1"># this update will create a duplicate relation element</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;A relation element of the same type and value already exists.&#39;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AbstractRelation</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractRelation.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return {type} {value} for string representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return {type} {value} for string representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractRelation.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return {type} {value} for unicode representation (deprecated).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return {type} {value} for unicode representation (deprecated).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractRelation.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for Relation class.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for Relation class.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type of relation element is missing.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value of relation element is missing.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">SOURCE_TYPES</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid relation type:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

    <span class="c1"># ensure isHostedBy and isCopiedFrom are mutually exclusive</span>
    <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
    <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>

    <span class="c1"># avoid creating duplicate element (same type and same value)</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                          <span class="n">value</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                          <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                          <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Relation element of the same type &#39;</span>
                              <span class="s1">&#39;and value already exists.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AbstractRelation</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractRelation.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update method for Relation class.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update method for Relation class.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type of relation element is missing.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value of relation element is missing.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">SOURCE_TYPES</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid relation type:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

    <span class="c1"># avoid changing this relation to an existing relation of same type and same value</span>
    <span class="n">rel</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
    <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
    <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                            <span class="n">value</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                            <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                            <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">qs</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">qs</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rel</span><span class="p">:</span>
        <span class="c1"># this update will create a duplicate relation element</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;A relation element of the same type and value already exists.&#39;</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">AbstractRelation</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.AbstractResource" class="doc doc-heading">
            <code>AbstractResource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ResourcePermissionsMixin (hs_core.models.ResourcePermissionsMixin)" href="#hs_core.models.ResourcePermissionsMixin">ResourcePermissionsMixin</a></code>, <code><span title="hs_core.s3.ResourceS3Mixin">ResourceS3Mixin</span></code></p>



        <p>Create Abstract Class for all Resources.</p>
<p>All hydroshare objects inherit from this mixin.  It defines things that must
be present to be considered a hydroshare resource.  Additionally, all
hydroshare resources should inherit from Page.  This gives them what they
need to be represented in the Mezzanine CMS.</p>
<p>In some cases, it is possible that the order of inheritence matters.  Best
practice dictates that you list pages.Page first and then other classes:</p>
<pre><code>class MyResourceContentType(pages.Page, hs_core.AbstractResource):
    ...
</code></pre>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span>
<span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span>
<span class="normal">3257</span>
<span class="normal">3258</span>
<span class="normal">3259</span>
<span class="normal">3260</span>
<span class="normal">3261</span>
<span class="normal">3262</span>
<span class="normal">3263</span>
<span class="normal">3264</span>
<span class="normal">3265</span>
<span class="normal">3266</span>
<span class="normal">3267</span>
<span class="normal">3268</span>
<span class="normal">3269</span>
<span class="normal">3270</span>
<span class="normal">3271</span>
<span class="normal">3272</span>
<span class="normal">3273</span>
<span class="normal">3274</span>
<span class="normal">3275</span>
<span class="normal">3276</span>
<span class="normal">3277</span>
<span class="normal">3278</span>
<span class="normal">3279</span>
<span class="normal">3280</span>
<span class="normal">3281</span>
<span class="normal">3282</span>
<span class="normal">3283</span>
<span class="normal">3284</span>
<span class="normal">3285</span>
<span class="normal">3286</span>
<span class="normal">3287</span>
<span class="normal">3288</span>
<span class="normal">3289</span>
<span class="normal">3290</span>
<span class="normal">3291</span>
<span class="normal">3292</span>
<span class="normal">3293</span>
<span class="normal">3294</span>
<span class="normal">3295</span>
<span class="normal">3296</span>
<span class="normal">3297</span>
<span class="normal">3298</span>
<span class="normal">3299</span>
<span class="normal">3300</span>
<span class="normal">3301</span>
<span class="normal">3302</span>
<span class="normal">3303</span>
<span class="normal">3304</span>
<span class="normal">3305</span>
<span class="normal">3306</span>
<span class="normal">3307</span>
<span class="normal">3308</span>
<span class="normal">3309</span>
<span class="normal">3310</span>
<span class="normal">3311</span>
<span class="normal">3312</span>
<span class="normal">3313</span>
<span class="normal">3314</span>
<span class="normal">3315</span>
<span class="normal">3316</span>
<span class="normal">3317</span>
<span class="normal">3318</span>
<span class="normal">3319</span>
<span class="normal">3320</span>
<span class="normal">3321</span>
<span class="normal">3322</span>
<span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AbstractResource</span><span class="p">(</span><span class="n">ResourcePermissionsMixin</span><span class="p">,</span> <span class="n">ResourceS3Mixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create Abstract Class for all Resources.</span>

<span class="sd">    All hydroshare objects inherit from this mixin.  It defines things that must</span>
<span class="sd">    be present to be considered a hydroshare resource.  Additionally, all</span>
<span class="sd">    hydroshare resources should inherit from Page.  This gives them what they</span>
<span class="sd">    need to be represented in the Mezzanine CMS.</span>

<span class="sd">    In some cases, it is possible that the order of inheritence matters.  Best</span>
<span class="sd">    practice dictates that you list pages.Page first and then other classes:</span>

<span class="sd">        class MyResourceContentType(pages.Page, hs_core.AbstractResource):</span>
<span class="sd">            ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>  <span class="c1"># the field added for use by Django inplace editing</span>
    <span class="n">last_changed_by</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                                        <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The person who last changed the resource&#39;</span><span class="p">,</span>
                                        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;last_changed_</span><span class="si">%(app_label)s</span><span class="s1">_</span><span class="si">%(class)s</span><span class="s1">&#39;</span><span class="p">,</span>
                                        <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                        <span class="n">default</span><span class="o">=</span><span class="mi">1</span>
                                        <span class="p">)</span>

    <span class="n">files</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="s1">&#39;hs_core.ResourceFile&#39;</span><span class="p">,</span>
                            <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The files associated with this resource&#39;</span><span class="p">,</span>
                            <span class="n">for_concrete_model</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">file_unpack_status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                                          <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                          <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="s1">&#39;Pending&#39;</span><span class="p">,</span> <span class="s1">&#39;Pending&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Running&#39;</span><span class="p">,</span> <span class="s1">&#39;Running&#39;</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">,</span> <span class="s1">&#39;Done&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">))</span>
                                          <span class="p">)</span>
    <span class="n">file_unpack_message</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">short_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">short_id</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">doi</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Permanent identifier. Never changes once it</span><span class="se">\&#39;</span><span class="s1">s been set.&#39;</span><span class="p">)</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="n">CommentsField</span><span class="p">()</span>
    <span class="n">rating</span> <span class="o">=</span> <span class="n">RatingField</span><span class="p">()</span>

    <span class="c1"># this is to establish a relationship between a resource and</span>
    <span class="c1"># any metadata container object (e.g., CoreMetaData object)</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>

    <span class="c1"># key/value metadata (additional metadata)</span>
    <span class="n">extra_metadata</span> <span class="o">=</span> <span class="n">HStoreField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># this field is for resources to store extra key:value pairs as needed, e.g., bag checksum is stored as</span>
    <span class="c1"># &quot;bag_checksum&quot;:value pair for published resources in order to meet the DataONE data distribution needs</span>
    <span class="c1"># for internal use only</span>
    <span class="c1"># this field WILL NOT get recorded in bag and SHOULD NEVER be used for storing metadata</span>
    <span class="n">extra_data</span> <span class="o">=</span> <span class="n">HStoreField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># cache metadata for performance optimization of my-resources page</span>
    <span class="n">cached_metadata</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">JSONField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># for tracking number of times resource and its files have been downloaded</span>
    <span class="n">download_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">bag_last_downloaded</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># for tracking number of times resource has been viewed</span>
    <span class="n">view_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># for tracking when resourceFiles were last compared with S3</span>
    <span class="n">files_checked</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">repaired</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># allow resource that contains spam_patterns to be discoverable/public</span>
    <span class="n">spam_allowlisted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">quota_holder</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                     <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;quota_holder&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh cached metadata before resource is saved to prevent stale cached metadata in memory getting</span>
<span class="sd">        written to DB&quot;&quot;&quot;</span>
        <span class="c1"># Only refresh cached_metadata from DB if object already exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">adding</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cached_metadata&#39;</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AbstractResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_view_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># using update query api to update instead of self.save() to avoid triggering solr realtime indexing</span>
        <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">view_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">view_count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_download_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># using update query api to update instead of self.save() to avoid triggering solr realtime indexing</span>
        <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">download_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">download_count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_cached_metadata_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a specific field in the cached metadata or all fields if &#39;all&#39; is specified</span>

<span class="sd">        :param field_name: The field to update (&#39;creator&#39;, &#39;subject&#39;, etc.). If &#39;all&#39;, update all fields.</span>

<span class="sd">        NOTE: This method gets called from post_save and post_delete signal handler for</span>
<span class="sd">        any core metadata elements. We need to update the &#39;modified&#39; field in cached metadata</span>
<span class="sd">        for any change to core metadata elements. The Date metadata element gets updated for the</span>
<span class="sd">        modified date type by the system as needed. We are depending on that change to modified date</span>
<span class="sd">        to update the &#39;modified&#39; field in cached metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">copied_metadata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">)</span>

        <span class="c1"># These are the fields that need to be updated in cached metadata</span>
        <span class="n">field_updaters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;creator&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_creators_field</span><span class="p">,</span>
            <span class="s1">&#39;contributor&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_contributors_field</span><span class="p">,</span>
            <span class="s1">&#39;coverage&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_coverage_field</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_title_field</span><span class="p">,</span>
            <span class="s1">&#39;subject&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_subjects_field</span><span class="p">,</span>
            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_date_field</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_status_field</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_abstract_field</span><span class="p">,</span>
            <span class="s1">&#39;relation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_relation_field</span><span class="p">,</span>
            <span class="s1">&#39;geospatialrelation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_geospatialrelation_field</span><span class="p">,</span>
            <span class="s1">&#39;fundingagency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_fundingagency_field</span><span class="p">,</span>
            <span class="s1">&#39;rights&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_rights_field</span><span class="p">,</span>
            <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_language_field</span><span class="p">,</span>
            <span class="s1">&#39;identifier&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_identifier_field</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_type_field</span><span class="p">,</span>
            <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_publisher_field</span>
        <span class="p">}</span>

        <span class="c1"># Update all fields if &#39;all&#39; is specified</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">updater</span> <span class="ow">in</span> <span class="n">field_updaters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">updater</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Update the specified field</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">field_updaters</span><span class="p">:</span>
                <span class="n">field_updaters</span><span class="p">[</span><span class="n">field_name</span><span class="p">](</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="c1"># Ensure all required fields are present</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_required_fields</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="c1"># Update the modified date every time a metadata element is updated/deleted, or when &#39;all&#39; is specified</span>
        <span class="n">modified_date</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;modified&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="c1"># this is the case of updating cached metadata as part of metadata save/delete signal handler</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">modified_date</span><span class="p">:</span>
                <span class="c1"># this update won&#39;t trigger the post_save signal for Date model since we are using update query api</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">modified_date</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">modified_date</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this is the case of updating cached metadata as part of management command</span>
            <span class="k">if</span> <span class="n">modified_date</span><span class="p">:</span>
                <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modified_date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

        <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cached_metadata</span><span class="o">=</span><span class="n">copied_metadata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_creators_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update creators field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">creators</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">creators</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;creators&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">email</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">email</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">address</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">address</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;phone&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">phone</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">phone</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;homepage&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">homepage</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">homepage</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
                <span class="s1">&#39;hs_user_id&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">,</span>
                <span class="s1">&#39;is_active_user&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">is_active_user</span><span class="p">,</span>
                <span class="s1">&#39;relative_uri&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">relative_uri</span><span class="p">,</span>
                <span class="s1">&#39;organization&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">organization</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">organization</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;identifiers&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">identifiers</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">creators</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_contributors_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update contributors field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">contributors</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">contributors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;contributors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">email</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">email</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">address</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">address</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;phone&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">phone</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">phone</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;homepage&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">homepage</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">homepage</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;hs_user_id&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">,</span>
                <span class="s1">&#39;is_active_user&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">is_active_user</span><span class="p">,</span>
                <span class="s1">&#39;relative_uri&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">relative_uri</span><span class="p">,</span>
                <span class="s1">&#39;organization&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">organization</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">organization</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;identifiers&#39;</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">identifiers</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contributors</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_title_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update title field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">title</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_update_subjects_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update subjects field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">subjects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">subjects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;subjects&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_date_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update date field in cached metadata&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;created&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span><span class="p">:</span>
            <span class="n">created_date</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;created&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">created_date</span><span class="p">:</span>
                <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">created_date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">created</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;published_date&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span><span class="p">:</span>
            <span class="n">published_date</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;published&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">published_date</span><span class="p">:</span>
                <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;published_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">published_date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_status_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update status field in cached metadata&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;raccess&#39;</span><span class="p">):</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;public&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span><span class="p">,</span>
                <span class="s2">&quot;discoverable&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span><span class="p">,</span>
                <span class="s2">&quot;published&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">,</span>
                <span class="s2">&quot;shareable&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">shareable</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_update_abstract_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update abstract field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">abstract</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">abstract</span><span class="p">:</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">abstract</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_update_coverage_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update coverage field in cached metadata&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_temporal_coverage_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_spatial_coverage_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_temporal_coverage_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update temporal coverage field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">temporal_coverage</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">temporal_coverage</span>
        <span class="n">temp_coverage</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">temporal_coverage</span><span class="p">:</span>
            <span class="n">temp_coverage</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">temporal_coverage</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;start_date&#39;</span><span class="p">:</span> <span class="n">temporal_coverage</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span>
                <span class="s1">&#39;end_date&#39;</span><span class="p">:</span> <span class="n">temporal_coverage</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">temporal_coverage</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;temporal_coverage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_coverage</span>

    <span class="k">def</span> <span class="nf">_update_spatial_coverage_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update spatial coverage field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">spatial_coverage</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage</span>
        <span class="n">spatial_coverage_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">spatial_coverage</span><span class="p">:</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">id</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;exists&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">type</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;projection&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;zunits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zunits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span>
                <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>
                <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">]</span>
                <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">]</span>
                <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">]</span>
                <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;exists&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;default_units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage_default_units</span>
            <span class="n">spatial_coverage_dict</span><span class="p">[</span><span class="s1">&#39;default_projection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">spatial_coverage_default_projection</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;spatial_coverage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_coverage_dict</span>

    <span class="k">def</span> <span class="nf">_update_relation_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update relation field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">relations</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;relations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;type_description&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">type_description</span><span class="p">(),</span>
                <span class="s1">&#39;is_user_editable&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Relation</span><span class="o">.</span><span class="n">NOT_USER_EDITABLE</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relations</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_geospatialrelation_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update geospatialrelation field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">geospatialrelations</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">geospatialrelations</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;geospatial_relations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="s1">&#39;type_description&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">type_description</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">geospatialrelations</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_fundingagency_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update fundingagency field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">funding_agencies</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">funding_agencies</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;funding_agencies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;agency_name&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">agency_name</span><span class="p">,</span>
                <span class="s1">&#39;award_title&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">award_title</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">award_title</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;award_number&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">award_number</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">award_number</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;agency_url&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">agency_url</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">agency_url</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">funding_agencies</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_rights_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update rights field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">rights</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">rights</span>
        <span class="k">if</span> <span class="n">rights</span><span class="p">:</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;rights&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">rights</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;statement&#39;</span><span class="p">:</span> <span class="n">rights</span><span class="o">.</span><span class="n">statement</span><span class="p">,</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">rights</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">rights</span><span class="o">.</span><span class="n">url</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_update_identifier_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update identifier field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">url</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">identifiers</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_language_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update language field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">language</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">language</span><span class="o">.</span><span class="n">code</span> <span class="k">if</span> <span class="n">language</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_update_type_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update type field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">_type</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">type</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_type</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">_type</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_update_publisher_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update publisher field in cached metadata&quot;&quot;&quot;</span>
        <span class="n">publisher</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">publisher</span>
        <span class="k">if</span> <span class="n">publisher</span><span class="p">:</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;publisher&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">publisher</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">publisher</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">publisher</span><span class="o">.</span><span class="n">url</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;publisher&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_ensure_required_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure all required fields are present in cached metadata&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_title_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;creators&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;creators&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_creators_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;contributors&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;contributors&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_contributors_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;created&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_date_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;subjects&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;subjects&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_subjects_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;status&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_status_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;abstract&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_abstract_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;temporal_coverage&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_temporal_coverage_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;spatial_coverage&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_spatial_coverage_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;relations&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;relations&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_relation_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;geospatial_relations&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;geospatial_relations&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_geospatialrelation_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;funding_agencies&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;funding_agencies&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_fundingagency_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;rights&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_rights_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;language&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_language_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;identifiers&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_identifier_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_type_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;publisher&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">copied_metadata</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;publisher&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_publisher_field</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_all_cached_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update all fields in the cached metadata</span>
<span class="sd">        This method is primarily for use in management commands to refresh cached metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cached_metadata_field</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

    <span class="c1"># definition of resource logic</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supports_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether folder operations are supported. Computed for polymorphic types.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the last updated date stored in metadata&quot;&quot;&quot;</span>
        <span class="c1"># get the modified date from the cached metadata</span>
        <span class="n">modified_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;modified&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">modified_date</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">modified_date</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get the modified date from the Date metadata element</span>
            <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;modified&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_required_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True only if all required metadata is present.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">has_all_required_elements</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">can_be_public_or_discoverable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if the resource can be set to public or discoverable.</span>

<span class="sd">        This is True if</span>

<span class="sd">        1. The resource has all metadata elements marked as required.</span>
<span class="sd">        2. The resource has all files that are considered required.</span>

<span class="sd">        and False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_content_files</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">has_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_metadata</span>
        <span class="k">return</span> <span class="n">has_metadata</span>

    <span class="k">def</span> <span class="nf">set_discoverable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the discoverable flag for a resource.</span>

<span class="sd">        :param value: True or False</span>
<span class="sd">        :param user: user requesting the change, or None for changes that are not user requests.</span>
<span class="sd">        :raises ValidationError: if the current configuration cannot be set to desired state</span>

<span class="sd">        This sets the discoverable flag (self.raccess.discoverable) for a resource based</span>
<span class="sd">        upon application logic. It is part of AbstractResource because its result depends</span>
<span class="sd">        upon resource state, and not just access control.</span>

<span class="sd">        * This flag can only be set to True if the resource passes basic validations</span>
<span class="sd">          `has_required_metata` and `has_required_content_files`</span>
<span class="sd">        * setting `discoverable` to `False` also sets `public` to `False`</span>
<span class="sd">        * setting `discoverable` to `True` does not change `public`</span>

<span class="sd">        Thus, the setting public=True, discoverable=False is disallowed.</span>

<span class="sd">        If `user` is None, access control is not checked.  This happens when a resource has been</span>
<span class="sd">        invalidated outside of the control of a specific user. In this case, user can be None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># access control is separate from validation logic</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_change_resource_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to change resource sharing status&quot;</span><span class="p">)</span>

        <span class="c1"># check that there is sufficient resource content</span>
        <span class="n">has_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_metadata</span>
        <span class="n">has_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_content_files</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">has_metadata</span> <span class="ow">and</span> <span class="n">has_files</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_metadata</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_files</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient metadata and content files to be &quot;</span> <span class="o">+</span> \
                    <span class="s2">&quot;discoverable&quot;</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_metadata</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient metadata to be discoverable&quot;</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_files</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient content files to be discoverable&quot;</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># state change is allowed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_public</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_index</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_public</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the public flag for a resource.</span>

<span class="sd">        :param value: True or False</span>
<span class="sd">        :param user: user requesting the change, or None for changes that are not user requests.</span>
<span class="sd">        :raises ValidationError: if the current configuration cannot be set to desired state</span>

<span class="sd">        This sets the public flag (self.raccess.public) for a resource based</span>
<span class="sd">        upon application logic. It is part of AbstractResource because its result depends</span>
<span class="sd">        upon resource state, and not just access control.</span>

<span class="sd">        * This flag can only be set to True if the resource passes basic validations</span>
<span class="sd">          `has_required_metata` and `has_required_content_files`</span>
<span class="sd">        * setting `public` to `True` also sets `discoverable` to `True`</span>
<span class="sd">        * setting `public` to `False` does not change `discoverable`</span>
<span class="sd">        * setting `public` to either also modifies the AVU isPublic for the resource.</span>

<span class="sd">        Thus, the setting public=True, discoverable=False is disallowed.</span>

<span class="sd">        If `user` is None, access control is not checked.  This happens when a resource has been</span>
<span class="sd">        invalidated outside of the control of a specific user. In this case, user can be None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># avoid import loop</span>
        <span class="kn">from</span> <span class="nn">hs_core.signals</span> <span class="kn">import</span> <span class="n">post_raccess_change</span>
        <span class="kn">from</span> <span class="nn">hs_access_control.models.shortcut</span> <span class="kn">import</span> <span class="n">zone_of_publicity</span>

        <span class="c1"># access control is separate from validation logic</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_change_resource_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to change resource sharing status&quot;</span><span class="p">)</span>

        <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span>  <span class="c1"># is this a change?</span>

        <span class="c1"># check that there is sufficient resource content</span>
        <span class="n">has_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_metadata</span>
        <span class="n">has_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_content_files</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">has_metadata</span> <span class="ow">and</span> <span class="n">has_files</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_metadata</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_files</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient metadata and content files to be public&quot;</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_metadata</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient metadata to be public&quot;</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_files</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient content files to be public&quot;</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># make valid state change</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># can&#39;t be public without being discoverable</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">post_raccess_change</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_index</span><span class="p">()</span>
            <span class="n">zone_of_publicity</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># public changed state: set isPublic metadata AVU accordingly</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">old_value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setAVU</span><span class="p">(</span><span class="s2">&quot;isPublic&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_published</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the published flag for a resource.</span>

<span class="sd">        :param value: True or False</span>

<span class="sd">        This sets the published flag (self.raccess.published)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">hs_core.signals</span> <span class="kn">import</span> <span class="n">post_raccess_change</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">immutable</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># can&#39;t be published without being public</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">post_raccess_change</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_index</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;updates previous versions of a resource (self) in index&quot;&quot;&quot;</span>
        <span class="n">prev_version_resource_relation_meta</span> <span class="o">=</span> <span class="n">Relation</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;isReplacedBy&#39;</span><span class="p">,</span>
                                                                      <span class="n">value__contains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">prev_version_resource_relation_meta</span><span class="p">:</span>
            <span class="n">prev_version_res</span> <span class="o">=</span> <span class="n">prev_version_resource_relation_meta</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">resource</span>
            <span class="k">if</span> <span class="n">prev_version_res</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span> <span class="ow">or</span> <span class="n">prev_version_res</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span><span class="p">:</span>
                <span class="c1"># saving to trigger index update for this previous version of resource</span>
                <span class="n">prev_version_res</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">prev_version_res</span><span class="o">.</span><span class="n">update_index</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_require_download_agreement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set resource require_download_agreement flag to True or False.</span>
<span class="sd">        If require_download_agreement is True then user will be prompted to agree to resource</span>
<span class="sd">        rights statement before he/she can download resource files or bag.</span>

<span class="sd">        :param user: user requesting the change</span>
<span class="sd">        :param value: True or False</span>
<span class="sd">        :raises PermissionDenied: if the user lacks permission to change resource flag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_change_resource_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PermissionDenied</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to change resource download agreement&quot;</span>
                                   <span class="s2">&quot; status&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">require_download_agreement</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_private_sharing_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set resource &#39;allow_private_sharing&#39; flag to True or False.</span>
<span class="sd">        If allow_private_sharing is True then any user including anonymous user will be able to use the resource url</span>
<span class="sd">        to view the resource (view mode).</span>

<span class="sd">        :param user: user requesting the change</span>
<span class="sd">        :param value: True or False</span>
<span class="sd">        :raises PermissionDenied: if the user lacks permission to change resource flag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_change_resource_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PermissionDenied</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to change resource private link sharing &quot;</span>
                                   <span class="s2">&quot; status&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">allow_private_sharing</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_public_and_discoverable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the settings of the public and discoverable flags for changes in metadata.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_be_public_or_discoverable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_discoverable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># also sets Public</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_url_of_path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_url_of_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the URL of an arbitrary path in this resource.</span>

<span class="sd">        A GET of this URL simply returns the contents of the path.</span>
<span class="sd">        This URL is independent of federation.</span>
<span class="sd">        PUT, POST, and DELETE are not supported.</span>
<span class="sd">        path includes data/contents/</span>

<span class="sd">        This choice for a URL is dependent mainly upon conformance to DataOne URL standards</span>
<span class="sd">        that are also conformant to the format in resourcemap.xml. This url does not contain</span>
<span class="sd">        the site URL, which is prefixed when needed.</span>

<span class="sd">        This is based upon the resourcemap_urls.py entry:</span>

<span class="sd">            url(r&#39;^resource/(?P&lt;shortkey&gt;[0-9a-f-]+)/data/contents/(?.+)/$&#39;,</span>
<span class="sd">                views.file_download_url_mapper,</span>
<span class="sd">                name=&#39;get_resource_file&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># must start with a / in order to concat with current_site_url.</span>
        <span class="n">url_encoded_path</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">url_encoded_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_s3_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">prepend_short_id</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the S3 path by which the given path is accessed.</span>
<span class="sd">           The input path includes data/contents/ as needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prepend_short_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">):</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">return</span> <span class="n">full_path</span>

    <span class="k">def</span> <span class="nf">set_quota_holder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setter</span><span class="p">,</span> <span class="n">new_holder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set quota holder of the resource to new_holder who must be an owner.</span>

<span class="sd">        setter is the requesting user to transfer quota holder and setter must also be an owner</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">hs_core.hydroshare.utils</span> <span class="kn">import</span> <span class="n">validate_user_quota</span>

        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">setter</span><span class="p">,</span> <span class="n">User</span><span class="p">))</span>
            <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">new_holder</span><span class="p">,</span> <span class="n">User</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">setter</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">owns_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="ow">not</span> <span class="n">new_holder</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">owns_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PermissionDenied</span><span class="p">(</span><span class="s2">&quot;Only owners can set or be set as quota holder for the resource&quot;</span><span class="p">)</span>

        <span class="c1"># ensure the new holder has a bucket, buckets only exist for users with resources</span>
        <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="n">istorage</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">new_holder</span><span class="o">.</span><span class="n">userprofile</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">)</span>
        <span class="c1"># QuotaException will be raised if new_holder does not have enough quota to hold this</span>
        <span class="c1"># new resource, in which case, set_quota_holder to the new user fails</span>
        <span class="n">validate_user_quota</span><span class="p">(</span><span class="n">new_holder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="c1"># if the resource is new, it does not have a quota holder yet</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quota_holder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span><span class="o">.</span><span class="n">new_quota_holder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">new_holder</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quota_holder</span> <span class="o">=</span> <span class="n">new_holder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setAVU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set an AVU at the resource level.</span>

<span class="sd">        This avoids mistakes in setting AVUs by assuring that the appropriate root path</span>
<span class="sd">        is alway used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># normalize boolean values to strings</span>
        <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="n">root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_path</span>
        <span class="n">istorage</span><span class="o">.</span><span class="n">setAVU</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getAVU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an AVU for a resource.</span>

<span class="sd">        This avoids mistakes in getting AVUs by assuring that the appropriate root path</span>
<span class="sd">        is alway used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="n">root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_path</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">istorage</span><span class="o">.</span><span class="n">getAVU</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>

        <span class="c1"># Convert selected boolean attribute values to bool; non-existence implies False</span>
        <span class="c1"># &quot;Private&quot; is the appropriate response if &quot;isPublic&quot; is None</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;isPublic&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Convert selected boolean attribute values to bool; non-existence implies True</span>
        <span class="c1"># If bag_modified or metadata_dirty does not exist, then we do not know the</span>
        <span class="c1"># state of metadata files and/or bags. They may not exist. Thus we interpret</span>
        <span class="c1"># None as &quot;true&quot;, which will generate the appropriate files if they do not exist.</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;bag_modified&#39;</span> <span class="ow">or</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;metadata_dirty&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># return strings for all other attributes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">scimeta_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get URL of the science metadata file resourcemetadata.xml &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">short_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">)</span>
        <span class="n">scimeta_path</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">scimeta_path</span>
        <span class="n">scimeta_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;rest_download&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">scimeta_path</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">scimeta_url</span>

    <span class="c1"># TODO: there are too many ways to get to the resourcemap.</span>
    <span class="c1"># 1. {id}/data/resourcemap.xml</span>
    <span class="c1"># 2. {id}/resmap</span>
    <span class="c1"># Choose one!</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">resmap_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get URL of the resource map resourcemap.xml.&quot;&quot;&quot;</span>
        <span class="n">resmap_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{resource_id}</span><span class="s2">/data/resourcemap.xml&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">)</span>
        <span class="n">resmap_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;rest_download&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">resmap_path</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">resmap_url</span>

    <span class="c1"># TODO: this is inaccurate; resourcemap.xml != systemmetadata.xml</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">sysmeta_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get URL of resource map xml.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{resource_id}</span><span class="s2">/data/resourcemap.xml&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete resource along with all of its metadata and data bag.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.hydroshare</span> <span class="kn">import</span> <span class="n">hs_bagit</span>
        <span class="k">for</span> <span class="n">fl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="c1"># COUCH: delete of file objects now cascades.</span>
            <span class="n">fl</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_logical_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">hs_bagit</span><span class="o">.</span><span class="n">delete_files_and_bag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AbstractResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the metadata object for this resource.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_object</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_metadata_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CoreMetaData</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">first_creator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get first creator of resource from metadata.&quot;&quot;&quot;</span>
        <span class="n">first_creator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">creators</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">first_creator</span>

    <span class="k">def</span> <span class="nf">get_metadata_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_format_elements</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get metadata xml for Resource.</span>

<span class="sd">        Resource types that support file types</span>
<span class="sd">        must override this method. See Composite Resource</span>
<span class="sd">        type as an example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get_xml</span><span class="p">(</span><span class="n">pretty_print</span><span class="o">=</span><span class="n">pretty_print</span><span class="p">,</span>
                                     <span class="n">include_format_elements</span><span class="o">=</span><span class="n">include_format_elements</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_schema_json_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether a given file is a schema.json file.</span>
<span class="sd">        Note: this will return true for any file that ends with the schema.json ending</span>
<span class="sd">        We are taking the risk that user might create a file with the same filename ending</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django_s3.utils</span> <span class="kn">import</span> <span class="n">is_schema_json_file</span> <span class="k">as</span> <span class="n">_is_schema_json_file</span>

        <span class="k">return</span> <span class="n">_is_schema_json_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_schema_json_values_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether a given file is a schema_values.json file.</span>
<span class="sd">        Note: this will return true for any file that ends with the _schema_values.json ending</span>
<span class="sd">        We are taking the risk that user might create a file with the same filename ending</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django_s3.utils</span> <span class="kn">import</span> <span class="n">is_schema_json_values_file</span> <span class="k">as</span> <span class="n">_is_schema_json_values_file</span>

        <span class="k">return</span> <span class="n">_is_schema_json_values_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_collection_list_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if a given file is an internally-generated collection list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">hs_collection_resource.utils</span> <span class="kn">import</span> <span class="n">CSV_FULL_NAME_TEMPLATE</span>
        <span class="n">collection_list_filename</span> <span class="o">=</span> <span class="n">CSV_FULL_NAME_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">collection_list_filename</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_metadata_xml_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether a given file is metadata.</span>
<span class="sd">        Note: this will return true for any file that ends with the metadata endings</span>
<span class="sd">        We are taking the risk that user might create a file with the same filename ending</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django_s3.utils</span> <span class="kn">import</span> <span class="n">is_metadata_xml_file</span> <span class="k">as</span> <span class="n">_is_metadata_xml_file</span>

        <span class="k">return</span> <span class="n">_is_metadata_xml_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_metadata_json_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether a given file is a metadata json file.</span>
<span class="sd">        Note: this will return true for any file that ends with the metadata endings or</span>
<span class="sd">        has the same name as the metadata json file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django_s3.utils</span> <span class="kn">import</span> <span class="n">is_metadata_json_file</span> <span class="k">as</span> <span class="n">_is_metadata_json_file</span>

        <span class="k">return</span> <span class="n">_is_metadata_json_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_aggregation_xml_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the file path *file_path* is one of the aggregation related xml file paths</span>

<span class="sd">        :param  file_path: full file path starting with resource short_id</span>
<span class="sd">        :return True if file_path is one of the aggregation xml file paths else False</span>

<span class="sd">        This function is overridden for Composite Resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">extra_capabilites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return None. No-op method.</span>

<span class="sd">        This is not terribly well defined yet, but should return at least a JSON serializable</span>
<span class="sd">        object of URL endpoints where extra self-describing services exist and can be queried by</span>
<span class="sd">        the user in the form of { &quot;name&quot; : &quot;endpoint&quot; }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">parse_citation_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">first_author</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return properly formatted citation name from metadata.&quot;&quot;&quot;</span>
        <span class="n">CREATOR_NAME_ERROR</span> <span class="o">=</span> <span class="s2">&quot;Failed to generate citation - invalid creator name.&quot;</span>
        <span class="n">first_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name_parts</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CREATOR_NAME_ERROR</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">last_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">first_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">first_names</span> <span class="o">=</span> <span class="n">first_names</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">last_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CREATOR_NAME_ERROR</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name_parts</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CREATOR_NAME_ERROR</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">first_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">last_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">first_names</span><span class="p">:</span>
            <span class="n">initials_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">first_names</span><span class="p">]</span>
            <span class="n">initials</span> <span class="o">=</span> <span class="s2">&quot;. &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">initials_list</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
            <span class="k">if</span> <span class="n">first_author</span><span class="p">:</span>
                <span class="n">author_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{last_name}</span><span class="s2">, </span><span class="si">{initials}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">author_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{initials}</span><span class="s2"> </span><span class="si">{last_name}</span><span class="s2">&quot;</span>
            <span class="n">author_name</span> <span class="o">=</span> <span class="n">author_name</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last_name</span><span class="o">=</span><span class="n">last_names</span><span class="p">,</span>
                                             <span class="n">initials</span><span class="o">=</span><span class="n">initials</span>
                                             <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">author_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{last_name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last_name</span><span class="o">=</span><span class="n">last_names</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">author_name</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>

    <span class="k">def</span> <span class="nf">get_custom_citation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get custom citation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">citation</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">citation</span><span class="o">.</span><span class="n">first</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_citation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forceHydroshareURI</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get citation or citations from resource metadata using cached_metadata.&quot;&quot;&quot;</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">citation_str_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">CITATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;Failed to generate citation.&quot;</span>

        <span class="c1"># Get creators from cached_metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cached_metadata&#39;</span><span class="p">])</span>
        <span class="n">cached_creators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;creators&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_creators</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> No creators found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CITATION_ERROR</span>

        <span class="c1"># Find first creator (order == 1)</span>
        <span class="n">first_creator</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cached_creators</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">first_creator</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> No first creator found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CITATION_ERROR</span>

        <span class="c1"># Format first creator name</span>
        <span class="n">creator_name</span> <span class="o">=</span> <span class="n">first_creator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">creator_name</span> <span class="o">=</span> <span class="n">creator_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">creator_name</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># No Nonetype</span>
        <span class="k">if</span> <span class="n">first_creator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;organization&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">creator_name</span><span class="p">:</span>
            <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_creator</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_citation_name</span><span class="p">(</span><span class="n">creator_name</span><span class="p">,</span> <span class="n">first_author</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="c1"># Add other creators</span>
        <span class="n">other_creators</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cached_creators</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">other_creators</span><span class="p">:</span>
            <span class="n">author_name</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">author_name</span> <span class="o">=</span> <span class="n">author_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">author_name</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># No Nonetype</span>
            <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;organization&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">author_name</span><span class="p">:</span>
                <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">author</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">author_name</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">author_name</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_citation_name</span><span class="p">(</span><span class="n">author_name</span><span class="p">))</span>

        <span class="c1"># Remove the last added comma and space</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">citation_str_lst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">citation_str_lst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">citation_str_lst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No valid creator names found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">err_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CITATION_ERROR</span>

        <span class="c1"># Get citation date from cached_metadata</span>
        <span class="n">citation_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">citation_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;published&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;modified&#39;</span><span class="p">):</span>
            <span class="n">citation_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">citation_date</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No published or modified date found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">err_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CITATION_ERROR</span>

        <span class="c1"># Parse the date and extract year</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">citation_date_obj</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">citation_date</span><span class="p">)</span>
            <span class="n">citation_year</span> <span class="o">=</span> <span class="n">citation_date_obj</span><span class="o">.</span><span class="n">year</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> Invalid date found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CITATION_ERROR</span>

        <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; (</span><span class="si">{year}</span><span class="s2">). &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">citation_year</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> No title found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CITATION_ERROR</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> No title value found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CITATION_ERROR</span>
        <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>

        <span class="c1"># Check for DOI identifier</span>
        <span class="n">isPendingActivation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;identifiers&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">doi</span> <span class="o">=</span> <span class="p">[</span><span class="n">idn</span> <span class="k">for</span> <span class="n">idn</span> <span class="ow">in</span> <span class="n">identifiers</span> <span class="k">if</span> <span class="n">idn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;doi&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">doi</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">forceHydroshareURI</span><span class="p">:</span>
            <span class="n">hs_identifier</span> <span class="o">=</span> <span class="n">doi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">DataciteSubmissionStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">doi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">DataciteSubmissionStatus</span><span class="o">.</span><span class="n">FAILURE</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">isPendingActivation</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hs_identifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">idn</span> <span class="k">for</span> <span class="n">idn</span> <span class="ow">in</span> <span class="n">identifiers</span> <span class="k">if</span> <span class="n">idn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;hydroShareIdentifier&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">hs_identifier</span><span class="p">:</span>
                <span class="n">hs_identifier</span> <span class="o">=</span> <span class="n">hs_identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No hydroShareIdentifier found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">err_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">CITATION_ERROR</span>

        <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;, HydroShare, </span><span class="si">{url}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">hs_identifier</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">isPendingActivation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">forceHydroshareURI</span><span class="p">:</span>
            <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;, DOI for this published resource is pending activation.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">citation_str_lst</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_supported_upload_file_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of permissible upload types.</span>

<span class="sd">        Subclasses override this function to allow only specific file types.</span>
<span class="sd">        Any version should return a tuple of those file extensions</span>
<span class="sd">        (ex: return (&quot;.csv&quot;, &quot;.txt&quot;,))</span>

<span class="sd">        To disallow all file upload, return an empty tuple ( return ())</span>

<span class="sd">        By default all file types are supported</span>

<span class="sd">        This is called before creating a specific instance; hence it is a class method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;.*&quot;</span><span class="p">,)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">allow_multiple_file_upload</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether multiple files can be uploaded.</span>

<span class="sd">        Subclasses of BaseResource override this function to tailor file upload.</span>
<span class="sd">        To allow multiple files to be uploaded return True, otherwise return False</span>

<span class="sd">        Resource by default allows multiple file upload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">can_have_multiple_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this kind of resource can contain multiple files.</span>

<span class="sd">        Subclasses of BaseResource override this function to tailor file upload.</span>

<span class="sd">        To allow resource to have only 1 file or no file, return False</span>

<span class="sd">        A resource by default can contain multiple files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">has_required_content_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether a resource has the required content files.</span>

<span class="sd">        Any subclass of this class may need to override this function</span>
<span class="sd">        to apply specific requirements as it relates to resource content files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_supported_upload_file_types</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_contained_file_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return a set of all file extensions for all files in the resource</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">extension</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">all</span><span class="p">()])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">readme_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a resource file that is at the root with a file name of either</span>
<span class="sd">        &#39;readme.txt&#39; or &#39;readme.md&#39; (filename is case insensitive). If no such file then None</span>
<span class="sd">        is returned. If both files exist then resource file for readme.md is returned&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">file_folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># no files exist at the root of the resource path - no need to check for readme file</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">file_path_md</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;readme.md&#39;</span><span class="p">)</span>
        <span class="n">file_path_txt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;readme.txt&#39;</span><span class="p">)</span>
        <span class="n">readme_res_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_file__iexact</span><span class="o">=</span><span class="n">file_path_md</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">readme_res_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">readme_res_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_file__iexact</span><span class="o">=</span><span class="n">file_path_txt</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">readme_res_file</span>

    <span class="k">def</span> <span class="nf">get_readme_file_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the content of the readme file. If both a readme.md and a readme.txt file exist,</span>
<span class="sd">        then the content of the readme.md file is returned, otherwise None</span>

<span class="sd">        Note: The user uploaded readme file if originally not encoded as utf-8, then any non-ascii</span>
<span class="sd">        characters in the file will be escaped when we return the file content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">readme_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readme_file</span>
        <span class="c1"># check the file exists on S3</span>

        <span class="k">if</span> <span class="n">readme_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">readme_file</span>

        <span class="c1"># check the file exists on S3</span>
        <span class="k">if</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="n">readme_file_content</span> <span class="o">=</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.md&#39;</span><span class="p">:</span>
                <span class="n">markdown_file_content</span> <span class="o">=</span> <span class="n">markdown</span><span class="p">(</span><span class="n">readme_file_content</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tables&#39;</span><span class="p">])</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">markdown_file_content</span><span class="p">,</span>
                        <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;file_type&#39;</span><span class="p">:</span> <span class="s1">&#39;md&#39;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">readme_file_content</span><span class="p">,</span> <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">file_name</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">file_name</span>
            <span class="n">readme_file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;readme file (</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">) is missing on S3. Deleting the file from Django.&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">log_msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logical_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets a generator to access each of the logical files of the resource.</span>
<span class="sd">        Note: Any derived class that supports logical file must override this function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># empty generator</span>
        <span class="k">yield from</span> <span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aggregation_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets a list of all aggregation types that currently exist in this resource</span>
<span class="sd">        Note: Any derived class that supports logical file must override this function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aggregation_type_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets a list of all aggregation type names that currently exist in this resource</span>
<span class="sd">        Note: Any derived class that supports logical file must override this function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_logical_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logical_file_class_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of logical files (aggregations) for a specified logical file class name.</span>
<span class="sd">        Note: Any derived class that supports logical file must override this function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_logical_spatial_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if any of the logical files has spatial coverage</span>
<span class="sd">        Note: Any derived class that supports logical file must override this function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_logical_temporal_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if any of the logical files has temporal coverage</span>
<span class="sd">        Note: Any derived class that supports logical file must override this function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supports_logical_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if resource allows associating resource file objects with logical file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">supports_folder_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_full_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if resource supports creation of folder at the specified path.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">supports_rename_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_full_path</span><span class="p">,</span> <span class="n">tgt_full_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if file/folder rename/move is allowed by this resource.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">supports_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_to_zip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if resource supports the specified folder to be zipped.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">supports_unzip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_to_unzip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if resource supports the unzipping of the specified file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">supports_delete_folder_on_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_folder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if resource allows the original folder to be deleted upon zip.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">storage_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;local&#39;</span>

    <span class="k">def</span> <span class="nf">is_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether a given path (relative to resource root, including /data/contents/)</span>
<span class="sd">           is a folder or not. Returns False if the path does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_split</span> <span class="o">=</span> <span class="n">folder_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">path_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">path_split</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_split</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># handles federation</span>
        <span class="n">s3_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
        <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listing</span> <span class="o">=</span> <span class="n">istorage</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">s3_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SessionException</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">path_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">listing</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># folders</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for AbstractResource class.&quot;&quot;&quot;</span>

        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.aggregation_type_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregation_type_names</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Gets a list of all aggregation type names that currently exist in this resource
Note: Any derived class that supports logical file must override this function</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.aggregation_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregation_types</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Gets a list of all aggregation types that currently exist in this resource
Note: Any derived class that supports logical file must override this function</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.can_be_public_or_discoverable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_be_public_or_discoverable</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return True if the resource can be set to public or discoverable.</p>
<p>This is True if</p>
<ol>
<li>The resource has all metadata elements marked as required.</li>
<li>The resource has all files that are considered required.</li>
</ol>
<p>and False otherwise</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.first_creator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">first_creator</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get first creator of resource from metadata.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.has_logical_spatial_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_logical_spatial_coverage</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if any of the logical files has spatial coverage
Note: Any derived class that supports logical file must override this function</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.has_logical_temporal_coverage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_logical_temporal_coverage</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if any of the logical files has temporal coverage
Note: Any derived class that supports logical file must override this function</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.has_required_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_required_metadata</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return True only if all required metadata is present.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.last_updated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">last_updated</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the last updated date stored in metadata</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.logical_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logical_files</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Gets a generator to access each of the logical files of the resource.
Note: Any derived class that supports logical file must override this function</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metadata</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the metadata object for this resource.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.readme_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readme_file</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a resource file that is at the root with a file name of either
'readme.txt' or 'readme.md' (filename is case insensitive). If no such file then None
is returned. If both files exist then resource file for readme.md is returned</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.supports_folders" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_folders</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return whether folder operations are supported. Computed for polymorphic types.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.AbstractResource.supports_logical_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_logical_file</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Check if resource allows associating resource file objects with logical file.</p>

    </div>

</div>



<div class="doc doc-object doc-class">



<h3 id="hs_core.models.AbstractResource.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for AbstractResource class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for AbstractResource class.&quot;&quot;&quot;</span>

    <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.allow_multiple_file_upload" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">allow_multiple_file_upload</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return whether multiple files can be uploaded.</p>
<p>Subclasses of BaseResource override this function to tailor file upload.
To allow multiple files to be uploaded return True, otherwise return False</p>
<p>Resource by default allows multiple file upload.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">allow_multiple_file_upload</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return whether multiple files can be uploaded.</span>

<span class="sd">    Subclasses of BaseResource override this function to tailor file upload.</span>
<span class="sd">    To allow multiple files to be uploaded return True, otherwise return False</span>

<span class="sd">    Resource by default allows multiple file upload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.can_have_multiple_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_have_multiple_files</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return whether this kind of resource can contain multiple files.</p>
<p>Subclasses of BaseResource override this function to tailor file upload.</p>
<p>To allow resource to have only 1 file or no file, return False</p>
<p>A resource by default can contain multiple files</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">can_have_multiple_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return whether this kind of resource can contain multiple files.</span>

<span class="sd">    Subclasses of BaseResource override this function to tailor file upload.</span>

<span class="sd">    To allow resource to have only 1 file or no file, return False</span>

<span class="sd">    A resource by default can contain multiple files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete resource along with all of its metadata and data bag.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete resource along with all of its metadata and data bag.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.hydroshare</span> <span class="kn">import</span> <span class="n">hs_bagit</span>
    <span class="k">for</span> <span class="n">fl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="c1"># COUCH: delete of file objects now cascades.</span>
        <span class="n">fl</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_logical_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="n">hs_bagit</span><span class="o">.</span><span class="n">delete_files_and_bag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">AbstractResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.extra_capabilites" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extra_capabilites</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return None. No-op method.</p>
<p>This is not terribly well defined yet, but should return at least a JSON serializable
object of URL endpoints where extra self-describing services exist and can be queried by
the user in the form of { "name" : "endpoint" }</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extra_capabilites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return None. No-op method.</span>

<span class="sd">    This is not terribly well defined yet, but should return at least a JSON serializable</span>
<span class="sd">    object of URL endpoints where extra self-describing services exist and can be queried by</span>
<span class="sd">    the user in the form of { &quot;name&quot; : &quot;endpoint&quot; }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.getAVU" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getAVU</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get an AVU for a resource.</p>
<p>This avoids mistakes in getting AVUs by assuring that the appropriate root path
is alway used.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">getAVU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an AVU for a resource.</span>

<span class="sd">    This avoids mistakes in getting AVUs by assuring that the appropriate root path</span>
<span class="sd">    is alway used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
    <span class="n">root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_path</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">istorage</span><span class="o">.</span><span class="n">getAVU</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>

    <span class="c1"># Convert selected boolean attribute values to bool; non-existence implies False</span>
    <span class="c1"># &quot;Private&quot; is the appropriate response if &quot;isPublic&quot; is None</span>
    <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;isPublic&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Convert selected boolean attribute values to bool; non-existence implies True</span>
    <span class="c1"># If bag_modified or metadata_dirty does not exist, then we do not know the</span>
    <span class="c1"># state of metadata files and/or bags. They may not exist. Thus we interpret</span>
    <span class="c1"># None as &quot;true&quot;, which will generate the appropriate files if they do not exist.</span>
    <span class="k">if</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;bag_modified&#39;</span> <span class="ow">or</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;metadata_dirty&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># return strings for all other attributes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.get_citation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_citation</span><span class="p">(</span><span class="n">forceHydroshareURI</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get citation or citations from resource metadata using cached_metadata.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_citation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forceHydroshareURI</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get citation or citations from resource metadata using cached_metadata.&quot;&quot;&quot;</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">citation_str_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">CITATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;Failed to generate citation.&quot;</span>

    <span class="c1"># Get creators from cached_metadata</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cached_metadata&#39;</span><span class="p">])</span>
    <span class="n">cached_creators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;creators&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_creators</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> No creators found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CITATION_ERROR</span>

    <span class="c1"># Find first creator (order == 1)</span>
    <span class="n">first_creator</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cached_creators</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">first_creator</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> No first creator found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CITATION_ERROR</span>

    <span class="c1"># Format first creator name</span>
    <span class="n">creator_name</span> <span class="o">=</span> <span class="n">first_creator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">creator_name</span> <span class="o">=</span> <span class="n">creator_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">creator_name</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># No Nonetype</span>
    <span class="k">if</span> <span class="n">first_creator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;organization&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">creator_name</span><span class="p">:</span>
        <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_creator</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_citation_name</span><span class="p">(</span><span class="n">creator_name</span><span class="p">,</span> <span class="n">first_author</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="c1"># Add other creators</span>
    <span class="n">other_creators</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cached_creators</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">other_creators</span><span class="p">:</span>
        <span class="n">author_name</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">author_name</span> <span class="o">=</span> <span class="n">author_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">author_name</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># No Nonetype</span>
        <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;organization&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">author_name</span><span class="p">:</span>
            <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">author</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">author_name</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">author_name</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_citation_name</span><span class="p">(</span><span class="n">author_name</span><span class="p">))</span>

    <span class="c1"># Remove the last added comma and space</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">citation_str_lst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">citation_str_lst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">citation_str_lst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No valid creator names found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">err_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CITATION_ERROR</span>

    <span class="c1"># Get citation date from cached_metadata</span>
    <span class="n">citation_date</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">citation_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;published&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;modified&#39;</span><span class="p">):</span>
        <span class="n">citation_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">citation_date</span><span class="p">:</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No published or modified date found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">err_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CITATION_ERROR</span>

    <span class="c1"># Parse the date and extract year</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">citation_date_obj</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">citation_date</span><span class="p">)</span>
        <span class="n">citation_year</span> <span class="o">=</span> <span class="n">citation_date_obj</span><span class="o">.</span><span class="n">year</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> Invalid date found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CITATION_ERROR</span>

    <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; (</span><span class="si">{year}</span><span class="s2">). &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">citation_year</span><span class="p">))</span>
    <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> No title found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CITATION_ERROR</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> No title value found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CITATION_ERROR</span>
    <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>

    <span class="c1"># Check for DOI identifier</span>
    <span class="n">isPendingActivation</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">identifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;identifiers&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">doi</span> <span class="o">=</span> <span class="p">[</span><span class="n">idn</span> <span class="k">for</span> <span class="n">idn</span> <span class="ow">in</span> <span class="n">identifiers</span> <span class="k">if</span> <span class="n">idn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;doi&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">doi</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">forceHydroshareURI</span><span class="p">:</span>
        <span class="n">hs_identifier</span> <span class="o">=</span> <span class="n">doi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">DataciteSubmissionStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">doi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">DataciteSubmissionStatus</span><span class="o">.</span><span class="n">FAILURE</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">isPendingActivation</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hs_identifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">idn</span> <span class="k">for</span> <span class="n">idn</span> <span class="ow">in</span> <span class="n">identifiers</span> <span class="k">if</span> <span class="n">idn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;hydroShareIdentifier&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hs_identifier</span><span class="p">:</span>
            <span class="n">hs_identifier</span> <span class="o">=</span> <span class="n">hs_identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No hydroShareIdentifier found in cached_metadata for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CITATION_ERROR</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">err_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CITATION_ERROR</span>

    <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;, HydroShare, </span><span class="si">{url}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">hs_identifier</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">isPendingActivation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">forceHydroshareURI</span><span class="p">:</span>
        <span class="n">citation_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;, DOI for this published resource is pending activation.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">citation_str_lst</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.get_custom_citation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_custom_citation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get custom citation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_custom_citation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get custom citation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">citation</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">citation</span><span class="o">.</span><span class="n">first</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.get_logical_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_logical_files</span><span class="p">(</span><span class="n">logical_file_class_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a list of logical files (aggregations) for a specified logical file class name.
Note: Any derived class that supports logical file must override this function</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3272</span>
<span class="normal">3273</span>
<span class="normal">3274</span>
<span class="normal">3275</span>
<span class="normal">3276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_logical_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logical_file_class_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of logical files (aggregations) for a specified logical file class name.</span>
<span class="sd">    Note: Any derived class that supports logical file must override this function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.get_metadata_xml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_metadata_xml</span><span class="p">(</span><span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_format_elements</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get metadata xml for Resource.</p>
<p>Resource types that support file types
must override this method. See Composite Resource
type as an example</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_metadata_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_format_elements</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get metadata xml for Resource.</span>

<span class="sd">    Resource types that support file types</span>
<span class="sd">    must override this method. See Composite Resource</span>
<span class="sd">    type as an example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get_xml</span><span class="p">(</span><span class="n">pretty_print</span><span class="o">=</span><span class="n">pretty_print</span><span class="p">,</span>
                                 <span class="n">include_format_elements</span><span class="o">=</span><span class="n">include_format_elements</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.get_readme_file_content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_readme_file_content</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets the content of the readme file. If both a readme.md and a readme.txt file exist,
then the content of the readme.md file is returned, otherwise None</p>
<p>Note: The user uploaded readme file if originally not encoded as utf-8, then any non-ascii
characters in the file will be escaped when we return the file content.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span>
<span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_readme_file_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the content of the readme file. If both a readme.md and a readme.txt file exist,</span>
<span class="sd">    then the content of the readme.md file is returned, otherwise None</span>

<span class="sd">    Note: The user uploaded readme file if originally not encoded as utf-8, then any non-ascii</span>
<span class="sd">    characters in the file will be escaped when we return the file content.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">readme_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readme_file</span>
    <span class="c1"># check the file exists on S3</span>

    <span class="k">if</span> <span class="n">readme_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">readme_file</span>

    <span class="c1"># check the file exists on S3</span>
    <span class="k">if</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
        <span class="n">readme_file_content</span> <span class="o">=</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.md&#39;</span><span class="p">:</span>
            <span class="n">markdown_file_content</span> <span class="o">=</span> <span class="n">markdown</span><span class="p">(</span><span class="n">readme_file_content</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tables&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">markdown_file_content</span><span class="p">,</span>
                    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;file_type&#39;</span><span class="p">:</span> <span class="s1">&#39;md&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">readme_file_content</span><span class="p">,</span> <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">file_name</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">readme_file</span><span class="o">.</span><span class="n">file_name</span>
        <span class="n">readme_file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;readme file (</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">) is missing on S3. Deleting the file from Django.&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">log_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.get_s3_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_s3_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">prepend_short_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the S3 path by which the given path is accessed.
The input path includes data/contents/ as needed.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_s3_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">prepend_short_id</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the S3 path by which the given path is accessed.</span>
<span class="sd">       The input path includes data/contents/ as needed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prepend_short_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">):</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">return</span> <span class="n">full_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.get_supported_upload_file_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_supported_upload_file_types</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a list of permissible upload types.</p>
<p>Subclasses override this function to allow only specific file types.
Any version should return a tuple of those file extensions
(ex: return (".csv", ".txt",))</p>
<p>To disallow all file upload, return an empty tuple ( return ())</p>
<p>By default all file types are supported</p>
<p>This is called before creating a specific instance; hence it is a class method.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_supported_upload_file_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of permissible upload types.</span>

<span class="sd">    Subclasses override this function to allow only specific file types.</span>
<span class="sd">    Any version should return a tuple of those file extensions</span>
<span class="sd">    (ex: return (&quot;.csv&quot;, &quot;.txt&quot;,))</span>

<span class="sd">    To disallow all file upload, return an empty tuple ( return ())</span>

<span class="sd">    By default all file types are supported</span>

<span class="sd">    This is called before creating a specific instance; hence it is a class method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;.*&quot;</span><span class="p">,)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.get_url_of_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_url_of_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the URL of an arbitrary path in this resource.</p>
<p>A GET of this URL simply returns the contents of the path.
This URL is independent of federation.
PUT, POST, and DELETE are not supported.
path includes data/contents/</p>
<p>This choice for a URL is dependent mainly upon conformance to DataOne URL standards
that are also conformant to the format in resourcemap.xml. This url does not contain
the site URL, which is prefixed when needed.</p>
<p>This is based upon the resourcemap_urls.py entry:</p>
<pre><code>url(r'^resource/(?P&lt;shortkey&gt;[0-9a-f-]+)/data/contents/(?.+)/$',
    views.file_download_url_mapper,
    name='get_resource_file')
</code></pre>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_url_of_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the URL of an arbitrary path in this resource.</span>

<span class="sd">    A GET of this URL simply returns the contents of the path.</span>
<span class="sd">    This URL is independent of federation.</span>
<span class="sd">    PUT, POST, and DELETE are not supported.</span>
<span class="sd">    path includes data/contents/</span>

<span class="sd">    This choice for a URL is dependent mainly upon conformance to DataOne URL standards</span>
<span class="sd">    that are also conformant to the format in resourcemap.xml. This url does not contain</span>
<span class="sd">    the site URL, which is prefixed when needed.</span>

<span class="sd">    This is based upon the resourcemap_urls.py entry:</span>

<span class="sd">        url(r&#39;^resource/(?P&lt;shortkey&gt;[0-9a-f-]+)/data/contents/(?.+)/$&#39;,</span>
<span class="sd">            views.file_download_url_mapper,</span>
<span class="sd">            name=&#39;get_resource_file&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># must start with a / in order to concat with current_site_url.</span>
    <span class="n">url_encoded_path</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">url_encoded_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.has_required_content_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_required_content_files</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check whether a resource has the required content files.</p>
<p>Any subclass of this class may need to override this function
to apply specific requirements as it relates to resource content files</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_required_content_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check whether a resource has the required content files.</span>

<span class="sd">    Any subclass of this class may need to override this function</span>
<span class="sd">    to apply specific requirements as it relates to resource content files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_supported_upload_file_types</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.is_aggregation_xml_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_aggregation_xml_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if the file path <em>file_path</em> is one of the aggregation related xml file paths</p>
<p>:param  file_path: full file path starting with resource short_id
:return True if file_path is one of the aggregation xml file paths else False</p>
<p>This function is overridden for Composite Resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_aggregation_xml_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the file path *file_path* is one of the aggregation related xml file paths</span>

<span class="sd">    :param  file_path: full file path starting with resource short_id</span>
<span class="sd">    :return True if file_path is one of the aggregation xml file paths else False</span>

<span class="sd">    This function is overridden for Composite Resource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.is_collection_list_csv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_collection_list_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine if a given file is an internally-generated collection list</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_collection_list_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if a given file is an internally-generated collection list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">hs_collection_resource.utils</span> <span class="kn">import</span> <span class="n">CSV_FULL_NAME_TEMPLATE</span>
    <span class="n">collection_list_filename</span> <span class="o">=</span> <span class="n">CSV_FULL_NAME_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">collection_list_filename</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.is_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_folder</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine whether a given path (relative to resource root, including /data/contents/)
is a folder or not. Returns False if the path does not exist.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine whether a given path (relative to resource root, including /data/contents/)</span>
<span class="sd">       is a folder or not. Returns False if the path does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_split</span> <span class="o">=</span> <span class="n">folder_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">path_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">path_split</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_split</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># handles federation</span>
    <span class="n">s3_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">listing</span> <span class="o">=</span> <span class="n">istorage</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">s3_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">SessionException</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">path_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">listing</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># folders</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.is_metadata_json_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_metadata_json_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Determine whether a given file is a metadata json file.
Note: this will return true for any file that ends with the metadata endings or
has the same name as the metadata json file</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_metadata_json_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine whether a given file is a metadata json file.</span>
<span class="sd">    Note: this will return true for any file that ends with the metadata endings or</span>
<span class="sd">    has the same name as the metadata json file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">django_s3.utils</span> <span class="kn">import</span> <span class="n">is_metadata_json_file</span> <span class="k">as</span> <span class="n">_is_metadata_json_file</span>

    <span class="k">return</span> <span class="n">_is_metadata_json_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.is_metadata_xml_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_metadata_xml_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Determine whether a given file is metadata.
Note: this will return true for any file that ends with the metadata endings
We are taking the risk that user might create a file with the same filename ending</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_metadata_xml_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine whether a given file is metadata.</span>
<span class="sd">    Note: this will return true for any file that ends with the metadata endings</span>
<span class="sd">    We are taking the risk that user might create a file with the same filename ending</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">django_s3.utils</span> <span class="kn">import</span> <span class="n">is_metadata_xml_file</span> <span class="k">as</span> <span class="n">_is_metadata_xml_file</span>

    <span class="k">return</span> <span class="n">_is_metadata_xml_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.is_schema_json_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_schema_json_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Determine whether a given file is a schema.json file.
Note: this will return true for any file that ends with the schema.json ending
We are taking the risk that user might create a file with the same filename ending</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_schema_json_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine whether a given file is a schema.json file.</span>
<span class="sd">    Note: this will return true for any file that ends with the schema.json ending</span>
<span class="sd">    We are taking the risk that user might create a file with the same filename ending</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">django_s3.utils</span> <span class="kn">import</span> <span class="n">is_schema_json_file</span> <span class="k">as</span> <span class="n">_is_schema_json_file</span>

    <span class="k">return</span> <span class="n">_is_schema_json_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.is_schema_json_values_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_schema_json_values_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Determine whether a given file is a schema_values.json file.
Note: this will return true for any file that ends with the _schema_values.json ending
We are taking the risk that user might create a file with the same filename ending</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_schema_json_values_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine whether a given file is a schema_values.json file.</span>
<span class="sd">    Note: this will return true for any file that ends with the _schema_values.json ending</span>
<span class="sd">    We are taking the risk that user might create a file with the same filename ending</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">django_s3.utils</span> <span class="kn">import</span> <span class="n">is_schema_json_values_file</span> <span class="k">as</span> <span class="n">_is_schema_json_values_file</span>

    <span class="k">return</span> <span class="n">_is_schema_json_values_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.parse_citation_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_citation_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">first_author</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return properly formatted citation name from metadata.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_citation_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">first_author</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return properly formatted citation name from metadata.&quot;&quot;&quot;</span>
    <span class="n">CREATOR_NAME_ERROR</span> <span class="o">=</span> <span class="s2">&quot;Failed to generate citation - invalid creator name.&quot;</span>
    <span class="n">first_names</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name_parts</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CREATOR_NAME_ERROR</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">last_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">first_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">first_names</span> <span class="o">=</span> <span class="n">first_names</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">last_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CREATOR_NAME_ERROR</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name_parts</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CREATOR_NAME_ERROR</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">first_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">last_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last_names</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">first_names</span><span class="p">:</span>
        <span class="n">initials_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">first_names</span><span class="p">]</span>
        <span class="n">initials</span> <span class="o">=</span> <span class="s2">&quot;. &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">initials_list</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
        <span class="k">if</span> <span class="n">first_author</span><span class="p">:</span>
            <span class="n">author_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{last_name}</span><span class="s2">, </span><span class="si">{initials}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">author_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{initials}</span><span class="s2"> </span><span class="si">{last_name}</span><span class="s2">&quot;</span>
        <span class="n">author_name</span> <span class="o">=</span> <span class="n">author_name</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last_name</span><span class="o">=</span><span class="n">last_names</span><span class="p">,</span>
                                         <span class="n">initials</span><span class="o">=</span><span class="n">initials</span>
                                         <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">author_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{last_name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last_name</span><span class="o">=</span><span class="n">last_names</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">author_name</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.resmap_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resmap_url</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get URL of the resource map resourcemap.xml.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">resmap_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get URL of the resource map resourcemap.xml.&quot;&quot;&quot;</span>
    <span class="n">resmap_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{resource_id}</span><span class="s2">/data/resourcemap.xml&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">)</span>
    <span class="n">resmap_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;rest_download&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">resmap_path</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">resmap_url</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Refresh cached metadata before resource is saved to prevent stale cached metadata in memory getting
written to DB</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Refresh cached metadata before resource is saved to prevent stale cached metadata in memory getting</span>
<span class="sd">    written to DB&quot;&quot;&quot;</span>
    <span class="c1"># Only refresh cached_metadata from DB if object already exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">adding</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cached_metadata&#39;</span><span class="p">])</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">AbstractResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.scimeta_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scimeta_url</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get URL of the science metadata file resourcemetadata.xml</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">scimeta_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get URL of the science metadata file resourcemetadata.xml &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">short_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">)</span>
    <span class="n">scimeta_path</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">scimeta_path</span>
    <span class="n">scimeta_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;rest_download&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">scimeta_path</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">scimeta_url</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.setAVU" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setAVU</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set an AVU at the resource level.</p>
<p>This avoids mistakes in setting AVUs by assuring that the appropriate root path
is alway used.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setAVU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set an AVU at the resource level.</span>

<span class="sd">    This avoids mistakes in setting AVUs by assuring that the appropriate root path</span>
<span class="sd">    is alway used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># normalize boolean values to strings</span>
    <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
    <span class="n">root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_path</span>
    <span class="n">istorage</span><span class="o">.</span><span class="n">setAVU</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.set_discoverable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_discoverable</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set the discoverable flag for a resource.</p>
<p>:param value: True or False
:param user: user requesting the change, or None for changes that are not user requests.
:raises ValidationError: if the current configuration cannot be set to desired state</p>
<p>This sets the discoverable flag (self.raccess.discoverable) for a resource based
upon application logic. It is part of AbstractResource because its result depends
upon resource state, and not just access control.</p>
<ul>
<li>This flag can only be set to True if the resource passes basic validations
  <code>has_required_metata</code> and <code>has_required_content_files</code></li>
<li>setting <code>discoverable</code> to <code>False</code> also sets <code>public</code> to <code>False</code></li>
<li>setting <code>discoverable</code> to <code>True</code> does not change <code>public</code></li>
</ul>
<p>Thus, the setting public=True, discoverable=False is disallowed.</p>
<p>If <code>user</code> is None, access control is not checked.  This happens when a resource has been
invalidated outside of the control of a specific user. In this case, user can be None</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_discoverable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the discoverable flag for a resource.</span>

<span class="sd">    :param value: True or False</span>
<span class="sd">    :param user: user requesting the change, or None for changes that are not user requests.</span>
<span class="sd">    :raises ValidationError: if the current configuration cannot be set to desired state</span>

<span class="sd">    This sets the discoverable flag (self.raccess.discoverable) for a resource based</span>
<span class="sd">    upon application logic. It is part of AbstractResource because its result depends</span>
<span class="sd">    upon resource state, and not just access control.</span>

<span class="sd">    * This flag can only be set to True if the resource passes basic validations</span>
<span class="sd">      `has_required_metata` and `has_required_content_files`</span>
<span class="sd">    * setting `discoverable` to `False` also sets `public` to `False`</span>
<span class="sd">    * setting `discoverable` to `True` does not change `public`</span>

<span class="sd">    Thus, the setting public=True, discoverable=False is disallowed.</span>

<span class="sd">    If `user` is None, access control is not checked.  This happens when a resource has been</span>
<span class="sd">    invalidated outside of the control of a specific user. In this case, user can be None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># access control is separate from validation logic</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_change_resource_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to change resource sharing status&quot;</span><span class="p">)</span>

    <span class="c1"># check that there is sufficient resource content</span>
    <span class="n">has_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_metadata</span>
    <span class="n">has_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_content_files</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">has_metadata</span> <span class="ow">and</span> <span class="n">has_files</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_metadata</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_files</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient metadata and content files to be &quot;</span> <span class="o">+</span> \
                <span class="s2">&quot;discoverable&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_metadata</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient metadata to be discoverable&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_files</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient content files to be discoverable&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># state change is allowed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_public</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_index</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.set_private_sharing_link" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_private_sharing_link</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set resource 'allow_private_sharing' flag to True or False.
If allow_private_sharing is True then any user including anonymous user will be able to use the resource url
to view the resource (view mode).</p>
<p>:param user: user requesting the change
:param value: True or False
:raises PermissionDenied: if the user lacks permission to change resource flag</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_private_sharing_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set resource &#39;allow_private_sharing&#39; flag to True or False.</span>
<span class="sd">    If allow_private_sharing is True then any user including anonymous user will be able to use the resource url</span>
<span class="sd">    to view the resource (view mode).</span>

<span class="sd">    :param user: user requesting the change</span>
<span class="sd">    :param value: True or False</span>
<span class="sd">    :raises PermissionDenied: if the user lacks permission to change resource flag</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_change_resource_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PermissionDenied</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to change resource private link sharing &quot;</span>
                               <span class="s2">&quot; status&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">allow_private_sharing</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.set_public" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_public</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set the public flag for a resource.</p>
<p>:param value: True or False
:param user: user requesting the change, or None for changes that are not user requests.
:raises ValidationError: if the current configuration cannot be set to desired state</p>
<p>This sets the public flag (self.raccess.public) for a resource based
upon application logic. It is part of AbstractResource because its result depends
upon resource state, and not just access control.</p>
<ul>
<li>This flag can only be set to True if the resource passes basic validations
  <code>has_required_metata</code> and <code>has_required_content_files</code></li>
<li>setting <code>public</code> to <code>True</code> also sets <code>discoverable</code> to <code>True</code></li>
<li>setting <code>public</code> to <code>False</code> does not change <code>discoverable</code></li>
<li>setting <code>public</code> to either also modifies the AVU isPublic for the resource.</li>
</ul>
<p>Thus, the setting public=True, discoverable=False is disallowed.</p>
<p>If <code>user</code> is None, access control is not checked.  This happens when a resource has been
invalidated outside of the control of a specific user. In this case, user can be None</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_public</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the public flag for a resource.</span>

<span class="sd">    :param value: True or False</span>
<span class="sd">    :param user: user requesting the change, or None for changes that are not user requests.</span>
<span class="sd">    :raises ValidationError: if the current configuration cannot be set to desired state</span>

<span class="sd">    This sets the public flag (self.raccess.public) for a resource based</span>
<span class="sd">    upon application logic. It is part of AbstractResource because its result depends</span>
<span class="sd">    upon resource state, and not just access control.</span>

<span class="sd">    * This flag can only be set to True if the resource passes basic validations</span>
<span class="sd">      `has_required_metata` and `has_required_content_files`</span>
<span class="sd">    * setting `public` to `True` also sets `discoverable` to `True`</span>
<span class="sd">    * setting `public` to `False` does not change `discoverable`</span>
<span class="sd">    * setting `public` to either also modifies the AVU isPublic for the resource.</span>

<span class="sd">    Thus, the setting public=True, discoverable=False is disallowed.</span>

<span class="sd">    If `user` is None, access control is not checked.  This happens when a resource has been</span>
<span class="sd">    invalidated outside of the control of a specific user. In this case, user can be None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># avoid import loop</span>
    <span class="kn">from</span> <span class="nn">hs_core.signals</span> <span class="kn">import</span> <span class="n">post_raccess_change</span>
    <span class="kn">from</span> <span class="nn">hs_access_control.models.shortcut</span> <span class="kn">import</span> <span class="n">zone_of_publicity</span>

    <span class="c1"># access control is separate from validation logic</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_change_resource_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to change resource sharing status&quot;</span><span class="p">)</span>

    <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span>  <span class="c1"># is this a change?</span>

    <span class="c1"># check that there is sufficient resource content</span>
    <span class="n">has_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_metadata</span>
    <span class="n">has_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_required_content_files</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">has_metadata</span> <span class="ow">and</span> <span class="n">has_files</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_metadata</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_files</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient metadata and content files to be public&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_metadata</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient metadata to be public&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">has_files</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resource does not have sufficient content files to be public&quot;</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># make valid state change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># can&#39;t be public without being discoverable</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">post_raccess_change</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_index</span><span class="p">()</span>
        <span class="n">zone_of_publicity</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># public changed state: set isPublic metadata AVU accordingly</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">old_value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAVU</span><span class="p">(</span><span class="s2">&quot;isPublic&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.set_published" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_published</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set the published flag for a resource.</p>
<p>:param value: True or False</p>
<p>This sets the published flag (self.raccess.published)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_published</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the published flag for a resource.</span>

<span class="sd">    :param value: True or False</span>

<span class="sd">    This sets the published flag (self.raccess.published)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">hs_core.signals</span> <span class="kn">import</span> <span class="n">post_raccess_change</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">immutable</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># can&#39;t be published without being public</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">post_raccess_change</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_index</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.set_quota_holder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_quota_holder</span><span class="p">(</span><span class="n">setter</span><span class="p">,</span> <span class="n">new_holder</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set quota holder of the resource to new_holder who must be an owner.</p>
<p>setter is the requesting user to transfer quota holder and setter must also be an owner</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_quota_holder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setter</span><span class="p">,</span> <span class="n">new_holder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set quota holder of the resource to new_holder who must be an owner.</span>

<span class="sd">    setter is the requesting user to transfer quota holder and setter must also be an owner</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">hs_core.hydroshare.utils</span> <span class="kn">import</span> <span class="n">validate_user_quota</span>

    <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">setter</span><span class="p">,</span> <span class="n">User</span><span class="p">))</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">new_holder</span><span class="p">,</span> <span class="n">User</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">setter</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">owns_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">or</span> \
            <span class="ow">not</span> <span class="n">new_holder</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">owns_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PermissionDenied</span><span class="p">(</span><span class="s2">&quot;Only owners can set or be set as quota holder for the resource&quot;</span><span class="p">)</span>

    <span class="c1"># ensure the new holder has a bucket, buckets only exist for users with resources</span>
    <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
    <span class="n">istorage</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">new_holder</span><span class="o">.</span><span class="n">userprofile</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">)</span>
    <span class="c1"># QuotaException will be raised if new_holder does not have enough quota to hold this</span>
    <span class="c1"># new resource, in which case, set_quota_holder to the new user fails</span>
    <span class="n">validate_user_quota</span><span class="p">(</span><span class="n">new_holder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="c1"># if the resource is new, it does not have a quota holder yet</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quota_holder</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span><span class="o">.</span><span class="n">new_quota_holder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">new_holder</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">quota_holder</span> <span class="o">=</span> <span class="n">new_holder</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.set_require_download_agreement" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_require_download_agreement</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set resource require_download_agreement flag to True or False.
If require_download_agreement is True then user will be prompted to agree to resource
rights statement before he/she can download resource files or bag.</p>
<p>:param user: user requesting the change
:param value: True or False
:raises PermissionDenied: if the user lacks permission to change resource flag</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_require_download_agreement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set resource require_download_agreement flag to True or False.</span>
<span class="sd">    If require_download_agreement is True then user will be prompted to agree to resource</span>
<span class="sd">    rights statement before he/she can download resource files or bag.</span>

<span class="sd">    :param user: user requesting the change</span>
<span class="sd">    :param value: True or False</span>
<span class="sd">    :raises PermissionDenied: if the user lacks permission to change resource flag</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_change_resource_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PermissionDenied</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to change resource download agreement&quot;</span>
                               <span class="s2">&quot; status&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">require_download_agreement</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.supports_delete_folder_on_zip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_delete_folder_on_zip</span><span class="p">(</span><span class="n">original_folder</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if resource allows the original folder to be deleted upon zip.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3315</span>
<span class="normal">3316</span>
<span class="normal">3317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">supports_delete_folder_on_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if resource allows the original folder to be deleted upon zip.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.supports_folder_creation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_folder_creation</span><span class="p">(</span><span class="n">folder_full_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if resource supports creation of folder at the specified path.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3299</span>
<span class="normal">3300</span>
<span class="normal">3301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">supports_folder_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_full_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if resource supports creation of folder at the specified path.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.supports_rename_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_rename_path</span><span class="p">(</span><span class="n">src_full_path</span><span class="p">,</span> <span class="n">tgt_full_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if file/folder rename/move is allowed by this resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3303</span>
<span class="normal">3304</span>
<span class="normal">3305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">supports_rename_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_full_path</span><span class="p">,</span> <span class="n">tgt_full_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if file/folder rename/move is allowed by this resource.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.supports_unzip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_unzip</span><span class="p">(</span><span class="n">file_to_unzip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if resource supports the unzipping of the specified file.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3311</span>
<span class="normal">3312</span>
<span class="normal">3313</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">supports_unzip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_to_unzip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if resource supports the unzipping of the specified file.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.supports_zip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supports_zip</span><span class="p">(</span><span class="n">folder_to_zip</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if resource supports the specified folder to be zipped.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3307</span>
<span class="normal">3308</span>
<span class="normal">3309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">supports_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_to_zip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if resource supports the specified folder to be zipped.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.sysmeta_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sysmeta_path</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get URL of resource map xml.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">sysmeta_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get URL of resource map xml.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{resource_id}</span><span class="s2">/data/resourcemap.xml&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.update_all_cached_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_all_cached_metadata</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update all fields in the cached metadata
This method is primarily for use in management commands to refresh cached metadata</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_all_cached_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update all fields in the cached metadata</span>
<span class="sd">    This method is primarily for use in management commands to refresh cached metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_cached_metadata_field</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.update_cached_metadata_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_cached_metadata_field</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update a specific field in the cached metadata or all fields if 'all' is specified</p>
<p>:param field_name: The field to update ('creator', 'subject', etc.). If 'all', update all fields.</p>
<p>NOTE: This method gets called from post_save and post_delete signal handler for
any core metadata elements. We need to update the 'modified' field in cached metadata
for any change to core metadata elements. The Date metadata element gets updated for the
modified date type by the system as needed. We are depending on that change to modified date
to update the 'modified' field in cached metadata.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_cached_metadata_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a specific field in the cached metadata or all fields if &#39;all&#39; is specified</span>

<span class="sd">    :param field_name: The field to update (&#39;creator&#39;, &#39;subject&#39;, etc.). If &#39;all&#39;, update all fields.</span>

<span class="sd">    NOTE: This method gets called from post_save and post_delete signal handler for</span>
<span class="sd">    any core metadata elements. We need to update the &#39;modified&#39; field in cached metadata</span>
<span class="sd">    for any change to core metadata elements. The Date metadata element gets updated for the</span>
<span class="sd">    modified date type by the system as needed. We are depending on that change to modified date</span>
<span class="sd">    to update the &#39;modified&#39; field in cached metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
    <span class="n">copied_metadata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">)</span>

    <span class="c1"># These are the fields that need to be updated in cached metadata</span>
    <span class="n">field_updaters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;creator&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_creators_field</span><span class="p">,</span>
        <span class="s1">&#39;contributor&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_contributors_field</span><span class="p">,</span>
        <span class="s1">&#39;coverage&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_coverage_field</span><span class="p">,</span>
        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_title_field</span><span class="p">,</span>
        <span class="s1">&#39;subject&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_subjects_field</span><span class="p">,</span>
        <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_date_field</span><span class="p">,</span>
        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_status_field</span><span class="p">,</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_abstract_field</span><span class="p">,</span>
        <span class="s1">&#39;relation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_relation_field</span><span class="p">,</span>
        <span class="s1">&#39;geospatialrelation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_geospatialrelation_field</span><span class="p">,</span>
        <span class="s1">&#39;fundingagency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_fundingagency_field</span><span class="p">,</span>
        <span class="s1">&#39;rights&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_rights_field</span><span class="p">,</span>
        <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_language_field</span><span class="p">,</span>
        <span class="s1">&#39;identifier&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_identifier_field</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_type_field</span><span class="p">,</span>
        <span class="s1">&#39;publisher&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_publisher_field</span>
    <span class="p">}</span>

    <span class="c1"># Update all fields if &#39;all&#39; is specified</span>
    <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">updater</span> <span class="ow">in</span> <span class="n">field_updaters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">updater</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Update the specified field</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">field_updaters</span><span class="p">:</span>
            <span class="n">field_updaters</span><span class="p">[</span><span class="n">field_name</span><span class="p">](</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

    <span class="c1"># Ensure all required fields are present</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_required_fields</span><span class="p">(</span><span class="n">copied_metadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>

    <span class="c1"># Update the modified date every time a metadata element is updated/deleted, or when &#39;all&#39; is specified</span>
    <span class="n">modified_date</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;modified&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">field_name</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="c1"># this is the case of updating cached metadata as part of metadata save/delete signal handler</span>
        <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">modified_date</span><span class="p">:</span>
            <span class="c1"># this update won&#39;t trigger the post_save signal for Date model since we are using update query api</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">modified_date</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">modified_date</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># this is the case of updating cached metadata as part of management command</span>
        <span class="k">if</span> <span class="n">modified_date</span><span class="p">:</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modified_date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copied_metadata</span><span class="p">[</span><span class="s1">&#39;modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cached_metadata</span><span class="o">=</span><span class="n">copied_metadata</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.update_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_index</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>updates previous versions of a resource (self) in index</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;updates previous versions of a resource (self) in index&quot;&quot;&quot;</span>
    <span class="n">prev_version_resource_relation_meta</span> <span class="o">=</span> <span class="n">Relation</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;isReplacedBy&#39;</span><span class="p">,</span>
                                                                  <span class="n">value__contains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">prev_version_resource_relation_meta</span><span class="p">:</span>
        <span class="n">prev_version_res</span> <span class="o">=</span> <span class="n">prev_version_resource_relation_meta</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">resource</span>
        <span class="k">if</span> <span class="n">prev_version_res</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span> <span class="ow">or</span> <span class="n">prev_version_res</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span><span class="p">:</span>
            <span class="c1"># saving to trigger index update for this previous version of resource</span>
            <span class="n">prev_version_res</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">prev_version_res</span><span class="o">.</span><span class="n">update_index</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.AbstractResource.update_public_and_discoverable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_public_and_discoverable</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the settings of the public and discoverable flags for changes in metadata.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_public_and_discoverable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the settings of the public and discoverable flags for changes in metadata.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_be_public_or_discoverable</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_discoverable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># also sets Public</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.BaseResource" class="doc doc-heading">
            <code>BaseResource</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="mezzanine.pages.models.Page">Page</span></code>, <code><a class="autorefs autorefs-internal" title="AbstractResource (hs_core.models.AbstractResource)" href="#hs_core.models.AbstractResource">AbstractResource</a></code></p>



        <p>Combine mezzanine Page model and AbstractResource model to establish base resource.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4197</span>
<span class="normal">4198</span>
<span class="normal">4199</span>
<span class="normal">4200</span>
<span class="normal">4201</span>
<span class="normal">4202</span>
<span class="normal">4203</span>
<span class="normal">4204</span>
<span class="normal">4205</span>
<span class="normal">4206</span>
<span class="normal">4207</span>
<span class="normal">4208</span>
<span class="normal">4209</span>
<span class="normal">4210</span>
<span class="normal">4211</span>
<span class="normal">4212</span>
<span class="normal">4213</span>
<span class="normal">4214</span>
<span class="normal">4215</span>
<span class="normal">4216</span>
<span class="normal">4217</span>
<span class="normal">4218</span>
<span class="normal">4219</span>
<span class="normal">4220</span>
<span class="normal">4221</span>
<span class="normal">4222</span>
<span class="normal">4223</span>
<span class="normal">4224</span>
<span class="normal">4225</span>
<span class="normal">4226</span>
<span class="normal">4227</span>
<span class="normal">4228</span>
<span class="normal">4229</span>
<span class="normal">4230</span>
<span class="normal">4231</span>
<span class="normal">4232</span>
<span class="normal">4233</span>
<span class="normal">4234</span>
<span class="normal">4235</span>
<span class="normal">4236</span>
<span class="normal">4237</span>
<span class="normal">4238</span>
<span class="normal">4239</span>
<span class="normal">4240</span>
<span class="normal">4241</span>
<span class="normal">4242</span>
<span class="normal">4243</span>
<span class="normal">4244</span>
<span class="normal">4245</span>
<span class="normal">4246</span>
<span class="normal">4247</span>
<span class="normal">4248</span>
<span class="normal">4249</span>
<span class="normal">4250</span>
<span class="normal">4251</span>
<span class="normal">4252</span>
<span class="normal">4253</span>
<span class="normal">4254</span>
<span class="normal">4255</span>
<span class="normal">4256</span>
<span class="normal">4257</span>
<span class="normal">4258</span>
<span class="normal">4259</span>
<span class="normal">4260</span>
<span class="normal">4261</span>
<span class="normal">4262</span>
<span class="normal">4263</span>
<span class="normal">4264</span>
<span class="normal">4265</span>
<span class="normal">4266</span>
<span class="normal">4267</span>
<span class="normal">4268</span>
<span class="normal">4269</span>
<span class="normal">4270</span>
<span class="normal">4271</span>
<span class="normal">4272</span>
<span class="normal">4273</span>
<span class="normal">4274</span>
<span class="normal">4275</span>
<span class="normal">4276</span>
<span class="normal">4277</span>
<span class="normal">4278</span>
<span class="normal">4279</span>
<span class="normal">4280</span>
<span class="normal">4281</span>
<span class="normal">4282</span>
<span class="normal">4283</span>
<span class="normal">4284</span>
<span class="normal">4285</span>
<span class="normal">4286</span>
<span class="normal">4287</span>
<span class="normal">4288</span>
<span class="normal">4289</span>
<span class="normal">4290</span>
<span class="normal">4291</span>
<span class="normal">4292</span>
<span class="normal">4293</span>
<span class="normal">4294</span>
<span class="normal">4295</span>
<span class="normal">4296</span>
<span class="normal">4297</span>
<span class="normal">4298</span>
<span class="normal">4299</span>
<span class="normal">4300</span>
<span class="normal">4301</span>
<span class="normal">4302</span>
<span class="normal">4303</span>
<span class="normal">4304</span>
<span class="normal">4305</span>
<span class="normal">4306</span>
<span class="normal">4307</span>
<span class="normal">4308</span>
<span class="normal">4309</span>
<span class="normal">4310</span>
<span class="normal">4311</span>
<span class="normal">4312</span>
<span class="normal">4313</span>
<span class="normal">4314</span>
<span class="normal">4315</span>
<span class="normal">4316</span>
<span class="normal">4317</span>
<span class="normal">4318</span>
<span class="normal">4319</span>
<span class="normal">4320</span>
<span class="normal">4321</span>
<span class="normal">4322</span>
<span class="normal">4323</span>
<span class="normal">4324</span>
<span class="normal">4325</span>
<span class="normal">4326</span>
<span class="normal">4327</span>
<span class="normal">4328</span>
<span class="normal">4329</span>
<span class="normal">4330</span>
<span class="normal">4331</span>
<span class="normal">4332</span>
<span class="normal">4333</span>
<span class="normal">4334</span>
<span class="normal">4335</span>
<span class="normal">4336</span>
<span class="normal">4337</span>
<span class="normal">4338</span>
<span class="normal">4339</span>
<span class="normal">4340</span>
<span class="normal">4341</span>
<span class="normal">4342</span>
<span class="normal">4343</span>
<span class="normal">4344</span>
<span class="normal">4345</span>
<span class="normal">4346</span>
<span class="normal">4347</span>
<span class="normal">4348</span>
<span class="normal">4349</span>
<span class="normal">4350</span>
<span class="normal">4351</span>
<span class="normal">4352</span>
<span class="normal">4353</span>
<span class="normal">4354</span>
<span class="normal">4355</span>
<span class="normal">4356</span>
<span class="normal">4357</span>
<span class="normal">4358</span>
<span class="normal">4359</span>
<span class="normal">4360</span>
<span class="normal">4361</span>
<span class="normal">4362</span>
<span class="normal">4363</span>
<span class="normal">4364</span>
<span class="normal">4365</span>
<span class="normal">4366</span>
<span class="normal">4367</span>
<span class="normal">4368</span>
<span class="normal">4369</span>
<span class="normal">4370</span>
<span class="normal">4371</span>
<span class="normal">4372</span>
<span class="normal">4373</span>
<span class="normal">4374</span>
<span class="normal">4375</span>
<span class="normal">4376</span>
<span class="normal">4377</span>
<span class="normal">4378</span>
<span class="normal">4379</span>
<span class="normal">4380</span>
<span class="normal">4381</span>
<span class="normal">4382</span>
<span class="normal">4383</span>
<span class="normal">4384</span>
<span class="normal">4385</span>
<span class="normal">4386</span>
<span class="normal">4387</span>
<span class="normal">4388</span>
<span class="normal">4389</span>
<span class="normal">4390</span>
<span class="normal">4391</span>
<span class="normal">4392</span>
<span class="normal">4393</span>
<span class="normal">4394</span>
<span class="normal">4395</span>
<span class="normal">4396</span>
<span class="normal">4397</span>
<span class="normal">4398</span>
<span class="normal">4399</span>
<span class="normal">4400</span>
<span class="normal">4401</span>
<span class="normal">4402</span>
<span class="normal">4403</span>
<span class="normal">4404</span>
<span class="normal">4405</span>
<span class="normal">4406</span>
<span class="normal">4407</span>
<span class="normal">4408</span>
<span class="normal">4409</span>
<span class="normal">4410</span>
<span class="normal">4411</span>
<span class="normal">4412</span>
<span class="normal">4413</span>
<span class="normal">4414</span>
<span class="normal">4415</span>
<span class="normal">4416</span>
<span class="normal">4417</span>
<span class="normal">4418</span>
<span class="normal">4419</span>
<span class="normal">4420</span>
<span class="normal">4421</span>
<span class="normal">4422</span>
<span class="normal">4423</span>
<span class="normal">4424</span>
<span class="normal">4425</span>
<span class="normal">4426</span>
<span class="normal">4427</span>
<span class="normal">4428</span>
<span class="normal">4429</span>
<span class="normal">4430</span>
<span class="normal">4431</span>
<span class="normal">4432</span>
<span class="normal">4433</span>
<span class="normal">4434</span>
<span class="normal">4435</span>
<span class="normal">4436</span>
<span class="normal">4437</span>
<span class="normal">4438</span>
<span class="normal">4439</span>
<span class="normal">4440</span>
<span class="normal">4441</span>
<span class="normal">4442</span>
<span class="normal">4443</span>
<span class="normal">4444</span>
<span class="normal">4445</span>
<span class="normal">4446</span>
<span class="normal">4447</span>
<span class="normal">4448</span>
<span class="normal">4449</span>
<span class="normal">4450</span>
<span class="normal">4451</span>
<span class="normal">4452</span>
<span class="normal">4453</span>
<span class="normal">4454</span>
<span class="normal">4455</span>
<span class="normal">4456</span>
<span class="normal">4457</span>
<span class="normal">4458</span>
<span class="normal">4459</span>
<span class="normal">4460</span>
<span class="normal">4461</span>
<span class="normal">4462</span>
<span class="normal">4463</span>
<span class="normal">4464</span>
<span class="normal">4465</span>
<span class="normal">4466</span>
<span class="normal">4467</span>
<span class="normal">4468</span>
<span class="normal">4469</span>
<span class="normal">4470</span>
<span class="normal">4471</span>
<span class="normal">4472</span>
<span class="normal">4473</span>
<span class="normal">4474</span>
<span class="normal">4475</span>
<span class="normal">4476</span>
<span class="normal">4477</span>
<span class="normal">4478</span>
<span class="normal">4479</span>
<span class="normal">4480</span>
<span class="normal">4481</span>
<span class="normal">4482</span>
<span class="normal">4483</span>
<span class="normal">4484</span>
<span class="normal">4485</span>
<span class="normal">4486</span>
<span class="normal">4487</span>
<span class="normal">4488</span>
<span class="normal">4489</span>
<span class="normal">4490</span>
<span class="normal">4491</span>
<span class="normal">4492</span>
<span class="normal">4493</span>
<span class="normal">4494</span>
<span class="normal">4495</span>
<span class="normal">4496</span>
<span class="normal">4497</span>
<span class="normal">4498</span>
<span class="normal">4499</span>
<span class="normal">4500</span>
<span class="normal">4501</span>
<span class="normal">4502</span>
<span class="normal">4503</span>
<span class="normal">4504</span>
<span class="normal">4505</span>
<span class="normal">4506</span>
<span class="normal">4507</span>
<span class="normal">4508</span>
<span class="normal">4509</span>
<span class="normal">4510</span>
<span class="normal">4511</span>
<span class="normal">4512</span>
<span class="normal">4513</span>
<span class="normal">4514</span>
<span class="normal">4515</span>
<span class="normal">4516</span>
<span class="normal">4517</span>
<span class="normal">4518</span>
<span class="normal">4519</span>
<span class="normal">4520</span>
<span class="normal">4521</span>
<span class="normal">4522</span>
<span class="normal">4523</span>
<span class="normal">4524</span>
<span class="normal">4525</span>
<span class="normal">4526</span>
<span class="normal">4527</span>
<span class="normal">4528</span>
<span class="normal">4529</span>
<span class="normal">4530</span>
<span class="normal">4531</span>
<span class="normal">4532</span>
<span class="normal">4533</span>
<span class="normal">4534</span>
<span class="normal">4535</span>
<span class="normal">4536</span>
<span class="normal">4537</span>
<span class="normal">4538</span>
<span class="normal">4539</span>
<span class="normal">4540</span>
<span class="normal">4541</span>
<span class="normal">4542</span>
<span class="normal">4543</span>
<span class="normal">4544</span>
<span class="normal">4545</span>
<span class="normal">4546</span>
<span class="normal">4547</span>
<span class="normal">4548</span>
<span class="normal">4549</span>
<span class="normal">4550</span>
<span class="normal">4551</span>
<span class="normal">4552</span>
<span class="normal">4553</span>
<span class="normal">4554</span>
<span class="normal">4555</span>
<span class="normal">4556</span>
<span class="normal">4557</span>
<span class="normal">4558</span>
<span class="normal">4559</span>
<span class="normal">4560</span>
<span class="normal">4561</span>
<span class="normal">4562</span>
<span class="normal">4563</span>
<span class="normal">4564</span>
<span class="normal">4565</span>
<span class="normal">4566</span>
<span class="normal">4567</span>
<span class="normal">4568</span>
<span class="normal">4569</span>
<span class="normal">4570</span>
<span class="normal">4571</span>
<span class="normal">4572</span>
<span class="normal">4573</span>
<span class="normal">4574</span>
<span class="normal">4575</span>
<span class="normal">4576</span>
<span class="normal">4577</span>
<span class="normal">4578</span>
<span class="normal">4579</span>
<span class="normal">4580</span>
<span class="normal">4581</span>
<span class="normal">4582</span>
<span class="normal">4583</span>
<span class="normal">4584</span>
<span class="normal">4585</span>
<span class="normal">4586</span>
<span class="normal">4587</span>
<span class="normal">4588</span>
<span class="normal">4589</span>
<span class="normal">4590</span>
<span class="normal">4591</span>
<span class="normal">4592</span>
<span class="normal">4593</span>
<span class="normal">4594</span>
<span class="normal">4595</span>
<span class="normal">4596</span>
<span class="normal">4597</span>
<span class="normal">4598</span>
<span class="normal">4599</span>
<span class="normal">4600</span>
<span class="normal">4601</span>
<span class="normal">4602</span>
<span class="normal">4603</span>
<span class="normal">4604</span>
<span class="normal">4605</span>
<span class="normal">4606</span>
<span class="normal">4607</span>
<span class="normal">4608</span>
<span class="normal">4609</span>
<span class="normal">4610</span>
<span class="normal">4611</span>
<span class="normal">4612</span>
<span class="normal">4613</span>
<span class="normal">4614</span>
<span class="normal">4615</span>
<span class="normal">4616</span>
<span class="normal">4617</span>
<span class="normal">4618</span>
<span class="normal">4619</span>
<span class="normal">4620</span>
<span class="normal">4621</span>
<span class="normal">4622</span>
<span class="normal">4623</span>
<span class="normal">4624</span>
<span class="normal">4625</span>
<span class="normal">4626</span>
<span class="normal">4627</span>
<span class="normal">4628</span>
<span class="normal">4629</span>
<span class="normal">4630</span>
<span class="normal">4631</span>
<span class="normal">4632</span>
<span class="normal">4633</span>
<span class="normal">4634</span>
<span class="normal">4635</span>
<span class="normal">4636</span>
<span class="normal">4637</span>
<span class="normal">4638</span>
<span class="normal">4639</span>
<span class="normal">4640</span>
<span class="normal">4641</span>
<span class="normal">4642</span>
<span class="normal">4643</span>
<span class="normal">4644</span>
<span class="normal">4645</span>
<span class="normal">4646</span>
<span class="normal">4647</span>
<span class="normal">4648</span>
<span class="normal">4649</span>
<span class="normal">4650</span>
<span class="normal">4651</span>
<span class="normal">4652</span>
<span class="normal">4653</span>
<span class="normal">4654</span>
<span class="normal">4655</span>
<span class="normal">4656</span>
<span class="normal">4657</span>
<span class="normal">4658</span>
<span class="normal">4659</span>
<span class="normal">4660</span>
<span class="normal">4661</span>
<span class="normal">4662</span>
<span class="normal">4663</span>
<span class="normal">4664</span>
<span class="normal">4665</span>
<span class="normal">4666</span>
<span class="normal">4667</span>
<span class="normal">4668</span>
<span class="normal">4669</span>
<span class="normal">4670</span>
<span class="normal">4671</span>
<span class="normal">4672</span>
<span class="normal">4673</span>
<span class="normal">4674</span>
<span class="normal">4675</span>
<span class="normal">4676</span>
<span class="normal">4677</span>
<span class="normal">4678</span>
<span class="normal">4679</span>
<span class="normal">4680</span>
<span class="normal">4681</span>
<span class="normal">4682</span>
<span class="normal">4683</span>
<span class="normal">4684</span>
<span class="normal">4685</span>
<span class="normal">4686</span>
<span class="normal">4687</span>
<span class="normal">4688</span>
<span class="normal">4689</span>
<span class="normal">4690</span>
<span class="normal">4691</span>
<span class="normal">4692</span>
<span class="normal">4693</span>
<span class="normal">4694</span>
<span class="normal">4695</span>
<span class="normal">4696</span>
<span class="normal">4697</span>
<span class="normal">4698</span>
<span class="normal">4699</span>
<span class="normal">4700</span>
<span class="normal">4701</span>
<span class="normal">4702</span>
<span class="normal">4703</span>
<span class="normal">4704</span>
<span class="normal">4705</span>
<span class="normal">4706</span>
<span class="normal">4707</span>
<span class="normal">4708</span>
<span class="normal">4709</span>
<span class="normal">4710</span>
<span class="normal">4711</span>
<span class="normal">4712</span>
<span class="normal">4713</span>
<span class="normal">4714</span>
<span class="normal">4715</span>
<span class="normal">4716</span>
<span class="normal">4717</span>
<span class="normal">4718</span>
<span class="normal">4719</span>
<span class="normal">4720</span>
<span class="normal">4721</span>
<span class="normal">4722</span>
<span class="normal">4723</span>
<span class="normal">4724</span>
<span class="normal">4725</span>
<span class="normal">4726</span>
<span class="normal">4727</span>
<span class="normal">4728</span>
<span class="normal">4729</span>
<span class="normal">4730</span>
<span class="normal">4731</span>
<span class="normal">4732</span>
<span class="normal">4733</span>
<span class="normal">4734</span>
<span class="normal">4735</span>
<span class="normal">4736</span>
<span class="normal">4737</span>
<span class="normal">4738</span>
<span class="normal">4739</span>
<span class="normal">4740</span>
<span class="normal">4741</span>
<span class="normal">4742</span>
<span class="normal">4743</span>
<span class="normal">4744</span>
<span class="normal">4745</span>
<span class="normal">4746</span>
<span class="normal">4747</span>
<span class="normal">4748</span>
<span class="normal">4749</span>
<span class="normal">4750</span>
<span class="normal">4751</span>
<span class="normal">4752</span>
<span class="normal">4753</span>
<span class="normal">4754</span>
<span class="normal">4755</span>
<span class="normal">4756</span>
<span class="normal">4757</span>
<span class="normal">4758</span>
<span class="normal">4759</span>
<span class="normal">4760</span>
<span class="normal">4761</span>
<span class="normal">4762</span>
<span class="normal">4763</span>
<span class="normal">4764</span>
<span class="normal">4765</span>
<span class="normal">4766</span>
<span class="normal">4767</span>
<span class="normal">4768</span>
<span class="normal">4769</span>
<span class="normal">4770</span>
<span class="normal">4771</span>
<span class="normal">4772</span>
<span class="normal">4773</span>
<span class="normal">4774</span>
<span class="normal">4775</span>
<span class="normal">4776</span>
<span class="normal">4777</span>
<span class="normal">4778</span>
<span class="normal">4779</span>
<span class="normal">4780</span>
<span class="normal">4781</span>
<span class="normal">4782</span>
<span class="normal">4783</span>
<span class="normal">4784</span>
<span class="normal">4785</span>
<span class="normal">4786</span>
<span class="normal">4787</span>
<span class="normal">4788</span>
<span class="normal">4789</span>
<span class="normal">4790</span>
<span class="normal">4791</span>
<span class="normal">4792</span>
<span class="normal">4793</span>
<span class="normal">4794</span>
<span class="normal">4795</span>
<span class="normal">4796</span>
<span class="normal">4797</span>
<span class="normal">4798</span>
<span class="normal">4799</span>
<span class="normal">4800</span>
<span class="normal">4801</span>
<span class="normal">4802</span>
<span class="normal">4803</span>
<span class="normal">4804</span>
<span class="normal">4805</span>
<span class="normal">4806</span>
<span class="normal">4807</span>
<span class="normal">4808</span>
<span class="normal">4809</span>
<span class="normal">4810</span>
<span class="normal">4811</span>
<span class="normal">4812</span>
<span class="normal">4813</span>
<span class="normal">4814</span>
<span class="normal">4815</span>
<span class="normal">4816</span>
<span class="normal">4817</span>
<span class="normal">4818</span>
<span class="normal">4819</span>
<span class="normal">4820</span>
<span class="normal">4821</span>
<span class="normal">4822</span>
<span class="normal">4823</span>
<span class="normal">4824</span>
<span class="normal">4825</span>
<span class="normal">4826</span>
<span class="normal">4827</span>
<span class="normal">4828</span>
<span class="normal">4829</span>
<span class="normal">4830</span>
<span class="normal">4831</span>
<span class="normal">4832</span>
<span class="normal">4833</span>
<span class="normal">4834</span>
<span class="normal">4835</span>
<span class="normal">4836</span>
<span class="normal">4837</span>
<span class="normal">4838</span>
<span class="normal">4839</span>
<span class="normal">4840</span>
<span class="normal">4841</span>
<span class="normal">4842</span>
<span class="normal">4843</span>
<span class="normal">4844</span>
<span class="normal">4845</span>
<span class="normal">4846</span>
<span class="normal">4847</span>
<span class="normal">4848</span>
<span class="normal">4849</span>
<span class="normal">4850</span>
<span class="normal">4851</span>
<span class="normal">4852</span>
<span class="normal">4853</span>
<span class="normal">4854</span>
<span class="normal">4855</span>
<span class="normal">4856</span>
<span class="normal">4857</span>
<span class="normal">4858</span>
<span class="normal">4859</span>
<span class="normal">4860</span>
<span class="normal">4861</span>
<span class="normal">4862</span>
<span class="normal">4863</span>
<span class="normal">4864</span>
<span class="normal">4865</span>
<span class="normal">4866</span>
<span class="normal">4867</span>
<span class="normal">4868</span>
<span class="normal">4869</span>
<span class="normal">4870</span>
<span class="normal">4871</span>
<span class="normal">4872</span>
<span class="normal">4873</span>
<span class="normal">4874</span>
<span class="normal">4875</span>
<span class="normal">4876</span>
<span class="normal">4877</span>
<span class="normal">4878</span>
<span class="normal">4879</span>
<span class="normal">4880</span>
<span class="normal">4881</span>
<span class="normal">4882</span>
<span class="normal">4883</span>
<span class="normal">4884</span>
<span class="normal">4885</span>
<span class="normal">4886</span>
<span class="normal">4887</span>
<span class="normal">4888</span>
<span class="normal">4889</span>
<span class="normal">4890</span>
<span class="normal">4891</span>
<span class="normal">4892</span>
<span class="normal">4893</span>
<span class="normal">4894</span>
<span class="normal">4895</span>
<span class="normal">4896</span>
<span class="normal">4897</span>
<span class="normal">4898</span>
<span class="normal">4899</span>
<span class="normal">4900</span>
<span class="normal">4901</span>
<span class="normal">4902</span>
<span class="normal">4903</span>
<span class="normal">4904</span>
<span class="normal">4905</span>
<span class="normal">4906</span>
<span class="normal">4907</span>
<span class="normal">4908</span>
<span class="normal">4909</span>
<span class="normal">4910</span>
<span class="normal">4911</span>
<span class="normal">4912</span>
<span class="normal">4913</span>
<span class="normal">4914</span>
<span class="normal">4915</span>
<span class="normal">4916</span>
<span class="normal">4917</span>
<span class="normal">4918</span>
<span class="normal">4919</span>
<span class="normal">4920</span>
<span class="normal">4921</span>
<span class="normal">4922</span>
<span class="normal">4923</span>
<span class="normal">4924</span>
<span class="normal">4925</span>
<span class="normal">4926</span>
<span class="normal">4927</span>
<span class="normal">4928</span>
<span class="normal">4929</span>
<span class="normal">4930</span>
<span class="normal">4931</span>
<span class="normal">4932</span>
<span class="normal">4933</span>
<span class="normal">4934</span>
<span class="normal">4935</span>
<span class="normal">4936</span>
<span class="normal">4937</span>
<span class="normal">4938</span>
<span class="normal">4939</span>
<span class="normal">4940</span>
<span class="normal">4941</span>
<span class="normal">4942</span>
<span class="normal">4943</span>
<span class="normal">4944</span>
<span class="normal">4945</span>
<span class="normal">4946</span>
<span class="normal">4947</span>
<span class="normal">4948</span>
<span class="normal">4949</span>
<span class="normal">4950</span>
<span class="normal">4951</span>
<span class="normal">4952</span>
<span class="normal">4953</span>
<span class="normal">4954</span>
<span class="normal">4955</span>
<span class="normal">4956</span>
<span class="normal">4957</span>
<span class="normal">4958</span>
<span class="normal">4959</span>
<span class="normal">4960</span>
<span class="normal">4961</span>
<span class="normal">4962</span>
<span class="normal">4963</span>
<span class="normal">4964</span>
<span class="normal">4965</span>
<span class="normal">4966</span>
<span class="normal">4967</span>
<span class="normal">4968</span>
<span class="normal">4969</span>
<span class="normal">4970</span>
<span class="normal">4971</span>
<span class="normal">4972</span>
<span class="normal">4973</span>
<span class="normal">4974</span>
<span class="normal">4975</span>
<span class="normal">4976</span>
<span class="normal">4977</span>
<span class="normal">4978</span>
<span class="normal">4979</span>
<span class="normal">4980</span>
<span class="normal">4981</span>
<span class="normal">4982</span>
<span class="normal">4983</span>
<span class="normal">4984</span>
<span class="normal">4985</span>
<span class="normal">4986</span>
<span class="normal">4987</span>
<span class="normal">4988</span>
<span class="normal">4989</span>
<span class="normal">4990</span>
<span class="normal">4991</span>
<span class="normal">4992</span>
<span class="normal">4993</span>
<span class="normal">4994</span>
<span class="normal">4995</span>
<span class="normal">4996</span>
<span class="normal">4997</span>
<span class="normal">4998</span>
<span class="normal">4999</span>
<span class="normal">5000</span>
<span class="normal">5001</span>
<span class="normal">5002</span>
<span class="normal">5003</span>
<span class="normal">5004</span>
<span class="normal">5005</span>
<span class="normal">5006</span>
<span class="normal">5007</span>
<span class="normal">5008</span>
<span class="normal">5009</span>
<span class="normal">5010</span>
<span class="normal">5011</span>
<span class="normal">5012</span>
<span class="normal">5013</span>
<span class="normal">5014</span>
<span class="normal">5015</span>
<span class="normal">5016</span>
<span class="normal">5017</span>
<span class="normal">5018</span>
<span class="normal">5019</span>
<span class="normal">5020</span>
<span class="normal">5021</span>
<span class="normal">5022</span>
<span class="normal">5023</span>
<span class="normal">5024</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseResource</span><span class="p">(</span><span class="n">Page</span><span class="p">,</span> <span class="n">AbstractResource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine mezzanine Page model and AbstractResource model to establish base resource.&quot;&quot;&quot;</span>

    <span class="n">resource_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;GenericResource&quot;</span><span class="p">)</span>
    <span class="c1"># this locked_time field is added for resource versioning locking representing</span>
    <span class="c1"># the time when the resource is locked for a new version action. A value of null</span>
    <span class="c1"># means the resource is not locked</span>
    <span class="n">locked_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">PublishedManager</span><span class="p">()</span>
    <span class="n">public_resources</span> <span class="o">=</span> <span class="n">PublicResourceManager</span><span class="p">()</span>
    <span class="n">discoverable_resources</span> <span class="o">=</span> <span class="n">DiscoverableResourceManager</span><span class="p">()</span>

    <span class="n">collections</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s1">&#39;BaseResource&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;resources&#39;</span><span class="p">)</span>

    <span class="c1"># used during discovery as well as in all other places in UI where resource type is displayed</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Generic&#39;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for BaseResource model.&quot;&quot;&quot;</span>

        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Generic&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;hs_core_genericresource&#39;</span>

    <span class="k">def</span> <span class="nf">can_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass through to abstract resource can_add function.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">AbstractResource</span><span class="o">.</span><span class="n">can_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">can_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass through to abstract resource can_add function.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">AbstractResource</span><span class="o">.</span><span class="n">can_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">can_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass through to abstract resource can_delete function.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">AbstractResource</span><span class="o">.</span><span class="n">can_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">can_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass through to abstract resource can_view function.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">AbstractResource</span><span class="o">.</span><span class="n">can_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_s3_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return S3Storage.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">S3Storage</span><span class="p">()</span>

    <span class="c1"># Paths relative to the resource</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the root folder of the S3 structure containing resource files.</span>

<span class="sd">        Note that this folder doesn&#39;t directly contain the resource files;</span>
<span class="sd">        They are contained in ./data/contents/* instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the file path of the resource.</span>

<span class="sd">        This is the root path plus &quot;data/contents&quot;.</span>
<span class="sd">        This is the root of the folder structure for resource files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;contents&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scimeta_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; path to science metadata file (in S3) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resourcemetadata.xml&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resmap_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; path to resource map file (in S3) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;resourcemap.xml&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bag_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the unique S3 path to the bag for the resource.</span>

<span class="sd">        Since this is a cache, it is stored in a different place than the resource files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bagit_path</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;HS_BAGIT_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;bags&#39;</span><span class="p">)</span>
        <span class="n">bagit_postfix</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;HS_BAGIT_POSTFIX&#39;</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bagit_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_id</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">bagit_postfix</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bag_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get bag url of resource data bag.&quot;&quot;&quot;</span>
        <span class="n">bagit_path</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;HS_BAGIT_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;bags&#39;</span><span class="p">)</span>
        <span class="n">bagit_postfix</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;HS_BAGIT_POSTFIX&#39;</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">)</span>
        <span class="n">bag_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{path}</span><span class="s2">/</span><span class="si">{resource_id}</span><span class="s2">.</span><span class="si">{postfix}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">bagit_path</span><span class="p">,</span>
                                                           <span class="n">resource_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span>
                                                           <span class="n">postfix</span><span class="o">=</span><span class="n">bagit_postfix</span><span class="p">)</span>
        <span class="n">reverse_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;django_s3_download&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">bag_path</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">reverse_url</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bag_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get checksum of resource bag. Currently only published resources have bag checksums computed and saved</span>
<span class="sd">        :return: checksum if bag checksum exists; empty string &#39;&#39; otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extra_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_data</span>
        <span class="k">if</span> <span class="s1">&#39;bag_checksum&#39;</span> <span class="ow">in</span> <span class="n">extra_data</span> <span class="ow">and</span> <span class="n">extra_data</span><span class="p">[</span><span class="s1">&#39;bag_checksum&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">extra_data</span><span class="p">[</span><span class="s1">&#39;bag_checksum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="nd">@bag_checksum</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">bag_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checksum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set bag checksum implemented as a property setter.</span>
<span class="sd">        :param checksum: checksum value to be set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">checksum</span><span class="p">:</span>
            <span class="n">extra_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_data</span>
            <span class="n">extra_data</span><span class="p">[</span><span class="s1">&#39;bag_checksum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">checksum</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extra_data</span> <span class="o">=</span> <span class="n">extra_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;checksum to set on the bag of the resource </span><span class="si">{}</span><span class="s2"> is empty&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="p">))</span>

    <span class="c1"># URIs relative to resource</span>
    <span class="c1"># these are independent of federation strategy</span>
    <span class="c1"># TODO: utilize &quot;reverse&quot; abstraction to tie this to urls.py for robustness</span>

    <span class="c1"># add these one by one to avoid errors.</span>

    <span class="c1"># @property</span>
    <span class="c1"># def root_uri(self):</span>
    <span class="c1">#     pass</span>

    <span class="c1"># @property</span>
    <span class="c1"># def scimeta_uri(self):</span>
    <span class="c1">#     return os.path.join(self.root_uri, &#39;scimeta&#39;)</span>

    <span class="c1"># @property</span>
    <span class="c1"># def sysmeta_uri(self):</span>
    <span class="c1">#     return os.path.join(self.root_uri, &#39;sysmeta&#39;)</span>

    <span class="c1"># @property</span>
    <span class="c1"># def file_uri(self):</span>
    <span class="c1">#     return os.path.join(self.root_uri, &#39;files&#39;)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">parse_creator_name</span><span class="p">(</span><span class="n">creator</span><span class="p">):</span>
        <span class="n">creator_name</span> <span class="o">=</span> <span class="n">creator</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">HumanName</span><span class="p">(</span><span class="n">creator_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">first</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">last</span><span class="p">:</span>
            <span class="n">name_parts</span> <span class="o">=</span> <span class="n">creator_name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">first</span> <span class="ow">and</span> <span class="n">name_parts</span><span class="p">:</span>
                <span class="n">name</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">last</span> <span class="ow">and</span> <span class="n">name_parts</span><span class="p">:</span>
                <span class="n">name</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">last</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_contributor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">contributor_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">contributor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">contributors</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">contributor</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_creator_name</span><span class="p">(</span><span class="n">contributor</span><span class="p">)</span>
                <span class="n">contributor_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">contributor</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="s2">&quot;Personal&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;givenName&quot;</span><span class="p">:</span> <span class="n">first_name</span><span class="p">,</span>
                    <span class="s2">&quot;familyName&quot;</span><span class="p">:</span> <span class="n">last_name</span><span class="p">,</span>
                    <span class="s2">&quot;contributorType&quot;</span><span class="p">:</span> <span class="s2">&quot;Other&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;affiliation&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">contributor</span><span class="o">.</span><span class="n">organization</span> <span class="ow">or</span> <span class="s2">&quot;CUAHSI&quot;</span><span class="p">}],</span>
                    <span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">:</span> <span class="p">[]</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">contributor</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">:</span>
                    <span class="n">contributor_data</span><span class="p">[</span><span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;nameIdentifier&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;https://hydroshare.org</span><span class="si">{</span><span class="n">contributor</span><span class="o">.</span><span class="n">relative_uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nameIdentifierScheme&quot;</span><span class="p">:</span> <span class="s2">&quot;Other&quot;</span><span class="p">,</span>
                    <span class="p">})</span>
                <span class="k">if</span> <span class="n">contributor</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ORCID&#39;</span><span class="p">):</span>
                    <span class="n">contributor_data</span><span class="p">[</span><span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;nameIdentifier&quot;</span><span class="p">:</span> <span class="n">contributor</span><span class="o">.</span><span class="n">identifiers</span><span class="p">[</span><span class="s1">&#39;ORCID&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;nameIdentifierScheme&quot;</span><span class="p">:</span> <span class="s2">&quot;ORCID&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;schemeUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://orcid.org&quot;</span>
                    <span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">contributor_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">contributor</span><span class="o">.</span><span class="n">organization</span> <span class="ow">or</span> <span class="s2">&quot;CUAHSI&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="s2">&quot;Organizational&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;contributorType&quot;</span><span class="p">:</span> <span class="s2">&quot;Other&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">:</span> <span class="p">[]</span>
                <span class="p">}</span>

            <span class="n">contributor_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contributor_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">contributor_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_funding_references</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build fundingReferences list for the DataCite JSON payload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">funding_references</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">get_funder_id</span><span class="p">(</span><span class="n">funder_name</span><span class="p">):</span>
            <span class="n">funder_name_lower</span> <span class="o">=</span> <span class="n">funder_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">encoded_funder_name</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">funder_name_lower</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.ror.org/v2/organizations?filter=types:funder&amp;query=</span><span class="si">{</span><span class="n">encoded_funder_name</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="n">items</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[])</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">funder_name_lower</span><span class="p">:</span>
                                <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get funder ID for &#39;</span><span class="si">{</span><span class="n">funder_name</span><span class="si">}</span><span class="s2">&#39;. Status: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching funder ID for &#39;</span><span class="si">{</span><span class="n">funder_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">for</span> <span class="n">funder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">funding_agencies</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">funder_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;funderName&quot;</span><span class="p">:</span> <span class="n">funder</span><span class="o">.</span><span class="n">agency_name</span>
            <span class="p">}</span>

            <span class="n">funder_id</span> <span class="o">=</span> <span class="n">get_funder_id</span><span class="p">(</span><span class="n">funder</span><span class="o">.</span><span class="n">agency_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">funder_id</span><span class="p">:</span>
                <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;funderIdentifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funder_id</span>
                <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;funderIdentifierType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ROR&quot;</span>
            <span class="k">elif</span> <span class="n">funder</span><span class="o">.</span><span class="n">agency_url</span><span class="p">:</span>
                <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;funderIdentifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funder</span><span class="o">.</span><span class="n">agency_url</span>
                <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;funderIdentifierType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Other&quot;</span>

            <span class="k">if</span> <span class="n">funder</span><span class="o">.</span><span class="n">award_number</span><span class="p">:</span>
                <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;awardNumber&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funder</span><span class="o">.</span><span class="n">award_number</span>
            <span class="k">if</span> <span class="n">funder</span><span class="o">.</span><span class="n">award_title</span><span class="p">:</span>
                <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;awardTitle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funder</span><span class="o">.</span><span class="n">award_title</span>

            <span class="n">funding_references</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">funder_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">funding_references</span>

    <span class="k">def</span> <span class="nf">get_related_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns two lists:</span>
<span class="sd">        - relatedIdentifiers: list of dictionaries for relatedIdentifiers</span>
<span class="sd">        - relatedItems: list of dictionaries for relatedItems</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">VALID_RELATION_TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isPartOf</span><span class="p">:</span> <span class="s2">&quot;IsPartOf&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">hasPart</span><span class="p">:</span> <span class="s2">&quot;HasPart&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isExecutedBy</span><span class="p">:</span> <span class="s2">&quot;IsSupplementedBy&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isCreatedBy</span><span class="p">:</span> <span class="s2">&quot;IsDocumentedBy&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isVersionOf</span><span class="p">:</span> <span class="s2">&quot;IsVersionOf&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReplacedBy</span><span class="p">:</span> <span class="s2">&quot;IsNewVersionOf&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isDescribedBy</span><span class="p">:</span> <span class="s2">&quot;IsDescribedBy&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">conformsTo</span><span class="p">:</span> <span class="s2">&quot;References&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">hasFormat</span><span class="p">:</span> <span class="s2">&quot;HasPart&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isFormatOf</span><span class="p">:</span> <span class="s2">&quot;IsPartOf&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isRequiredBy</span><span class="p">:</span> <span class="s2">&quot;IsRequiredBy&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span> <span class="s2">&quot;Requires&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReferencedBy</span><span class="p">:</span> <span class="s2">&quot;IsReferencedBy&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">references</span><span class="p">:</span> <span class="s2">&quot;References&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">replaces</span><span class="p">:</span> <span class="s2">&quot;Replaces&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">source</span><span class="p">:</span> <span class="s2">&quot;IsDerivedFrom&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isSimilarTo</span><span class="p">:</span> <span class="s2">&quot;IsIdenticalTo&quot;</span><span class="p">,</span>
            <span class="n">RelationTypes</span><span class="o">.</span><span class="n">relation</span><span class="p">:</span> <span class="s2">&quot;References&quot;</span>
        <span class="p">}</span>

        <span class="n">RESOURCE_TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;CompositeResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CollectionResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Collection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ToolResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Software&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ModelProgramResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Software&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ModelInstanceResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Model&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GenericResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TimeSeriesResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GeographicFeatureResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GeographicRasterResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MultidimensionalResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ScriptResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Software&quot;</span><span class="p">,</span>
            <span class="s2">&quot;WebAppResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Service&quot;</span>
        <span class="p">}</span>

        <span class="n">related_identifiers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">related_items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(https?://\S+|10\.\d{4,9}/\S+)&#39;</span><span class="p">,</span> <span class="n">relation</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">identifier_value</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="n">relation</span><span class="o">.</span><span class="n">value</span>
            <span class="n">identifier_type</span> <span class="o">=</span> <span class="s2">&quot;URL&quot;</span> <span class="k">if</span> <span class="n">identifier_value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;DOI&quot;</span>

            <span class="n">relation_type</span> <span class="o">=</span> <span class="n">VALID_RELATION_TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">relation</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

            <span class="n">related_identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;relatedIdentifier&quot;</span><span class="p">:</span> <span class="n">identifier_value</span><span class="p">,</span>
                <span class="s2">&quot;relatedIdentifierType&quot;</span><span class="p">:</span> <span class="n">identifier_type</span><span class="p">,</span>
                <span class="s2">&quot;relationType&quot;</span><span class="p">:</span> <span class="n">relation_type</span>
            <span class="p">})</span>

            <span class="n">related_items</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;relatedItemType&quot;</span><span class="p">:</span> <span class="n">RESOURCE_TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span><span class="p">,</span> <span class="s2">&quot;Other&quot;</span><span class="p">),</span>
                <span class="s2">&quot;relationType&quot;</span><span class="p">:</span> <span class="n">relation_type</span><span class="p">,</span>
                <span class="s2">&quot;relatedItemIdentifier&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;relatedItemIdentifierType&quot;</span><span class="p">:</span> <span class="n">identifier_type</span><span class="p">,</span>
                    <span class="s2">&quot;relatedItemIdentifier&quot;</span><span class="p">:</span> <span class="n">identifier_value</span>
                <span class="p">}</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">related_identifiers</span><span class="p">,</span> <span class="n">related_items</span>

    <span class="k">def</span> <span class="nf">get_dates_for_doi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of date dictionaries formatted for the DOI creation payload,</span>
<span class="sd">        handling both temporal coverage and metadata dates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">date_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="s1">&#39;Created&#39;</span><span class="p">,</span>
            <span class="s1">&#39;modified&#39;</span><span class="p">:</span> <span class="s1">&#39;Updated&#39;</span><span class="p">,</span>
            <span class="s1">&#39;published&#39;</span><span class="p">:</span> <span class="s1">&#39;Accepted&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Handling temporal coverage date</span>
        <span class="n">temporal_dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">coverages</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;period&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">temporal_dates</span> <span class="ow">and</span> <span class="n">temporal_dates</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">temporal_dates</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">):</span>
            <span class="c1"># Format temporal coverage date as a range</span>
            <span class="n">coverage_date</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temporal_dates</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">temporal_dates</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dateType&quot;</span><span class="p">:</span> <span class="s2">&quot;Coverage&quot;</span>
            <span class="p">}</span>
            <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coverage_date</span><span class="p">)</span>

        <span class="c1"># Handling individual metadata dates</span>
        <span class="n">metadata_dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">metadata_dates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">date_mapping</span><span class="p">:</span>
                <span class="c1"># Mapping the date types (created, modified, published)</span>
                <span class="n">mapped_date</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;dateType&quot;</span><span class="p">:</span> <span class="n">date_mapping</span><span class="p">[</span><span class="n">date</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_date</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dates</span>

    <span class="k">def</span> <span class="nf">get_datacite_deposit_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return JSON payload for creating a DOI with DataCite API.</span>
<span class="sd">        Conforms to DataCite REST API for DOI creation: https://support.datacite.org/reference/post_dois</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No title found for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">creators</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No creators found for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">abstract</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No abstract found for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">. Using empty string.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;obj&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;abstract&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})()</span>

        <span class="c1"># Add &quot;test&quot; to the suffix if in test mode</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;hs.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">-test&quot;</span> <span class="k">if</span> <span class="n">test_mode</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;hs.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">doi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">DATACITE_PREFIX</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;dois&quot;</span><span class="p">,</span>
                <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="n">doi</span><span class="p">,</span>
                    <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">DATACITE_PREFIX</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;suffix&quot;</span><span class="p">:</span> <span class="n">suffix</span><span class="p">,</span>  <span class="c1"># Use modified suffix</span>
                    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;publish&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;creators&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;titles&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">}],</span>
                    <span class="s2">&quot;publisher&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Consortium of Universities for the Advancement of Hydrologic Science, Inc&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;publisherIdentifier&quot;</span><span class="p">:</span> <span class="s2">&quot;https://ror.org/04s2bx355&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;publisherIdentifierScheme&quot;</span><span class="p">:</span> <span class="s2">&quot;ROR&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;schemeUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://ror.org&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;publicationYear&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;subjects&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;contributors&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;identifiers&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;dates&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;resourceTypeGeneral&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;resourceType&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span><span class="p">,</span>
                        <span class="s2">&quot;schemaOrg&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;bibtex&quot;</span><span class="p">:</span> <span class="s2">&quot;misc&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;citeproc&quot;</span><span class="p">:</span> <span class="s2">&quot;dataset&quot;</span>
                    <span class="p">},</span>
                    <span class="c1"># &quot;relatedIdentifiers&quot;: [],</span>
                    <span class="s2">&quot;relatedItems&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;sizes&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;formats&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;rightsList&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;descriptions&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;geoLocations&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;fundingReferences&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;container&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DataRepository&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;identifier&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.hydroshare.org&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;identifierType&quot;</span><span class="p">:</span> <span class="s2">&quot;URL&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;HydroShare Resources&quot;</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;contentUrl&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bag_url</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;bag_url&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bag_url</span> <span class="k">else</span> <span class="p">[],</span>
                    <span class="s2">&quot;schemaVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;http://datacite.org/schema/kernel-4&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;findable&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;repositories&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">DATACITE_USERNAME</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">pub_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;published&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;publicationYear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">pub_date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span> <span class="k">if</span> <span class="n">pub_date</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>

        <span class="n">hs_identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;hydroShareIdentifier&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hs_identifier</span><span class="p">:</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hs_identifier</span><span class="o">.</span><span class="n">url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No hydroShareIdentifier found for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">creators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">creators</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">first_creator</span> <span class="o">=</span> <span class="p">[</span><span class="n">cr</span> <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="n">creators</span> <span class="k">if</span> <span class="n">cr</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">other_creators</span> <span class="o">=</span> <span class="p">[</span><span class="n">cr</span> <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="n">creators</span> <span class="k">if</span> <span class="n">cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">creator</span> <span class="ow">in</span> <span class="p">[</span><span class="n">first_creator</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">other_creators</span> <span class="k">if</span> <span class="n">first_creator</span> <span class="k">else</span> <span class="n">creators</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">creator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_creator_name</span><span class="p">(</span><span class="n">creator</span><span class="p">)</span>
                <span class="n">creator_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="s2">&quot;Personal&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;givenName&quot;</span><span class="p">:</span> <span class="n">first_name</span><span class="p">,</span>
                    <span class="s2">&quot;familyName&quot;</span><span class="p">:</span> <span class="n">last_name</span><span class="p">,</span>
                    <span class="s2">&quot;affiliation&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="o">.</span><span class="n">organization</span> <span class="ow">or</span> <span class="s2">&quot;CUAHSI&quot;</span><span class="p">}],</span>
                    <span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">:</span> <span class="p">[]</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">creator</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">:</span>
                    <span class="n">creator_data</span><span class="p">[</span><span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;nameIdentifier&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;https://hydroshare.org</span><span class="si">{</span><span class="n">creator</span><span class="o">.</span><span class="n">relative_uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;nameIdentifierScheme&quot;</span><span class="p">:</span> <span class="s2">&quot;Other&quot;</span><span class="p">,</span>
                    <span class="p">})</span>
                <span class="k">if</span> <span class="n">creator</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ORCID&#39;</span><span class="p">):</span>
                    <span class="n">creator_data</span><span class="p">[</span><span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;nameIdentifier&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="o">.</span><span class="n">identifiers</span><span class="p">[</span><span class="s1">&#39;ORCID&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;nameIdentifierScheme&quot;</span><span class="p">:</span> <span class="s2">&quot;ORCID&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;schemeUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://orcid.org&quot;</span>
                    <span class="p">})</span>
                <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;creators&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">creator_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">creator_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="o">.</span><span class="n">organization</span> <span class="ow">or</span> <span class="s2">&quot;CUAHSI&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="s2">&quot;Organizational&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">:</span> <span class="p">[]</span>
                <span class="p">}</span>
                <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;creators&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">creator_data</span><span class="p">)</span>

        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;contributors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contributor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subjects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;subjects&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="n">subject</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dates_for_doi</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">abstract</span><span class="p">:</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;descriptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">abstract</span><span class="p">,</span>
                    <span class="s2">&quot;descriptionType&quot;</span><span class="p">:</span> <span class="s2">&quot;Abstract&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">rights</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">rights</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="n">rights_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;rights&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">rights</span><span class="o">.</span><span class="n">statement</span><span class="p">[:</span><span class="mi">2000</span><span class="p">],</span>
                <span class="s2">&quot;rightsUri&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">rights</span><span class="o">.</span><span class="n">url</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">pub_date</span><span class="p">:</span>
                <span class="n">rights_data</span><span class="p">[</span><span class="s2">&quot;rightsUriStartDate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pub_date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;rightsList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rights_data</span><span class="p">]</span>

        <span class="n">related_identifiers</span><span class="p">,</span> <span class="n">related_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_related_items</span><span class="p">()</span>
        <span class="c1"># payload[&quot;data&quot;][&quot;attributes&quot;][&quot;relatedIdentifiers&quot;] = related_identifiers</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;relatedItems&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">related_items</span>

        <span class="k">for</span> <span class="n">coverage</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">coverages</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">coverage</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
                <span class="n">box_values</span> <span class="o">=</span> <span class="n">coverage</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">box_values</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;westlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;eastlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;southlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;northlimit&#39;</span><span class="p">)):</span>
                    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;geoLocations&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;geoLocationBox&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;westBoundLongitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">box_values</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">]),</span>
                            <span class="s2">&quot;eastBoundLongitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">box_values</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">]),</span>
                            <span class="s2">&quot;southBoundLatitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">box_values</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">]),</span>
                            <span class="s2">&quot;northBoundLatitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">box_values</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">])</span>
                        <span class="p">}</span>
                    <span class="p">})</span>
            <span class="k">elif</span> <span class="n">coverage</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                <span class="n">point_values</span> <span class="o">=</span> <span class="n">coverage</span><span class="o">.</span><span class="n">value</span>
                <span class="n">longitude</span> <span class="o">=</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">))</span>
                <span class="n">latitude</span> <span class="o">=</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">geo_location</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;geoLocationPoint&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;pointLongitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">longitude</span><span class="p">),</span>
                            <span class="s2">&quot;pointLatitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
                        <span class="n">geo_location</span><span class="p">[</span><span class="s2">&quot;geoLocationPlace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

                    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;geoLocations&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geo_location</span><span class="p">)</span>

        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;fundingReferences&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_funding_references</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">format_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">formats</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;formats&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_obj</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">all_identifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">all_identifiers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">identifier</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
                <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;identifiers&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;identifier&quot;</span><span class="p">:</span> <span class="n">identifier</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                    <span class="s2">&quot;identifierType&quot;</span><span class="p">:</span> <span class="n">identifier</span><span class="o">.</span><span class="n">name</span>
                <span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;alternateIdentifiers&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;alternateIdentifier&quot;</span><span class="p">:</span> <span class="n">identifier</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                    <span class="s2">&quot;alternateIdentifierType&quot;</span><span class="p">:</span> <span class="n">identifier</span><span class="o">.</span><span class="n">name</span>
                <span class="p">})</span>

        <span class="c1"># if self.metadata.citation and hasattr(self.metadata.citation, &#39;value&#39;):</span>
        <span class="c1">#     payload[&quot;data&quot;][&quot;attributes&quot;][&quot;identifiers&quot;].append({</span>
        <span class="c1">#         &quot;alternateIdentifier&quot;: self.metadata.citation.value,</span>
        <span class="c1">#         &quot;alternateIdentifierType&quot;: &quot;Citation&quot;</span>
        <span class="c1">#     })</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;sizes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the total size of all data files in S3.</span>

<span class="sd">        This size does not include metadata. Just files. Specifically,</span>
<span class="sd">        resourcemetadata.xml, systemmetadata.xml are not included in this</span>
<span class="sd">        size estimate.</span>

<span class="sd">        Raises SessionException if S3 fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># trigger file size read for files that haven&#39;t been set yet</span>
        <span class="n">res_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">_size__lt</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">calculate_size</span><span class="p">()</span>
            <span class="c1"># compute the total file size for the resource</span>
            <span class="n">res_size_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">Sum</span><span class="p">(</span><span class="s1">&#39;_size&#39;</span><span class="p">))</span>
            <span class="n">res_size</span> <span class="o">=</span> <span class="n">res_size_dict</span><span class="p">[</span><span class="s1">&#39;_size__sum&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">res_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">verbose_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return verbose name of content_model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_model</span><span class="p">()</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">discovery_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return name used for the content type in discovery/solr search.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_model</span><span class="p">()</span><span class="o">.</span><span class="n">display_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">can_be_submitted_for_metadata_review</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine when data and metadata are complete enough for the resource to be published.</span>

<span class="sd">        The property can be overriden by specific resource type which is not appropriate for</span>
<span class="sd">        publication such as the Web App resource</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_be_public_or_discoverable</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_supported_upload_file_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get supported upload types for a resource.</span>

<span class="sd">        This can be overridden to choose which types of file can be uploaded by a subclass.</span>

<span class="sd">        By default, all file types are supported</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: this should be replaced by an instance method.</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;.*&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">can_have_multiple_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if multiple files can be uploaded.</span>

<span class="sd">        This can be overridden to choose how many files can be uploaded by a subclass.</span>

<span class="sd">        By default, uploads are not limited.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: this should be replaced by an instance method.</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">can_have_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the resource supports files at all.</span>

<span class="sd">        This can be overridden to choose whether files can be uploaded by a subclass.</span>

<span class="sd">        By default, uploads are allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: this should be replaced by an instance method.</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_hs_term_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dict of HS Terms and their values.</span>

<span class="sd">        Will be used to parse webapp url templates</span>

<span class="sd">        NOTES FOR ANY SUBCLASS OF THIS CLASS TO OVERRIDE THIS FUNCTION:</span>
<span class="sd">        resource types that inherit this class should add/merge their resource-specific HS Terms</span>
<span class="sd">        into this dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hs_term_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">hs_term_dict</span><span class="p">[</span><span class="s2">&quot;HS_RES_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_id</span>
        <span class="n">hs_term_dict</span><span class="p">[</span><span class="s2">&quot;HS_RES_TYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span>
        <span class="n">hs_term_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">hs_term_dict</span>

    <span class="k">def</span> <span class="nf">replaced_by</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; return a list or resources that replaced this one &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">hs_core.hydroshare</span> <span class="kn">import</span> <span class="n">get_resource_by_shortkey</span>

        <span class="n">replaced_by_resources</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">get_replaced_by</span><span class="p">(</span><span class="n">resource</span><span class="p">):</span>
            <span class="n">replace_relation_meta</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReplacedBy</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">replace_relation_meta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">version_citation</span> <span class="o">=</span> <span class="n">replace_relation_meta</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="s1">&#39;/resource/&#39;</span> <span class="ow">in</span> <span class="n">version_citation</span><span class="p">:</span>
                    <span class="n">version_res_id</span> <span class="o">=</span> <span class="n">version_citation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/resource/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">new_version_res</span> <span class="o">=</span> <span class="n">get_resource_by_shortkey</span><span class="p">(</span><span class="n">version_res_id</span><span class="p">,</span> <span class="n">or_404</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">replaced_by_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_version_res</span><span class="p">)</span>
                        <span class="n">get_replaced_by</span><span class="p">(</span><span class="n">new_version_res</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="n">get_replaced_by</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">replaced_by_resources</span>

    <span class="k">def</span> <span class="nf">get_relation_version_res_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the resource url from resource citation stored in relation metadata for resource</span>
<span class="sd">        versioning</span>
<span class="sd">        :param rel_type: type of relation (allowed types are: &#39;isVersionOf&#39; and &#39;isReplacedBy&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">relation_meta_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">rel_type</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">relation_meta_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get the resource url from resource citation</span>
            <span class="n">version_res_url</span> <span class="o">=</span> <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">version_res_url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spam_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Compile a single regular expression that will match any individual</span>
        <span class="c1"># pattern from a given list of patterns, case-insensitive.</span>
        <span class="c1"># ( &#39;|&#39; is a special character in regular expressions. An expression</span>
        <span class="c1"># &#39;A|B&#39; will match either &#39;A&#39; or &#39;B&#39; ).</span>
        <span class="n">full_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">patterns</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">match</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># no title</span>
                <span class="k">pass</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subjects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">match</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># no keywords</span>
                <span class="k">pass</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">abstract</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">match</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># no abstract</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">show_in_discover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return True if a resource should be exhibited</span>
<span class="sd">        A resource should be exhibited if it is at least discoverable</span>
<span class="sd">        and not replaced by anything that exists and is at least discoverable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># not exhibitable</span>

        <span class="n">replaced_by_resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaced_by</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">res</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">discoverable</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">replaced_by_resources</span><span class="p">]):</span>
            <span class="c1"># there is a newer discoverable resource - so this resource should not be shown in discover</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">spam_allowlisted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spam_patterns</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">update_relation_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the citation stored in relation metadata for relation type</span>
<span class="sd">        &#39;isReplacedBy&#39;, &#39;isPartOf&#39; and &#39;hasPart&#39; if needed&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">hs_core.hydroshare</span> <span class="kn">import</span> <span class="n">get_resource_by_shortkey</span>

        <span class="k">def</span> <span class="nf">_update_relation_meta</span><span class="p">(</span><span class="n">relation_meta_obj</span><span class="p">):</span>
            <span class="n">relation_updated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="s1">&#39;/resource/&#39;</span> <span class="ow">in</span> <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">version_citation</span> <span class="o">=</span> <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span>
                <span class="n">version_res_id</span> <span class="o">=</span> <span class="n">version_citation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/resource/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">version_res</span> <span class="o">=</span> <span class="n">get_resource_by_shortkey</span><span class="p">(</span><span class="n">version_res_id</span><span class="p">,</span> <span class="n">or_404</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                    <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                    <span class="n">relation_updated</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">return</span> <span class="n">relation_updated</span>
                <span class="n">current_version_citation</span> <span class="o">=</span> <span class="n">version_res</span><span class="o">.</span><span class="n">get_citation</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">current_version_citation</span> <span class="o">!=</span> <span class="n">version_citation</span><span class="p">:</span>
                    <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">current_version_citation</span>
                    <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="n">relation_updated</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">relation_updated</span>

        <span class="n">relations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">replace_relation</span> <span class="o">=</span> <span class="p">[</span><span class="n">rel</span> <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">relations</span> <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReplacedBy</span><span class="p">]</span>
        <span class="n">replace_relation_updated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">replace_relation</span><span class="p">:</span>
            <span class="n">replace_relation</span> <span class="o">=</span> <span class="n">replace_relation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">replace_relation_updated</span> <span class="o">=</span> <span class="n">_update_relation_meta</span><span class="p">(</span><span class="n">replace_relation</span><span class="p">)</span>

        <span class="n">part_of_relation_updated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">part_of_relation</span> <span class="ow">in</span> <span class="p">[</span><span class="n">rel</span> <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">relations</span> <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isPartOf</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">_update_relation_meta</span><span class="p">(</span><span class="n">part_of_relation</span><span class="p">):</span>
                <span class="n">part_of_relation_updated</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">has_part_relation_updated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">has_part_relation</span> <span class="ow">in</span> <span class="p">[</span><span class="n">rel</span> <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">relations</span> <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">hasPart</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">_update_relation_meta</span><span class="p">(</span><span class="n">has_part_relation</span><span class="p">):</span>
                <span class="n">has_part_relation_updated</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">replace_relation_updated</span><span class="p">,</span> <span class="n">part_of_relation_updated</span><span class="p">,</span> <span class="n">has_part_relation_updated</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAVU</span><span class="p">(</span><span class="s2">&quot;bag_modified&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAVU</span><span class="p">(</span><span class="s2">&quot;metadata_dirty&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cached_metadata&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_non_preferred_path_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of file/folder paths that do not meet hydroshare file/folder preferred naming convention&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">find_non_preferred_folder_paths</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dir_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
                <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>

            <span class="n">folders</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">istorage</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">folder</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">not_preferred_paths</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">check_for_preferred_name</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
                    <span class="n">folder_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                    <span class="n">folder_path</span> <span class="o">=</span> <span class="n">folder_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                    <span class="n">not_preferred_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
                <span class="n">subdir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="n">find_non_preferred_folder_paths</span><span class="p">(</span><span class="n">subdir_path</span><span class="p">)</span>

        <span class="n">not_preferred_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="c1"># check for non-conforming file names</span>
        <span class="k">for</span> <span class="n">res_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">short_path</span> <span class="o">=</span> <span class="n">res_file</span><span class="o">.</span><span class="n">short_path</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">short_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">check_for_preferred_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
                <span class="n">not_preferred_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">short_path</span><span class="p">)</span>

        <span class="c1"># check for non-conforming folder names</span>
        <span class="n">find_non_preferred_folder_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">not_preferred_paths</span>

    <span class="k">def</span> <span class="nf">get_relative_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dir_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">dir_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">dir_path</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.bag_checksum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bag_checksum</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>get checksum of resource bag. Currently only published resources have bag checksums computed and saved
:return: checksum if bag checksum exists; empty string '' otherwise</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.bag_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bag_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the unique S3 path to the bag for the resource.</p>
<p>Since this is a cache, it is stored in a different place than the resource files.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.bag_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bag_url</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get bag url of resource data bag.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.can_be_submitted_for_metadata_review" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_be_submitted_for_metadata_review</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Determine when data and metadata are complete enough for the resource to be published.</p>
<p>The property can be overriden by specific resource type which is not appropriate for
publication such as the Web App resource
:return:</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.discovery_content_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">discovery_content_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return name used for the content type in discovery/solr search.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.file_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">file_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the file path of the resource.</p>
<p>This is the root path plus "data/contents".
This is the root of the folder structure for resource files.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.resmap_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resmap_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>path to resource map file (in S3)</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.root_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">root_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the root folder of the S3 structure containing resource files.</p>
<p>Note that this folder doesn't directly contain the resource files;
They are contained in ./data/contents/* instead.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.scimeta_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scimeta_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>path to science metadata file (in S3)</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.show_in_discover" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_in_discover</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>return True if a resource should be exhibited
A resource should be exhibited if it is at least discoverable
and not replaced by anything that exists and is at least discoverable.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">size</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the total size of all data files in S3.</p>
<p>This size does not include metadata. Just files. Specifically,
resourcemetadata.xml, systemmetadata.xml are not included in this
size estimate.</p>
<p>Raises SessionException if S3 fails.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.BaseResource.verbose_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">verbose_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return verbose name of content_model.</p>

    </div>

</div>



<div class="doc doc-object doc-class">



<h3 id="hs_core.models.BaseResource.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for BaseResource model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4215</span>
<span class="normal">4216</span>
<span class="normal">4217</span>
<span class="normal">4218</span>
<span class="normal">4219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for BaseResource model.&quot;&quot;&quot;</span>

    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Generic&#39;</span>
    <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;hs_core_genericresource&#39;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.can_add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_add</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pass through to abstract resource can_add function.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4221</span>
<span class="normal">4222</span>
<span class="normal">4223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through to abstract resource can_add function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">AbstractResource</span><span class="o">.</span><span class="n">can_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.can_change" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_change</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pass through to abstract resource can_add function.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4225</span>
<span class="normal">4226</span>
<span class="normal">4227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through to abstract resource can_add function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">AbstractResource</span><span class="o">.</span><span class="n">can_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.can_delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_delete</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pass through to abstract resource can_delete function.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4229</span>
<span class="normal">4230</span>
<span class="normal">4231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through to abstract resource can_delete function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">AbstractResource</span><span class="o">.</span><span class="n">can_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.can_have_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_have_files</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return whether the resource supports files at all.</p>
<p>This can be overridden to choose whether files can be uploaded by a subclass.</p>
<p>By default, uploads are allowed.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4826</span>
<span class="normal">4827</span>
<span class="normal">4828</span>
<span class="normal">4829</span>
<span class="normal">4830</span>
<span class="normal">4831</span>
<span class="normal">4832</span>
<span class="normal">4833</span>
<span class="normal">4834</span>
<span class="normal">4835</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">can_have_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return whether the resource supports files at all.</span>

<span class="sd">    This can be overridden to choose whether files can be uploaded by a subclass.</span>

<span class="sd">    By default, uploads are allowed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: this should be replaced by an instance method.</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.can_have_multiple_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_have_multiple_files</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return True if multiple files can be uploaded.</p>
<p>This can be overridden to choose how many files can be uploaded by a subclass.</p>
<p>By default, uploads are not limited.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4815</span>
<span class="normal">4816</span>
<span class="normal">4817</span>
<span class="normal">4818</span>
<span class="normal">4819</span>
<span class="normal">4820</span>
<span class="normal">4821</span>
<span class="normal">4822</span>
<span class="normal">4823</span>
<span class="normal">4824</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">can_have_multiple_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if multiple files can be uploaded.</span>

<span class="sd">    This can be overridden to choose how many files can be uploaded by a subclass.</span>

<span class="sd">    By default, uploads are not limited.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: this should be replaced by an instance method.</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.can_view" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_view</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pass through to abstract resource can_view function.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4233</span>
<span class="normal">4234</span>
<span class="normal">4235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through to abstract resource can_view function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">AbstractResource</span><span class="o">.</span><span class="n">can_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.get_datacite_deposit_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_datacite_deposit_json</span><span class="p">(</span><span class="n">test_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return JSON payload for creating a DOI with DataCite API.
Conforms to DataCite REST API for DOI creation: https://support.datacite.org/reference/post_dois</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4543</span>
<span class="normal">4544</span>
<span class="normal">4545</span>
<span class="normal">4546</span>
<span class="normal">4547</span>
<span class="normal">4548</span>
<span class="normal">4549</span>
<span class="normal">4550</span>
<span class="normal">4551</span>
<span class="normal">4552</span>
<span class="normal">4553</span>
<span class="normal">4554</span>
<span class="normal">4555</span>
<span class="normal">4556</span>
<span class="normal">4557</span>
<span class="normal">4558</span>
<span class="normal">4559</span>
<span class="normal">4560</span>
<span class="normal">4561</span>
<span class="normal">4562</span>
<span class="normal">4563</span>
<span class="normal">4564</span>
<span class="normal">4565</span>
<span class="normal">4566</span>
<span class="normal">4567</span>
<span class="normal">4568</span>
<span class="normal">4569</span>
<span class="normal">4570</span>
<span class="normal">4571</span>
<span class="normal">4572</span>
<span class="normal">4573</span>
<span class="normal">4574</span>
<span class="normal">4575</span>
<span class="normal">4576</span>
<span class="normal">4577</span>
<span class="normal">4578</span>
<span class="normal">4579</span>
<span class="normal">4580</span>
<span class="normal">4581</span>
<span class="normal">4582</span>
<span class="normal">4583</span>
<span class="normal">4584</span>
<span class="normal">4585</span>
<span class="normal">4586</span>
<span class="normal">4587</span>
<span class="normal">4588</span>
<span class="normal">4589</span>
<span class="normal">4590</span>
<span class="normal">4591</span>
<span class="normal">4592</span>
<span class="normal">4593</span>
<span class="normal">4594</span>
<span class="normal">4595</span>
<span class="normal">4596</span>
<span class="normal">4597</span>
<span class="normal">4598</span>
<span class="normal">4599</span>
<span class="normal">4600</span>
<span class="normal">4601</span>
<span class="normal">4602</span>
<span class="normal">4603</span>
<span class="normal">4604</span>
<span class="normal">4605</span>
<span class="normal">4606</span>
<span class="normal">4607</span>
<span class="normal">4608</span>
<span class="normal">4609</span>
<span class="normal">4610</span>
<span class="normal">4611</span>
<span class="normal">4612</span>
<span class="normal">4613</span>
<span class="normal">4614</span>
<span class="normal">4615</span>
<span class="normal">4616</span>
<span class="normal">4617</span>
<span class="normal">4618</span>
<span class="normal">4619</span>
<span class="normal">4620</span>
<span class="normal">4621</span>
<span class="normal">4622</span>
<span class="normal">4623</span>
<span class="normal">4624</span>
<span class="normal">4625</span>
<span class="normal">4626</span>
<span class="normal">4627</span>
<span class="normal">4628</span>
<span class="normal">4629</span>
<span class="normal">4630</span>
<span class="normal">4631</span>
<span class="normal">4632</span>
<span class="normal">4633</span>
<span class="normal">4634</span>
<span class="normal">4635</span>
<span class="normal">4636</span>
<span class="normal">4637</span>
<span class="normal">4638</span>
<span class="normal">4639</span>
<span class="normal">4640</span>
<span class="normal">4641</span>
<span class="normal">4642</span>
<span class="normal">4643</span>
<span class="normal">4644</span>
<span class="normal">4645</span>
<span class="normal">4646</span>
<span class="normal">4647</span>
<span class="normal">4648</span>
<span class="normal">4649</span>
<span class="normal">4650</span>
<span class="normal">4651</span>
<span class="normal">4652</span>
<span class="normal">4653</span>
<span class="normal">4654</span>
<span class="normal">4655</span>
<span class="normal">4656</span>
<span class="normal">4657</span>
<span class="normal">4658</span>
<span class="normal">4659</span>
<span class="normal">4660</span>
<span class="normal">4661</span>
<span class="normal">4662</span>
<span class="normal">4663</span>
<span class="normal">4664</span>
<span class="normal">4665</span>
<span class="normal">4666</span>
<span class="normal">4667</span>
<span class="normal">4668</span>
<span class="normal">4669</span>
<span class="normal">4670</span>
<span class="normal">4671</span>
<span class="normal">4672</span>
<span class="normal">4673</span>
<span class="normal">4674</span>
<span class="normal">4675</span>
<span class="normal">4676</span>
<span class="normal">4677</span>
<span class="normal">4678</span>
<span class="normal">4679</span>
<span class="normal">4680</span>
<span class="normal">4681</span>
<span class="normal">4682</span>
<span class="normal">4683</span>
<span class="normal">4684</span>
<span class="normal">4685</span>
<span class="normal">4686</span>
<span class="normal">4687</span>
<span class="normal">4688</span>
<span class="normal">4689</span>
<span class="normal">4690</span>
<span class="normal">4691</span>
<span class="normal">4692</span>
<span class="normal">4693</span>
<span class="normal">4694</span>
<span class="normal">4695</span>
<span class="normal">4696</span>
<span class="normal">4697</span>
<span class="normal">4698</span>
<span class="normal">4699</span>
<span class="normal">4700</span>
<span class="normal">4701</span>
<span class="normal">4702</span>
<span class="normal">4703</span>
<span class="normal">4704</span>
<span class="normal">4705</span>
<span class="normal">4706</span>
<span class="normal">4707</span>
<span class="normal">4708</span>
<span class="normal">4709</span>
<span class="normal">4710</span>
<span class="normal">4711</span>
<span class="normal">4712</span>
<span class="normal">4713</span>
<span class="normal">4714</span>
<span class="normal">4715</span>
<span class="normal">4716</span>
<span class="normal">4717</span>
<span class="normal">4718</span>
<span class="normal">4719</span>
<span class="normal">4720</span>
<span class="normal">4721</span>
<span class="normal">4722</span>
<span class="normal">4723</span>
<span class="normal">4724</span>
<span class="normal">4725</span>
<span class="normal">4726</span>
<span class="normal">4727</span>
<span class="normal">4728</span>
<span class="normal">4729</span>
<span class="normal">4730</span>
<span class="normal">4731</span>
<span class="normal">4732</span>
<span class="normal">4733</span>
<span class="normal">4734</span>
<span class="normal">4735</span>
<span class="normal">4736</span>
<span class="normal">4737</span>
<span class="normal">4738</span>
<span class="normal">4739</span>
<span class="normal">4740</span>
<span class="normal">4741</span>
<span class="normal">4742</span>
<span class="normal">4743</span>
<span class="normal">4744</span>
<span class="normal">4745</span>
<span class="normal">4746</span>
<span class="normal">4747</span>
<span class="normal">4748</span>
<span class="normal">4749</span>
<span class="normal">4750</span>
<span class="normal">4751</span>
<span class="normal">4752</span>
<span class="normal">4753</span>
<span class="normal">4754</span>
<span class="normal">4755</span>
<span class="normal">4756</span>
<span class="normal">4757</span>
<span class="normal">4758</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_datacite_deposit_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return JSON payload for creating a DOI with DataCite API.</span>
<span class="sd">    Conforms to DataCite REST API for DOI creation: https://support.datacite.org/reference/post_dois</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No title found for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">creators</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No creators found for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">abstract</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No abstract found for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">. Using empty string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;obj&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;abstract&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})()</span>

    <span class="c1"># Add &quot;test&quot; to the suffix if in test mode</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;hs.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">-test&quot;</span> <span class="k">if</span> <span class="n">test_mode</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;hs.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">doi</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">DATACITE_PREFIX</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;dois&quot;</span><span class="p">,</span>
            <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="n">doi</span><span class="p">,</span>
                <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">DATACITE_PREFIX</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;suffix&quot;</span><span class="p">:</span> <span class="n">suffix</span><span class="p">,</span>  <span class="c1"># Use modified suffix</span>
                <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;publish&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;creators&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;titles&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">}],</span>
                <span class="s2">&quot;publisher&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Consortium of Universities for the Advancement of Hydrologic Science, Inc&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;publisherIdentifier&quot;</span><span class="p">:</span> <span class="s2">&quot;https://ror.org/04s2bx355&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;publisherIdentifierScheme&quot;</span><span class="p">:</span> <span class="s2">&quot;ROR&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;schemeUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://ror.org&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;publicationYear&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;subjects&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;contributors&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;identifiers&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;dates&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
                <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;resourceTypeGeneral&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;resourceType&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span><span class="p">,</span>
                    <span class="s2">&quot;schemaOrg&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;bibtex&quot;</span><span class="p">:</span> <span class="s2">&quot;misc&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;citeproc&quot;</span><span class="p">:</span> <span class="s2">&quot;dataset&quot;</span>
                <span class="p">},</span>
                <span class="c1"># &quot;relatedIdentifiers&quot;: [],</span>
                <span class="s2">&quot;relatedItems&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;sizes&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;formats&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;rightsList&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;descriptions&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;geoLocations&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;fundingReferences&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;container&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DataRepository&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;identifier&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.hydroshare.org&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;identifierType&quot;</span><span class="p">:</span> <span class="s2">&quot;URL&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;HydroShare Resources&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;contentUrl&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bag_url</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;bag_url&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bag_url</span> <span class="k">else</span> <span class="p">[],</span>
                <span class="s2">&quot;schemaVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;http://datacite.org/schema/kernel-4&quot;</span><span class="p">,</span>
                <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;findable&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;repositories&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">DATACITE_USERNAME</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">pub_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;published&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;publicationYear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">pub_date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span> <span class="k">if</span> <span class="n">pub_date</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>

    <span class="n">hs_identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;hydroShareIdentifier&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">hs_identifier</span><span class="p">:</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hs_identifier</span><span class="o">.</span><span class="n">url</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No hydroShareIdentifier found for resource </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">short_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">creators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">creators</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">first_creator</span> <span class="o">=</span> <span class="p">[</span><span class="n">cr</span> <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="n">creators</span> <span class="k">if</span> <span class="n">cr</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">other_creators</span> <span class="o">=</span> <span class="p">[</span><span class="n">cr</span> <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="n">creators</span> <span class="k">if</span> <span class="n">cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">creator</span> <span class="ow">in</span> <span class="p">[</span><span class="n">first_creator</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">other_creators</span> <span class="k">if</span> <span class="n">first_creator</span> <span class="k">else</span> <span class="n">creators</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">creator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_creator_name</span><span class="p">(</span><span class="n">creator</span><span class="p">)</span>
            <span class="n">creator_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="s2">&quot;Personal&quot;</span><span class="p">,</span>
                <span class="s2">&quot;givenName&quot;</span><span class="p">:</span> <span class="n">first_name</span><span class="p">,</span>
                <span class="s2">&quot;familyName&quot;</span><span class="p">:</span> <span class="n">last_name</span><span class="p">,</span>
                <span class="s2">&quot;affiliation&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="o">.</span><span class="n">organization</span> <span class="ow">or</span> <span class="s2">&quot;CUAHSI&quot;</span><span class="p">}],</span>
                <span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">creator</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">:</span>
                <span class="n">creator_data</span><span class="p">[</span><span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;nameIdentifier&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;https://hydroshare.org</span><span class="si">{</span><span class="n">creator</span><span class="o">.</span><span class="n">relative_uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;nameIdentifierScheme&quot;</span><span class="p">:</span> <span class="s2">&quot;Other&quot;</span><span class="p">,</span>
                <span class="p">})</span>
            <span class="k">if</span> <span class="n">creator</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ORCID&#39;</span><span class="p">):</span>
                <span class="n">creator_data</span><span class="p">[</span><span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;nameIdentifier&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="o">.</span><span class="n">identifiers</span><span class="p">[</span><span class="s1">&#39;ORCID&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;nameIdentifierScheme&quot;</span><span class="p">:</span> <span class="s2">&quot;ORCID&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;schemeUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://orcid.org&quot;</span>
                <span class="p">})</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;creators&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">creator_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">creator_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="o">.</span><span class="n">organization</span> <span class="ow">or</span> <span class="s2">&quot;CUAHSI&quot;</span><span class="p">,</span>
                <span class="s2">&quot;nameType&quot;</span><span class="p">:</span> <span class="s2">&quot;Organizational&quot;</span><span class="p">,</span>
                <span class="s2">&quot;nameIdentifiers&quot;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;creators&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">creator_data</span><span class="p">)</span>

    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;contributors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contributor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">subjects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;subjects&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="n">subject</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">})</span>

    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dates_for_doi</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">abstract</span><span class="p">:</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;descriptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">abstract</span><span class="p">,</span>
                <span class="s2">&quot;descriptionType&quot;</span><span class="p">:</span> <span class="s2">&quot;Abstract&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">rights</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">rights</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
        <span class="n">rights_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rights&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">rights</span><span class="o">.</span><span class="n">statement</span><span class="p">[:</span><span class="mi">2000</span><span class="p">],</span>
            <span class="s2">&quot;rightsUri&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">rights</span><span class="o">.</span><span class="n">url</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">pub_date</span><span class="p">:</span>
            <span class="n">rights_data</span><span class="p">[</span><span class="s2">&quot;rightsUriStartDate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pub_date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;rightsList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rights_data</span><span class="p">]</span>

    <span class="n">related_identifiers</span><span class="p">,</span> <span class="n">related_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_related_items</span><span class="p">()</span>
    <span class="c1"># payload[&quot;data&quot;][&quot;attributes&quot;][&quot;relatedIdentifiers&quot;] = related_identifiers</span>
    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;relatedItems&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">related_items</span>

    <span class="k">for</span> <span class="n">coverage</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">coverages</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">coverage</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="n">box_values</span> <span class="o">=</span> <span class="n">coverage</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">box_values</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;westlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;eastlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;southlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;northlimit&#39;</span><span class="p">)):</span>
                <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;geoLocations&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;geoLocationBox&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;westBoundLongitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">box_values</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">]),</span>
                        <span class="s2">&quot;eastBoundLongitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">box_values</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">]),</span>
                        <span class="s2">&quot;southBoundLatitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">box_values</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">]),</span>
                        <span class="s2">&quot;northBoundLatitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">box_values</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">])</span>
                    <span class="p">}</span>
                <span class="p">})</span>
        <span class="k">elif</span> <span class="n">coverage</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
            <span class="n">point_values</span> <span class="o">=</span> <span class="n">coverage</span><span class="o">.</span><span class="n">value</span>
            <span class="n">longitude</span> <span class="o">=</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">))</span>
            <span class="n">latitude</span> <span class="o">=</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">geo_location</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;geoLocationPoint&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;pointLongitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">longitude</span><span class="p">),</span>
                        <span class="s2">&quot;pointLatitude&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">point_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
                    <span class="n">geo_location</span><span class="p">[</span><span class="s2">&quot;geoLocationPlace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_values</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

                <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;geoLocations&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geo_location</span><span class="p">)</span>

    <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;fundingReferences&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_funding_references</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">format_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">formats</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;formats&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_obj</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">all_identifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">all_identifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">identifier</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;identifiers&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;identifier&quot;</span><span class="p">:</span> <span class="n">identifier</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;identifierType&quot;</span><span class="p">:</span> <span class="n">identifier</span><span class="o">.</span><span class="n">name</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;alternateIdentifiers&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;alternateIdentifier&quot;</span><span class="p">:</span> <span class="n">identifier</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;alternateIdentifierType&quot;</span><span class="p">:</span> <span class="n">identifier</span><span class="o">.</span><span class="n">name</span>
            <span class="p">})</span>

    <span class="c1"># if self.metadata.citation and hasattr(self.metadata.citation, &#39;value&#39;):</span>
    <span class="c1">#     payload[&quot;data&quot;][&quot;attributes&quot;][&quot;identifiers&quot;].append({</span>
    <span class="c1">#         &quot;alternateIdentifier&quot;: self.metadata.citation.value,</span>
    <span class="c1">#         &quot;alternateIdentifierType&quot;: &quot;Citation&quot;</span>
    <span class="c1">#     })</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;sizes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.get_dates_for_doi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dates_for_doi</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a list of date dictionaries formatted for the DOI creation payload,
handling both temporal coverage and metadata dates.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4509</span>
<span class="normal">4510</span>
<span class="normal">4511</span>
<span class="normal">4512</span>
<span class="normal">4513</span>
<span class="normal">4514</span>
<span class="normal">4515</span>
<span class="normal">4516</span>
<span class="normal">4517</span>
<span class="normal">4518</span>
<span class="normal">4519</span>
<span class="normal">4520</span>
<span class="normal">4521</span>
<span class="normal">4522</span>
<span class="normal">4523</span>
<span class="normal">4524</span>
<span class="normal">4525</span>
<span class="normal">4526</span>
<span class="normal">4527</span>
<span class="normal">4528</span>
<span class="normal">4529</span>
<span class="normal">4530</span>
<span class="normal">4531</span>
<span class="normal">4532</span>
<span class="normal">4533</span>
<span class="normal">4534</span>
<span class="normal">4535</span>
<span class="normal">4536</span>
<span class="normal">4537</span>
<span class="normal">4538</span>
<span class="normal">4539</span>
<span class="normal">4540</span>
<span class="normal">4541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_dates_for_doi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of date dictionaries formatted for the DOI creation payload,</span>
<span class="sd">    handling both temporal coverage and metadata dates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="s1">&#39;Created&#39;</span><span class="p">,</span>
        <span class="s1">&#39;modified&#39;</span><span class="p">:</span> <span class="s1">&#39;Updated&#39;</span><span class="p">,</span>
        <span class="s1">&#39;published&#39;</span><span class="p">:</span> <span class="s1">&#39;Accepted&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Handling temporal coverage date</span>
    <span class="n">temporal_dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">coverages</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;period&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">temporal_dates</span> <span class="ow">and</span> <span class="n">temporal_dates</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">temporal_dates</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">):</span>
        <span class="c1"># Format temporal coverage date as a range</span>
        <span class="n">coverage_date</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temporal_dates</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">temporal_dates</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dateType&quot;</span><span class="p">:</span> <span class="s2">&quot;Coverage&quot;</span>
        <span class="p">}</span>
        <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coverage_date</span><span class="p">)</span>

    <span class="c1"># Handling individual metadata dates</span>
    <span class="n">metadata_dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">metadata_dates</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">date_mapping</span><span class="p">:</span>
            <span class="c1"># Mapping the date types (created, modified, published)</span>
            <span class="n">mapped_date</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
                <span class="s2">&quot;dateType&quot;</span><span class="p">:</span> <span class="n">date_mapping</span><span class="p">[</span><span class="n">date</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_date</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.get_funding_references" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_funding_references</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Build fundingReferences list for the DataCite JSON payload.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4390</span>
<span class="normal">4391</span>
<span class="normal">4392</span>
<span class="normal">4393</span>
<span class="normal">4394</span>
<span class="normal">4395</span>
<span class="normal">4396</span>
<span class="normal">4397</span>
<span class="normal">4398</span>
<span class="normal">4399</span>
<span class="normal">4400</span>
<span class="normal">4401</span>
<span class="normal">4402</span>
<span class="normal">4403</span>
<span class="normal">4404</span>
<span class="normal">4405</span>
<span class="normal">4406</span>
<span class="normal">4407</span>
<span class="normal">4408</span>
<span class="normal">4409</span>
<span class="normal">4410</span>
<span class="normal">4411</span>
<span class="normal">4412</span>
<span class="normal">4413</span>
<span class="normal">4414</span>
<span class="normal">4415</span>
<span class="normal">4416</span>
<span class="normal">4417</span>
<span class="normal">4418</span>
<span class="normal">4419</span>
<span class="normal">4420</span>
<span class="normal">4421</span>
<span class="normal">4422</span>
<span class="normal">4423</span>
<span class="normal">4424</span>
<span class="normal">4425</span>
<span class="normal">4426</span>
<span class="normal">4427</span>
<span class="normal">4428</span>
<span class="normal">4429</span>
<span class="normal">4430</span>
<span class="normal">4431</span>
<span class="normal">4432</span>
<span class="normal">4433</span>
<span class="normal">4434</span>
<span class="normal">4435</span>
<span class="normal">4436</span>
<span class="normal">4437</span>
<span class="normal">4438</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_funding_references</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build fundingReferences list for the DataCite JSON payload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">funding_references</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_funder_id</span><span class="p">(</span><span class="n">funder_name</span><span class="p">):</span>
        <span class="n">funder_name_lower</span> <span class="o">=</span> <span class="n">funder_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">encoded_funder_name</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">funder_name_lower</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.ror.org/v2/organizations?filter=types:funder&amp;query=</span><span class="si">{</span><span class="n">encoded_funder_name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">funder_name_lower</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get funder ID for &#39;</span><span class="si">{</span><span class="n">funder_name</span><span class="si">}</span><span class="s2">&#39;. Status: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching funder ID for &#39;</span><span class="si">{</span><span class="n">funder_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">funder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">funding_agencies</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">funder_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;funderName&quot;</span><span class="p">:</span> <span class="n">funder</span><span class="o">.</span><span class="n">agency_name</span>
        <span class="p">}</span>

        <span class="n">funder_id</span> <span class="o">=</span> <span class="n">get_funder_id</span><span class="p">(</span><span class="n">funder</span><span class="o">.</span><span class="n">agency_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">funder_id</span><span class="p">:</span>
            <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;funderIdentifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funder_id</span>
            <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;funderIdentifierType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ROR&quot;</span>
        <span class="k">elif</span> <span class="n">funder</span><span class="o">.</span><span class="n">agency_url</span><span class="p">:</span>
            <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;funderIdentifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funder</span><span class="o">.</span><span class="n">agency_url</span>
            <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;funderIdentifierType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Other&quot;</span>

        <span class="k">if</span> <span class="n">funder</span><span class="o">.</span><span class="n">award_number</span><span class="p">:</span>
            <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;awardNumber&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funder</span><span class="o">.</span><span class="n">award_number</span>
        <span class="k">if</span> <span class="n">funder</span><span class="o">.</span><span class="n">award_title</span><span class="p">:</span>
            <span class="n">funder_data</span><span class="p">[</span><span class="s2">&quot;awardTitle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">funder</span><span class="o">.</span><span class="n">award_title</span>

        <span class="n">funding_references</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">funder_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">funding_references</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.get_hs_term_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_hs_term_dict</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a dict of HS Terms and their values.</p>
<p>Will be used to parse webapp url templates</p>
<p>NOTES FOR ANY SUBCLASS OF THIS CLASS TO OVERRIDE THIS FUNCTION:
resource types that inherit this class should add/merge their resource-specific HS Terms
into this dict</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4837</span>
<span class="normal">4838</span>
<span class="normal">4839</span>
<span class="normal">4840</span>
<span class="normal">4841</span>
<span class="normal">4842</span>
<span class="normal">4843</span>
<span class="normal">4844</span>
<span class="normal">4845</span>
<span class="normal">4846</span>
<span class="normal">4847</span>
<span class="normal">4848</span>
<span class="normal">4849</span>
<span class="normal">4850</span>
<span class="normal">4851</span>
<span class="normal">4852</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_hs_term_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a dict of HS Terms and their values.</span>

<span class="sd">    Will be used to parse webapp url templates</span>

<span class="sd">    NOTES FOR ANY SUBCLASS OF THIS CLASS TO OVERRIDE THIS FUNCTION:</span>
<span class="sd">    resource types that inherit this class should add/merge their resource-specific HS Terms</span>
<span class="sd">    into this dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hs_term_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">hs_term_dict</span><span class="p">[</span><span class="s2">&quot;HS_RES_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_id</span>
    <span class="n">hs_term_dict</span><span class="p">[</span><span class="s2">&quot;HS_RES_TYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span>
    <span class="n">hs_term_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">hs_term_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.get_non_preferred_path_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_non_preferred_path_names</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a list of file/folder paths that do not meet hydroshare file/folder preferred naming convention</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4992</span>
<span class="normal">4993</span>
<span class="normal">4994</span>
<span class="normal">4995</span>
<span class="normal">4996</span>
<span class="normal">4997</span>
<span class="normal">4998</span>
<span class="normal">4999</span>
<span class="normal">5000</span>
<span class="normal">5001</span>
<span class="normal">5002</span>
<span class="normal">5003</span>
<span class="normal">5004</span>
<span class="normal">5005</span>
<span class="normal">5006</span>
<span class="normal">5007</span>
<span class="normal">5008</span>
<span class="normal">5009</span>
<span class="normal">5010</span>
<span class="normal">5011</span>
<span class="normal">5012</span>
<span class="normal">5013</span>
<span class="normal">5014</span>
<span class="normal">5015</span>
<span class="normal">5016</span>
<span class="normal">5017</span>
<span class="normal">5018</span>
<span class="normal">5019</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_non_preferred_path_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of file/folder paths that do not meet hydroshare file/folder preferred naming convention&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">find_non_preferred_folder_paths</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dir_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>

        <span class="n">folders</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">istorage</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">folder</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">not_preferred_paths</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">check_for_preferred_name</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
                <span class="n">folder_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="n">folder_path</span> <span class="o">=</span> <span class="n">folder_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="n">not_preferred_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
            <span class="n">subdir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
            <span class="n">find_non_preferred_folder_paths</span><span class="p">(</span><span class="n">subdir_path</span><span class="p">)</span>

    <span class="n">not_preferred_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
    <span class="c1"># check for non-conforming file names</span>
    <span class="k">for</span> <span class="n">res_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">short_path</span> <span class="o">=</span> <span class="n">res_file</span><span class="o">.</span><span class="n">short_path</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">short_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">check_for_preferred_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="n">not_preferred_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">short_path</span><span class="p">)</span>

    <span class="c1"># check for non-conforming folder names</span>
    <span class="n">find_non_preferred_folder_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">not_preferred_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.get_related_items" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_related_items</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns two lists:
- relatedIdentifiers: list of dictionaries for relatedIdentifiers
- relatedItems: list of dictionaries for relatedItems</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4440</span>
<span class="normal">4441</span>
<span class="normal">4442</span>
<span class="normal">4443</span>
<span class="normal">4444</span>
<span class="normal">4445</span>
<span class="normal">4446</span>
<span class="normal">4447</span>
<span class="normal">4448</span>
<span class="normal">4449</span>
<span class="normal">4450</span>
<span class="normal">4451</span>
<span class="normal">4452</span>
<span class="normal">4453</span>
<span class="normal">4454</span>
<span class="normal">4455</span>
<span class="normal">4456</span>
<span class="normal">4457</span>
<span class="normal">4458</span>
<span class="normal">4459</span>
<span class="normal">4460</span>
<span class="normal">4461</span>
<span class="normal">4462</span>
<span class="normal">4463</span>
<span class="normal">4464</span>
<span class="normal">4465</span>
<span class="normal">4466</span>
<span class="normal">4467</span>
<span class="normal">4468</span>
<span class="normal">4469</span>
<span class="normal">4470</span>
<span class="normal">4471</span>
<span class="normal">4472</span>
<span class="normal">4473</span>
<span class="normal">4474</span>
<span class="normal">4475</span>
<span class="normal">4476</span>
<span class="normal">4477</span>
<span class="normal">4478</span>
<span class="normal">4479</span>
<span class="normal">4480</span>
<span class="normal">4481</span>
<span class="normal">4482</span>
<span class="normal">4483</span>
<span class="normal">4484</span>
<span class="normal">4485</span>
<span class="normal">4486</span>
<span class="normal">4487</span>
<span class="normal">4488</span>
<span class="normal">4489</span>
<span class="normal">4490</span>
<span class="normal">4491</span>
<span class="normal">4492</span>
<span class="normal">4493</span>
<span class="normal">4494</span>
<span class="normal">4495</span>
<span class="normal">4496</span>
<span class="normal">4497</span>
<span class="normal">4498</span>
<span class="normal">4499</span>
<span class="normal">4500</span>
<span class="normal">4501</span>
<span class="normal">4502</span>
<span class="normal">4503</span>
<span class="normal">4504</span>
<span class="normal">4505</span>
<span class="normal">4506</span>
<span class="normal">4507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_related_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns two lists:</span>
<span class="sd">    - relatedIdentifiers: list of dictionaries for relatedIdentifiers</span>
<span class="sd">    - relatedItems: list of dictionaries for relatedItems</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">VALID_RELATION_TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isPartOf</span><span class="p">:</span> <span class="s2">&quot;IsPartOf&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">hasPart</span><span class="p">:</span> <span class="s2">&quot;HasPart&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isExecutedBy</span><span class="p">:</span> <span class="s2">&quot;IsSupplementedBy&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isCreatedBy</span><span class="p">:</span> <span class="s2">&quot;IsDocumentedBy&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isVersionOf</span><span class="p">:</span> <span class="s2">&quot;IsVersionOf&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReplacedBy</span><span class="p">:</span> <span class="s2">&quot;IsNewVersionOf&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isDescribedBy</span><span class="p">:</span> <span class="s2">&quot;IsDescribedBy&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">conformsTo</span><span class="p">:</span> <span class="s2">&quot;References&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">hasFormat</span><span class="p">:</span> <span class="s2">&quot;HasPart&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isFormatOf</span><span class="p">:</span> <span class="s2">&quot;IsPartOf&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isRequiredBy</span><span class="p">:</span> <span class="s2">&quot;IsRequiredBy&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span> <span class="s2">&quot;Requires&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReferencedBy</span><span class="p">:</span> <span class="s2">&quot;IsReferencedBy&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">references</span><span class="p">:</span> <span class="s2">&quot;References&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">replaces</span><span class="p">:</span> <span class="s2">&quot;Replaces&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">source</span><span class="p">:</span> <span class="s2">&quot;IsDerivedFrom&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isSimilarTo</span><span class="p">:</span> <span class="s2">&quot;IsIdenticalTo&quot;</span><span class="p">,</span>
        <span class="n">RelationTypes</span><span class="o">.</span><span class="n">relation</span><span class="p">:</span> <span class="s2">&quot;References&quot;</span>
    <span class="p">}</span>

    <span class="n">RESOURCE_TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;CompositeResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CollectionResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Collection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ToolResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Software&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ModelProgramResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Software&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ModelInstanceResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Model&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GenericResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TimeSeriesResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GeographicFeatureResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GeographicRasterResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MultidimensionalResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ScriptResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Software&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WebAppResource&quot;</span><span class="p">:</span> <span class="s2">&quot;Service&quot;</span>
    <span class="p">}</span>

    <span class="n">related_identifiers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">related_items</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(https?://\S+|10\.\d{4,9}/\S+)&#39;</span><span class="p">,</span> <span class="n">relation</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">identifier_value</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="n">relation</span><span class="o">.</span><span class="n">value</span>
        <span class="n">identifier_type</span> <span class="o">=</span> <span class="s2">&quot;URL&quot;</span> <span class="k">if</span> <span class="n">identifier_value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;DOI&quot;</span>

        <span class="n">relation_type</span> <span class="o">=</span> <span class="n">VALID_RELATION_TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">relation</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

        <span class="n">related_identifiers</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;relatedIdentifier&quot;</span><span class="p">:</span> <span class="n">identifier_value</span><span class="p">,</span>
            <span class="s2">&quot;relatedIdentifierType&quot;</span><span class="p">:</span> <span class="n">identifier_type</span><span class="p">,</span>
            <span class="s2">&quot;relationType&quot;</span><span class="p">:</span> <span class="n">relation_type</span>
        <span class="p">})</span>

        <span class="n">related_items</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;relatedItemType&quot;</span><span class="p">:</span> <span class="n">RESOURCE_TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span><span class="p">,</span> <span class="s2">&quot;Other&quot;</span><span class="p">),</span>
            <span class="s2">&quot;relationType&quot;</span><span class="p">:</span> <span class="n">relation_type</span><span class="p">,</span>
            <span class="s2">&quot;relatedItemIdentifier&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;relatedItemIdentifierType&quot;</span><span class="p">:</span> <span class="n">identifier_type</span><span class="p">,</span>
                <span class="s2">&quot;relatedItemIdentifier&quot;</span><span class="p">:</span> <span class="n">identifier_value</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">related_identifiers</span><span class="p">,</span> <span class="n">related_items</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.get_relation_version_res_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_relation_version_res_url</span><span class="p">(</span><span class="n">rel_type</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extracts the resource url from resource citation stored in relation metadata for resource
versioning
:param rel_type: type of relation (allowed types are: 'isVersionOf' and 'isReplacedBy')</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4876</span>
<span class="normal">4877</span>
<span class="normal">4878</span>
<span class="normal">4879</span>
<span class="normal">4880</span>
<span class="normal">4881</span>
<span class="normal">4882</span>
<span class="normal">4883</span>
<span class="normal">4884</span>
<span class="normal">4885</span>
<span class="normal">4886</span>
<span class="normal">4887</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_relation_version_res_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts the resource url from resource citation stored in relation metadata for resource</span>
<span class="sd">    versioning</span>
<span class="sd">    :param rel_type: type of relation (allowed types are: &#39;isVersionOf&#39; and &#39;isReplacedBy&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">relation_meta_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">rel_type</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">relation_meta_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># get the resource url from resource citation</span>
        <span class="n">version_res_url</span> <span class="o">=</span> <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">version_res_url</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.get_s3_storage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_s3_storage</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return S3Storage.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4237</span>
<span class="normal">4238</span>
<span class="normal">4239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_s3_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return S3Storage.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">S3Storage</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.get_supported_upload_file_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_supported_upload_file_types</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get supported upload types for a resource.</p>
<p>This can be overridden to choose which types of file can be uploaded by a subclass.</p>
<p>By default, all file types are supported</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4804</span>
<span class="normal">4805</span>
<span class="normal">4806</span>
<span class="normal">4807</span>
<span class="normal">4808</span>
<span class="normal">4809</span>
<span class="normal">4810</span>
<span class="normal">4811</span>
<span class="normal">4812</span>
<span class="normal">4813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_supported_upload_file_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get supported upload types for a resource.</span>

<span class="sd">    This can be overridden to choose which types of file can be uploaded by a subclass.</span>

<span class="sd">    By default, all file types are supported</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: this should be replaced by an instance method.</span>
    <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.replaced_by" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">replaced_by</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>return a list or resources that replaced this one</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4854</span>
<span class="normal">4855</span>
<span class="normal">4856</span>
<span class="normal">4857</span>
<span class="normal">4858</span>
<span class="normal">4859</span>
<span class="normal">4860</span>
<span class="normal">4861</span>
<span class="normal">4862</span>
<span class="normal">4863</span>
<span class="normal">4864</span>
<span class="normal">4865</span>
<span class="normal">4866</span>
<span class="normal">4867</span>
<span class="normal">4868</span>
<span class="normal">4869</span>
<span class="normal">4870</span>
<span class="normal">4871</span>
<span class="normal">4872</span>
<span class="normal">4873</span>
<span class="normal">4874</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">replaced_by</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; return a list or resources that replaced this one &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">hs_core.hydroshare</span> <span class="kn">import</span> <span class="n">get_resource_by_shortkey</span>

    <span class="n">replaced_by_resources</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_replaced_by</span><span class="p">(</span><span class="n">resource</span><span class="p">):</span>
        <span class="n">replace_relation_meta</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReplacedBy</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">replace_relation_meta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version_citation</span> <span class="o">=</span> <span class="n">replace_relation_meta</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="s1">&#39;/resource/&#39;</span> <span class="ow">in</span> <span class="n">version_citation</span><span class="p">:</span>
                <span class="n">version_res_id</span> <span class="o">=</span> <span class="n">version_citation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/resource/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new_version_res</span> <span class="o">=</span> <span class="n">get_resource_by_shortkey</span><span class="p">(</span><span class="n">version_res_id</span><span class="p">,</span> <span class="n">or_404</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">replaced_by_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_version_res</span><span class="p">)</span>
                    <span class="n">get_replaced_by</span><span class="p">(</span><span class="n">new_version_res</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                    <span class="k">pass</span>

    <span class="n">get_replaced_by</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">replaced_by_resources</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.BaseResource.update_relation_meta" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_relation_meta</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Updates the citation stored in relation metadata for relation type
'isReplacedBy', 'isPartOf' and 'hasPart' if needed</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4946</span>
<span class="normal">4947</span>
<span class="normal">4948</span>
<span class="normal">4949</span>
<span class="normal">4950</span>
<span class="normal">4951</span>
<span class="normal">4952</span>
<span class="normal">4953</span>
<span class="normal">4954</span>
<span class="normal">4955</span>
<span class="normal">4956</span>
<span class="normal">4957</span>
<span class="normal">4958</span>
<span class="normal">4959</span>
<span class="normal">4960</span>
<span class="normal">4961</span>
<span class="normal">4962</span>
<span class="normal">4963</span>
<span class="normal">4964</span>
<span class="normal">4965</span>
<span class="normal">4966</span>
<span class="normal">4967</span>
<span class="normal">4968</span>
<span class="normal">4969</span>
<span class="normal">4970</span>
<span class="normal">4971</span>
<span class="normal">4972</span>
<span class="normal">4973</span>
<span class="normal">4974</span>
<span class="normal">4975</span>
<span class="normal">4976</span>
<span class="normal">4977</span>
<span class="normal">4978</span>
<span class="normal">4979</span>
<span class="normal">4980</span>
<span class="normal">4981</span>
<span class="normal">4982</span>
<span class="normal">4983</span>
<span class="normal">4984</span>
<span class="normal">4985</span>
<span class="normal">4986</span>
<span class="normal">4987</span>
<span class="normal">4988</span>
<span class="normal">4989</span>
<span class="normal">4990</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_relation_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates the citation stored in relation metadata for relation type</span>
<span class="sd">    &#39;isReplacedBy&#39;, &#39;isPartOf&#39; and &#39;hasPart&#39; if needed&quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">hs_core.hydroshare</span> <span class="kn">import</span> <span class="n">get_resource_by_shortkey</span>

    <span class="k">def</span> <span class="nf">_update_relation_meta</span><span class="p">(</span><span class="n">relation_meta_obj</span><span class="p">):</span>
        <span class="n">relation_updated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="s1">&#39;/resource/&#39;</span> <span class="ow">in</span> <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">version_citation</span> <span class="o">=</span> <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span>
            <span class="n">version_res_id</span> <span class="o">=</span> <span class="n">version_citation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/resource/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">version_res</span> <span class="o">=</span> <span class="n">get_resource_by_shortkey</span><span class="p">(</span><span class="n">version_res_id</span><span class="p">,</span> <span class="n">or_404</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                <span class="n">relation_updated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="n">relation_updated</span>
            <span class="n">current_version_citation</span> <span class="o">=</span> <span class="n">version_res</span><span class="o">.</span><span class="n">get_citation</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">current_version_citation</span> <span class="o">!=</span> <span class="n">version_citation</span><span class="p">:</span>
                <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">current_version_citation</span>
                <span class="n">relation_meta_obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="n">relation_updated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">relation_updated</span>

    <span class="n">relations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">replace_relation</span> <span class="o">=</span> <span class="p">[</span><span class="n">rel</span> <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">relations</span> <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReplacedBy</span><span class="p">]</span>
    <span class="n">replace_relation_updated</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">replace_relation</span><span class="p">:</span>
        <span class="n">replace_relation</span> <span class="o">=</span> <span class="n">replace_relation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">replace_relation_updated</span> <span class="o">=</span> <span class="n">_update_relation_meta</span><span class="p">(</span><span class="n">replace_relation</span><span class="p">)</span>

    <span class="n">part_of_relation_updated</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">part_of_relation</span> <span class="ow">in</span> <span class="p">[</span><span class="n">rel</span> <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">relations</span> <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isPartOf</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">_update_relation_meta</span><span class="p">(</span><span class="n">part_of_relation</span><span class="p">):</span>
            <span class="n">part_of_relation_updated</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">has_part_relation_updated</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">has_part_relation</span> <span class="ow">in</span> <span class="p">[</span><span class="n">rel</span> <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">relations</span> <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">hasPart</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">_update_relation_meta</span><span class="p">(</span><span class="n">has_part_relation</span><span class="p">):</span>
            <span class="n">has_part_relation_updated</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">replace_relation_updated</span><span class="p">,</span> <span class="n">part_of_relation_updated</span><span class="p">,</span> <span class="n">has_part_relation_updated</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAVU</span><span class="p">(</span><span class="s2">&quot;bag_modified&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAVU</span><span class="p">(</span><span class="s2">&quot;metadata_dirty&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cached_metadata&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Citation" class="doc doc-heading">
            <code>Citation</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Citation metadata element model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DCTERMS</span><span class="o">.</span><span class="n">bibliographicCitation</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Citation</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Citation metadata element model.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Citation&#39;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return value field for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Citation class.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call parent update function for Citation class.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Citation</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call delete function for Citation class.&quot;&quot;&quot;</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
        <span class="n">element</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
        <span class="n">citation</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">citation</span><span class="p">:</span>
            <span class="n">Citation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">citation</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Citation.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Citation class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Citation class.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Citation.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return value field for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return value field for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Citation.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Call delete function for Citation class.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call delete function for Citation class.&quot;&quot;&quot;</span>
    <span class="n">element</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
    <span class="n">element</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Citation.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Call parent update function for Citation class.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call parent update function for Citation class.&quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Citation</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Contributor" class="doc doc-heading">
            <code>Contributor</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Party (hs_core.models.Party)" href="#hs_core.models.Party">Party</a></code></p>



        <p>Extend Party model with the term of 'Contributor'.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">contributor</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Contributor</span><span class="p">(</span><span class="n">Party</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend Party model with the term of &#39;Contributor&#39;.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Contributor&#39;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.CoreMetaData" class="doc doc-heading">
            <code>CoreMetaData</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.db.models.Model">Model</span></code>, <code><span title="hs_core.hs_rdf.RDF_MetaData_Mixin">RDF_MetaData_Mixin</span></code></p>



        <p>Define CoreMetaData model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5044</span>
<span class="normal">5045</span>
<span class="normal">5046</span>
<span class="normal">5047</span>
<span class="normal">5048</span>
<span class="normal">5049</span>
<span class="normal">5050</span>
<span class="normal">5051</span>
<span class="normal">5052</span>
<span class="normal">5053</span>
<span class="normal">5054</span>
<span class="normal">5055</span>
<span class="normal">5056</span>
<span class="normal">5057</span>
<span class="normal">5058</span>
<span class="normal">5059</span>
<span class="normal">5060</span>
<span class="normal">5061</span>
<span class="normal">5062</span>
<span class="normal">5063</span>
<span class="normal">5064</span>
<span class="normal">5065</span>
<span class="normal">5066</span>
<span class="normal">5067</span>
<span class="normal">5068</span>
<span class="normal">5069</span>
<span class="normal">5070</span>
<span class="normal">5071</span>
<span class="normal">5072</span>
<span class="normal">5073</span>
<span class="normal">5074</span>
<span class="normal">5075</span>
<span class="normal">5076</span>
<span class="normal">5077</span>
<span class="normal">5078</span>
<span class="normal">5079</span>
<span class="normal">5080</span>
<span class="normal">5081</span>
<span class="normal">5082</span>
<span class="normal">5083</span>
<span class="normal">5084</span>
<span class="normal">5085</span>
<span class="normal">5086</span>
<span class="normal">5087</span>
<span class="normal">5088</span>
<span class="normal">5089</span>
<span class="normal">5090</span>
<span class="normal">5091</span>
<span class="normal">5092</span>
<span class="normal">5093</span>
<span class="normal">5094</span>
<span class="normal">5095</span>
<span class="normal">5096</span>
<span class="normal">5097</span>
<span class="normal">5098</span>
<span class="normal">5099</span>
<span class="normal">5100</span>
<span class="normal">5101</span>
<span class="normal">5102</span>
<span class="normal">5103</span>
<span class="normal">5104</span>
<span class="normal">5105</span>
<span class="normal">5106</span>
<span class="normal">5107</span>
<span class="normal">5108</span>
<span class="normal">5109</span>
<span class="normal">5110</span>
<span class="normal">5111</span>
<span class="normal">5112</span>
<span class="normal">5113</span>
<span class="normal">5114</span>
<span class="normal">5115</span>
<span class="normal">5116</span>
<span class="normal">5117</span>
<span class="normal">5118</span>
<span class="normal">5119</span>
<span class="normal">5120</span>
<span class="normal">5121</span>
<span class="normal">5122</span>
<span class="normal">5123</span>
<span class="normal">5124</span>
<span class="normal">5125</span>
<span class="normal">5126</span>
<span class="normal">5127</span>
<span class="normal">5128</span>
<span class="normal">5129</span>
<span class="normal">5130</span>
<span class="normal">5131</span>
<span class="normal">5132</span>
<span class="normal">5133</span>
<span class="normal">5134</span>
<span class="normal">5135</span>
<span class="normal">5136</span>
<span class="normal">5137</span>
<span class="normal">5138</span>
<span class="normal">5139</span>
<span class="normal">5140</span>
<span class="normal">5141</span>
<span class="normal">5142</span>
<span class="normal">5143</span>
<span class="normal">5144</span>
<span class="normal">5145</span>
<span class="normal">5146</span>
<span class="normal">5147</span>
<span class="normal">5148</span>
<span class="normal">5149</span>
<span class="normal">5150</span>
<span class="normal">5151</span>
<span class="normal">5152</span>
<span class="normal">5153</span>
<span class="normal">5154</span>
<span class="normal">5155</span>
<span class="normal">5156</span>
<span class="normal">5157</span>
<span class="normal">5158</span>
<span class="normal">5159</span>
<span class="normal">5160</span>
<span class="normal">5161</span>
<span class="normal">5162</span>
<span class="normal">5163</span>
<span class="normal">5164</span>
<span class="normal">5165</span>
<span class="normal">5166</span>
<span class="normal">5167</span>
<span class="normal">5168</span>
<span class="normal">5169</span>
<span class="normal">5170</span>
<span class="normal">5171</span>
<span class="normal">5172</span>
<span class="normal">5173</span>
<span class="normal">5174</span>
<span class="normal">5175</span>
<span class="normal">5176</span>
<span class="normal">5177</span>
<span class="normal">5178</span>
<span class="normal">5179</span>
<span class="normal">5180</span>
<span class="normal">5181</span>
<span class="normal">5182</span>
<span class="normal">5183</span>
<span class="normal">5184</span>
<span class="normal">5185</span>
<span class="normal">5186</span>
<span class="normal">5187</span>
<span class="normal">5188</span>
<span class="normal">5189</span>
<span class="normal">5190</span>
<span class="normal">5191</span>
<span class="normal">5192</span>
<span class="normal">5193</span>
<span class="normal">5194</span>
<span class="normal">5195</span>
<span class="normal">5196</span>
<span class="normal">5197</span>
<span class="normal">5198</span>
<span class="normal">5199</span>
<span class="normal">5200</span>
<span class="normal">5201</span>
<span class="normal">5202</span>
<span class="normal">5203</span>
<span class="normal">5204</span>
<span class="normal">5205</span>
<span class="normal">5206</span>
<span class="normal">5207</span>
<span class="normal">5208</span>
<span class="normal">5209</span>
<span class="normal">5210</span>
<span class="normal">5211</span>
<span class="normal">5212</span>
<span class="normal">5213</span>
<span class="normal">5214</span>
<span class="normal">5215</span>
<span class="normal">5216</span>
<span class="normal">5217</span>
<span class="normal">5218</span>
<span class="normal">5219</span>
<span class="normal">5220</span>
<span class="normal">5221</span>
<span class="normal">5222</span>
<span class="normal">5223</span>
<span class="normal">5224</span>
<span class="normal">5225</span>
<span class="normal">5226</span>
<span class="normal">5227</span>
<span class="normal">5228</span>
<span class="normal">5229</span>
<span class="normal">5230</span>
<span class="normal">5231</span>
<span class="normal">5232</span>
<span class="normal">5233</span>
<span class="normal">5234</span>
<span class="normal">5235</span>
<span class="normal">5236</span>
<span class="normal">5237</span>
<span class="normal">5238</span>
<span class="normal">5239</span>
<span class="normal">5240</span>
<span class="normal">5241</span>
<span class="normal">5242</span>
<span class="normal">5243</span>
<span class="normal">5244</span>
<span class="normal">5245</span>
<span class="normal">5246</span>
<span class="normal">5247</span>
<span class="normal">5248</span>
<span class="normal">5249</span>
<span class="normal">5250</span>
<span class="normal">5251</span>
<span class="normal">5252</span>
<span class="normal">5253</span>
<span class="normal">5254</span>
<span class="normal">5255</span>
<span class="normal">5256</span>
<span class="normal">5257</span>
<span class="normal">5258</span>
<span class="normal">5259</span>
<span class="normal">5260</span>
<span class="normal">5261</span>
<span class="normal">5262</span>
<span class="normal">5263</span>
<span class="normal">5264</span>
<span class="normal">5265</span>
<span class="normal">5266</span>
<span class="normal">5267</span>
<span class="normal">5268</span>
<span class="normal">5269</span>
<span class="normal">5270</span>
<span class="normal">5271</span>
<span class="normal">5272</span>
<span class="normal">5273</span>
<span class="normal">5274</span>
<span class="normal">5275</span>
<span class="normal">5276</span>
<span class="normal">5277</span>
<span class="normal">5278</span>
<span class="normal">5279</span>
<span class="normal">5280</span>
<span class="normal">5281</span>
<span class="normal">5282</span>
<span class="normal">5283</span>
<span class="normal">5284</span>
<span class="normal">5285</span>
<span class="normal">5286</span>
<span class="normal">5287</span>
<span class="normal">5288</span>
<span class="normal">5289</span>
<span class="normal">5290</span>
<span class="normal">5291</span>
<span class="normal">5292</span>
<span class="normal">5293</span>
<span class="normal">5294</span>
<span class="normal">5295</span>
<span class="normal">5296</span>
<span class="normal">5297</span>
<span class="normal">5298</span>
<span class="normal">5299</span>
<span class="normal">5300</span>
<span class="normal">5301</span>
<span class="normal">5302</span>
<span class="normal">5303</span>
<span class="normal">5304</span>
<span class="normal">5305</span>
<span class="normal">5306</span>
<span class="normal">5307</span>
<span class="normal">5308</span>
<span class="normal">5309</span>
<span class="normal">5310</span>
<span class="normal">5311</span>
<span class="normal">5312</span>
<span class="normal">5313</span>
<span class="normal">5314</span>
<span class="normal">5315</span>
<span class="normal">5316</span>
<span class="normal">5317</span>
<span class="normal">5318</span>
<span class="normal">5319</span>
<span class="normal">5320</span>
<span class="normal">5321</span>
<span class="normal">5322</span>
<span class="normal">5323</span>
<span class="normal">5324</span>
<span class="normal">5325</span>
<span class="normal">5326</span>
<span class="normal">5327</span>
<span class="normal">5328</span>
<span class="normal">5329</span>
<span class="normal">5330</span>
<span class="normal">5331</span>
<span class="normal">5332</span>
<span class="normal">5333</span>
<span class="normal">5334</span>
<span class="normal">5335</span>
<span class="normal">5336</span>
<span class="normal">5337</span>
<span class="normal">5338</span>
<span class="normal">5339</span>
<span class="normal">5340</span>
<span class="normal">5341</span>
<span class="normal">5342</span>
<span class="normal">5343</span>
<span class="normal">5344</span>
<span class="normal">5345</span>
<span class="normal">5346</span>
<span class="normal">5347</span>
<span class="normal">5348</span>
<span class="normal">5349</span>
<span class="normal">5350</span>
<span class="normal">5351</span>
<span class="normal">5352</span>
<span class="normal">5353</span>
<span class="normal">5354</span>
<span class="normal">5355</span>
<span class="normal">5356</span>
<span class="normal">5357</span>
<span class="normal">5358</span>
<span class="normal">5359</span>
<span class="normal">5360</span>
<span class="normal">5361</span>
<span class="normal">5362</span>
<span class="normal">5363</span>
<span class="normal">5364</span>
<span class="normal">5365</span>
<span class="normal">5366</span>
<span class="normal">5367</span>
<span class="normal">5368</span>
<span class="normal">5369</span>
<span class="normal">5370</span>
<span class="normal">5371</span>
<span class="normal">5372</span>
<span class="normal">5373</span>
<span class="normal">5374</span>
<span class="normal">5375</span>
<span class="normal">5376</span>
<span class="normal">5377</span>
<span class="normal">5378</span>
<span class="normal">5379</span>
<span class="normal">5380</span>
<span class="normal">5381</span>
<span class="normal">5382</span>
<span class="normal">5383</span>
<span class="normal">5384</span>
<span class="normal">5385</span>
<span class="normal">5386</span>
<span class="normal">5387</span>
<span class="normal">5388</span>
<span class="normal">5389</span>
<span class="normal">5390</span>
<span class="normal">5391</span>
<span class="normal">5392</span>
<span class="normal">5393</span>
<span class="normal">5394</span>
<span class="normal">5395</span>
<span class="normal">5396</span>
<span class="normal">5397</span>
<span class="normal">5398</span>
<span class="normal">5399</span>
<span class="normal">5400</span>
<span class="normal">5401</span>
<span class="normal">5402</span>
<span class="normal">5403</span>
<span class="normal">5404</span>
<span class="normal">5405</span>
<span class="normal">5406</span>
<span class="normal">5407</span>
<span class="normal">5408</span>
<span class="normal">5409</span>
<span class="normal">5410</span>
<span class="normal">5411</span>
<span class="normal">5412</span>
<span class="normal">5413</span>
<span class="normal">5414</span>
<span class="normal">5415</span>
<span class="normal">5416</span>
<span class="normal">5417</span>
<span class="normal">5418</span>
<span class="normal">5419</span>
<span class="normal">5420</span>
<span class="normal">5421</span>
<span class="normal">5422</span>
<span class="normal">5423</span>
<span class="normal">5424</span>
<span class="normal">5425</span>
<span class="normal">5426</span>
<span class="normal">5427</span>
<span class="normal">5428</span>
<span class="normal">5429</span>
<span class="normal">5430</span>
<span class="normal">5431</span>
<span class="normal">5432</span>
<span class="normal">5433</span>
<span class="normal">5434</span>
<span class="normal">5435</span>
<span class="normal">5436</span>
<span class="normal">5437</span>
<span class="normal">5438</span>
<span class="normal">5439</span>
<span class="normal">5440</span>
<span class="normal">5441</span>
<span class="normal">5442</span>
<span class="normal">5443</span>
<span class="normal">5444</span>
<span class="normal">5445</span>
<span class="normal">5446</span>
<span class="normal">5447</span>
<span class="normal">5448</span>
<span class="normal">5449</span>
<span class="normal">5450</span>
<span class="normal">5451</span>
<span class="normal">5452</span>
<span class="normal">5453</span>
<span class="normal">5454</span>
<span class="normal">5455</span>
<span class="normal">5456</span>
<span class="normal">5457</span>
<span class="normal">5458</span>
<span class="normal">5459</span>
<span class="normal">5460</span>
<span class="normal">5461</span>
<span class="normal">5462</span>
<span class="normal">5463</span>
<span class="normal">5464</span>
<span class="normal">5465</span>
<span class="normal">5466</span>
<span class="normal">5467</span>
<span class="normal">5468</span>
<span class="normal">5469</span>
<span class="normal">5470</span>
<span class="normal">5471</span>
<span class="normal">5472</span>
<span class="normal">5473</span>
<span class="normal">5474</span>
<span class="normal">5475</span>
<span class="normal">5476</span>
<span class="normal">5477</span>
<span class="normal">5478</span>
<span class="normal">5479</span>
<span class="normal">5480</span>
<span class="normal">5481</span>
<span class="normal">5482</span>
<span class="normal">5483</span>
<span class="normal">5484</span>
<span class="normal">5485</span>
<span class="normal">5486</span>
<span class="normal">5487</span>
<span class="normal">5488</span>
<span class="normal">5489</span>
<span class="normal">5490</span>
<span class="normal">5491</span>
<span class="normal">5492</span>
<span class="normal">5493</span>
<span class="normal">5494</span>
<span class="normal">5495</span>
<span class="normal">5496</span>
<span class="normal">5497</span>
<span class="normal">5498</span>
<span class="normal">5499</span>
<span class="normal">5500</span>
<span class="normal">5501</span>
<span class="normal">5502</span>
<span class="normal">5503</span>
<span class="normal">5504</span>
<span class="normal">5505</span>
<span class="normal">5506</span>
<span class="normal">5507</span>
<span class="normal">5508</span>
<span class="normal">5509</span>
<span class="normal">5510</span>
<span class="normal">5511</span>
<span class="normal">5512</span>
<span class="normal">5513</span>
<span class="normal">5514</span>
<span class="normal">5515</span>
<span class="normal">5516</span>
<span class="normal">5517</span>
<span class="normal">5518</span>
<span class="normal">5519</span>
<span class="normal">5520</span>
<span class="normal">5521</span>
<span class="normal">5522</span>
<span class="normal">5523</span>
<span class="normal">5524</span>
<span class="normal">5525</span>
<span class="normal">5526</span>
<span class="normal">5527</span>
<span class="normal">5528</span>
<span class="normal">5529</span>
<span class="normal">5530</span>
<span class="normal">5531</span>
<span class="normal">5532</span>
<span class="normal">5533</span>
<span class="normal">5534</span>
<span class="normal">5535</span>
<span class="normal">5536</span>
<span class="normal">5537</span>
<span class="normal">5538</span>
<span class="normal">5539</span>
<span class="normal">5540</span>
<span class="normal">5541</span>
<span class="normal">5542</span>
<span class="normal">5543</span>
<span class="normal">5544</span>
<span class="normal">5545</span>
<span class="normal">5546</span>
<span class="normal">5547</span>
<span class="normal">5548</span>
<span class="normal">5549</span>
<span class="normal">5550</span>
<span class="normal">5551</span>
<span class="normal">5552</span>
<span class="normal">5553</span>
<span class="normal">5554</span>
<span class="normal">5555</span>
<span class="normal">5556</span>
<span class="normal">5557</span>
<span class="normal">5558</span>
<span class="normal">5559</span>
<span class="normal">5560</span>
<span class="normal">5561</span>
<span class="normal">5562</span>
<span class="normal">5563</span>
<span class="normal">5564</span>
<span class="normal">5565</span>
<span class="normal">5566</span>
<span class="normal">5567</span>
<span class="normal">5568</span>
<span class="normal">5569</span>
<span class="normal">5570</span>
<span class="normal">5571</span>
<span class="normal">5572</span>
<span class="normal">5573</span>
<span class="normal">5574</span>
<span class="normal">5575</span>
<span class="normal">5576</span>
<span class="normal">5577</span>
<span class="normal">5578</span>
<span class="normal">5579</span>
<span class="normal">5580</span>
<span class="normal">5581</span>
<span class="normal">5582</span>
<span class="normal">5583</span>
<span class="normal">5584</span>
<span class="normal">5585</span>
<span class="normal">5586</span>
<span class="normal">5587</span>
<span class="normal">5588</span>
<span class="normal">5589</span>
<span class="normal">5590</span>
<span class="normal">5591</span>
<span class="normal">5592</span>
<span class="normal">5593</span>
<span class="normal">5594</span>
<span class="normal">5595</span>
<span class="normal">5596</span>
<span class="normal">5597</span>
<span class="normal">5598</span>
<span class="normal">5599</span>
<span class="normal">5600</span>
<span class="normal">5601</span>
<span class="normal">5602</span>
<span class="normal">5603</span>
<span class="normal">5604</span>
<span class="normal">5605</span>
<span class="normal">5606</span>
<span class="normal">5607</span>
<span class="normal">5608</span>
<span class="normal">5609</span>
<span class="normal">5610</span>
<span class="normal">5611</span>
<span class="normal">5612</span>
<span class="normal">5613</span>
<span class="normal">5614</span>
<span class="normal">5615</span>
<span class="normal">5616</span>
<span class="normal">5617</span>
<span class="normal">5618</span>
<span class="normal">5619</span>
<span class="normal">5620</span>
<span class="normal">5621</span>
<span class="normal">5622</span>
<span class="normal">5623</span>
<span class="normal">5624</span>
<span class="normal">5625</span>
<span class="normal">5626</span>
<span class="normal">5627</span>
<span class="normal">5628</span>
<span class="normal">5629</span>
<span class="normal">5630</span>
<span class="normal">5631</span>
<span class="normal">5632</span>
<span class="normal">5633</span>
<span class="normal">5634</span>
<span class="normal">5635</span>
<span class="normal">5636</span>
<span class="normal">5637</span>
<span class="normal">5638</span>
<span class="normal">5639</span>
<span class="normal">5640</span>
<span class="normal">5641</span>
<span class="normal">5642</span>
<span class="normal">5643</span>
<span class="normal">5644</span>
<span class="normal">5645</span>
<span class="normal">5646</span>
<span class="normal">5647</span>
<span class="normal">5648</span>
<span class="normal">5649</span>
<span class="normal">5650</span>
<span class="normal">5651</span>
<span class="normal">5652</span>
<span class="normal">5653</span>
<span class="normal">5654</span>
<span class="normal">5655</span>
<span class="normal">5656</span>
<span class="normal">5657</span>
<span class="normal">5658</span>
<span class="normal">5659</span>
<span class="normal">5660</span>
<span class="normal">5661</span>
<span class="normal">5662</span>
<span class="normal">5663</span>
<span class="normal">5664</span>
<span class="normal">5665</span>
<span class="normal">5666</span>
<span class="normal">5667</span>
<span class="normal">5668</span>
<span class="normal">5669</span>
<span class="normal">5670</span>
<span class="normal">5671</span>
<span class="normal">5672</span>
<span class="normal">5673</span>
<span class="normal">5674</span>
<span class="normal">5675</span>
<span class="normal">5676</span>
<span class="normal">5677</span>
<span class="normal">5678</span>
<span class="normal">5679</span>
<span class="normal">5680</span>
<span class="normal">5681</span>
<span class="normal">5682</span>
<span class="normal">5683</span>
<span class="normal">5684</span>
<span class="normal">5685</span>
<span class="normal">5686</span>
<span class="normal">5687</span>
<span class="normal">5688</span>
<span class="normal">5689</span>
<span class="normal">5690</span>
<span class="normal">5691</span>
<span class="normal">5692</span>
<span class="normal">5693</span>
<span class="normal">5694</span>
<span class="normal">5695</span>
<span class="normal">5696</span>
<span class="normal">5697</span>
<span class="normal">5698</span>
<span class="normal">5699</span>
<span class="normal">5700</span>
<span class="normal">5701</span>
<span class="normal">5702</span>
<span class="normal">5703</span>
<span class="normal">5704</span>
<span class="normal">5705</span>
<span class="normal">5706</span>
<span class="normal">5707</span>
<span class="normal">5708</span>
<span class="normal">5709</span>
<span class="normal">5710</span>
<span class="normal">5711</span>
<span class="normal">5712</span>
<span class="normal">5713</span>
<span class="normal">5714</span>
<span class="normal">5715</span>
<span class="normal">5716</span>
<span class="normal">5717</span>
<span class="normal">5718</span>
<span class="normal">5719</span>
<span class="normal">5720</span>
<span class="normal">5721</span>
<span class="normal">5722</span>
<span class="normal">5723</span>
<span class="normal">5724</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CoreMetaData</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">RDF_MetaData_Mixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define CoreMetaData model.&quot;&quot;&quot;</span>

    <span class="n">XML_HEADER</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#39;&#39;&#39;</span>

    <span class="n">NAMESPACES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rdf&#39;</span><span class="p">:</span> <span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span><span class="p">,</span>
                  <span class="s1">&#39;rdfs1&#39;</span><span class="p">:</span> <span class="s2">&quot;http://www.w3.org/2000/01/rdf-schema#&quot;</span><span class="p">,</span>
                  <span class="s1">&#39;dc&#39;</span><span class="p">:</span> <span class="s2">&quot;http://purl.org/dc/elements/1.1/&quot;</span><span class="p">,</span>
                  <span class="s1">&#39;dcterms&#39;</span><span class="p">:</span> <span class="s2">&quot;http://purl.org/dc/terms/&quot;</span><span class="p">,</span>
                  <span class="s1">&#39;hsterms&#39;</span><span class="p">:</span> <span class="s2">&quot;https://www.hydroshare.org/terms/&quot;</span><span class="p">}</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">_description</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Description</span><span class="p">)</span>    <span class="c1"># resource abstract</span>
    <span class="n">_title</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Title</span><span class="p">)</span>
    <span class="n">creators</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Creator</span><span class="p">)</span>
    <span class="n">contributors</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Contributor</span><span class="p">)</span>
    <span class="n">citation</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Citation</span><span class="p">)</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span>
    <span class="n">coverages</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Coverage</span><span class="p">)</span>
    <span class="n">formats</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Format</span><span class="p">)</span>
    <span class="n">identifiers</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Identifier</span><span class="p">)</span>
    <span class="n">_language</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Language</span><span class="p">)</span>
    <span class="n">subjects</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Subject</span><span class="p">)</span>
    <span class="n">relations</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Relation</span><span class="p">)</span>
    <span class="n">geospatialrelations</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">GeospatialRelation</span><span class="p">)</span>
    <span class="n">_rights</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Rights</span><span class="p">)</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Type</span><span class="p">)</span>
    <span class="n">_publisher</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">Publisher</span><span class="p">)</span>
    <span class="n">funding_agencies</span> <span class="o">=</span> <span class="n">GenericRelation</span><span class="p">(</span><span class="n">FundingAgency</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return base resource object that the metadata defines.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the first title object from metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_title</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the first description object from metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">language</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the first _language object from metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_language</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the first rights object from metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rights</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the first _type object from metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">publisher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the first _publisher object from metadata.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publisher</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spatial_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coverages</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;period&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">temporal_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coverages</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;period&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spatial_coverage_default_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;WGS 84 EPSG:4326&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spatial_coverage_default_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Decimal degrees&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an instance of rest_framework Serializer for self</span>
<span class="sd">        Note: Subclass must override this property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.views.resource_metadata_rest_api</span> <span class="kn">import</span> <span class="n">CoreMetaDataSerializer</span>
        <span class="k">return</span> <span class="n">CoreMetaDataSerializer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rdf_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.hydroshare</span> <span class="kn">import</span> <span class="n">current_site_url</span>
        <span class="k">return</span> <span class="n">URIRef</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/resource/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_site_url</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">rdf_metadata_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.hydroshare</span> <span class="kn">import</span> <span class="n">current_site_url</span>
        <span class="k">return</span> <span class="n">URIRef</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/resource/</span><span class="si">{}</span><span class="s2">/data/resourcemetadata.xml&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_site_url</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">rdf_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">HSTERMS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">resource_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ignored_generic_relations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override to exclude generic relations from the rdf/xml.  This is built specifically for Format, which is the</span>
<span class="sd">        only AbstractMetadataElement that is on a metadata model and not included in the rdf/xml.  Returns a list</span>
<span class="sd">        of classes to be ignored&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Format</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">ingest_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CoreMetaData</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">ingest_metadata</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdf_subject_from_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">extra_metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">extendedMetadata</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">o</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">o</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="n">extra_metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="n">res</span><span class="o">.</span><span class="n">extra_metadata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">extra_metadata</span><span class="p">)</span>

        <span class="c1"># delete ingested default citation</span>
        <span class="n">citation_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(.*) \(\d</span><span class="si">{4}</span><span class="s2">\)\. (.*), http:\/\/(.*)\/[A-z0-9]</span><span class="si">{32}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># noqa</span>
        <span class="n">ingested_citation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">citation</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ingested_citation</span> <span class="ow">and</span> <span class="n">citation_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ingested_citation</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">citation</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">res</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_rdf_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CoreMetaData</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_rdf_graph</span><span class="p">()</span>

        <span class="n">subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdf_subject</span><span class="p">()</span>

        <span class="c1"># add any key/value metadata items</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">extra_metadata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">extra_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">extendedMetadata</span> <span class="o">=</span> <span class="n">BNode</span><span class="p">()</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">extendedMetadata</span><span class="p">,</span> <span class="n">extendedMetadata</span><span class="p">))</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">extendedMetadata</span><span class="p">,</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">Literal</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">extendedMetadata</span><span class="p">,</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Literal</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

        <span class="c1"># if custom citation does not exist, use the default citation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">citation</span><span class="o">.</span><span class="n">first</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="n">DCTERMS</span><span class="o">.</span><span class="n">bibliographicCitation</span><span class="p">,</span> <span class="n">Literal</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">get_citation</span><span class="p">(</span><span class="n">forceHydroshareURI</span><span class="o">=</span><span class="kc">False</span><span class="p">))))</span>

        <span class="kn">from</span> <span class="nn">.hydroshare</span> <span class="kn">import</span> <span class="n">current_site_url</span>
        <span class="n">TYPE_SUBJECT</span> <span class="o">=</span> <span class="n">URIRef</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/terms/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_site_url</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">resource_type</span><span class="p">))</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">TYPE_SUBJECT</span><span class="p">,</span> <span class="n">RDFS1</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">)))</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">TYPE_SUBJECT</span><span class="p">,</span> <span class="n">RDFS1</span><span class="o">.</span><span class="n">isDefinedBy</span><span class="p">,</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">HSTERMS</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_for_bulk_update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">parsed_metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the input *metadata* dict to needed format and store it in</span>
<span class="sd">        *parsed_metadata* list</span>
<span class="sd">        :param  metadata: a dict of metadata that needs to be parsed to get the metadata in the</span>
<span class="sd">        format needed for updating the metadata elements supported by resource type</span>
<span class="sd">        :param  parsed_metadata: a list of dicts that will be appended with parsed data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">keys_to_update</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)}})</span>

        <span class="k">if</span> <span class="s1">&#39;creators&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;creators&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;creators&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;creators&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">creator</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;creators&#39;</span><span class="p">):</span>
                <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;creator&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="p">})</span>

        <span class="k">if</span> <span class="s1">&#39;contributors&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;contributors&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;contributors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;contributors&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">contributor</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;contributors&#39;</span><span class="p">):</span>
                <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;contributor&quot;</span><span class="p">:</span> <span class="n">contributor</span><span class="p">})</span>

        <span class="k">if</span> <span class="s1">&#39;coverages&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">coverage</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;coverages&#39;</span><span class="p">):</span>
                <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;coverage&quot;</span><span class="p">:</span> <span class="n">coverage</span><span class="p">})</span>

        <span class="k">if</span> <span class="s1">&#39;dates&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dates&#39;</span><span class="p">):</span>
                <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="p">})</span>

        <span class="k">if</span> <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;abstract&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)}})</span>

        <span class="k">if</span> <span class="s1">&#39;language&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">)}})</span>

        <span class="k">if</span> <span class="s1">&#39;rights&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;rights&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rights&#39;</span><span class="p">)})</span>

        <span class="k">if</span> <span class="s1">&#39;sources&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sources&#39;</span><span class="p">):</span>
                <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">})</span>

        <span class="k">if</span> <span class="s1">&#39;subjects&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;subjects&#39;</span><span class="p">):</span>
                <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">subject</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]}})</span>

        <span class="k">if</span> <span class="s1">&#39;funding_agencies&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">agency</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;funding_agencies&quot;</span><span class="p">):</span>
                <span class="c1"># using fundingagency instead of funding_agency to be consistent with UI</span>
                <span class="c1"># add-metadata logic as well as the term for the metadata element.</span>
                <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;fundingagency&quot;</span><span class="p">:</span> <span class="n">agency</span><span class="p">})</span>

        <span class="k">if</span> <span class="s1">&#39;relations&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;relations&#39;</span><span class="p">):</span>
                <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">})</span>

        <span class="k">if</span> <span class="s1">&#39;geospatialrelations&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;geospatialrelations&#39;</span><span class="p">):</span>
                <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;geospatialrelation&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">})</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_supported_element_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of supported metadata element names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Citation&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Creator&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Contributor&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Coverage&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Format&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Rights&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Title&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Type&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Date&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Identifier&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Language&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Subject&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Relation&#39;</span><span class="p">,</span>
                <span class="s1">&#39;GeospatialRelation&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Publisher&#39;</span><span class="p">,</span>
                <span class="s1">&#39;FundingAgency&#39;</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_form_errors_as_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to generate a string from form.errors</span>
<span class="sd">        :param  form: an instance of Django Form class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error_string</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                 <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">error_string</span>

    <span class="k">def</span> <span class="nf">set_dirty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Track whethrer metadata object is dirty.</span>

<span class="sd">        Subclasses that have the attribute to track whether metadata object is dirty</span>
<span class="sd">        should override this method to allow setting that attribute</span>

<span class="sd">        :param flag: a boolean value</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">has_all_required_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether metadata has all required elements.</span>

<span class="sd">        This method needs to be overriden by any subclass of this class</span>
<span class="sd">        if they implement additional metadata elements that are required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;untitled resource&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;creators&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rights&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;rights&#39;</span><span class="p">][</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subjects&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_required_missing_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desired_state</span><span class="o">=</span><span class="s1">&#39;discoverable&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of required missing metadata elements.</span>

<span class="sd">        This method needs to be overriden by any subclass of this class</span>
<span class="sd">        if they implement additional metadata elements that are required</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">resource_states</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;discoverable&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">desired_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resource_states</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Desired resource state is not in: </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource_states</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="n">missing_required_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">desired_state</span> <span class="o">!=</span> <span class="s1">&#39;published&#39;</span><span class="p">:</span>
            <span class="c1"># check for title, abstract, rights, and keywords using cached_metadata</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="p">{}):</span>
                <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Title (at least 30 characters)&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;untitled resource&#39;</span><span class="p">:</span>
                <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Title (at least 30 characters)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="p">{}):</span>
                <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Abstract (at least 150 characters)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rights&#39;</span><span class="p">,</span> <span class="p">{}):</span>
                <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Rights&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subjects&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Keywords (at least 3)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check for title, abstract, and keywords using cached_metadata</span>
            <span class="n">cached_metadata</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;The title must be at least 30 characters.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">150</span><span class="p">:</span>
                <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;The abstract must be at least 150 characters.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subjects&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;subjects&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;You must include at least 3 keywords.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">missing_required_elements</span>

    <span class="k">def</span> <span class="nf">get_recommended_missing_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of recommended missing metadata elements.</span>

<span class="sd">        This method needs to be overriden by any subclass of this class</span>
<span class="sd">        if they implement additional metadata elements that are required</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">missing_recommended_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;funding_agencies&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">missing_recommended_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Funding Agency&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">readme_file</span> <span class="ow">and</span> <span class="n">resource</span><span class="o">.</span><span class="n">resource_type</span> <span class="o">==</span> <span class="s2">&quot;CompositeResource&quot;</span><span class="p">:</span>
            <span class="n">missing_recommended_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Readme file containing variables, &#39;</span>
                                                <span class="s1">&#39;abbreviations/acronyms, and non-standard file formats&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spatial_coverage&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;temporal_coverage&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="n">missing_recommended_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Coverage that describes locations that are related to the dataset&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">missing_recommended_elements</span>

    <span class="k">def</span> <span class="nf">delete_all_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete all metadata elements.</span>

<span class="sd">        This method needs to be overriden by any subclass of this class if that class</span>
<span class="sd">        has additional metadata elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rights</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rights</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contributors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coverages</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funding_agencies</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">copy_all_elements_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_md</span><span class="p">,</span> <span class="n">exclude_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy all metadata elements from another resource.&quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">md_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">src_md</span><span class="p">)</span>
        <span class="n">supported_element_names</span> <span class="o">=</span> <span class="n">src_md</span><span class="o">.</span><span class="n">get_supported_element_names</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">supported_element_names</span><span class="p">:</span>
            <span class="n">element_model_type</span> <span class="o">=</span> <span class="n">src_md</span><span class="o">.</span><span class="n">_get_metadata_element_model_type</span><span class="p">(</span><span class="n">element_name</span><span class="p">)</span>
            <span class="n">elements_to_copy</span> <span class="o">=</span> <span class="n">element_model_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">object_id</span><span class="o">=</span><span class="n">src_md</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">md_type</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements_to_copy</span><span class="p">:</span>
                <span class="n">element_args</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="n">element_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">)</span>
                <span class="n">element_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
                <span class="n">element_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;object_id&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">exclude_elements</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">element_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">exclude_elements</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="o">**</span><span class="n">element_args</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="o">**</span><span class="n">element_args</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">UserValidationError</span> <span class="k">as</span> <span class="n">uve</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error copying </span><span class="si">{</span><span class="n">element</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uve</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">element_args</span><span class="p">[</span><span class="s2">&quot;hydroshare_user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">del</span> <span class="n">element_args</span><span class="p">[</span><span class="s2">&quot;is_active_user&quot;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="o">**</span><span class="n">element_args</span><span class="p">)</span>

    <span class="c1"># this method needs to be overriden by any subclass of this class</span>
    <span class="c1"># to allow updating of extended (resource specific) metadata</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update method for CoreMetaData model.</span>

<span class="sd">        :param metadata: a list of dicts - each dict in the format of {element_name: **kwargs}</span>
<span class="sd">        element_name must be in lowercase.</span>
<span class="sd">        example of a dict in metadata list:</span>
<span class="sd">            {&#39;creator&#39;: {&#39;name&#39;: &#39;John Howard&#39;, &#39;email: &#39;jh@gmail.com&#39;}}</span>
<span class="sd">        :param  user: user who is updating metadata</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="p">(</span><span class="n">AbstractValidationForm</span><span class="p">,</span> <span class="n">ContributorValidationForm</span><span class="p">,</span>
                            <span class="n">CreatorValidationForm</span><span class="p">,</span> <span class="n">FundingAgencyValidationForm</span><span class="p">,</span>
                            <span class="n">GeospatialRelationValidationForm</span><span class="p">,</span>
                            <span class="n">LanguageValidationForm</span><span class="p">,</span> <span class="n">RelationValidationForm</span><span class="p">,</span>
                            <span class="n">RightsValidationForm</span><span class="p">,</span> <span class="n">TitleValidationForm</span><span class="p">)</span>

        <span class="n">validation_forms_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">TitleValidationForm</span><span class="p">,</span>
                                    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">AbstractValidationForm</span><span class="p">,</span>
                                    <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="n">LanguageValidationForm</span><span class="p">,</span>
                                    <span class="s1">&#39;rights&#39;</span><span class="p">:</span> <span class="n">RightsValidationForm</span><span class="p">,</span>
                                    <span class="s1">&#39;creator&#39;</span><span class="p">:</span> <span class="n">CreatorValidationForm</span><span class="p">,</span>
                                    <span class="s1">&#39;contributor&#39;</span><span class="p">:</span> <span class="n">ContributorValidationForm</span><span class="p">,</span>
                                    <span class="s1">&#39;relation&#39;</span><span class="p">:</span> <span class="n">RelationValidationForm</span><span class="p">,</span>
                                    <span class="s1">&#39;geospatialrelation&#39;</span><span class="p">:</span> <span class="n">GeospatialRelationValidationForm</span><span class="p">,</span>
                                    <span class="s1">&#39;fundingagency&#39;</span><span class="p">:</span> <span class="n">FundingAgencyValidationForm</span>
                                    <span class="p">}</span>
        <span class="c1"># updating non-repeatable elements</span>
        <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;rights&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">dict_item</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">dict_item</span><span class="p">:</span>
                        <span class="n">validation_form</span> <span class="o">=</span> <span class="n">validation_forms_mapping</span><span class="p">[</span><span class="n">element_name</span><span class="p">](</span>
                            <span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                            <span class="n">err_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_errors_as_string</span><span class="p">(</span><span class="n">validation_form</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_string</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_non_repeatable_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;creator&#39;</span><span class="p">,</span> <span class="s1">&#39;contributor&#39;</span><span class="p">,</span> <span class="s1">&#39;coverage&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;relation&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;geospatialrelation&#39;</span><span class="p">,</span> <span class="s1">&#39;subject&#39;</span><span class="p">):</span>
                <span class="n">subjects</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">dict_item</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">dict_item</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s1">&#39;subject&#39;</span><span class="p">:</span>
                            <span class="n">subject_data</span> <span class="o">=</span> <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subject_data</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Subject value is missing&quot;</span><span class="p">)</span>
                            <span class="n">subjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s1">&#39;coverage&#39;</span><span class="p">:</span>
                            <span class="n">coverage_data</span> <span class="o">=</span> <span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">]</span>
                            <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coverage_data</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage type data is missing&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coverage_data</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage value data is missing&quot;</span><span class="p">)</span>
                            <span class="n">coverage_value_dict</span> <span class="o">=</span> <span class="n">coverage_data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                            <span class="n">coverage_type</span> <span class="o">=</span> <span class="n">coverage_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                            <span class="n">Coverage</span><span class="o">.</span><span class="n">validate_coverage_type_value_attributes</span><span class="p">(</span><span class="n">coverage_type</span><span class="p">,</span>
                                                                             <span class="n">coverage_value_dict</span><span class="p">)</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;creator&#39;</span><span class="p">,</span> <span class="s1">&#39;contributor&#39;</span><span class="p">]:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">party_data</span> <span class="o">=</span> <span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">]</span>
                                <span class="k">if</span> <span class="s1">&#39;identifiers&#39;</span> <span class="ow">in</span> <span class="n">party_data</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">party_data</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                                        <span class="c1"># convert dict to json for form validation</span>
                                        <span class="n">party_data</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                                            <span class="n">party_data</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">])</span>
                            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid identifier data for &quot;</span>
                                                      <span class="s2">&quot;creator/contributor&quot;</span><span class="p">)</span>
                            <span class="n">validation_form</span> <span class="o">=</span> <span class="n">validation_forms_mapping</span><span class="p">[</span><span class="n">element_name</span><span class="p">](</span>
                                <span class="n">party_data</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">validation_form</span> <span class="o">=</span> <span class="n">validation_forms_mapping</span><span class="p">[</span><span class="n">element_name</span><span class="p">](</span>
                                <span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                            <span class="n">err_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_errors_as_string</span><span class="p">(</span><span class="n">validation_form</span><span class="p">)</span>
                            <span class="n">err_string</span> <span class="o">+=</span> <span class="s2">&quot; element name:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element_name</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_string</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subjects</span><span class="p">:</span>
                    <span class="n">subjects_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subjects_set</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">subjects</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Duplicate subject values found&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_repeatable_element</span><span class="p">(</span><span class="n">element_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

            <span class="c1"># allow only updating or creating date element of type valid</span>
            <span class="n">element_name</span> <span class="o">=</span> <span class="s1">&#39;date&#39;</span>
            <span class="n">date_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">date_dict</span> <span class="k">for</span> <span class="n">date_dict</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">date_dict</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">date_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">date_item</span> <span class="ow">in</span> <span class="n">date_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">date_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">date_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">date_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
                            <span class="k">break</span>

            <span class="c1"># allow only updating or creating identifiers which does not have name value</span>
            <span class="c1"># &#39;hydroShareIdentifier&#39;</span>
            <span class="n">element_name</span> <span class="o">=</span> <span class="s1">&#39;identifier&#39;</span>
            <span class="n">identifier_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_dict</span> <span class="k">for</span> <span class="n">id_dict</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">id_dict</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">id_item</span> <span class="ow">in</span> <span class="n">identifier_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;hydroshareidentifier&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>

            <span class="n">element_name</span> <span class="o">=</span> <span class="s1">&#39;fundingagency&#39;</span>
            <span class="n">identifier_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_dict</span> <span class="k">for</span> <span class="n">id_dict</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">id_dict</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">id_item</span> <span class="ow">in</span> <span class="n">identifier_list</span><span class="p">:</span>
                    <span class="n">validation_form</span> <span class="o">=</span> <span class="n">validation_forms_mapping</span><span class="p">[</span><span class="n">element_name</span><span class="p">](</span>
                        <span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                        <span class="n">err_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_errors_as_string</span><span class="p">(</span><span class="n">validation_form</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_string</span><span class="p">)</span>
                <span class="c1"># update_repeatable_elements will append an &#39;s&#39; to element_name before getattr,</span>
                <span class="c1"># unless property_name is provided.  I&#39;d like to remove English grammar rules from</span>
                <span class="c1"># our codebase, but in the interest of time, I&#39;ll just add a special case for</span>
                <span class="c1"># handling funding_agencies</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_repeatable_element</span><span class="p">(</span><span class="n">element_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                                               <span class="n">property_name</span><span class="o">=</span><span class="s2">&quot;funding_agencies&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resource_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;hydroShareIdentifier&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span>

    <span class="k">def</span> <span class="nf">create_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_model_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create any supported metadata element.&quot;&quot;&quot;</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_element_model_type</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">element_model_name</span> <span class="o">=</span> <span class="n">element_model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element_model_name</span> <span class="o">==</span> <span class="s1">&#39;creator&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> can&#39;t be created for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">element_model_name</span> <span class="o">==</span> <span class="s1">&#39;identifier&#39;</span><span class="p">:</span>
                <span class="n">name_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name_value</span> <span class="o">!=</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
                    <span class="c1"># for published resource the &#39;name&#39; attribute of the identifier must be set to &#39;doi&#39;</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For a published resource only a doi identifier can be created&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">element_model_name</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
                <span class="n">date_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">date_type</span> <span class="ow">and</span> <span class="n">date_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;modified&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> date can&#39;t be created for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date_type</span><span class="p">))</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">model_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">element</span>

    <span class="k">def</span> <span class="nf">update_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_model_name</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metadata element.&quot;&quot;&quot;</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_element_model_type</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">element_model_name</span> <span class="o">=</span> <span class="n">element_model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element_model_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;creator&#39;</span><span class="p">,</span> <span class="s1">&#39;rights&#39;</span><span class="p">,</span> <span class="s1">&#39;identifier&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> can&#39;t be updated for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">element_model_name</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
                <span class="n">date_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">date_type</span> <span class="ow">and</span> <span class="n">date_type</span> <span class="o">!=</span> <span class="s1">&#39;modified&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> date can&#39;t be updated for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date_type</span><span class="p">))</span>
        <span class="n">model_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_model_name</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete Metadata element.&quot;&quot;&quot;</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_element_model_type</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">)</span>
        <span class="n">element_model_name</span> <span class="o">=</span> <span class="n">element_model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element_model_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="s1">&#39;contributor&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;relation&#39;</span><span class="p">,</span> <span class="s1">&#39;fundingagency&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> can&#39;t be deleted for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">))</span>
        <span class="n">model_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_metadata_element_model_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_model_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get type of metadata element based on model type.&quot;&quot;&quot;</span>
        <span class="n">element_model_name</span> <span class="o">=</span> <span class="n">element_model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Metadata element type:</span><span class="si">%s</span><span class="s2"> is not one of the &quot;</span>
                                  <span class="s2">&quot;supported in core metadata elements.&quot;</span>
                                  <span class="o">%</span> <span class="n">element_model_name</span><span class="p">)</span>

        <span class="n">unsupported_element_error</span> <span class="o">=</span> <span class="s2">&quot;Metadata element type:</span><span class="si">%s</span><span class="s2"> is not supported.&quot;</span> \
                                    <span class="o">%</span> <span class="n">element_model_name</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">app_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span>
                                                 <span class="n">model</span><span class="o">=</span><span class="n">element_model_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">model_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">app_label</span><span class="o">=</span><span class="s1">&#39;hs_core&#39;</span><span class="p">,</span>
                                                     <span class="n">model</span><span class="o">=</span><span class="n">element_model_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">unsupported_element_error</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">model_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">(),</span> <span class="n">AbstractMetaDataElement</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">unsupported_element_error</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">model_type</span>

    <span class="k">def</span> <span class="nf">_is_valid_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether metadata element is valid.&quot;&quot;&quot;</span>
        <span class="n">allowed_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_supported_element_names</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">element_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">allowed_elements</span>

    <span class="k">def</span> <span class="nf">update_non_repeatable_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">property_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a non-repeatable metadata element.</span>

<span class="sd">        This helper function is to create/update a specific metadata element as specified by</span>
<span class="sd">        *element_name*</span>
<span class="sd">        :param element_name: metadata element class name (e.g. title)</span>
<span class="sd">        :param metadata: a list of dicts - each dict has data to update/create a specific metadata</span>
<span class="sd">        element (e.g. {&#39;title&#39;: {&#39;value&#39;: &#39;my resource title&#39;}}</span>
<span class="sd">        :param property_name: name of the property/attribute name in this class or its sub class</span>
<span class="sd">        to access the metadata element instance of *metadata_element*. This is needed only when</span>
<span class="sd">        the property/attribute name differs from the element class name</span>

<span class="sd">            Example:</span>
<span class="sd">            class ModelProgramMetaData(CoreMetaData):</span>
<span class="sd">                _mpmetadata = GenericRelation(MpMetadata)</span>

<span class="sd">                @property</span>
<span class="sd">                def program(self):</span>
<span class="sd">                    return self._mpmetadata.all().first()</span>

<span class="sd">            For the above class to update the metadata element MpMetadata, this function needs to</span>
<span class="sd">            be called with element_name=&#39;mpmetadata&#39; and property_name=&#39;program&#39;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dict_item</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">dict_item</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">property_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">property_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">element</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_element</span><span class="p">(</span><span class="n">element_id</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                        <span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">update_repeatable_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">property_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a repeatable metadata element.</span>

<span class="sd">        Creates new metadata elements of type *element_name*. Any existing metadata elements of</span>
<span class="sd">        matching type get deleted first.</span>
<span class="sd">        :param element_name: class name of the metadata element (e.g. creator)</span>
<span class="sd">        :param metadata: a list of dicts containing data for each of the metadata elements that</span>
<span class="sd">        needs to be created/updated as part of bulk update</span>
<span class="sd">        :param property_name: (Optional) the property/attribute name used in this instance of</span>
<span class="sd">        CoreMetaData (or its sub class) to access all the objects of type *element_type*</span>
<span class="sd">            Example:</span>
<span class="sd">            class MODFLOWModelInstanceMetaData(ModelInstanceMetaData):</span>
<span class="sd">                 _model_input = GenericRelation(ModelInput)</span>

<span class="sd">                @property</span>
<span class="sd">                def model_inputs(self):</span>
<span class="sd">                    return self._model_input.all()</span>

<span class="sd">            For the above class to update the metadata element ModelInput, this function needs to</span>
<span class="sd">            be called with element_name=&#39;modelinput&#39; and property_name=&#39;model_inputs&#39;. If in the</span>
<span class="sd">            above class instead of using the attribute name &#39;_model_inputs&#39; we have used</span>
<span class="sd">            &#39;modelinputs&#39; then this function needs to be called with element_name=&#39;modelinput&#39; and</span>
<span class="sd">            no need to pass a value for the property_name.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_dict</span> <span class="k">for</span> <span class="n">element_dict</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">element_dict</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">property_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">property_name</span><span class="p">)</span>

            <span class="n">elements</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">element_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span> <span class="o">**</span><span class="n">element</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.CoreMetaData.description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">description</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the first description object from metadata.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.CoreMetaData.language" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">language</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the first _language object from metadata.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.CoreMetaData.publisher" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">publisher</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the first _publisher object from metadata.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.CoreMetaData.resource" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resource</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return base resource object that the metadata defines.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.CoreMetaData.rights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rights</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the first rights object from metadata.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.CoreMetaData.serializer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serializer</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return an instance of rest_framework Serializer for self
Note: Subclass must override this property</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.CoreMetaData.title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">title</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the first title object from metadata.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.CoreMetaData.type" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the first _type object from metadata.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.copy_all_elements_from" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy_all_elements_from</span><span class="p">(</span><span class="n">src_md</span><span class="p">,</span> <span class="n">exclude_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Copy all metadata elements from another resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5416</span>
<span class="normal">5417</span>
<span class="normal">5418</span>
<span class="normal">5419</span>
<span class="normal">5420</span>
<span class="normal">5421</span>
<span class="normal">5422</span>
<span class="normal">5423</span>
<span class="normal">5424</span>
<span class="normal">5425</span>
<span class="normal">5426</span>
<span class="normal">5427</span>
<span class="normal">5428</span>
<span class="normal">5429</span>
<span class="normal">5430</span>
<span class="normal">5431</span>
<span class="normal">5432</span>
<span class="normal">5433</span>
<span class="normal">5434</span>
<span class="normal">5435</span>
<span class="normal">5436</span>
<span class="normal">5437</span>
<span class="normal">5438</span>
<span class="normal">5439</span>
<span class="normal">5440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">copy_all_elements_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_md</span><span class="p">,</span> <span class="n">exclude_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy all metadata elements from another resource.&quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">md_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">src_md</span><span class="p">)</span>
    <span class="n">supported_element_names</span> <span class="o">=</span> <span class="n">src_md</span><span class="o">.</span><span class="n">get_supported_element_names</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">supported_element_names</span><span class="p">:</span>
        <span class="n">element_model_type</span> <span class="o">=</span> <span class="n">src_md</span><span class="o">.</span><span class="n">_get_metadata_element_model_type</span><span class="p">(</span><span class="n">element_name</span><span class="p">)</span>
        <span class="n">elements_to_copy</span> <span class="o">=</span> <span class="n">element_model_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">object_id</span><span class="o">=</span><span class="n">src_md</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">md_type</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements_to_copy</span><span class="p">:</span>
            <span class="n">element_args</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="n">element_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">)</span>
            <span class="n">element_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
            <span class="n">element_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;object_id&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">exclude_elements</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">element_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">exclude_elements</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="o">**</span><span class="n">element_args</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="o">**</span><span class="n">element_args</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UserValidationError</span> <span class="k">as</span> <span class="n">uve</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error copying </span><span class="si">{</span><span class="n">element</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uve</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">element_args</span><span class="p">[</span><span class="s2">&quot;hydroshare_user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">del</span> <span class="n">element_args</span><span class="p">[</span><span class="s2">&quot;is_active_user&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="o">**</span><span class="n">element_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.create_element" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create any supported metadata element.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5574</span>
<span class="normal">5575</span>
<span class="normal">5576</span>
<span class="normal">5577</span>
<span class="normal">5578</span>
<span class="normal">5579</span>
<span class="normal">5580</span>
<span class="normal">5581</span>
<span class="normal">5582</span>
<span class="normal">5583</span>
<span class="normal">5584</span>
<span class="normal">5585</span>
<span class="normal">5586</span>
<span class="normal">5587</span>
<span class="normal">5588</span>
<span class="normal">5589</span>
<span class="normal">5590</span>
<span class="normal">5591</span>
<span class="normal">5592</span>
<span class="normal">5593</span>
<span class="normal">5594</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_model_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create any supported metadata element.&quot;&quot;&quot;</span>
    <span class="n">model_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_element_model_type</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="n">element_model_name</span> <span class="o">=</span> <span class="n">element_model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
    <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element_model_name</span> <span class="o">==</span> <span class="s1">&#39;creator&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> can&#39;t be created for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">element_model_name</span> <span class="o">==</span> <span class="s1">&#39;identifier&#39;</span><span class="p">:</span>
            <span class="n">name_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name_value</span> <span class="o">!=</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
                <span class="c1"># for published resource the &#39;name&#39; attribute of the identifier must be set to &#39;doi&#39;</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For a published resource only a doi identifier can be created&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">element_model_name</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
            <span class="n">date_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">date_type</span> <span class="ow">and</span> <span class="n">date_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;modified&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> date can&#39;t be created for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date_type</span><span class="p">))</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">model_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">element</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.delete_all_elements" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_all_elements</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete all metadata elements.</p>
<p>This method needs to be overriden by any subclass of this class if that class
has additional metadata elements</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5387</span>
<span class="normal">5388</span>
<span class="normal">5389</span>
<span class="normal">5390</span>
<span class="normal">5391</span>
<span class="normal">5392</span>
<span class="normal">5393</span>
<span class="normal">5394</span>
<span class="normal">5395</span>
<span class="normal">5396</span>
<span class="normal">5397</span>
<span class="normal">5398</span>
<span class="normal">5399</span>
<span class="normal">5400</span>
<span class="normal">5401</span>
<span class="normal">5402</span>
<span class="normal">5403</span>
<span class="normal">5404</span>
<span class="normal">5405</span>
<span class="normal">5406</span>
<span class="normal">5407</span>
<span class="normal">5408</span>
<span class="normal">5409</span>
<span class="normal">5410</span>
<span class="normal">5411</span>
<span class="normal">5412</span>
<span class="normal">5413</span>
<span class="normal">5414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_all_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete all metadata elements.</span>

<span class="sd">    This method needs to be overriden by any subclass of this class if that class</span>
<span class="sd">    has additional metadata elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rights</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rights</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">creators</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">contributors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coverages</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">funding_agencies</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.delete_element" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">,</span> <span class="n">element_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete Metadata element.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5611</span>
<span class="normal">5612</span>
<span class="normal">5613</span>
<span class="normal">5614</span>
<span class="normal">5615</span>
<span class="normal">5616</span>
<span class="normal">5617</span>
<span class="normal">5618</span>
<span class="normal">5619</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_model_name</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete Metadata element.&quot;&quot;&quot;</span>
    <span class="n">model_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_element_model_type</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">)</span>
    <span class="n">element_model_name</span> <span class="o">=</span> <span class="n">element_model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
    <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element_model_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="s1">&#39;contributor&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;relation&#39;</span><span class="p">,</span> <span class="s1">&#39;fundingagency&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> can&#39;t be deleted for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">))</span>
    <span class="n">model_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.get_form_errors_as_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_form_errors_as_string</span><span class="p">(</span><span class="n">form</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Helper method to generate a string from form.errors
:param  form: an instance of Django Form class</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5279</span>
<span class="normal">5280</span>
<span class="normal">5281</span>
<span class="normal">5282</span>
<span class="normal">5283</span>
<span class="normal">5284</span>
<span class="normal">5285</span>
<span class="normal">5286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_form_errors_as_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method to generate a string from form.errors</span>
<span class="sd">    :param  form: an instance of Django Form class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">error_string</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                             <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">error_string</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.get_recommended_missing_elements" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_recommended_missing_elements</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a list of recommended missing metadata elements.</p>
<p>This method needs to be overriden by any subclass of this class
if they implement additional metadata elements that are required</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5366</span>
<span class="normal">5367</span>
<span class="normal">5368</span>
<span class="normal">5369</span>
<span class="normal">5370</span>
<span class="normal">5371</span>
<span class="normal">5372</span>
<span class="normal">5373</span>
<span class="normal">5374</span>
<span class="normal">5375</span>
<span class="normal">5376</span>
<span class="normal">5377</span>
<span class="normal">5378</span>
<span class="normal">5379</span>
<span class="normal">5380</span>
<span class="normal">5381</span>
<span class="normal">5382</span>
<span class="normal">5383</span>
<span class="normal">5384</span>
<span class="normal">5385</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_recommended_missing_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of recommended missing metadata elements.</span>

<span class="sd">    This method needs to be overriden by any subclass of this class</span>
<span class="sd">    if they implement additional metadata elements that are required</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">missing_recommended_elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;funding_agencies&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">missing_recommended_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Funding Agency&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">readme_file</span> <span class="ow">and</span> <span class="n">resource</span><span class="o">.</span><span class="n">resource_type</span> <span class="o">==</span> <span class="s2">&quot;CompositeResource&quot;</span><span class="p">:</span>
        <span class="n">missing_recommended_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Readme file containing variables, &#39;</span>
                                            <span class="s1">&#39;abbreviations/acronyms, and non-standard file formats&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spatial_coverage&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">and</span> \
            <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;temporal_coverage&#39;</span><span class="p">,</span> <span class="p">{}):</span>
        <span class="n">missing_recommended_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Coverage that describes locations that are related to the dataset&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">missing_recommended_elements</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.get_required_missing_elements" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_required_missing_elements</span><span class="p">(</span><span class="n">desired_state</span><span class="o">=</span><span class="s1">&#39;discoverable&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a list of required missing metadata elements.</p>
<p>This method needs to be overriden by any subclass of this class
if they implement additional metadata elements that are required</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5329</span>
<span class="normal">5330</span>
<span class="normal">5331</span>
<span class="normal">5332</span>
<span class="normal">5333</span>
<span class="normal">5334</span>
<span class="normal">5335</span>
<span class="normal">5336</span>
<span class="normal">5337</span>
<span class="normal">5338</span>
<span class="normal">5339</span>
<span class="normal">5340</span>
<span class="normal">5341</span>
<span class="normal">5342</span>
<span class="normal">5343</span>
<span class="normal">5344</span>
<span class="normal">5345</span>
<span class="normal">5346</span>
<span class="normal">5347</span>
<span class="normal">5348</span>
<span class="normal">5349</span>
<span class="normal">5350</span>
<span class="normal">5351</span>
<span class="normal">5352</span>
<span class="normal">5353</span>
<span class="normal">5354</span>
<span class="normal">5355</span>
<span class="normal">5356</span>
<span class="normal">5357</span>
<span class="normal">5358</span>
<span class="normal">5359</span>
<span class="normal">5360</span>
<span class="normal">5361</span>
<span class="normal">5362</span>
<span class="normal">5363</span>
<span class="normal">5364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_required_missing_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desired_state</span><span class="o">=</span><span class="s1">&#39;discoverable&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of required missing metadata elements.</span>

<span class="sd">    This method needs to be overriden by any subclass of this class</span>
<span class="sd">    if they implement additional metadata elements that are required</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">resource_states</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;discoverable&#39;</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">desired_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resource_states</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Desired resource state is not in: </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource_states</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
    <span class="n">missing_required_elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">desired_state</span> <span class="o">!=</span> <span class="s1">&#39;published&#39;</span><span class="p">:</span>
        <span class="c1"># check for title, abstract, rights, and keywords using cached_metadata</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Title (at least 30 characters)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;untitled resource&#39;</span><span class="p">:</span>
            <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Title (at least 30 characters)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Abstract (at least 150 characters)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rights&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Rights&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subjects&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Keywords (at least 3)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># check for title, abstract, and keywords using cached_metadata</span>
        <span class="n">cached_metadata</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;The title must be at least 30 characters.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">150</span><span class="p">:</span>
            <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;The abstract must be at least 150 characters.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subjects&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;subjects&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">missing_required_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;You must include at least 3 keywords.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">missing_required_elements</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.get_supported_element_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_supported_element_names</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return a list of supported metadata element names.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5258</span>
<span class="normal">5259</span>
<span class="normal">5260</span>
<span class="normal">5261</span>
<span class="normal">5262</span>
<span class="normal">5263</span>
<span class="normal">5264</span>
<span class="normal">5265</span>
<span class="normal">5266</span>
<span class="normal">5267</span>
<span class="normal">5268</span>
<span class="normal">5269</span>
<span class="normal">5270</span>
<span class="normal">5271</span>
<span class="normal">5272</span>
<span class="normal">5273</span>
<span class="normal">5274</span>
<span class="normal">5275</span>
<span class="normal">5276</span>
<span class="normal">5277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_supported_element_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of supported metadata element names.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Citation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Creator&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Contributor&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Coverage&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Format&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Rights&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Title&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Type&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Date&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Identifier&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Language&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Subject&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Relation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;GeospatialRelation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Publisher&#39;</span><span class="p">,</span>
            <span class="s1">&#39;FundingAgency&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.has_all_required_elements" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_all_required_elements</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine whether metadata has all required elements.</p>
<p>This method needs to be overriden by any subclass of this class
if they implement additional metadata elements that are required</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5299</span>
<span class="normal">5300</span>
<span class="normal">5301</span>
<span class="normal">5302</span>
<span class="normal">5303</span>
<span class="normal">5304</span>
<span class="normal">5305</span>
<span class="normal">5306</span>
<span class="normal">5307</span>
<span class="normal">5308</span>
<span class="normal">5309</span>
<span class="normal">5310</span>
<span class="normal">5311</span>
<span class="normal">5312</span>
<span class="normal">5313</span>
<span class="normal">5314</span>
<span class="normal">5315</span>
<span class="normal">5316</span>
<span class="normal">5317</span>
<span class="normal">5318</span>
<span class="normal">5319</span>
<span class="normal">5320</span>
<span class="normal">5321</span>
<span class="normal">5322</span>
<span class="normal">5323</span>
<span class="normal">5324</span>
<span class="normal">5325</span>
<span class="normal">5326</span>
<span class="normal">5327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_all_required_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine whether metadata has all required elements.</span>

<span class="sd">    This method needs to be overriden by any subclass of this class</span>
<span class="sd">    if they implement additional metadata elements that are required</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="p">{}):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;untitled resource&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="p">{}):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;creators&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rights&#39;</span><span class="p">,</span> <span class="p">{}):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="p">[</span><span class="s1">&#39;rights&#39;</span><span class="p">][</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">cached_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subjects&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.ignored_generic_relations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ignored_generic_relations</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override to exclude generic relations from the rdf/xml.  This is built specifically for Format, which is the
only AbstractMetadataElement that is on a metadata model and not included in the rdf/xml.  Returns a list
of classes to be ignored</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5145</span>
<span class="normal">5146</span>
<span class="normal">5147</span>
<span class="normal">5148</span>
<span class="normal">5149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ignored_generic_relations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override to exclude generic relations from the rdf/xml.  This is built specifically for Format, which is the</span>
<span class="sd">    only AbstractMetadataElement that is on a metadata model and not included in the rdf/xml.  Returns a list</span>
<span class="sd">    of classes to be ignored&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Format</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.parse_for_bulk_update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_for_bulk_update</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">parsed_metadata</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Parse the input <em>metadata</em> dict to needed format and store it in
<em>parsed_metadata</em> list
:param  metadata: a dict of metadata that needs to be parsed to get the metadata in the
format needed for updating the metadata elements supported by resource type
:param  parsed_metadata: a list of dicts that will be appended with parsed data</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5194</span>
<span class="normal">5195</span>
<span class="normal">5196</span>
<span class="normal">5197</span>
<span class="normal">5198</span>
<span class="normal">5199</span>
<span class="normal">5200</span>
<span class="normal">5201</span>
<span class="normal">5202</span>
<span class="normal">5203</span>
<span class="normal">5204</span>
<span class="normal">5205</span>
<span class="normal">5206</span>
<span class="normal">5207</span>
<span class="normal">5208</span>
<span class="normal">5209</span>
<span class="normal">5210</span>
<span class="normal">5211</span>
<span class="normal">5212</span>
<span class="normal">5213</span>
<span class="normal">5214</span>
<span class="normal">5215</span>
<span class="normal">5216</span>
<span class="normal">5217</span>
<span class="normal">5218</span>
<span class="normal">5219</span>
<span class="normal">5220</span>
<span class="normal">5221</span>
<span class="normal">5222</span>
<span class="normal">5223</span>
<span class="normal">5224</span>
<span class="normal">5225</span>
<span class="normal">5226</span>
<span class="normal">5227</span>
<span class="normal">5228</span>
<span class="normal">5229</span>
<span class="normal">5230</span>
<span class="normal">5231</span>
<span class="normal">5232</span>
<span class="normal">5233</span>
<span class="normal">5234</span>
<span class="normal">5235</span>
<span class="normal">5236</span>
<span class="normal">5237</span>
<span class="normal">5238</span>
<span class="normal">5239</span>
<span class="normal">5240</span>
<span class="normal">5241</span>
<span class="normal">5242</span>
<span class="normal">5243</span>
<span class="normal">5244</span>
<span class="normal">5245</span>
<span class="normal">5246</span>
<span class="normal">5247</span>
<span class="normal">5248</span>
<span class="normal">5249</span>
<span class="normal">5250</span>
<span class="normal">5251</span>
<span class="normal">5252</span>
<span class="normal">5253</span>
<span class="normal">5254</span>
<span class="normal">5255</span>
<span class="normal">5256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">parse_for_bulk_update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">parsed_metadata</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse the input *metadata* dict to needed format and store it in</span>
<span class="sd">    *parsed_metadata* list</span>
<span class="sd">    :param  metadata: a dict of metadata that needs to be parsed to get the metadata in the</span>
<span class="sd">    format needed for updating the metadata elements supported by resource type</span>
<span class="sd">    :param  parsed_metadata: a list of dicts that will be appended with parsed data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">keys_to_update</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)}})</span>

    <span class="k">if</span> <span class="s1">&#39;creators&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;creators&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;creators&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;creators&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">creator</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;creators&#39;</span><span class="p">):</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;creator&quot;</span><span class="p">:</span> <span class="n">creator</span><span class="p">})</span>

    <span class="k">if</span> <span class="s1">&#39;contributors&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;contributors&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;contributors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;contributors&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">contributor</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;contributors&#39;</span><span class="p">):</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;contributor&quot;</span><span class="p">:</span> <span class="n">contributor</span><span class="p">})</span>

    <span class="k">if</span> <span class="s1">&#39;coverages&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">coverage</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;coverages&#39;</span><span class="p">):</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;coverage&quot;</span><span class="p">:</span> <span class="n">coverage</span><span class="p">})</span>

    <span class="k">if</span> <span class="s1">&#39;dates&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dates&#39;</span><span class="p">):</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="p">})</span>

    <span class="k">if</span> <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;abstract&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)}})</span>

    <span class="k">if</span> <span class="s1">&#39;language&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">)}})</span>

    <span class="k">if</span> <span class="s1">&#39;rights&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;rights&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rights&#39;</span><span class="p">)})</span>

    <span class="k">if</span> <span class="s1">&#39;sources&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sources&#39;</span><span class="p">):</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">})</span>

    <span class="k">if</span> <span class="s1">&#39;subjects&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;subjects&#39;</span><span class="p">):</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">subject</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]}})</span>

    <span class="k">if</span> <span class="s1">&#39;funding_agencies&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">agency</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;funding_agencies&quot;</span><span class="p">):</span>
            <span class="c1"># using fundingagency instead of funding_agency to be consistent with UI</span>
            <span class="c1"># add-metadata logic as well as the term for the metadata element.</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;fundingagency&quot;</span><span class="p">:</span> <span class="n">agency</span><span class="p">})</span>

    <span class="k">if</span> <span class="s1">&#39;relations&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;relations&#39;</span><span class="p">):</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">})</span>

    <span class="k">if</span> <span class="s1">&#39;geospatialrelations&#39;</span> <span class="ow">in</span> <span class="n">keys_to_update</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">relation</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;geospatialrelations&#39;</span><span class="p">):</span>
            <span class="n">parsed_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;geospatialrelation&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.set_dirty" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_dirty</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Track whethrer metadata object is dirty.</p>
<p>Subclasses that have the attribute to track whether metadata object is dirty
should override this method to allow setting that attribute</p>
<p>:param flag: a boolean value
:return:</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5288</span>
<span class="normal">5289</span>
<span class="normal">5290</span>
<span class="normal">5291</span>
<span class="normal">5292</span>
<span class="normal">5293</span>
<span class="normal">5294</span>
<span class="normal">5295</span>
<span class="normal">5296</span>
<span class="normal">5297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_dirty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Track whethrer metadata object is dirty.</span>

<span class="sd">    Subclasses that have the attribute to track whether metadata object is dirty</span>
<span class="sd">    should override this method to allow setting that attribute</span>

<span class="sd">    :param flag: a boolean value</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update method for CoreMetaData model.</p>
<p>:param metadata: a list of dicts - each dict in the format of {element_name: **kwargs}
element_name must be in lowercase.
example of a dict in metadata list:
    {'creator': {'name': 'John Howard', 'email: 'jh@gmail.com'}}
:param  user: user who is updating metadata
:return:</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5444</span>
<span class="normal">5445</span>
<span class="normal">5446</span>
<span class="normal">5447</span>
<span class="normal">5448</span>
<span class="normal">5449</span>
<span class="normal">5450</span>
<span class="normal">5451</span>
<span class="normal">5452</span>
<span class="normal">5453</span>
<span class="normal">5454</span>
<span class="normal">5455</span>
<span class="normal">5456</span>
<span class="normal">5457</span>
<span class="normal">5458</span>
<span class="normal">5459</span>
<span class="normal">5460</span>
<span class="normal">5461</span>
<span class="normal">5462</span>
<span class="normal">5463</span>
<span class="normal">5464</span>
<span class="normal">5465</span>
<span class="normal">5466</span>
<span class="normal">5467</span>
<span class="normal">5468</span>
<span class="normal">5469</span>
<span class="normal">5470</span>
<span class="normal">5471</span>
<span class="normal">5472</span>
<span class="normal">5473</span>
<span class="normal">5474</span>
<span class="normal">5475</span>
<span class="normal">5476</span>
<span class="normal">5477</span>
<span class="normal">5478</span>
<span class="normal">5479</span>
<span class="normal">5480</span>
<span class="normal">5481</span>
<span class="normal">5482</span>
<span class="normal">5483</span>
<span class="normal">5484</span>
<span class="normal">5485</span>
<span class="normal">5486</span>
<span class="normal">5487</span>
<span class="normal">5488</span>
<span class="normal">5489</span>
<span class="normal">5490</span>
<span class="normal">5491</span>
<span class="normal">5492</span>
<span class="normal">5493</span>
<span class="normal">5494</span>
<span class="normal">5495</span>
<span class="normal">5496</span>
<span class="normal">5497</span>
<span class="normal">5498</span>
<span class="normal">5499</span>
<span class="normal">5500</span>
<span class="normal">5501</span>
<span class="normal">5502</span>
<span class="normal">5503</span>
<span class="normal">5504</span>
<span class="normal">5505</span>
<span class="normal">5506</span>
<span class="normal">5507</span>
<span class="normal">5508</span>
<span class="normal">5509</span>
<span class="normal">5510</span>
<span class="normal">5511</span>
<span class="normal">5512</span>
<span class="normal">5513</span>
<span class="normal">5514</span>
<span class="normal">5515</span>
<span class="normal">5516</span>
<span class="normal">5517</span>
<span class="normal">5518</span>
<span class="normal">5519</span>
<span class="normal">5520</span>
<span class="normal">5521</span>
<span class="normal">5522</span>
<span class="normal">5523</span>
<span class="normal">5524</span>
<span class="normal">5525</span>
<span class="normal">5526</span>
<span class="normal">5527</span>
<span class="normal">5528</span>
<span class="normal">5529</span>
<span class="normal">5530</span>
<span class="normal">5531</span>
<span class="normal">5532</span>
<span class="normal">5533</span>
<span class="normal">5534</span>
<span class="normal">5535</span>
<span class="normal">5536</span>
<span class="normal">5537</span>
<span class="normal">5538</span>
<span class="normal">5539</span>
<span class="normal">5540</span>
<span class="normal">5541</span>
<span class="normal">5542</span>
<span class="normal">5543</span>
<span class="normal">5544</span>
<span class="normal">5545</span>
<span class="normal">5546</span>
<span class="normal">5547</span>
<span class="normal">5548</span>
<span class="normal">5549</span>
<span class="normal">5550</span>
<span class="normal">5551</span>
<span class="normal">5552</span>
<span class="normal">5553</span>
<span class="normal">5554</span>
<span class="normal">5555</span>
<span class="normal">5556</span>
<span class="normal">5557</span>
<span class="normal">5558</span>
<span class="normal">5559</span>
<span class="normal">5560</span>
<span class="normal">5561</span>
<span class="normal">5562</span>
<span class="normal">5563</span>
<span class="normal">5564</span>
<span class="normal">5565</span>
<span class="normal">5566</span>
<span class="normal">5567</span>
<span class="normal">5568</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update method for CoreMetaData model.</span>

<span class="sd">    :param metadata: a list of dicts - each dict in the format of {element_name: **kwargs}</span>
<span class="sd">    element_name must be in lowercase.</span>
<span class="sd">    example of a dict in metadata list:</span>
<span class="sd">        {&#39;creator&#39;: {&#39;name&#39;: &#39;John Howard&#39;, &#39;email: &#39;jh@gmail.com&#39;}}</span>
<span class="sd">    :param  user: user who is updating metadata</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="p">(</span><span class="n">AbstractValidationForm</span><span class="p">,</span> <span class="n">ContributorValidationForm</span><span class="p">,</span>
                        <span class="n">CreatorValidationForm</span><span class="p">,</span> <span class="n">FundingAgencyValidationForm</span><span class="p">,</span>
                        <span class="n">GeospatialRelationValidationForm</span><span class="p">,</span>
                        <span class="n">LanguageValidationForm</span><span class="p">,</span> <span class="n">RelationValidationForm</span><span class="p">,</span>
                        <span class="n">RightsValidationForm</span><span class="p">,</span> <span class="n">TitleValidationForm</span><span class="p">)</span>

    <span class="n">validation_forms_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">TitleValidationForm</span><span class="p">,</span>
                                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">AbstractValidationForm</span><span class="p">,</span>
                                <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="n">LanguageValidationForm</span><span class="p">,</span>
                                <span class="s1">&#39;rights&#39;</span><span class="p">:</span> <span class="n">RightsValidationForm</span><span class="p">,</span>
                                <span class="s1">&#39;creator&#39;</span><span class="p">:</span> <span class="n">CreatorValidationForm</span><span class="p">,</span>
                                <span class="s1">&#39;contributor&#39;</span><span class="p">:</span> <span class="n">ContributorValidationForm</span><span class="p">,</span>
                                <span class="s1">&#39;relation&#39;</span><span class="p">:</span> <span class="n">RelationValidationForm</span><span class="p">,</span>
                                <span class="s1">&#39;geospatialrelation&#39;</span><span class="p">:</span> <span class="n">GeospatialRelationValidationForm</span><span class="p">,</span>
                                <span class="s1">&#39;fundingagency&#39;</span><span class="p">:</span> <span class="n">FundingAgencyValidationForm</span>
                                <span class="p">}</span>
    <span class="c1"># updating non-repeatable elements</span>
    <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;rights&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">dict_item</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">dict_item</span><span class="p">:</span>
                    <span class="n">validation_form</span> <span class="o">=</span> <span class="n">validation_forms_mapping</span><span class="p">[</span><span class="n">element_name</span><span class="p">](</span>
                        <span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                        <span class="n">err_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_errors_as_string</span><span class="p">(</span><span class="n">validation_form</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_non_repeatable_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;creator&#39;</span><span class="p">,</span> <span class="s1">&#39;contributor&#39;</span><span class="p">,</span> <span class="s1">&#39;coverage&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;relation&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;geospatialrelation&#39;</span><span class="p">,</span> <span class="s1">&#39;subject&#39;</span><span class="p">):</span>
            <span class="n">subjects</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">dict_item</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">dict_item</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s1">&#39;subject&#39;</span><span class="p">:</span>
                        <span class="n">subject_data</span> <span class="o">=</span> <span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subject_data</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Subject value is missing&quot;</span><span class="p">)</span>
                        <span class="n">subjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_item</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s1">&#39;coverage&#39;</span><span class="p">:</span>
                        <span class="n">coverage_data</span> <span class="o">=</span> <span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coverage_data</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage type data is missing&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coverage_data</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage value data is missing&quot;</span><span class="p">)</span>
                        <span class="n">coverage_value_dict</span> <span class="o">=</span> <span class="n">coverage_data</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                        <span class="n">coverage_type</span> <span class="o">=</span> <span class="n">coverage_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                        <span class="n">Coverage</span><span class="o">.</span><span class="n">validate_coverage_type_value_attributes</span><span class="p">(</span><span class="n">coverage_type</span><span class="p">,</span>
                                                                         <span class="n">coverage_value_dict</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;creator&#39;</span><span class="p">,</span> <span class="s1">&#39;contributor&#39;</span><span class="p">]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">party_data</span> <span class="o">=</span> <span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">]</span>
                            <span class="k">if</span> <span class="s1">&#39;identifiers&#39;</span> <span class="ow">in</span> <span class="n">party_data</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">party_data</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                                    <span class="c1"># convert dict to json for form validation</span>
                                    <span class="n">party_data</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                                        <span class="n">party_data</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid identifier data for &quot;</span>
                                                  <span class="s2">&quot;creator/contributor&quot;</span><span class="p">)</span>
                        <span class="n">validation_form</span> <span class="o">=</span> <span class="n">validation_forms_mapping</span><span class="p">[</span><span class="n">element_name</span><span class="p">](</span>
                            <span class="n">party_data</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">validation_form</span> <span class="o">=</span> <span class="n">validation_forms_mapping</span><span class="p">[</span><span class="n">element_name</span><span class="p">](</span>
                            <span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                        <span class="n">err_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_errors_as_string</span><span class="p">(</span><span class="n">validation_form</span><span class="p">)</span>
                        <span class="n">err_string</span> <span class="o">+=</span> <span class="s2">&quot; element name:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element_name</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_string</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subjects</span><span class="p">:</span>
                <span class="n">subjects_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subjects_set</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">subjects</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Duplicate subject values found&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_repeatable_element</span><span class="p">(</span><span class="n">element_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="c1"># allow only updating or creating date element of type valid</span>
        <span class="n">element_name</span> <span class="o">=</span> <span class="s1">&#39;date&#39;</span>
        <span class="n">date_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">date_dict</span> <span class="k">for</span> <span class="n">date_dict</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">date_dict</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">date_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">date_item</span> <span class="ow">in</span> <span class="n">date_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">date_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">date_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span>
                                            <span class="o">**</span><span class="n">date_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
                        <span class="k">break</span>

        <span class="c1"># allow only updating or creating identifiers which does not have name value</span>
        <span class="c1"># &#39;hydroShareIdentifier&#39;</span>
        <span class="n">element_name</span> <span class="o">=</span> <span class="s1">&#39;identifier&#39;</span>
        <span class="n">identifier_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_dict</span> <span class="k">for</span> <span class="n">id_dict</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">id_dict</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">id_item</span> <span class="ow">in</span> <span class="n">identifier_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;hydroshareidentifier&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span>
                                            <span class="o">**</span><span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>

        <span class="n">element_name</span> <span class="o">=</span> <span class="s1">&#39;fundingagency&#39;</span>
        <span class="n">identifier_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_dict</span> <span class="k">for</span> <span class="n">id_dict</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">id_dict</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">id_item</span> <span class="ow">in</span> <span class="n">identifier_list</span><span class="p">:</span>
                <span class="n">validation_form</span> <span class="o">=</span> <span class="n">validation_forms_mapping</span><span class="p">[</span><span class="n">element_name</span><span class="p">](</span>
                    <span class="n">id_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                    <span class="n">err_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_errors_as_string</span><span class="p">(</span><span class="n">validation_form</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_string</span><span class="p">)</span>
            <span class="c1"># update_repeatable_elements will append an &#39;s&#39; to element_name before getattr,</span>
            <span class="c1"># unless property_name is provided.  I&#39;d like to remove English grammar rules from</span>
            <span class="c1"># our codebase, but in the interest of time, I&#39;ll just add a special case for</span>
            <span class="c1"># handling funding_agencies</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_repeatable_element</span><span class="p">(</span><span class="n">element_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                                           <span class="n">property_name</span><span class="o">=</span><span class="s2">&quot;funding_agencies&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.update_element" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update metadata element.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5596</span>
<span class="normal">5597</span>
<span class="normal">5598</span>
<span class="normal">5599</span>
<span class="normal">5600</span>
<span class="normal">5601</span>
<span class="normal">5602</span>
<span class="normal">5603</span>
<span class="normal">5604</span>
<span class="normal">5605</span>
<span class="normal">5606</span>
<span class="normal">5607</span>
<span class="normal">5608</span>
<span class="normal">5609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_model_name</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update metadata element.&quot;&quot;&quot;</span>
    <span class="n">model_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metadata_element_model_type</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="n">element_model_name</span> <span class="o">=</span> <span class="n">element_model_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
    <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element_model_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;creator&#39;</span><span class="p">,</span> <span class="s1">&#39;rights&#39;</span><span class="p">,</span> <span class="s1">&#39;identifier&#39;</span><span class="p">,</span> <span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;publisher&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> can&#39;t be updated for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element_model_name</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">element_model_name</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
            <span class="n">date_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">date_type</span> <span class="ow">and</span> <span class="n">date_type</span> <span class="o">!=</span> <span class="s1">&#39;modified&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> date can&#39;t be updated for a published resource&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date_type</span><span class="p">))</span>
    <span class="n">model_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.update_non_repeatable_element" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_non_repeatable_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">property_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update a non-repeatable metadata element.</p>
<p>This helper function is to create/update a specific metadata element as specified by
<em>element_name</em>
:param element_name: metadata element class name (e.g. title)
:param metadata: a list of dicts - each dict has data to update/create a specific metadata
element (e.g. {'title': {'value': 'my resource title'}}
:param property_name: name of the property/attribute name in this class or its sub class
to access the metadata element instance of <em>metadata_element</em>. This is needed only when
the property/attribute name differs from the element class name</p>
<pre><code>Example:
class ModelProgramMetaData(CoreMetaData):
    _mpmetadata = GenericRelation(MpMetadata)

    @property
    def program(self):
        return self._mpmetadata.all().first()

For the above class to update the metadata element MpMetadata, this function needs to
be called with element_name='mpmetadata' and property_name='program'
</code></pre>
<p>:return:</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5651</span>
<span class="normal">5652</span>
<span class="normal">5653</span>
<span class="normal">5654</span>
<span class="normal">5655</span>
<span class="normal">5656</span>
<span class="normal">5657</span>
<span class="normal">5658</span>
<span class="normal">5659</span>
<span class="normal">5660</span>
<span class="normal">5661</span>
<span class="normal">5662</span>
<span class="normal">5663</span>
<span class="normal">5664</span>
<span class="normal">5665</span>
<span class="normal">5666</span>
<span class="normal">5667</span>
<span class="normal">5668</span>
<span class="normal">5669</span>
<span class="normal">5670</span>
<span class="normal">5671</span>
<span class="normal">5672</span>
<span class="normal">5673</span>
<span class="normal">5674</span>
<span class="normal">5675</span>
<span class="normal">5676</span>
<span class="normal">5677</span>
<span class="normal">5678</span>
<span class="normal">5679</span>
<span class="normal">5680</span>
<span class="normal">5681</span>
<span class="normal">5682</span>
<span class="normal">5683</span>
<span class="normal">5684</span>
<span class="normal">5685</span>
<span class="normal">5686</span>
<span class="normal">5687</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_non_repeatable_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">property_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a non-repeatable metadata element.</span>

<span class="sd">    This helper function is to create/update a specific metadata element as specified by</span>
<span class="sd">    *element_name*</span>
<span class="sd">    :param element_name: metadata element class name (e.g. title)</span>
<span class="sd">    :param metadata: a list of dicts - each dict has data to update/create a specific metadata</span>
<span class="sd">    element (e.g. {&#39;title&#39;: {&#39;value&#39;: &#39;my resource title&#39;}}</span>
<span class="sd">    :param property_name: name of the property/attribute name in this class or its sub class</span>
<span class="sd">    to access the metadata element instance of *metadata_element*. This is needed only when</span>
<span class="sd">    the property/attribute name differs from the element class name</span>

<span class="sd">        Example:</span>
<span class="sd">        class ModelProgramMetaData(CoreMetaData):</span>
<span class="sd">            _mpmetadata = GenericRelation(MpMetadata)</span>

<span class="sd">            @property</span>
<span class="sd">            def program(self):</span>
<span class="sd">                return self._mpmetadata.all().first()</span>

<span class="sd">        For the above class to update the metadata element MpMetadata, this function needs to</span>
<span class="sd">        be called with element_name=&#39;mpmetadata&#39; and property_name=&#39;program&#39;</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">dict_item</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">dict_item</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">property_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">element</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">element</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">property_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_element</span><span class="p">(</span><span class="n">element_id</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                    <span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">dict_item</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.CoreMetaData.update_repeatable_element" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_repeatable_element</span><span class="p">(</span><span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">property_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update a repeatable metadata element.</p>
<p>Creates new metadata elements of type <em>element_name</em>. Any existing metadata elements of
matching type get deleted first.
:param element_name: class name of the metadata element (e.g. creator)
:param metadata: a list of dicts containing data for each of the metadata elements that
needs to be created/updated as part of bulk update
:param property_name: (Optional) the property/attribute name used in this instance of
CoreMetaData (or its sub class) to access all the objects of type <em>element_type</em>
    Example:
    class MODFLOWModelInstanceMetaData(ModelInstanceMetaData):
         _model_input = GenericRelation(ModelInput)</p>
<pre><code>    @property
    def model_inputs(self):
        return self._model_input.all()

For the above class to update the metadata element ModelInput, this function needs to
be called with element_name='modelinput' and property_name='model_inputs'. If in the
above class instead of using the attribute name '_model_inputs' we have used
'modelinputs' then this function needs to be called with element_name='modelinput' and
no need to pass a value for the property_name.
</code></pre>
<p>:return:</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5689</span>
<span class="normal">5690</span>
<span class="normal">5691</span>
<span class="normal">5692</span>
<span class="normal">5693</span>
<span class="normal">5694</span>
<span class="normal">5695</span>
<span class="normal">5696</span>
<span class="normal">5697</span>
<span class="normal">5698</span>
<span class="normal">5699</span>
<span class="normal">5700</span>
<span class="normal">5701</span>
<span class="normal">5702</span>
<span class="normal">5703</span>
<span class="normal">5704</span>
<span class="normal">5705</span>
<span class="normal">5706</span>
<span class="normal">5707</span>
<span class="normal">5708</span>
<span class="normal">5709</span>
<span class="normal">5710</span>
<span class="normal">5711</span>
<span class="normal">5712</span>
<span class="normal">5713</span>
<span class="normal">5714</span>
<span class="normal">5715</span>
<span class="normal">5716</span>
<span class="normal">5717</span>
<span class="normal">5718</span>
<span class="normal">5719</span>
<span class="normal">5720</span>
<span class="normal">5721</span>
<span class="normal">5722</span>
<span class="normal">5723</span>
<span class="normal">5724</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_repeatable_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">property_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a repeatable metadata element.</span>

<span class="sd">    Creates new metadata elements of type *element_name*. Any existing metadata elements of</span>
<span class="sd">    matching type get deleted first.</span>
<span class="sd">    :param element_name: class name of the metadata element (e.g. creator)</span>
<span class="sd">    :param metadata: a list of dicts containing data for each of the metadata elements that</span>
<span class="sd">    needs to be created/updated as part of bulk update</span>
<span class="sd">    :param property_name: (Optional) the property/attribute name used in this instance of</span>
<span class="sd">    CoreMetaData (or its sub class) to access all the objects of type *element_type*</span>
<span class="sd">        Example:</span>
<span class="sd">        class MODFLOWModelInstanceMetaData(ModelInstanceMetaData):</span>
<span class="sd">             _model_input = GenericRelation(ModelInput)</span>

<span class="sd">            @property</span>
<span class="sd">            def model_inputs(self):</span>
<span class="sd">                return self._model_input.all()</span>

<span class="sd">        For the above class to update the metadata element ModelInput, this function needs to</span>
<span class="sd">        be called with element_name=&#39;modelinput&#39; and property_name=&#39;model_inputs&#39;. If in the</span>
<span class="sd">        above class instead of using the attribute name &#39;_model_inputs&#39; we have used</span>
<span class="sd">        &#39;modelinputs&#39; then this function needs to be called with element_name=&#39;modelinput&#39; and</span>
<span class="sd">        no need to pass a value for the property_name.</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">element_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">element_dict</span> <span class="k">for</span> <span class="n">element_dict</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">element_dict</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">property_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_name</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">property_name</span><span class="p">)</span>

        <span class="n">elements</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">element_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_model_name</span><span class="o">=</span><span class="n">element_name</span><span class="p">,</span> <span class="o">**</span><span class="n">element</span><span class="p">[</span><span class="n">element_name</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Coverage" class="doc doc-heading">
            <code>Coverage</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Coverage custom metadata element model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">coverage</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Coverage</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Coverage custom metadata element model.&quot;&quot;&quot;</span>

    <span class="n">COVERAGE_TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="s1">&#39;Box&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;point&#39;</span><span class="p">,</span> <span class="s1">&#39;Point&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;Period&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Coverage&#39;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">COVERAGE_TYPES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return {type} {value} for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Coverage model.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    _value field stores a json string. The content of the json</span>
<span class="sd">     string depends on the type of coverage as shown below. All keys shown in</span>
<span class="sd">     json string are required.</span>

<span class="sd">     For coverage type: period</span>
<span class="sd">         _value = &quot;{&#39;name&#39;:coverage name value here (optional), &#39;start&#39;:start date value,</span>
<span class="sd">         &#39;end&#39;:end date value, &#39;scheme&#39;:&#39;W3C-DTF}&quot;</span>

<span class="sd">     For coverage type: point</span>
<span class="sd">         _value = &quot;{&#39;east&#39;:east coordinate value,</span>
<span class="sd">                    &#39;north&#39;:north coordinate value,</span>
<span class="sd">                    &#39;units:units applying to (east. north),</span>
<span class="sd">                    &#39;name&#39;:coverage name value here (optional),</span>
<span class="sd">                    &#39;elevation&#39;: coordinate in the vertical direction (optional),</span>
<span class="sd">                    &#39;zunits&#39;: units for elevation (optional),</span>
<span class="sd">                    &#39;projection&#39;: name of the projection (optional),</span>
<span class="sd">                    }&quot;</span>

<span class="sd">     For coverage type: box</span>
<span class="sd">         _value = &quot;{&#39;northlimit&#39;:northenmost coordinate value,</span>
<span class="sd">                    &#39;eastlimit&#39;:easternmost coordinate value,</span>
<span class="sd">                    &#39;southlimit&#39;:southernmost coordinate value,</span>
<span class="sd">                    &#39;westlimit&#39;:westernmost coordinate value,</span>
<span class="sd">                    &#39;units:units applying to 4 limits (north, east, south &amp; east),</span>
<span class="sd">                    &#39;name&#39;:coverage name value here (optional),</span>
<span class="sd">                    &#39;uplimit&#39;:uppermost coordinate value (optional),</span>
<span class="sd">                    &#39;downlimit&#39;:lowermost coordinate value (optional),</span>
<span class="sd">                    &#39;zunits&#39;: units for uplimit/downlimit (optional),</span>
<span class="sd">                    &#39;projection&#39;: name of the projection (optional)}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return json representation of coverage values.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for Coverage model.</span>

<span class="sd">        data for the coverage value attribute must be provided as a dictionary</span>
<span class="sd">        Note that kwargs[&#39;_value&#39;] is a JSON-serialized unicode string dictionary</span>
<span class="sd">        generated from django.forms.models.model_to_dict() which converts model values</span>
<span class="sd">        to dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># check the type doesn&#39;t already exists - we allow only one coverage type per resource</span>
            <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
            <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">COVERAGE_TYPES</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid coverage type:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
                <span class="c1"># check that there is not already a coverage of point type</span>
                <span class="n">coverage</span> <span class="o">=</span> <span class="n">Coverage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;point&#39;</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                                   <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">coverage</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage type &#39;Box&#39; can&#39;t be created when there &quot;</span>
                                          <span class="s2">&quot;is a coverage of type &#39;Point&#39;&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                <span class="c1"># check that there is not already a coverage of box type</span>
                <span class="n">coverage</span> <span class="o">=</span> <span class="n">Coverage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                                   <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">coverage</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage type &#39;Point&#39; can&#39;t be created when &quot;</span>
                                          <span class="s2">&quot;there is a coverage of type &#39;Box&#39;&quot;</span><span class="p">)</span>

            <span class="n">value_arg_dict</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">value_arg_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s1">&#39;_value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">value_arg_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;_value&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">value_arg_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">validate_coverage_type_value_attributes</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">value_arg_dict</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;period&#39;</span><span class="p">:</span>
                    <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">value_arg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                                  <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)}</span>
                <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                    <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">value_arg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                                  <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;zunits&#39;</span><span class="p">,</span> <span class="s1">&#39;projection&#39;</span><span class="p">)}</span>
                <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
                    <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">value_arg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                                  <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;northlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;eastlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;southlimit&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;westlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;uplimit&#39;</span><span class="p">,</span> <span class="s1">&#39;downlimit&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;zunits&#39;</span><span class="p">,</span> <span class="s1">&#39;projection&#39;</span><span class="p">)}</span>

                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;projection&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span><span class="p">:</span>
                        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;WGS 84 EPSG:4326&#39;</span>

                <span class="n">value_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value_dict</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_json</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Coverage</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Coverage value is missing.&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type of coverage element is missing.&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for Coverage model.</span>

<span class="sd">        data for the coverage value attribute must be provided as a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">Coverage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

        <span class="n">changing_coverage_type</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">changing_coverage_type</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">validate_coverage_type_value_attributes</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Coverage value is missing.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">changing_coverage_type</span><span class="p">:</span>
                <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_dict</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">value</span>

            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;period&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                        <span class="n">value_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">item_name</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;zunits&#39;</span><span class="p">,</span> <span class="s1">&#39;projection&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                        <span class="n">value_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">item_name</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;northlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;eastlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;southlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;westlimit&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;uplimit&#39;</span><span class="p">,</span> <span class="s1">&#39;downlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;zunits&#39;</span><span class="p">,</span> <span class="s1">&#39;projection&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                        <span class="n">value_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">item_name</span><span class="p">]</span>

            <span class="n">value_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value_dict</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_json</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Coverage</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Coverage model.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage element can&#39;t be deleted.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_to_xml_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update etree SubElement container with coverage values.&quot;&quot;&quot;</span>
        <span class="n">NAMESPACES</span> <span class="o">=</span> <span class="n">CoreMetaData</span><span class="o">.</span><span class="n">NAMESPACES</span>
        <span class="n">dc_coverage</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}coverage&#39;</span> <span class="o">%</span> <span class="n">NAMESPACES</span><span class="p">[</span><span class="s1">&#39;dc&#39;</span><span class="p">])</span>
        <span class="n">cov_dcterm</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
        <span class="n">dc_coverage_dcterms</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">dc_coverage</span><span class="p">,</span>
                                               <span class="n">cov_dcterm</span> <span class="o">%</span> <span class="n">NAMESPACES</span><span class="p">[</span><span class="s1">&#39;dcterms&#39;</span><span class="p">])</span>
        <span class="n">rdf_coverage_value</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">dc_coverage_dcterms</span><span class="p">,</span>
                                              <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}value&#39;</span> <span class="o">%</span> <span class="n">NAMESPACES</span><span class="p">[</span><span class="s1">&#39;rdf&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;period&#39;</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>
            <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;start=</span><span class="si">%s</span><span class="s1">; end=</span><span class="si">%s</span><span class="s1">; scheme=W3C-DTF&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                                                              <span class="n">end_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>

            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;name=</span><span class="si">%s</span><span class="s1">; &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cov_value</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;east=</span><span class="si">%s</span><span class="s1">; north=</span><span class="si">%s</span><span class="s1">; units=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">],</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">],</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;name=</span><span class="si">%s</span><span class="s1">; &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cov_value</span>
            <span class="k">if</span> <span class="s1">&#39;elevation&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; elevation=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;zunits&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; zunits=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;zunits&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;projection&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; projection=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this is box type</span>
            <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;northlimit=</span><span class="si">%s</span><span class="s1">; eastlimit=</span><span class="si">%s</span><span class="s1">; southlimit=</span><span class="si">%s</span><span class="s1">; westlimit=</span><span class="si">%s</span><span class="s1">; units=</span><span class="si">%s</span><span class="s1">&#39;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;name=</span><span class="si">%s</span><span class="s1">; &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cov_value</span>
            <span class="k">if</span> <span class="s1">&#39;uplimit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; uplimit=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;uplimit&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;downlimit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; downlimit=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;downlimit&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;uplimit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="s1">&#39;downlimit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; zunits=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;zunits&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;projection&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; projection=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span>

        <span class="n">rdf_coverage_value</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">cov_value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">cov</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">triples</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">cov</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">cov</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">RDF</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key_value</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
                <span class="n">key_value</span> <span class="o">=</span> <span class="n">key_value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">key_value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">]:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
                <span class="n">value_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">Coverage</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value_dict</span><span class="p">,</span> <span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">coverage</span> <span class="o">=</span> <span class="n">BNode</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="n">coverage</span><span class="p">))</span>
        <span class="n">DCTERMS_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">DCTERMS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">coverage</span><span class="p">,</span> <span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">DCTERMS_type</span><span class="p">))</span>
        <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">]:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="n">value_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">value_string</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;=&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)])</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">coverage</span><span class="p">,</span> <span class="n">RDF</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Literal</span><span class="p">(</span><span class="n">value_string</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_coverage_type_value_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">coverage_type</span><span class="p">,</span> <span class="n">value_dict</span><span class="p">,</span> <span class="n">use_limit_postfix</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate values based on coverage type.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">compute_longitude</span><span class="p">(</span><span class="n">key_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">and</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">360</span><span class="p">:</span>
                <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">+</span> <span class="mi">360</span>
            <span class="k">elif</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">360</span><span class="p">:</span>
                <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span>
            <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">or</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid value for </span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">. Value for </span><span class="si">{}</span><span class="s2"> longitude should be in the range of -180 to 180&quot;</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="n">err_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key_name</span><span class="p">,</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">],</span> <span class="n">key_name</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">coverage_type</span> <span class="o">==</span> <span class="s1">&#39;period&#39;</span><span class="p">:</span>
            <span class="c1"># check that all the required sub-elements exist</span>
            <span class="k">if</span> <span class="s1">&#39;start&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span> <span class="ow">or</span> <span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For coverage of type &#39;period&#39; values for both start date &quot;</span>
                                      <span class="s2">&quot;and end date are needed.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">coverage_type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
            <span class="c1"># check that all the required sub-elements exist</span>
            <span class="k">if</span> <span class="s1">&#39;east&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span> <span class="ow">or</span> <span class="s1">&#39;north&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span> <span class="ow">or</span> <span class="s1">&#39;units&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For coverage of type &#39;point&#39; values for &#39;east&#39;, &#39;north&#39; &quot;</span>
                                      <span class="s2">&quot;and &#39;units&#39; are needed.&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">value_item</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;north&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value_dict</span><span class="p">[</span><span class="n">value_item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_dict</span><span class="p">[</span><span class="n">value_item</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for &#39;</span><span class="si">{}</span><span class="s2">&#39; must be numeric&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value_item</span><span class="p">))</span>

            <span class="n">compute_longitude</span><span class="p">(</span><span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;east&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for North latitude should be &quot;</span>
                                      <span class="s2">&quot;in the range of -90 to 90&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">coverage_type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="c1"># check that all the required sub-elements exist</span>
            <span class="n">box_key_names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;north&#39;</span><span class="p">:</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">:</span> <span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;south&#39;</span><span class="p">:</span> <span class="s1">&#39;south&#39;</span><span class="p">,</span> <span class="s1">&#39;west&#39;</span><span class="p">:</span> <span class="s1">&#39;west&#39;</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">use_limit_postfix</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">box_key_names</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">box_key_names</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">limit&quot;</span>
            <span class="n">required_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">box_key_names</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">value_item</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value_item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For coverage of type &#39;box&#39; values for one or more &quot;</span>
                                          <span class="s2">&quot;bounding box limits or &#39;units&#39; is missing.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value_item</span> <span class="o">!=</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">value_dict</span><span class="p">[</span><span class="n">value_item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_dict</span><span class="p">[</span><span class="n">value_item</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for &#39;</span><span class="si">{}</span><span class="s2">&#39; must be numeric&quot;</span>
                                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value_item</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for North latitude should be &quot;</span>
                                      <span class="s2">&quot;in the range of -90 to 90&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for South latitude should be &quot;</span>
                                      <span class="s2">&quot;in the range of -90 to 90&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for North latitude must be greater than or &quot;</span>
                                          <span class="s2">&quot;equal to that of South latitude.&quot;</span><span class="p">)</span>

            <span class="n">compute_longitude</span><span class="p">(</span><span class="n">key_name</span><span class="o">=</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">])</span>
            <span class="n">compute_longitude</span><span class="p">(</span><span class="n">key_name</span><span class="o">=</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;west&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use the dominate module to generate element display HTML.</span>

<span class="sd">        This function should be used for displaying one spatial coverage element</span>
<span class="sd">        or one temporal coverage element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root_div</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;content-block&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_th</span><span class="p">(</span><span class="n">heading_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">th</span><span class="p">(</span><span class="n">heading_name</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="s2">&quot;text-muted&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">root_div</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                <span class="n">legend</span><span class="p">(</span><span class="s1">&#39;Spatial Coverage&#39;</span><span class="p">)</span>
                <span class="n">div</span><span class="p">(</span><span class="s1">&#39;Coordinate Reference System&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;text-muted&#39;</span><span class="p">)</span>
                <span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">])</span>
                <span class="n">div</span><span class="p">(</span><span class="s1">&#39;Coordinate Reference System Unit&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;text-muted has-space-top&#39;</span><span class="p">)</span>
                <span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
                <span class="n">h4</span><span class="p">(</span><span class="s1">&#39;Extent&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;space-top&#39;</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">table</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;custom-table&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">tbody</span><span class="p">():</span>
                            <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                                <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;North&#39;</span><span class="p">)</span>
                                <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">])</span>
                            <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                                <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;West&#39;</span><span class="p">)</span>
                                <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">])</span>
                            <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                                <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;South&#39;</span><span class="p">)</span>
                                <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">])</span>
                            <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                                <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;East&#39;</span><span class="p">)</span>
                                <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                            <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;North&#39;</span><span class="p">)</span>
                            <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">])</span>
                        <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                            <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;East&#39;</span><span class="p">)</span>
                            <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">legend</span><span class="p">(</span><span class="s1">&#39;Temporal Coverage&#39;</span><span class="p">)</span>
                <span class="n">start_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
                <span class="n">end_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>
                <span class="k">with</span> <span class="n">table</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;custom-table&#39;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">tbody</span><span class="p">():</span>
                        <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                            <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;Start Date&#39;</span><span class="p">)</span>
                            <span class="n">td</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">))</span>
                        <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                            <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;End Date&#39;</span><span class="p">)</span>
                            <span class="n">td</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">root_div</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">pretty</span><span class="o">=</span><span class="n">pretty</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_temporal_html_form</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return CoverageTemporalForm for Coverage model.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CoverageTemporalForm</span>
        <span class="n">coverage_data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>
            <span class="c1"># change the date format to match with datepicker date format</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>

        <span class="n">coverage_form</span> <span class="o">=</span> <span class="n">CoverageTemporalForm</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">coverage_data_dict</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="n">allow_edit</span><span class="p">,</span>
                                             <span class="n">res_short_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span> <span class="k">if</span> <span class="n">resource</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                             <span class="n">element_id</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">element</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                             <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coverage_form</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_spatial_html_form</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return SpatialCoverageForm for Coverage model.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CoverageSpatialForm</span>
        <span class="n">coverage_data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
                <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">]</span>
                <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">]</span>
                <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">]</span>
                <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span>
                <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>
                <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">coverage_form</span> <span class="o">=</span> <span class="n">CoverageSpatialForm</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">coverage_data_dict</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="n">allow_edit</span><span class="p">,</span>
                                            <span class="n">res_short_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span> <span class="k">if</span> <span class="n">resource</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                            <span class="n">element_id</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">element</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                            <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coverage_form</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.Coverage.value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">value</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return json representation of coverage values.</p>

    </div>

</div>



<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Coverage.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Coverage model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Coverage model.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Coverage.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return {type} {value} for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return {type} {value} for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Coverage.add_to_xml_container" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_to_xml_container</span><span class="p">(</span><span class="n">container</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update etree SubElement container with coverage values.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_to_xml_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update etree SubElement container with coverage values.&quot;&quot;&quot;</span>
    <span class="n">NAMESPACES</span> <span class="o">=</span> <span class="n">CoreMetaData</span><span class="o">.</span><span class="n">NAMESPACES</span>
    <span class="n">dc_coverage</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}coverage&#39;</span> <span class="o">%</span> <span class="n">NAMESPACES</span><span class="p">[</span><span class="s1">&#39;dc&#39;</span><span class="p">])</span>
    <span class="n">cov_dcterm</span> <span class="o">=</span> <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
    <span class="n">dc_coverage_dcterms</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">dc_coverage</span><span class="p">,</span>
                                           <span class="n">cov_dcterm</span> <span class="o">%</span> <span class="n">NAMESPACES</span><span class="p">[</span><span class="s1">&#39;dcterms&#39;</span><span class="p">])</span>
    <span class="n">rdf_coverage_value</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">dc_coverage_dcterms</span><span class="p">,</span>
                                          <span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}value&#39;</span> <span class="o">%</span> <span class="n">NAMESPACES</span><span class="p">[</span><span class="s1">&#39;rdf&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;period&#39;</span><span class="p">:</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>
        <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;start=</span><span class="si">%s</span><span class="s1">; end=</span><span class="si">%s</span><span class="s1">; scheme=W3C-DTF&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                                                          <span class="n">end_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>

        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;name=</span><span class="si">%s</span><span class="s1">; &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cov_value</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
        <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;east=</span><span class="si">%s</span><span class="s1">; north=</span><span class="si">%s</span><span class="s1">; units=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">],</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">],</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;name=</span><span class="si">%s</span><span class="s1">; &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cov_value</span>
        <span class="k">if</span> <span class="s1">&#39;elevation&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; elevation=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;zunits&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; zunits=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;zunits&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;projection&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; projection=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># this is box type</span>
        <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;northlimit=</span><span class="si">%s</span><span class="s1">; eastlimit=</span><span class="si">%s</span><span class="s1">; southlimit=</span><span class="si">%s</span><span class="s1">; westlimit=</span><span class="si">%s</span><span class="s1">; units=</span><span class="si">%s</span><span class="s1">&#39;</span> \
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">],</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">],</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">=</span> <span class="s1">&#39;name=</span><span class="si">%s</span><span class="s1">; &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cov_value</span>
        <span class="k">if</span> <span class="s1">&#39;uplimit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; uplimit=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;uplimit&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;downlimit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; downlimit=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;downlimit&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;uplimit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="s1">&#39;downlimit&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; zunits=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;zunits&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;projection&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">cov_value</span> <span class="o">+=</span> <span class="s1">&#39;; projection=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span>

    <span class="n">rdf_coverage_value</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">cov_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Coverage.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for Coverage model.</p>
<p>data for the coverage value attribute must be provided as a dictionary
Note that kwargs['_value'] is a JSON-serialized unicode string dictionary
generated from django.forms.models.model_to_dict() which converts model values
to dictionaries.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for Coverage model.</span>

<span class="sd">    data for the coverage value attribute must be provided as a dictionary</span>
<span class="sd">    Note that kwargs[&#39;_value&#39;] is a JSON-serialized unicode string dictionary</span>
<span class="sd">    generated from django.forms.models.model_to_dict() which converts model values</span>
<span class="sd">    to dictionaries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="c1"># check the type doesn&#39;t already exists - we allow only one coverage type per resource</span>
        <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
        <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">COVERAGE_TYPES</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid coverage type:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="c1"># check that there is not already a coverage of point type</span>
            <span class="n">coverage</span> <span class="o">=</span> <span class="n">Coverage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;point&#39;</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                               <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">coverage</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage type &#39;Box&#39; can&#39;t be created when there &quot;</span>
                                      <span class="s2">&quot;is a coverage of type &#39;Point&#39;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
            <span class="c1"># check that there is not already a coverage of box type</span>
            <span class="n">coverage</span> <span class="o">=</span> <span class="n">Coverage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                               <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">coverage</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage type &#39;Point&#39; can&#39;t be created when &quot;</span>
                                      <span class="s2">&quot;there is a coverage of type &#39;Box&#39;&quot;</span><span class="p">)</span>

        <span class="n">value_arg_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">value_arg_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;_value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">value_arg_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;_value&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">value_arg_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">validate_coverage_type_value_attributes</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">value_arg_dict</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;period&#39;</span><span class="p">:</span>
                <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">value_arg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                              <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)}</span>
            <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">value_arg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                              <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;zunits&#39;</span><span class="p">,</span> <span class="s1">&#39;projection&#39;</span><span class="p">)}</span>
            <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
                <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">value_arg_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                              <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;northlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;eastlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;southlimit&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;westlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;uplimit&#39;</span><span class="p">,</span> <span class="s1">&#39;downlimit&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;zunits&#39;</span><span class="p">,</span> <span class="s1">&#39;projection&#39;</span><span class="p">)}</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;projection&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span><span class="p">:</span>
                    <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;WGS 84 EPSG:4326&#39;</span>

            <span class="n">value_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value_dict</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_json</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Coverage</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Coverage value is missing.&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type of coverage element is missing.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Coverage.get_html" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_html</span><span class="p">(</span><span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Use the dominate module to generate element display HTML.</p>
<p>This function should be used for displaying one spatial coverage element
or one temporal coverage element</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use the dominate module to generate element display HTML.</span>

<span class="sd">    This function should be used for displaying one spatial coverage element</span>
<span class="sd">    or one temporal coverage element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root_div</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;content-block&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_th</span><span class="p">(</span><span class="n">heading_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">th</span><span class="p">(</span><span class="n">heading_name</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="s2">&quot;text-muted&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">root_div</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
            <span class="n">legend</span><span class="p">(</span><span class="s1">&#39;Spatial Coverage&#39;</span><span class="p">)</span>
            <span class="n">div</span><span class="p">(</span><span class="s1">&#39;Coordinate Reference System&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;text-muted&#39;</span><span class="p">)</span>
            <span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">])</span>
            <span class="n">div</span><span class="p">(</span><span class="s1">&#39;Coordinate Reference System Unit&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;text-muted has-space-top&#39;</span><span class="p">)</span>
            <span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
            <span class="n">h4</span><span class="p">(</span><span class="s1">&#39;Extent&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;space-top&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">table</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;custom-table&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">tbody</span><span class="p">():</span>
                        <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                            <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;North&#39;</span><span class="p">)</span>
                            <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">])</span>
                        <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                            <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;West&#39;</span><span class="p">)</span>
                            <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">])</span>
                        <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                            <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;South&#39;</span><span class="p">)</span>
                            <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">])</span>
                        <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                            <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;East&#39;</span><span class="p">)</span>
                            <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                        <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;North&#39;</span><span class="p">)</span>
                        <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">])</span>
                    <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                        <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;East&#39;</span><span class="p">)</span>
                        <span class="n">td</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">legend</span><span class="p">(</span><span class="s1">&#39;Temporal Coverage&#39;</span><span class="p">)</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">table</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;custom-table&#39;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">tbody</span><span class="p">():</span>
                    <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                        <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;Start Date&#39;</span><span class="p">)</span>
                        <span class="n">td</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">))</span>
                    <span class="k">with</span> <span class="n">tr</span><span class="p">():</span>
                        <span class="n">get_th</span><span class="p">(</span><span class="s1">&#39;End Date&#39;</span><span class="p">)</span>
                        <span class="n">td</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">root_div</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">pretty</span><span class="o">=</span><span class="n">pretty</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Coverage.get_spatial_html_form" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_spatial_html_form</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return SpatialCoverageForm for Coverage model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_spatial_html_form</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return SpatialCoverageForm for Coverage model.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CoverageSpatialForm</span>
    <span class="n">coverage_data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span>
        <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;northlimit&#39;</span><span class="p">]</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;eastlimit&#39;</span><span class="p">]</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;southlimit&#39;</span><span class="p">]</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;westlimit&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>
            <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">coverage_form</span> <span class="o">=</span> <span class="n">CoverageSpatialForm</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">coverage_data_dict</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="n">allow_edit</span><span class="p">,</span>
                                        <span class="n">res_short_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span> <span class="k">if</span> <span class="n">resource</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                        <span class="n">element_id</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">element</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                        <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coverage_form</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Coverage.get_temporal_html_form" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_temporal_html_form</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return CoverageTemporalForm for Coverage model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_temporal_html_form</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return CoverageTemporalForm for Coverage model.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CoverageTemporalForm</span>
    <span class="n">coverage_data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>
        <span class="c1"># change the date format to match with datepicker date format</span>
        <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
        <span class="n">coverage_data_dict</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>

    <span class="n">coverage_form</span> <span class="o">=</span> <span class="n">CoverageTemporalForm</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">coverage_data_dict</span><span class="p">,</span> <span class="n">allow_edit</span><span class="o">=</span><span class="n">allow_edit</span><span class="p">,</span>
                                         <span class="n">res_short_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span> <span class="k">if</span> <span class="n">resource</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                         <span class="n">element_id</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">element</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                                         <span class="n">file_type</span><span class="o">=</span><span class="n">file_type</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coverage_form</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Coverage.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom remove method for Coverage model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Coverage model.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Coverage element can&#39;t be deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Coverage.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for Coverage model.</p>
<p>data for the coverage value attribute must be provided as a dictionary</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for Coverage model.</span>

<span class="sd">    data for the coverage value attribute must be provided as a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="n">Coverage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

    <span class="n">changing_coverage_type</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">changing_coverage_type</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">validate_coverage_type_value_attributes</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Coverage value is missing.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">changing_coverage_type</span><span class="p">:</span>
            <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_dict</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
            <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;period&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                    <span class="n">value_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">item_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;zunits&#39;</span><span class="p">,</span> <span class="s1">&#39;projection&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                    <span class="n">value_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">item_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">cov</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;northlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;eastlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;southlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;westlimit&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;uplimit&#39;</span><span class="p">,</span> <span class="s1">&#39;downlimit&#39;</span><span class="p">,</span> <span class="s1">&#39;zunits&#39;</span><span class="p">,</span> <span class="s1">&#39;projection&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                    <span class="n">value_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">item_name</span><span class="p">]</span>

        <span class="n">value_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value_dict</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_json</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">Coverage</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Coverage.validate_coverage_type_value_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_coverage_type_value_attributes</span><span class="p">(</span><span class="n">coverage_type</span><span class="p">,</span> <span class="n">value_dict</span><span class="p">,</span> <span class="n">use_limit_postfix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Validate values based on coverage type.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">validate_coverage_type_value_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">coverage_type</span><span class="p">,</span> <span class="n">value_dict</span><span class="p">,</span> <span class="n">use_limit_postfix</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate values based on coverage type.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">compute_longitude</span><span class="p">(</span><span class="n">key_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">and</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">360</span><span class="p">:</span>
            <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">+</span> <span class="mi">360</span>
        <span class="k">elif</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span>
        <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">or</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid value for </span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">. Value for </span><span class="si">{}</span><span class="s2"> longitude should be in the range of -180 to 180&quot;</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="n">err_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key_name</span><span class="p">,</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">key_name</span><span class="p">],</span> <span class="n">key_name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">coverage_type</span> <span class="o">==</span> <span class="s1">&#39;period&#39;</span><span class="p">:</span>
        <span class="c1"># check that all the required sub-elements exist</span>
        <span class="k">if</span> <span class="s1">&#39;start&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span> <span class="ow">or</span> <span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For coverage of type &#39;period&#39; values for both start date &quot;</span>
                                  <span class="s2">&quot;and end date are needed.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">coverage_type</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
        <span class="c1"># check that all the required sub-elements exist</span>
        <span class="k">if</span> <span class="s1">&#39;east&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span> <span class="ow">or</span> <span class="s1">&#39;north&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span> <span class="ow">or</span> <span class="s1">&#39;units&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For coverage of type &#39;point&#39; values for &#39;east&#39;, &#39;north&#39; &quot;</span>
                                  <span class="s2">&quot;and &#39;units&#39; are needed.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">value_item</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;north&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value_dict</span><span class="p">[</span><span class="n">value_item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_dict</span><span class="p">[</span><span class="n">value_item</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for &#39;</span><span class="si">{}</span><span class="s2">&#39; must be numeric&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value_item</span><span class="p">))</span>

        <span class="n">compute_longitude</span><span class="p">(</span><span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;east&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for North latitude should be &quot;</span>
                                  <span class="s2">&quot;in the range of -90 to 90&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">coverage_type</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
        <span class="c1"># check that all the required sub-elements exist</span>
        <span class="n">box_key_names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;north&#39;</span><span class="p">:</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">:</span> <span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;south&#39;</span><span class="p">:</span> <span class="s1">&#39;south&#39;</span><span class="p">,</span> <span class="s1">&#39;west&#39;</span><span class="p">:</span> <span class="s1">&#39;west&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">use_limit_postfix</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">box_key_names</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">box_key_names</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">limit&quot;</span>
        <span class="n">required_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">box_key_names</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">value_item</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value_item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value_dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For coverage of type &#39;box&#39; values for one or more &quot;</span>
                                      <span class="s2">&quot;bounding box limits or &#39;units&#39; is missing.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value_item</span> <span class="o">!=</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">value_dict</span><span class="p">[</span><span class="n">value_item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_dict</span><span class="p">[</span><span class="n">value_item</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for &#39;</span><span class="si">{}</span><span class="s2">&#39; must be numeric&quot;</span>
                                              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value_item</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for North latitude should be &quot;</span>
                                  <span class="s2">&quot;in the range of -90 to 90&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">or</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for South latitude should be &quot;</span>
                                  <span class="s2">&quot;in the range of -90 to 90&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="n">value_dict</span><span class="p">[</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;south&#39;</span><span class="p">]]:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Value for North latitude must be greater than or &quot;</span>
                                      <span class="s2">&quot;equal to that of South latitude.&quot;</span><span class="p">)</span>

        <span class="n">compute_longitude</span><span class="p">(</span><span class="n">key_name</span><span class="o">=</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">])</span>
        <span class="n">compute_longitude</span><span class="p">(</span><span class="n">key_name</span><span class="o">=</span><span class="n">box_key_names</span><span class="p">[</span><span class="s1">&#39;west&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Creator" class="doc doc-heading">
            <code>Creator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Party (hs_core.models.Party)" href="#hs_core.models.Party">Party</a></code></p>



        <p>Extend Party model with the term of 'Creator' and a proper ordering.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">creator</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">creatorOrder</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Creator</span><span class="p">(</span><span class="n">Party</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend Party model with the term of &#39;Creator&#39; and a proper ordering.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s2">&quot;Creator&quot;</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Creator class.&quot;&quot;&quot;</span>

        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Creator.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Creator class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Creator class.&quot;&quot;&quot;</span>

    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Date" class="doc doc-heading">
            <code>Date</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Date metadata model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Date</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Date metadata model.&quot;&quot;&quot;</span>

    <span class="n">DC_DATE_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;Created&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;modified&#39;</span><span class="p">,</span> <span class="s1">&#39;Modified&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="s1">&#39;Valid&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;available&#39;</span><span class="p">,</span> <span class="s1">&#39;Available&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">HS_DATE_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;reviewStarted&#39;</span><span class="p">,</span> <span class="s1">&#39;Review Started&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">,</span> <span class="s1">&#39;Published&#39;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">DATE_TYPE_CHOICES</span> <span class="o">=</span> <span class="n">DC_DATE_TYPE_CHOICES</span> <span class="o">+</span> <span class="n">HS_DATE_TYPE_CHOICES</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">DATE_TYPE_CHOICES</span><span class="p">)</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return either {type} {start} or {type} {start} {end} for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{start}</span><span class="s2"> </span><span class="si">{end}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span>
                                                 <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{start}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Date class.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">date_node</span> <span class="o">=</span> <span class="n">BNode</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="n">date_node</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">inner</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">inner</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DC_DATE_TYPE_CHOICES</span><span class="p">]:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">date_node</span><span class="p">,</span> <span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">DCTERMS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">date_node</span><span class="p">,</span> <span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">HSTERMS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)))</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">date_node</span><span class="p">,</span> <span class="n">RDF</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">date_node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">triples</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">date_node</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">date_node</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">RDF</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="ow">and</span> <span class="n">value</span><span class="p">:</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">start_date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="n">Date</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for Date model.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">DATE_TYPE_CHOICES</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid date type:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

            <span class="c1"># get matching resource</span>
            <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;end_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;start_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;published&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Resource is not published yet.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;reviewStarted&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">review_pending</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Review is already pending.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;available&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Resource has not been made public yet.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;end_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For date type valid, end date must be a date &quot;</span>
                                              <span class="s2">&quot;after the start date.&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type of date element is missing.&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update model for Date model.&quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;start_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;created&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Resource creation date can&#39;t be changed&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;modified&#39;</span><span class="p">:</span>
                <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;end_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For date type valid, end date must be a date &quot;</span>
                                              <span class="s2">&quot;after the start date.&quot;</span><span class="p">)</span>
                    <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span>
                    <span class="n">dt</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span>
                    <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dt</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For date type valid, end date must be a date &quot;</span>
                                                  <span class="s2">&quot;after the start date.&quot;</span><span class="p">)</span>
                    <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span>
                    <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span>
                <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;modified&#39;</span><span class="p">:</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Date model.&quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;modified&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Date element of type:</span><span class="si">%s</span><span class="s2"> can&#39;t be deleted.&quot;</span> <span class="o">%</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

        <span class="n">dt</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Date.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Date class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Date class.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Date.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return either {type} {start} or {type} {start} {end} for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return either {type} {start} or {type} {start} {end} for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{start}</span><span class="s2"> </span><span class="si">{end}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span>
                                             <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{type}</span><span class="s2"> </span><span class="si">{start}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Date.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for Date model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for Date model.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">DATE_TYPE_CHOICES</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid date type:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

        <span class="c1"># get matching resource</span>
        <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;end_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;start_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;published&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Resource is not published yet.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;reviewStarted&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">review_pending</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Review is already pending.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;available&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">public</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Resource has not been made public yet.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;end_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For date type valid, end date must be a date &quot;</span>
                                          <span class="s2">&quot;after the start date.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type of date element is missing.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Date.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom remove method for Date model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Date model.&quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;modified&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Date element of type:</span><span class="si">%s</span><span class="s2"> can&#39;t be deleted.&quot;</span> <span class="o">%</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="n">dt</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Date.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update model for Date model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update model for Date model.&quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;start_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;created&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Resource creation date can&#39;t be changed&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;modified&#39;</span><span class="p">:</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;end_date&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For date type valid, end date must be a date &quot;</span>
                                          <span class="s2">&quot;after the start date.&quot;</span><span class="p">)</span>
                <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span>
                <span class="n">dt</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span>
                <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dt</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;For date type valid, end date must be a date &quot;</span>
                                              <span class="s2">&quot;after the start date.&quot;</span><span class="p">)</span>
                <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span>
                <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">dt</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;modified&#39;</span><span class="p">:</span>
        <span class="n">dt</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">dt</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Description" class="doc doc-heading">
            <code>Description</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Description metadata element model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">abstract</span><span class="o">=</span><span class="n">DCTERMS</span><span class="o">.</span><span class="n">abstract</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Description</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Description metadata element model.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Description&#39;</span>
    <span class="n">abstract</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">validate_abstract</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return abstract field for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Description model.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update method for Description model.&quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_abstract</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Description</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update method for Description model.&quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_abstract</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Description</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create custom remove method for Description model.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Description element of a resource can&#39;t be deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Description.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Description model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Description model.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Description.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return abstract field for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return abstract field for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Description.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update method for Description model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update method for Description model.&quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_abstract</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Description</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Description.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create custom remove method for Description model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create custom remove method for Description model.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Description element of a resource can&#39;t be deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Description.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update method for Description model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update method for Description model.&quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_abstract</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">])</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Description</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.DiscoverableResourceManager" class="doc doc-heading">
            <code>DiscoverableResourceManager</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.db.models.Manager">Manager</span></code></p>



        <p>Extend Django model Manager to filter for public or discoverable resources.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4185</span>
<span class="normal">4186</span>
<span class="normal">4187</span>
<span class="normal">4188</span>
<span class="normal">4189</span>
<span class="normal">4190</span>
<span class="normal">4191</span>
<span class="normal">4192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DiscoverableResourceManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend Django model Manager to filter for public or discoverable resources.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extend Django model Manager to filter for public or discoverable resources.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DiscoverableResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">Q</span><span class="p">(</span><span class="n">raccess__discoverable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">raccess__public</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="hs_core.models.DiscoverableResourceManager.get_queryset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_queryset</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extend Django model Manager to filter for public or discoverable resources.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4188</span>
<span class="normal">4189</span>
<span class="normal">4190</span>
<span class="normal">4191</span>
<span class="normal">4192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend Django model Manager to filter for public or discoverable resources.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DiscoverableResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">Q</span><span class="p">(</span><span class="n">raccess__discoverable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">raccess__public</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Format" class="doc doc-heading">
            <code>Format</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Format custom metadata element model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Format</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Format custom metadata element model.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Format&#39;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Format model.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return value field for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Format.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Format model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Format model.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Format.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return value field for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return value field for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.FundingAgency" class="doc doc-heading">
            <code>FundingAgency</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define FundingAgency custom metadata element mode.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">awardInfo</span><span class="p">,</span> <span class="n">agency_name</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">fundingAgencyName</span><span class="p">,</span> <span class="n">award_title</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">awardTitle</span><span class="p">,</span>
           <span class="n">award_number</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">awardNumber</span><span class="p">,</span> <span class="n">agency_url</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">fundingAgencyURL</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">FundingAgency</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define FundingAgency custom metadata element mode.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;FundingAgency&#39;</span>
    <span class="n">agency_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">award_title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">award_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">agency_url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return agency_name field for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">agency_name</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for FundingAgency model.&quot;&quot;&quot;</span>
        <span class="n">agency_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;agency_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">agency_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">agency_name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Agency name is missing&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FundingAgency</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update method for Agency model.&quot;&quot;&quot;</span>
        <span class="n">agency_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;agency_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">agency_name</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">agency_name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Agency name is missing&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">FundingAgency</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="hs_core.models.FundingAgency.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return agency_name field for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return agency_name field for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">agency_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.FundingAgency.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for FundingAgency model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for FundingAgency model.&quot;&quot;&quot;</span>
    <span class="n">agency_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;agency_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">agency_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">agency_name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Agency name is missing&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FundingAgency</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.FundingAgency.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update method for Agency model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update method for Agency model.&quot;&quot;&quot;</span>
    <span class="n">agency_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;agency_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">agency_name</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">agency_name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Agency name is missing&quot;</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">FundingAgency</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.GroupOwnership" class="doc doc-heading">
            <code>GroupOwnership</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.db.models.Model">Model</span></code></p>



        <p>Define lookup table allowing django auth users to own django auth groups.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GroupOwnership</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define lookup table allowing django auth users to own django auth groups.&quot;&quot;&quot;</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Group</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.HSAdaptorEditInline" class="doc doc-heading">
            <code>HSAdaptorEditInline</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>



        <p>Define permissions-based helper to determine if user can edit adapter field.</p>
<p>Adaptor class added for Django inplace editing to honor HydroShare user-resource permissions</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HSAdaptorEditInline</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define permissions-based helper to determine if user can edit adapter field.</span>

<span class="sd">    Adaptor class added for Django inplace editing to honor HydroShare user-resource permissions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">can_edit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">adaptor_field</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define permissions-based helper to determine if user can edit adapter field.&quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">adaptor_field</span><span class="o">.</span><span class="n">obj</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_content_model</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cm</span><span class="o">.</span><span class="n">can_change</span><span class="p">(</span><span class="n">adaptor_field</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="hs_core.models.HSAdaptorEditInline.can_edit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_edit</span><span class="p">(</span><span class="n">adaptor_field</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define permissions-based helper to determine if user can edit adapter field.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">can_edit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">adaptor_field</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define permissions-based helper to determine if user can edit adapter field.&quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">adaptor_field</span><span class="o">.</span><span class="n">obj</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_content_model</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cm</span><span class="o">.</span><span class="n">can_change</span><span class="p">(</span><span class="n">adaptor_field</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Identifier" class="doc doc-heading">
            <code>Identifier</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Create Identifier custom metadata element.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Identifier</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create Identifier custom metadata element.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Identifier&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return {name} {url} for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> </span><span class="si">{url}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">identifier_node</span> <span class="o">=</span> <span class="n">BNode</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="n">identifier_node</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">identifier_node</span><span class="p">,</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">doi</span><span class="p">,</span> <span class="n">URIRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">identifier_node</span><span class="p">,</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">hydroShareIdentifier</span><span class="p">,</span> <span class="n">URIRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">identifier_node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">triples</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">identifier_node</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">doi</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;doi&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;hydroShareIdentifier&#39;</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">identifier_node</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">hydroShareIdentifier</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
                    <span class="c1"># overwrite hydroShareIdentifier url with this resource&#39;s url</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">content_object</span><span class="o">.</span><span class="n">rdf_subject</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
                <span class="n">Identifier</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for Identifier model.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
            <span class="c1"># get matching resource</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>
            <span class="c1"># check the identifier name doesn&#39;t already exist - identifier name</span>
            <span class="c1"># needs to be unique per resource</span>
            <span class="n">idf</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                            <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                            <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">idf</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Identifier name:</span><span class="si">%s</span><span class="s1"> already exists&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">doi</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Identifier of &#39;DOI&#39; type can&#39;t be created for a &quot;</span>
                                          <span class="s2">&quot;resource that has not been assigned a DOI yet.&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Identifier</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Name of identifier element is missing.&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update method for Identifier model.&quot;&quot;&quot;</span>
        <span class="n">idf</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hydroshareidentifier&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;migration&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Identifier name &#39;hydroshareIdentifier&#39; can&#39;t &quot;</span>
                                              <span class="s2">&quot;be changed.&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Identifier name &#39;DOI&#39; can&#39;t be changed.&quot;</span><span class="p">)</span>

                <span class="c1"># check this new identifier name not already exists</span>
                <span class="k">if</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">object_id</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
                                             <span class="n">content_type__pk</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;migration&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Identifier name:</span><span class="si">%s</span><span class="s1"> already exists.&#39;</span>
                                              <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hydroshareidentifier&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;migration&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Hydroshare identifier url value can&#39;t be changed.&quot;</span><span class="p">)</span>

                <span class="c1"># check this new identifier url not already exists</span>
                <span class="k">if</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">url__iexact</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">object_id</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
                                             <span class="n">content_type__pk</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Identifier URL:</span><span class="si">%s</span><span class="s1"> already exists.&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Identifier</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Idenfitier method.&quot;&quot;&quot;</span>
        <span class="n">idf</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

        <span class="c1"># get matching resource</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">content_object</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hydroshareidentifier&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Hydroshare identifier:</span><span class="si">%s</span><span class="s2"> can&#39;t be deleted.&quot;</span> <span class="o">%</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">doi</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Hydroshare identifier:</span><span class="si">%s</span><span class="s2"> can&#39;t be deleted for a resource &quot;</span>
                                      <span class="s2">&quot;that has been assigned a DOI.&quot;</span> <span class="o">%</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">idf</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Identifier.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return {name} {url} for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return {name} {url} for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> </span><span class="si">{url}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Identifier.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for Identifier model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for Identifier model.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
        <span class="c1"># get matching resource</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>
        <span class="c1"># check the identifier name doesn&#39;t already exist - identifier name</span>
        <span class="c1"># needs to be unique per resource</span>
        <span class="n">idf</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                        <span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                        <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">idf</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Identifier name:</span><span class="si">%s</span><span class="s1"> already exists&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">doi</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Identifier of &#39;DOI&#39; type can&#39;t be created for a &quot;</span>
                                      <span class="s2">&quot;resource that has not been assigned a DOI yet.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Identifier</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Name of identifier element is missing.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Identifier.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom remove method for Idenfitier method.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Idenfitier method.&quot;&quot;&quot;</span>
    <span class="n">idf</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

    <span class="c1"># get matching resource</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">content_object</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hydroshareidentifier&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Hydroshare identifier:</span><span class="si">%s</span><span class="s2"> can&#39;t be deleted.&quot;</span> <span class="o">%</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">doi</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Hydroshare identifier:</span><span class="si">%s</span><span class="s2"> can&#39;t be deleted for a resource &quot;</span>
                                  <span class="s2">&quot;that has been assigned a DOI.&quot;</span> <span class="o">%</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">idf</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Identifier.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update method for Identifier model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update method for Identifier model.&quot;&quot;&quot;</span>
    <span class="n">idf</span> <span class="o">=</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hydroshareidentifier&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;migration&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Identifier name &#39;hydroshareIdentifier&#39; can&#39;t &quot;</span>
                                          <span class="s2">&quot;be changed.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;doi&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Identifier name &#39;DOI&#39; can&#39;t be changed.&quot;</span><span class="p">)</span>

            <span class="c1"># check this new identifier name not already exists</span>
            <span class="k">if</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">object_id</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
                                         <span class="n">content_type__pk</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;migration&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Identifier name:</span><span class="si">%s</span><span class="s1"> already exists.&#39;</span>
                                          <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">idf</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hydroshareidentifier&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;migration&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Hydroshare identifier url value can&#39;t be changed.&quot;</span><span class="p">)</span>

            <span class="c1"># check this new identifier url not already exists</span>
            <span class="k">if</span> <span class="n">Identifier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">url__iexact</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">object_id</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
                                         <span class="n">content_type__pk</span><span class="o">=</span><span class="n">idf</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Identifier URL:</span><span class="si">%s</span><span class="s1"> already exists.&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">Identifier</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Language" class="doc doc-heading">
            <code>Language</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define language custom metadata model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Language</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define language custom metadata model.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Language&#39;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">iso_languages</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Language model.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return code field for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for Language model.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;code&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># check the code is a valid code</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">iso_languages</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]]:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid language code:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])</span>

            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Language</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Language code is missing.&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update method for Language model.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;code&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># validate language code</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">iso_languages</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]]:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid language code:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">Language</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Language code is missing.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">code</span><span class="p">:</span>
            <span class="n">Language</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Language.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Language model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Language model.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Language.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return code field for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return code field for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Language.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for Language model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for Language model.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;code&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="c1"># check the code is a valid code</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">iso_languages</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]]:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid language code:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Language</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Language code is missing.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Language.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update method for Language model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update method for Language model.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;code&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="c1"># validate language code</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">iso_languages</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]]:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Invalid language code:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Language</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Language code is missing.&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Party" class="doc doc-heading">
            <code>Party</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define party model to define a person.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Party</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define party model to define a person.&quot;&quot;&quot;</span>

    <span class="n">hydroshare_user_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">validate_hydroshare_user_id</span><span class="p">])</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">organization</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">homepage</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># flag to track if a creator/contributor is an active hydroshare user</span>
    <span class="c1"># this flag is set by the system based on the field &#39;hydoshare_user_id&#39;</span>
    <span class="n">is_active_user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># to store one or more external identifier (Google Scholar, ResearchGate, ORCID etc)</span>
    <span class="c1"># each identifier is stored as a key/value pair {name:link}</span>
    <span class="n">identifiers</span> <span class="o">=</span> <span class="n">HStoreField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># list of identifiers currently supported</span>
    <span class="n">supported_identifiers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ResearchGateID&#39;</span><span class="p">:</span>
                             <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^https:\/\/www\.researchgate\.net\/profile\/[^\s]+$&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;ORCID&#39;</span><span class="p">:</span>
                             <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^https:\/\/orcid\.org\/[0-9]</span><span class="si">{4}</span><span class="s1">-[0-9]</span><span class="si">{4}</span><span class="s1">-[0-9]</span><span class="si">{4}</span><span class="s1">-[0-9]</span><span class="si">{4}</span><span class="s1">$&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;GoogleScholarID&#39;</span><span class="p">:</span>
                             <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^https:\/\/scholar\.google\.com\/citations\?.*user=[^\s]+$&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;ResearcherID&#39;</span><span class="p">:</span>
                             <span class="s1">&#39;https://www.researcherid.com/&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return name field for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Party class.&quot;&quot;&quot;</span>

        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">party_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">()</span>
        <span class="n">party</span> <span class="o">=</span> <span class="n">BNode</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="n">party_type</span><span class="p">,</span> <span class="n">party</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">field_term</span><span class="p">,</span> <span class="n">field_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_field_terms_and_values</span><span class="p">([</span><span class="s1">&#39;identifiers&#39;</span><span class="p">,</span> <span class="s1">&#39;is_active_user&#39;</span><span class="p">]):</span>
            <span class="c1"># TODO: remove this once we are no longer concerned with backwards compatibility</span>
            <span class="k">if</span> <span class="n">field_term</span> <span class="o">==</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">party</span><span class="p">,</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">field_value</span><span class="p">))</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">party</span><span class="p">,</span> <span class="n">field_term</span><span class="p">,</span> <span class="n">field_value</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">party</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">HSTERMS</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default implementation that ingests by convention&quot;&quot;&quot;</span>
        <span class="n">party_type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">party</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">party_type</span><span class="p">):</span>
            <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">fields_by_term</span> <span class="o">=</span> <span class="p">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_field_term</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">):</span> <span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">triples</span><span class="p">((</span><span class="n">party</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="c1"># TODO: remove this once we are no longer concerned with backwards compatibility</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
                    <span class="c1"># parse the description into a hydroshare_user_id</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">hydroshare_user_id</span>
                    <span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;user/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields_by_term</span><span class="p">:</span>
                    <span class="n">identifiers</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_dict</span><span class="p">[</span><span class="n">fields_by_term</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value_dict</span> <span class="ow">or</span> <span class="n">identifiers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">,</span> <span class="n">identifiers</span><span class="o">=</span><span class="n">identifiers</span><span class="p">,</span> <span class="o">**</span><span class="n">value_dict</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">,</span> <span class="o">**</span><span class="n">value_dict</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_post_data_with_identifiers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">as_json</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">identifier_names</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;identifier_name&#39;</span><span class="p">)</span>
        <span class="n">identifier_links</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;identifier_link&#39;</span><span class="p">)</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">identifier_links</span> <span class="ow">and</span> <span class="n">identifier_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier_names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier_links</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid data for identifiers&quot;</span><span class="p">)</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">identifier_names</span><span class="p">,</span> <span class="n">identifier_links</span><span class="p">)))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier_names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">identifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid data for identifiers&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">as_json</span><span class="p">:</span>
                <span class="n">identifiers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>

        <span class="n">post_data_dict</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
        <span class="n">post_data_dict</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">identifiers</span>

        <span class="k">return</span> <span class="n">post_data_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for Party model.&quot;&quot;&quot;</span>
        <span class="n">element_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="n">identifiers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;identifiers&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">validate_identifiers</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">identifiers</span>

        <span class="n">hs_user_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hydroshare_user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hs_user_id</span><span class="p">:</span>
            <span class="n">validate_hydroshare_user_id</span><span class="p">(</span><span class="n">hs_user_id</span><span class="p">)</span>

        <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
        <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s1">&#39;Creator&#39;</span><span class="p">:</span>
            <span class="n">party</span> <span class="o">=</span> <span class="n">Creator</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                           <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
            <span class="n">creator_order</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">party</span><span class="p">:</span>
                <span class="n">creator_order</span> <span class="o">=</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="s1">&#39;organization&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span>
                    <span class="s2">&quot;Either an organization or name is required for a creator element&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;organization&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span>
                                <span class="s2">&quot;Either the name or organization must not be blank for the creator &quot;</span>
                                <span class="s2">&quot;element&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">creator_order</span>

        <span class="n">party</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Party</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">)</span>
            <span class="n">party</span><span class="o">.</span><span class="n">is_active_user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span>
            <span class="n">party</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">party</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update method for Party model.&quot;&quot;&quot;</span>
        <span class="n">element_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">creator_order</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;hydroshare_user_id&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">party</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hydroshare_user_id&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span> <span class="o">!=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hydroshare_user_id&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;HydroShare user identifier can&#39;t be changed.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s1">&#39;Creator&#39;</span><span class="p">:</span>
            <span class="n">creator_order</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">creator_order</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">creator_order</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>

        <span class="n">identifiers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;identifiers&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">validate_identifiers</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">identifiers</span>

        <span class="n">party</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Party</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">)</span>
            <span class="n">party</span><span class="o">.</span><span class="n">is_active_user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">party</span><span class="o">.</span><span class="n">is_active_user</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">party</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;is_active_user&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">party</span><span class="p">,</span> <span class="n">Creator</span><span class="p">)</span> <span class="ow">and</span> <span class="n">creator_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="o">!=</span> <span class="n">creator_order</span><span class="p">:</span>
                <span class="n">resource_creators</span> <span class="o">=</span> <span class="n">Creator</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">object_id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span> <span class="n">content_type__pk</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">creator_order</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource_creators</span><span class="p">):</span>
                    <span class="n">creator_order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource_creators</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">res_cr</span> <span class="ow">in</span> <span class="n">resource_creators</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="n">creator_order</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;</span> <span class="n">creator_order</span><span class="p">:</span>
                            <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">res_cr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="ow">and</span> <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;=</span> <span class="n">creator_order</span><span class="p">:</span>
                            <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">-=</span> <span class="mi">1</span>
                            <span class="n">res_cr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>

                <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">creator_order</span>
                <span class="n">party</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">relative_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;/user/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="si">}</span><span class="s2">/&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hydroshare_user_id</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_active_user</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Party model.&quot;&quot;&quot;</span>
        <span class="n">party</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

        <span class="c1"># if we are deleting a creator, then we have to update the order attribute of remaining</span>
        <span class="c1"># creators associated with a resource</span>
        <span class="c1"># make sure we are not deleting all creators of a resource</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">party</span><span class="p">,</span> <span class="n">Creator</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">Creator</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
                                      <span class="n">content_type__pk</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;The only creator of the resource can&#39;t be deleted.&quot;</span><span class="p">)</span>

            <span class="n">creators_to_update</span> <span class="o">=</span> <span class="n">Creator</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">object_id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
                <span class="n">content_type__pk</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="n">creators_to_update</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
                    <span class="n">cr</span><span class="o">.</span><span class="n">order</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">cr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
            <span class="n">party</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overriding the django model delete() method to update creator order attribute for</span>
<span class="sd">        remaining creators.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Party</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="n">using</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="n">keep_parents</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_identifiers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates optional identifiers for user/creator/contributor</span>
<span class="sd">        :param  identifiers: identifier data as a json string or as a dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifiers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
                <span class="c1"># validation form can populate the dict(kwargs) with key &#39;identifiers&quot; with</span>
                <span class="c1"># value of empty string if data passed to the validation form did not had this</span>
                <span class="c1"># key. In that case no need to convert the string to dict</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">identifiers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Value for identifiers not in the correct format&quot;</span><span class="p">)</span>
        <span class="c1"># identifiers = kwargs[&#39;identifiers&#39;]</span>
        <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
            <span class="c1"># validate the identifiers are one of the supported ones</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">supported_identifiers</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                               <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not a supported identifier.&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="c1"># validate identifier values - check for duplicate links</span>
            <span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">identifiers</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">links</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                           <span class="s2">&quot;Duplicate identifier links found.&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
                <span class="n">validator</span> <span class="o">=</span> <span class="n">URLValidator</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">validator</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">ValidationError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                               <span class="s2">&quot;Identifier link must be a URL.&quot;</span><span class="p">)</span>

            <span class="c1"># validate identifier keys - check for duplicate names</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">identifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                           <span class="s2">&quot;Duplicate identifier names found&quot;</span><span class="p">)</span>

            <span class="c1"># validate that the links for the known identifiers are valid</span>
            <span class="k">for</span> <span class="n">id_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">supported_identifiers</span><span class="p">:</span>
                <span class="n">id_link</span> <span class="o">=</span> <span class="n">identifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id_name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">id_link</span><span class="p">:</span>
                    <span class="n">regex</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">supported_identifiers</span><span class="p">[</span><span class="n">id_name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">id_link</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                                   <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="si">{</span><span class="n">id_link</span><span class="si">}</span><span class="se">\&#39;</span><span class="s2"> is not a valid </span><span class="si">{</span><span class="n">id_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">identifiers</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Party.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Party class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Party class.&quot;&quot;&quot;</span>

    <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Party.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return name field for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return name field for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Party.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for Party model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for Party model.&quot;&quot;&quot;</span>
    <span class="n">element_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">identifiers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;identifiers&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">validate_identifiers</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">identifiers</span>

    <span class="n">hs_user_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hydroshare_user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hs_user_id</span><span class="p">:</span>
        <span class="n">validate_hydroshare_user_id</span><span class="p">(</span><span class="n">hs_user_id</span><span class="p">)</span>

    <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
    <span class="n">metadata_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">metadata_obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s1">&#39;Creator&#39;</span><span class="p">:</span>
        <span class="n">party</span> <span class="o">=</span> <span class="n">Creator</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                       <span class="n">content_type</span><span class="o">=</span><span class="n">metadata_type</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
        <span class="n">creator_order</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">party</span><span class="p">:</span>
            <span class="n">creator_order</span> <span class="o">=</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="s1">&#39;organization&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span>
                <span class="s2">&quot;Either an organization or name is required for a creator element&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;organization&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span>
                            <span class="s2">&quot;Either the name or organization must not be blank for the creator &quot;</span>
                            <span class="s2">&quot;element&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">creator_order</span>

    <span class="n">party</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Party</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">)</span>
        <span class="n">party</span><span class="o">.</span><span class="n">is_active_user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span>
        <span class="n">party</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">party</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Party.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Overriding the django model delete() method to update creator order attribute for
remaining creators.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Overriding the django model delete() method to update creator order attribute for</span>
<span class="sd">    remaining creators.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Party</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="n">using</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="n">keep_parents</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Party.ingest_rdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ingest_rdf</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Default implementation that ingests by convention</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Default implementation that ingests by convention&quot;&quot;&quot;</span>
    <span class="n">party_type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">party</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">party_type</span><span class="p">):</span>
        <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fields_by_term</span> <span class="o">=</span> <span class="p">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_field_term</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">):</span> <span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">triples</span><span class="p">((</span><span class="n">party</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="c1"># TODO: remove this once we are no longer concerned with backwards compatibility</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
                <span class="c1"># parse the description into a hydroshare_user_id</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">HSTERMS</span><span class="o">.</span><span class="n">hydroshare_user_id</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;user/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields_by_term</span><span class="p">:</span>
                <span class="n">identifiers</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_dict</span><span class="p">[</span><span class="n">fields_by_term</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_dict</span> <span class="ow">or</span> <span class="n">identifiers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">,</span> <span class="n">identifiers</span><span class="o">=</span><span class="n">identifiers</span><span class="p">,</span> <span class="o">**</span><span class="n">value_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">,</span> <span class="o">**</span><span class="n">value_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Party.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom remove method for Party model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Party model.&quot;&quot;&quot;</span>
    <span class="n">party</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>

    <span class="c1"># if we are deleting a creator, then we have to update the order attribute of remaining</span>
    <span class="c1"># creators associated with a resource</span>
    <span class="c1"># make sure we are not deleting all creators of a resource</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">party</span><span class="p">,</span> <span class="n">Creator</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Creator</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
                                  <span class="n">content_type__pk</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;The only creator of the resource can&#39;t be deleted.&quot;</span><span class="p">)</span>

        <span class="n">creators_to_update</span> <span class="o">=</span> <span class="n">Creator</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">object_id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
            <span class="n">content_type__pk</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="n">creators_to_update</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
                <span class="n">cr</span><span class="o">.</span><span class="n">order</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">cr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
        <span class="n">party</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Party.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update method for Party model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update method for Party model.&quot;&quot;&quot;</span>
    <span class="n">element_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">creator_order</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s1">&#39;hydroshare_user_id&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">party</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hydroshare_user_id&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span> <span class="o">!=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hydroshare_user_id&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;HydroShare user identifier can&#39;t be changed.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;order&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s1">&#39;Creator&#39;</span><span class="p">:</span>
        <span class="n">creator_order</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">creator_order</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">creator_order</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span>

    <span class="n">identifiers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;identifiers&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">validate_identifiers</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;identifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">identifiers</span>

    <span class="n">party</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Party</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">hydroshare_user_id</span><span class="p">)</span>
        <span class="n">party</span><span class="o">.</span><span class="n">is_active_user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">party</span><span class="o">.</span><span class="n">is_active_user</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">party</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;is_active_user&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">party</span><span class="p">,</span> <span class="n">Creator</span><span class="p">)</span> <span class="ow">and</span> <span class="n">creator_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="o">!=</span> <span class="n">creator_order</span><span class="p">:</span>
            <span class="n">resource_creators</span> <span class="o">=</span> <span class="n">Creator</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">object_id</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span> <span class="n">content_type__pk</span><span class="o">=</span><span class="n">party</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">creator_order</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource_creators</span><span class="p">):</span>
                <span class="n">creator_order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource_creators</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">res_cr</span> <span class="ow">in</span> <span class="n">resource_creators</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="n">creator_order</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;</span> <span class="n">creator_order</span><span class="p">:</span>
                        <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">res_cr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&gt;</span> <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="ow">and</span> <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;=</span> <span class="n">creator_order</span><span class="p">:</span>
                        <span class="n">res_cr</span><span class="o">.</span><span class="n">order</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="n">res_cr</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>

            <span class="n">party</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">creator_order</span>
            <span class="n">party</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Party.validate_identifiers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_identifiers</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Validates optional identifiers for user/creator/contributor
:param  identifiers: identifier data as a json string or as a dict</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">validate_identifiers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates optional identifiers for user/creator/contributor</span>
<span class="sd">    :param  identifiers: identifier data as a json string or as a dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifiers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
            <span class="c1"># validation form can populate the dict(kwargs) with key &#39;identifiers&quot; with</span>
            <span class="c1"># value of empty string if data passed to the validation form did not had this</span>
            <span class="c1"># key. In that case no need to convert the string to dict</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">identifiers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Value for identifiers not in the correct format&quot;</span><span class="p">)</span>
    <span class="c1"># identifiers = kwargs[&#39;identifiers&#39;]</span>
    <span class="k">if</span> <span class="n">identifiers</span><span class="p">:</span>
        <span class="c1"># validate the identifiers are one of the supported ones</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">supported_identifiers</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                           <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not a supported identifier.&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="c1"># validate identifier values - check for duplicate links</span>
        <span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">identifiers</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">links</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                       <span class="s2">&quot;Duplicate identifier links found.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="n">validator</span> <span class="o">=</span> <span class="n">URLValidator</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">validator</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ValidationError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                           <span class="s2">&quot;Identifier link must be a URL.&quot;</span><span class="p">)</span>

        <span class="c1"># validate identifier keys - check for duplicate names</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">identifiers</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                       <span class="s2">&quot;Duplicate identifier names found&quot;</span><span class="p">)</span>

        <span class="c1"># validate that the links for the known identifiers are valid</span>
        <span class="k">for</span> <span class="n">id_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">supported_identifiers</span><span class="p">:</span>
            <span class="n">id_link</span> <span class="o">=</span> <span class="n">identifiers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id_name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">id_link</span><span class="p">:</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">supported_identifiers</span><span class="p">[</span><span class="n">id_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">id_link</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">PartyValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid data found for identifiers. &quot;</span>
                                               <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="si">{</span><span class="n">id_link</span><span class="si">}</span><span class="se">\&#39;</span><span class="s2"> is not a valid </span><span class="si">{</span><span class="n">id_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">identifiers</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.PublicResourceManager" class="doc doc-heading">
            <code>PublicResourceManager</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="django.db.models.Manager">Manager</span></code></p>



        <p>Extend Django model Manager to allow for public resource access.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4177</span>
<span class="normal">4178</span>
<span class="normal">4179</span>
<span class="normal">4180</span>
<span class="normal">4181</span>
<span class="normal">4182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PublicResourceManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend Django model Manager to allow for public resource access.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extend Django model Manager to allow for public resource access.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PublicResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">raccess__public</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="hs_core.models.PublicResourceManager.get_queryset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_queryset</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extend Django model Manager to allow for public resource access.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4180</span>
<span class="normal">4181</span>
<span class="normal">4182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend Django model Manager to allow for public resource access.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PublicResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">raccess__public</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Publisher" class="doc doc-heading">
            <code>Publisher</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Publisher custom metadata model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">publisher</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">publisherName</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">publisherURL</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Publisher</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Publisher custom metadata model.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Publisher&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return {name} {url} for unicode representation of Publisher model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> </span><span class="si">{url}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Publisher model.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for Publisher model.&quot;&quot;&quot;</span>
        <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
        <span class="c1"># get matching resource</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Resource not found&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Publisher element can&#39;t be created for a resource that &quot;</span>
                                  <span class="s2">&quot;is not yet published.&quot;</span><span class="p">)</span>

        <span class="n">publisher_CUAHSI</span> <span class="o">=</span> <span class="s2">&quot;Consortium of Universities for the Advancement of Hydrologic &quot;</span> \
                           <span class="s2">&quot;Science, Inc. (CUAHSI)&quot;</span>

        <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="c1"># if the resource has content files, set CUAHSI as the publisher</span>
            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">publisher_CUAHSI</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid publisher name&quot;</span><span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">publisher_CUAHSI</span>
            <span class="k">if</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;https://www.cuahsi.org&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid publisher URL&quot;</span><span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://www.cuahsi.org&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># make sure we are not setting CUAHSI as publisher for a resource</span>
            <span class="c1"># that has no content files, unless it is a Collection</span>
            <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">resource_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;collectionresource&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">publisher_CUAHSI</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid publisher name&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;https://www.cuahsi.org&#39;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid publisher URL&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Publisher</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom update method for Publisher model.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Publisher element can&#39;t be updated.&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Publisher model.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Publisher element can&#39;t be deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Publisher.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Publisher model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Publisher model.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Publisher.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return {name} {url} for unicode representation of Publisher model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return {name} {url} for unicode representation of Publisher model.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{name}</span><span class="s2"> </span><span class="si">{url}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Publisher.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for Publisher model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for Publisher model.&quot;&quot;&quot;</span>
    <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
    <span class="c1"># get matching resource</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">BaseResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Resource not found&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">published</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Publisher element can&#39;t be created for a resource that &quot;</span>
                              <span class="s2">&quot;is not yet published.&quot;</span><span class="p">)</span>

    <span class="n">publisher_CUAHSI</span> <span class="o">=</span> <span class="s2">&quot;Consortium of Universities for the Advancement of Hydrologic &quot;</span> \
                       <span class="s2">&quot;Science, Inc. (CUAHSI)&quot;</span>

    <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="c1"># if the resource has content files, set CUAHSI as the publisher</span>
        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">publisher_CUAHSI</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid publisher name&quot;</span><span class="p">)</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">publisher_CUAHSI</span>
        <span class="k">if</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;https://www.cuahsi.org&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid publisher URL&quot;</span><span class="p">)</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://www.cuahsi.org&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure we are not setting CUAHSI as publisher for a resource</span>
        <span class="c1"># that has no content files, unless it is a Collection</span>
        <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">resource_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;collectionresource&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">publisher_CUAHSI</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid publisher name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;https://www.cuahsi.org&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Invalid publisher URL&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Publisher</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Publisher.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom remove method for Publisher model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Publisher model.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Publisher element can&#39;t be deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Publisher.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom update method for Publisher model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom update method for Publisher model.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Publisher element can&#39;t be updated.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.RangedFileReader" class="doc doc-heading">
            <code>RangedFileReader</code>


</h2>


    <div class="doc doc-contents ">



        <p>Wraps a file like object with an iterator that runs over part (or all) of
the file defined by start and stop. Blocks of block_size will be returned
from the starting position, up to, but not including the stop point.
https://github.com/satchamo/django/commit/2ce75c5c4bee2a858c0214d136bfcd351fcde11d</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4094</span>
<span class="normal">4095</span>
<span class="normal">4096</span>
<span class="normal">4097</span>
<span class="normal">4098</span>
<span class="normal">4099</span>
<span class="normal">4100</span>
<span class="normal">4101</span>
<span class="normal">4102</span>
<span class="normal">4103</span>
<span class="normal">4104</span>
<span class="normal">4105</span>
<span class="normal">4106</span>
<span class="normal">4107</span>
<span class="normal">4108</span>
<span class="normal">4109</span>
<span class="normal">4110</span>
<span class="normal">4111</span>
<span class="normal">4112</span>
<span class="normal">4113</span>
<span class="normal">4114</span>
<span class="normal">4115</span>
<span class="normal">4116</span>
<span class="normal">4117</span>
<span class="normal">4118</span>
<span class="normal">4119</span>
<span class="normal">4120</span>
<span class="normal">4121</span>
<span class="normal">4122</span>
<span class="normal">4123</span>
<span class="normal">4124</span>
<span class="normal">4125</span>
<span class="normal">4126</span>
<span class="normal">4127</span>
<span class="normal">4128</span>
<span class="normal">4129</span>
<span class="normal">4130</span>
<span class="normal">4131</span>
<span class="normal">4132</span>
<span class="normal">4133</span>
<span class="normal">4134</span>
<span class="normal">4135</span>
<span class="normal">4136</span>
<span class="normal">4137</span>
<span class="normal">4138</span>
<span class="normal">4139</span>
<span class="normal">4140</span>
<span class="normal">4141</span>
<span class="normal">4142</span>
<span class="normal">4143</span>
<span class="normal">4144</span>
<span class="normal">4145</span>
<span class="normal">4146</span>
<span class="normal">4147</span>
<span class="normal">4148</span>
<span class="normal">4149</span>
<span class="normal">4150</span>
<span class="normal">4151</span>
<span class="normal">4152</span>
<span class="normal">4153</span>
<span class="normal">4154</span>
<span class="normal">4155</span>
<span class="normal">4156</span>
<span class="normal">4157</span>
<span class="normal">4158</span>
<span class="normal">4159</span>
<span class="normal">4160</span>
<span class="normal">4161</span>
<span class="normal">4162</span>
<span class="normal">4163</span>
<span class="normal">4164</span>
<span class="normal">4165</span>
<span class="normal">4166</span>
<span class="normal">4167</span>
<span class="normal">4168</span>
<span class="normal">4169</span>
<span class="normal">4170</span>
<span class="normal">4171</span>
<span class="normal">4172</span>
<span class="normal">4173</span>
<span class="normal">4174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RangedFileReader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps a file like object with an iterator that runs over part (or all) of</span>
<span class="sd">    the file defined by start and stop. Blocks of block_size will be returned</span>
<span class="sd">    from the starting position, up to, but not including the stop point.</span>
<span class="sd">    https://github.com/satchamo/django/commit/2ce75c5c4bee2a858c0214d136bfcd351fcde11d</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;RANGED_FILE_READER_BLOCK_SIZE&#39;</span><span class="p">,</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="n">dump_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;RANGED_FILE_READER_DUMP_SIZE&#39;</span><span class="p">,</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_like</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span> <span class="n">block_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">file_like</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="n">block_size</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.f proc.stdout is an _io.BufferedReader object</span>
        <span class="c1"># so it will not have a seek method</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seekable</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if the file is not seekable, we read and discard</span>
            <span class="c1"># until we reach the start position</span>
            <span class="n">remaining_to_dump</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
            <span class="k">while</span> <span class="n">remaining_to_dump</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">read_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_size</span><span class="p">,</span> <span class="n">remaining_to_dump</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">read_size</span><span class="p">)</span>
                <span class="n">remaining_to_dump</span> <span class="o">-=</span> <span class="n">read_size</span>
        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="k">while</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">position</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">yield</span> <span class="n">data</span>
            <span class="n">position</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">parse_range_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">resource_size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses a range header into a list of two-tuples (start, stop) where `start`</span>
<span class="sd">        is the starting byte of the range (inclusive) and `stop` is the ending byte</span>
<span class="sd">        position of the range (exclusive).</span>
<span class="sd">        Returns None if the value of the header is not syntatically valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span> <span class="ow">or</span> <span class="s1">&#39;=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">units</span><span class="p">,</span> <span class="n">range_</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">units</span> <span class="o">!=</span> <span class="s2">&quot;bytes&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">range_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
                <span class="c1"># suffix-byte-range-spec: this form specifies the last N bytes of an</span>
                <span class="c1"># entity-body</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">resource_size</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">resource_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># byte-range-spec: first-byte-pos &quot;-&quot; [last-byte-pos]</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                <span class="c1"># the +1 is here since we want the stopping point to be exclusive, whereas in</span>
                <span class="c1"># the HTTP spec, the last-byte-pos is inclusive</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">stop</span> <span class="k">else</span> <span class="n">resource_size</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="n">stop</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>

            <span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">ranges</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="hs_core.models.RangedFileReader.parse_range_header" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_range_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">resource_size</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Parses a range header into a list of two-tuples (start, stop) where <code>start</code>
is the starting byte of the range (inclusive) and <code>stop</code> is the ending byte
position of the range (exclusive).
Returns None if the value of the header is not syntatically valid.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4132</span>
<span class="normal">4133</span>
<span class="normal">4134</span>
<span class="normal">4135</span>
<span class="normal">4136</span>
<span class="normal">4137</span>
<span class="normal">4138</span>
<span class="normal">4139</span>
<span class="normal">4140</span>
<span class="normal">4141</span>
<span class="normal">4142</span>
<span class="normal">4143</span>
<span class="normal">4144</span>
<span class="normal">4145</span>
<span class="normal">4146</span>
<span class="normal">4147</span>
<span class="normal">4148</span>
<span class="normal">4149</span>
<span class="normal">4150</span>
<span class="normal">4151</span>
<span class="normal">4152</span>
<span class="normal">4153</span>
<span class="normal">4154</span>
<span class="normal">4155</span>
<span class="normal">4156</span>
<span class="normal">4157</span>
<span class="normal">4158</span>
<span class="normal">4159</span>
<span class="normal">4160</span>
<span class="normal">4161</span>
<span class="normal">4162</span>
<span class="normal">4163</span>
<span class="normal">4164</span>
<span class="normal">4165</span>
<span class="normal">4166</span>
<span class="normal">4167</span>
<span class="normal">4168</span>
<span class="normal">4169</span>
<span class="normal">4170</span>
<span class="normal">4171</span>
<span class="normal">4172</span>
<span class="normal">4173</span>
<span class="normal">4174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">parse_range_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">resource_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses a range header into a list of two-tuples (start, stop) where `start`</span>
<span class="sd">    is the starting byte of the range (inclusive) and `stop` is the ending byte</span>
<span class="sd">    position of the range (exclusive).</span>
<span class="sd">    Returns None if the value of the header is not syntatically valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span> <span class="ow">or</span> <span class="s1">&#39;=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">ranges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">units</span><span class="p">,</span> <span class="n">range_</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">!=</span> <span class="s2">&quot;bytes&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">range_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
            <span class="c1"># suffix-byte-range-spec: this form specifies the last N bytes of an</span>
            <span class="c1"># entity-body</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">resource_size</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">resource_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># byte-range-spec: first-byte-pos &quot;-&quot; [last-byte-pos]</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="c1"># the +1 is here since we want the stopping point to be exclusive, whereas in</span>
            <span class="c1"># the HTTP spec, the last-byte-pos is inclusive</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">stop</span> <span class="k">else</span> <span class="n">resource_size</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ranges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Relation" class="doc doc-heading">
            <code>Relation</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractRelation (hs_core.models.AbstractRelation)" href="#hs_core.models.AbstractRelation">AbstractRelation</a></code></p>



        <p>Define Relation custom metadata model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">relation</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Relation</span><span class="p">(</span><span class="n">AbstractRelation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Relation custom metadata model.&quot;&quot;&quot;</span>

    <span class="n">SOURCE_TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isPartOf</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;The content of this resource is part of&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">hasPart</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource includes&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isExecutedBy</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;The content of this resource can be executed by&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isCreatedBy</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
         <span class="s1">&#39;The content of this resource was created by a related App or software program&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isVersionOf</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource updates and replaces a previous version&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReplacedBy</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource has been replaced by a newer version&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isDescribedBy</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource is described by&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">conformsTo</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource conforms to established standard described by&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">hasFormat</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource has a related resource in another format&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isFormatOf</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource is a different format of&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isRequiredBy</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource is required by&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">requires</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource requires&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReferencedBy</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource is referenced by&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;The content of this resource references&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">replaces</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;This resource replaces&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;The content of this resource is derived from&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isSimilarTo</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;The content of this resource is similar to&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># these are hydroshare custom terms that are not Dublin Core terms</span>
    <span class="n">HS_RELATION_TERMS</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isExecutedBy</span><span class="p">,</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isCreatedBy</span><span class="p">,</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isDescribedBy</span><span class="p">,</span>
                         <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isSimilarTo</span><span class="p">)</span>
    <span class="n">NOT_USER_EDITABLE</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isVersionOf</span><span class="p">,</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReplacedBy</span><span class="p">,</span>
                         <span class="n">RelationTypes</span><span class="o">.</span><span class="n">isPartOf</span><span class="p">,</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">hasPart</span><span class="p">,</span> <span class="n">RelationTypes</span><span class="o">.</span><span class="n">replaces</span><span class="p">)</span>
    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Relation&#39;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">SOURCE_TYPES</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Relation</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Relation</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">relation_node</span> <span class="o">=</span> <span class="n">BNode</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="n">relation_node</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">HS_RELATION_TERMS</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">relation_node</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">HSTERMS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">),</span> <span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">relation_node</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">DCTERMS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">),</span> <span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">relation_node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">triples</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">triples</span><span class="p">((</span><span class="n">relation_node</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="n">type_term</span> <span class="o">=</span> <span class="n">p</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">o</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">type_term</span><span class="p">:</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="n">type_term</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">Relation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.ResourceFile" class="doc doc-heading">
            <code>ResourceFile</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="hs_core.s3.ResourceFileS3Mixin">ResourceFileS3Mixin</span></code></p>



        <p>Represent a file in a resource.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3427</span>
<span class="normal">3428</span>
<span class="normal">3429</span>
<span class="normal">3430</span>
<span class="normal">3431</span>
<span class="normal">3432</span>
<span class="normal">3433</span>
<span class="normal">3434</span>
<span class="normal">3435</span>
<span class="normal">3436</span>
<span class="normal">3437</span>
<span class="normal">3438</span>
<span class="normal">3439</span>
<span class="normal">3440</span>
<span class="normal">3441</span>
<span class="normal">3442</span>
<span class="normal">3443</span>
<span class="normal">3444</span>
<span class="normal">3445</span>
<span class="normal">3446</span>
<span class="normal">3447</span>
<span class="normal">3448</span>
<span class="normal">3449</span>
<span class="normal">3450</span>
<span class="normal">3451</span>
<span class="normal">3452</span>
<span class="normal">3453</span>
<span class="normal">3454</span>
<span class="normal">3455</span>
<span class="normal">3456</span>
<span class="normal">3457</span>
<span class="normal">3458</span>
<span class="normal">3459</span>
<span class="normal">3460</span>
<span class="normal">3461</span>
<span class="normal">3462</span>
<span class="normal">3463</span>
<span class="normal">3464</span>
<span class="normal">3465</span>
<span class="normal">3466</span>
<span class="normal">3467</span>
<span class="normal">3468</span>
<span class="normal">3469</span>
<span class="normal">3470</span>
<span class="normal">3471</span>
<span class="normal">3472</span>
<span class="normal">3473</span>
<span class="normal">3474</span>
<span class="normal">3475</span>
<span class="normal">3476</span>
<span class="normal">3477</span>
<span class="normal">3478</span>
<span class="normal">3479</span>
<span class="normal">3480</span>
<span class="normal">3481</span>
<span class="normal">3482</span>
<span class="normal">3483</span>
<span class="normal">3484</span>
<span class="normal">3485</span>
<span class="normal">3486</span>
<span class="normal">3487</span>
<span class="normal">3488</span>
<span class="normal">3489</span>
<span class="normal">3490</span>
<span class="normal">3491</span>
<span class="normal">3492</span>
<span class="normal">3493</span>
<span class="normal">3494</span>
<span class="normal">3495</span>
<span class="normal">3496</span>
<span class="normal">3497</span>
<span class="normal">3498</span>
<span class="normal">3499</span>
<span class="normal">3500</span>
<span class="normal">3501</span>
<span class="normal">3502</span>
<span class="normal">3503</span>
<span class="normal">3504</span>
<span class="normal">3505</span>
<span class="normal">3506</span>
<span class="normal">3507</span>
<span class="normal">3508</span>
<span class="normal">3509</span>
<span class="normal">3510</span>
<span class="normal">3511</span>
<span class="normal">3512</span>
<span class="normal">3513</span>
<span class="normal">3514</span>
<span class="normal">3515</span>
<span class="normal">3516</span>
<span class="normal">3517</span>
<span class="normal">3518</span>
<span class="normal">3519</span>
<span class="normal">3520</span>
<span class="normal">3521</span>
<span class="normal">3522</span>
<span class="normal">3523</span>
<span class="normal">3524</span>
<span class="normal">3525</span>
<span class="normal">3526</span>
<span class="normal">3527</span>
<span class="normal">3528</span>
<span class="normal">3529</span>
<span class="normal">3530</span>
<span class="normal">3531</span>
<span class="normal">3532</span>
<span class="normal">3533</span>
<span class="normal">3534</span>
<span class="normal">3535</span>
<span class="normal">3536</span>
<span class="normal">3537</span>
<span class="normal">3538</span>
<span class="normal">3539</span>
<span class="normal">3540</span>
<span class="normal">3541</span>
<span class="normal">3542</span>
<span class="normal">3543</span>
<span class="normal">3544</span>
<span class="normal">3545</span>
<span class="normal">3546</span>
<span class="normal">3547</span>
<span class="normal">3548</span>
<span class="normal">3549</span>
<span class="normal">3550</span>
<span class="normal">3551</span>
<span class="normal">3552</span>
<span class="normal">3553</span>
<span class="normal">3554</span>
<span class="normal">3555</span>
<span class="normal">3556</span>
<span class="normal">3557</span>
<span class="normal">3558</span>
<span class="normal">3559</span>
<span class="normal">3560</span>
<span class="normal">3561</span>
<span class="normal">3562</span>
<span class="normal">3563</span>
<span class="normal">3564</span>
<span class="normal">3565</span>
<span class="normal">3566</span>
<span class="normal">3567</span>
<span class="normal">3568</span>
<span class="normal">3569</span>
<span class="normal">3570</span>
<span class="normal">3571</span>
<span class="normal">3572</span>
<span class="normal">3573</span>
<span class="normal">3574</span>
<span class="normal">3575</span>
<span class="normal">3576</span>
<span class="normal">3577</span>
<span class="normal">3578</span>
<span class="normal">3579</span>
<span class="normal">3580</span>
<span class="normal">3581</span>
<span class="normal">3582</span>
<span class="normal">3583</span>
<span class="normal">3584</span>
<span class="normal">3585</span>
<span class="normal">3586</span>
<span class="normal">3587</span>
<span class="normal">3588</span>
<span class="normal">3589</span>
<span class="normal">3590</span>
<span class="normal">3591</span>
<span class="normal">3592</span>
<span class="normal">3593</span>
<span class="normal">3594</span>
<span class="normal">3595</span>
<span class="normal">3596</span>
<span class="normal">3597</span>
<span class="normal">3598</span>
<span class="normal">3599</span>
<span class="normal">3600</span>
<span class="normal">3601</span>
<span class="normal">3602</span>
<span class="normal">3603</span>
<span class="normal">3604</span>
<span class="normal">3605</span>
<span class="normal">3606</span>
<span class="normal">3607</span>
<span class="normal">3608</span>
<span class="normal">3609</span>
<span class="normal">3610</span>
<span class="normal">3611</span>
<span class="normal">3612</span>
<span class="normal">3613</span>
<span class="normal">3614</span>
<span class="normal">3615</span>
<span class="normal">3616</span>
<span class="normal">3617</span>
<span class="normal">3618</span>
<span class="normal">3619</span>
<span class="normal">3620</span>
<span class="normal">3621</span>
<span class="normal">3622</span>
<span class="normal">3623</span>
<span class="normal">3624</span>
<span class="normal">3625</span>
<span class="normal">3626</span>
<span class="normal">3627</span>
<span class="normal">3628</span>
<span class="normal">3629</span>
<span class="normal">3630</span>
<span class="normal">3631</span>
<span class="normal">3632</span>
<span class="normal">3633</span>
<span class="normal">3634</span>
<span class="normal">3635</span>
<span class="normal">3636</span>
<span class="normal">3637</span>
<span class="normal">3638</span>
<span class="normal">3639</span>
<span class="normal">3640</span>
<span class="normal">3641</span>
<span class="normal">3642</span>
<span class="normal">3643</span>
<span class="normal">3644</span>
<span class="normal">3645</span>
<span class="normal">3646</span>
<span class="normal">3647</span>
<span class="normal">3648</span>
<span class="normal">3649</span>
<span class="normal">3650</span>
<span class="normal">3651</span>
<span class="normal">3652</span>
<span class="normal">3653</span>
<span class="normal">3654</span>
<span class="normal">3655</span>
<span class="normal">3656</span>
<span class="normal">3657</span>
<span class="normal">3658</span>
<span class="normal">3659</span>
<span class="normal">3660</span>
<span class="normal">3661</span>
<span class="normal">3662</span>
<span class="normal">3663</span>
<span class="normal">3664</span>
<span class="normal">3665</span>
<span class="normal">3666</span>
<span class="normal">3667</span>
<span class="normal">3668</span>
<span class="normal">3669</span>
<span class="normal">3670</span>
<span class="normal">3671</span>
<span class="normal">3672</span>
<span class="normal">3673</span>
<span class="normal">3674</span>
<span class="normal">3675</span>
<span class="normal">3676</span>
<span class="normal">3677</span>
<span class="normal">3678</span>
<span class="normal">3679</span>
<span class="normal">3680</span>
<span class="normal">3681</span>
<span class="normal">3682</span>
<span class="normal">3683</span>
<span class="normal">3684</span>
<span class="normal">3685</span>
<span class="normal">3686</span>
<span class="normal">3687</span>
<span class="normal">3688</span>
<span class="normal">3689</span>
<span class="normal">3690</span>
<span class="normal">3691</span>
<span class="normal">3692</span>
<span class="normal">3693</span>
<span class="normal">3694</span>
<span class="normal">3695</span>
<span class="normal">3696</span>
<span class="normal">3697</span>
<span class="normal">3698</span>
<span class="normal">3699</span>
<span class="normal">3700</span>
<span class="normal">3701</span>
<span class="normal">3702</span>
<span class="normal">3703</span>
<span class="normal">3704</span>
<span class="normal">3705</span>
<span class="normal">3706</span>
<span class="normal">3707</span>
<span class="normal">3708</span>
<span class="normal">3709</span>
<span class="normal">3710</span>
<span class="normal">3711</span>
<span class="normal">3712</span>
<span class="normal">3713</span>
<span class="normal">3714</span>
<span class="normal">3715</span>
<span class="normal">3716</span>
<span class="normal">3717</span>
<span class="normal">3718</span>
<span class="normal">3719</span>
<span class="normal">3720</span>
<span class="normal">3721</span>
<span class="normal">3722</span>
<span class="normal">3723</span>
<span class="normal">3724</span>
<span class="normal">3725</span>
<span class="normal">3726</span>
<span class="normal">3727</span>
<span class="normal">3728</span>
<span class="normal">3729</span>
<span class="normal">3730</span>
<span class="normal">3731</span>
<span class="normal">3732</span>
<span class="normal">3733</span>
<span class="normal">3734</span>
<span class="normal">3735</span>
<span class="normal">3736</span>
<span class="normal">3737</span>
<span class="normal">3738</span>
<span class="normal">3739</span>
<span class="normal">3740</span>
<span class="normal">3741</span>
<span class="normal">3742</span>
<span class="normal">3743</span>
<span class="normal">3744</span>
<span class="normal">3745</span>
<span class="normal">3746</span>
<span class="normal">3747</span>
<span class="normal">3748</span>
<span class="normal">3749</span>
<span class="normal">3750</span>
<span class="normal">3751</span>
<span class="normal">3752</span>
<span class="normal">3753</span>
<span class="normal">3754</span>
<span class="normal">3755</span>
<span class="normal">3756</span>
<span class="normal">3757</span>
<span class="normal">3758</span>
<span class="normal">3759</span>
<span class="normal">3760</span>
<span class="normal">3761</span>
<span class="normal">3762</span>
<span class="normal">3763</span>
<span class="normal">3764</span>
<span class="normal">3765</span>
<span class="normal">3766</span>
<span class="normal">3767</span>
<span class="normal">3768</span>
<span class="normal">3769</span>
<span class="normal">3770</span>
<span class="normal">3771</span>
<span class="normal">3772</span>
<span class="normal">3773</span>
<span class="normal">3774</span>
<span class="normal">3775</span>
<span class="normal">3776</span>
<span class="normal">3777</span>
<span class="normal">3778</span>
<span class="normal">3779</span>
<span class="normal">3780</span>
<span class="normal">3781</span>
<span class="normal">3782</span>
<span class="normal">3783</span>
<span class="normal">3784</span>
<span class="normal">3785</span>
<span class="normal">3786</span>
<span class="normal">3787</span>
<span class="normal">3788</span>
<span class="normal">3789</span>
<span class="normal">3790</span>
<span class="normal">3791</span>
<span class="normal">3792</span>
<span class="normal">3793</span>
<span class="normal">3794</span>
<span class="normal">3795</span>
<span class="normal">3796</span>
<span class="normal">3797</span>
<span class="normal">3798</span>
<span class="normal">3799</span>
<span class="normal">3800</span>
<span class="normal">3801</span>
<span class="normal">3802</span>
<span class="normal">3803</span>
<span class="normal">3804</span>
<span class="normal">3805</span>
<span class="normal">3806</span>
<span class="normal">3807</span>
<span class="normal">3808</span>
<span class="normal">3809</span>
<span class="normal">3810</span>
<span class="normal">3811</span>
<span class="normal">3812</span>
<span class="normal">3813</span>
<span class="normal">3814</span>
<span class="normal">3815</span>
<span class="normal">3816</span>
<span class="normal">3817</span>
<span class="normal">3818</span>
<span class="normal">3819</span>
<span class="normal">3820</span>
<span class="normal">3821</span>
<span class="normal">3822</span>
<span class="normal">3823</span>
<span class="normal">3824</span>
<span class="normal">3825</span>
<span class="normal">3826</span>
<span class="normal">3827</span>
<span class="normal">3828</span>
<span class="normal">3829</span>
<span class="normal">3830</span>
<span class="normal">3831</span>
<span class="normal">3832</span>
<span class="normal">3833</span>
<span class="normal">3834</span>
<span class="normal">3835</span>
<span class="normal">3836</span>
<span class="normal">3837</span>
<span class="normal">3838</span>
<span class="normal">3839</span>
<span class="normal">3840</span>
<span class="normal">3841</span>
<span class="normal">3842</span>
<span class="normal">3843</span>
<span class="normal">3844</span>
<span class="normal">3845</span>
<span class="normal">3846</span>
<span class="normal">3847</span>
<span class="normal">3848</span>
<span class="normal">3849</span>
<span class="normal">3850</span>
<span class="normal">3851</span>
<span class="normal">3852</span>
<span class="normal">3853</span>
<span class="normal">3854</span>
<span class="normal">3855</span>
<span class="normal">3856</span>
<span class="normal">3857</span>
<span class="normal">3858</span>
<span class="normal">3859</span>
<span class="normal">3860</span>
<span class="normal">3861</span>
<span class="normal">3862</span>
<span class="normal">3863</span>
<span class="normal">3864</span>
<span class="normal">3865</span>
<span class="normal">3866</span>
<span class="normal">3867</span>
<span class="normal">3868</span>
<span class="normal">3869</span>
<span class="normal">3870</span>
<span class="normal">3871</span>
<span class="normal">3872</span>
<span class="normal">3873</span>
<span class="normal">3874</span>
<span class="normal">3875</span>
<span class="normal">3876</span>
<span class="normal">3877</span>
<span class="normal">3878</span>
<span class="normal">3879</span>
<span class="normal">3880</span>
<span class="normal">3881</span>
<span class="normal">3882</span>
<span class="normal">3883</span>
<span class="normal">3884</span>
<span class="normal">3885</span>
<span class="normal">3886</span>
<span class="normal">3887</span>
<span class="normal">3888</span>
<span class="normal">3889</span>
<span class="normal">3890</span>
<span class="normal">3891</span>
<span class="normal">3892</span>
<span class="normal">3893</span>
<span class="normal">3894</span>
<span class="normal">3895</span>
<span class="normal">3896</span>
<span class="normal">3897</span>
<span class="normal">3898</span>
<span class="normal">3899</span>
<span class="normal">3900</span>
<span class="normal">3901</span>
<span class="normal">3902</span>
<span class="normal">3903</span>
<span class="normal">3904</span>
<span class="normal">3905</span>
<span class="normal">3906</span>
<span class="normal">3907</span>
<span class="normal">3908</span>
<span class="normal">3909</span>
<span class="normal">3910</span>
<span class="normal">3911</span>
<span class="normal">3912</span>
<span class="normal">3913</span>
<span class="normal">3914</span>
<span class="normal">3915</span>
<span class="normal">3916</span>
<span class="normal">3917</span>
<span class="normal">3918</span>
<span class="normal">3919</span>
<span class="normal">3920</span>
<span class="normal">3921</span>
<span class="normal">3922</span>
<span class="normal">3923</span>
<span class="normal">3924</span>
<span class="normal">3925</span>
<span class="normal">3926</span>
<span class="normal">3927</span>
<span class="normal">3928</span>
<span class="normal">3929</span>
<span class="normal">3930</span>
<span class="normal">3931</span>
<span class="normal">3932</span>
<span class="normal">3933</span>
<span class="normal">3934</span>
<span class="normal">3935</span>
<span class="normal">3936</span>
<span class="normal">3937</span>
<span class="normal">3938</span>
<span class="normal">3939</span>
<span class="normal">3940</span>
<span class="normal">3941</span>
<span class="normal">3942</span>
<span class="normal">3943</span>
<span class="normal">3944</span>
<span class="normal">3945</span>
<span class="normal">3946</span>
<span class="normal">3947</span>
<span class="normal">3948</span>
<span class="normal">3949</span>
<span class="normal">3950</span>
<span class="normal">3951</span>
<span class="normal">3952</span>
<span class="normal">3953</span>
<span class="normal">3954</span>
<span class="normal">3955</span>
<span class="normal">3956</span>
<span class="normal">3957</span>
<span class="normal">3958</span>
<span class="normal">3959</span>
<span class="normal">3960</span>
<span class="normal">3961</span>
<span class="normal">3962</span>
<span class="normal">3963</span>
<span class="normal">3964</span>
<span class="normal">3965</span>
<span class="normal">3966</span>
<span class="normal">3967</span>
<span class="normal">3968</span>
<span class="normal">3969</span>
<span class="normal">3970</span>
<span class="normal">3971</span>
<span class="normal">3972</span>
<span class="normal">3973</span>
<span class="normal">3974</span>
<span class="normal">3975</span>
<span class="normal">3976</span>
<span class="normal">3977</span>
<span class="normal">3978</span>
<span class="normal">3979</span>
<span class="normal">3980</span>
<span class="normal">3981</span>
<span class="normal">3982</span>
<span class="normal">3983</span>
<span class="normal">3984</span>
<span class="normal">3985</span>
<span class="normal">3986</span>
<span class="normal">3987</span>
<span class="normal">3988</span>
<span class="normal">3989</span>
<span class="normal">3990</span>
<span class="normal">3991</span>
<span class="normal">3992</span>
<span class="normal">3993</span>
<span class="normal">3994</span>
<span class="normal">3995</span>
<span class="normal">3996</span>
<span class="normal">3997</span>
<span class="normal">3998</span>
<span class="normal">3999</span>
<span class="normal">4000</span>
<span class="normal">4001</span>
<span class="normal">4002</span>
<span class="normal">4003</span>
<span class="normal">4004</span>
<span class="normal">4005</span>
<span class="normal">4006</span>
<span class="normal">4007</span>
<span class="normal">4008</span>
<span class="normal">4009</span>
<span class="normal">4010</span>
<span class="normal">4011</span>
<span class="normal">4012</span>
<span class="normal">4013</span>
<span class="normal">4014</span>
<span class="normal">4015</span>
<span class="normal">4016</span>
<span class="normal">4017</span>
<span class="normal">4018</span>
<span class="normal">4019</span>
<span class="normal">4020</span>
<span class="normal">4021</span>
<span class="normal">4022</span>
<span class="normal">4023</span>
<span class="normal">4024</span>
<span class="normal">4025</span>
<span class="normal">4026</span>
<span class="normal">4027</span>
<span class="normal">4028</span>
<span class="normal">4029</span>
<span class="normal">4030</span>
<span class="normal">4031</span>
<span class="normal">4032</span>
<span class="normal">4033</span>
<span class="normal">4034</span>
<span class="normal">4035</span>
<span class="normal">4036</span>
<span class="normal">4037</span>
<span class="normal">4038</span>
<span class="normal">4039</span>
<span class="normal">4040</span>
<span class="normal">4041</span>
<span class="normal">4042</span>
<span class="normal">4043</span>
<span class="normal">4044</span>
<span class="normal">4045</span>
<span class="normal">4046</span>
<span class="normal">4047</span>
<span class="normal">4048</span>
<span class="normal">4049</span>
<span class="normal">4050</span>
<span class="normal">4051</span>
<span class="normal">4052</span>
<span class="normal">4053</span>
<span class="normal">4054</span>
<span class="normal">4055</span>
<span class="normal">4056</span>
<span class="normal">4057</span>
<span class="normal">4058</span>
<span class="normal">4059</span>
<span class="normal">4060</span>
<span class="normal">4061</span>
<span class="normal">4062</span>
<span class="normal">4063</span>
<span class="normal">4064</span>
<span class="normal">4065</span>
<span class="normal">4066</span>
<span class="normal">4067</span>
<span class="normal">4068</span>
<span class="normal">4069</span>
<span class="normal">4070</span>
<span class="normal">4071</span>
<span class="normal">4072</span>
<span class="normal">4073</span>
<span class="normal">4074</span>
<span class="normal">4075</span>
<span class="normal">4076</span>
<span class="normal">4077</span>
<span class="normal">4078</span>
<span class="normal">4079</span>
<span class="normal">4080</span>
<span class="normal">4081</span>
<span class="normal">4082</span>
<span class="normal">4083</span>
<span class="normal">4084</span>
<span class="normal">4085</span>
<span class="normal">4086</span>
<span class="normal">4087</span>
<span class="normal">4088</span>
<span class="normal">4089</span>
<span class="normal">4090</span>
<span class="normal">4091</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ResourceFile</span><span class="p">(</span><span class="n">ResourceFileS3Mixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent a file in a resource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">index_together</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;object_id&#39;</span><span class="p">,</span> <span class="s1">&#39;resource_file&#39;</span><span class="p">],</span>
                          <span class="p">]</span>
    <span class="c1"># A ResourceFile is a sub-object of a resource, which can have several types.</span>
    <span class="n">object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">,</span> <span class="s1">&#39;object_id&#39;</span><span class="p">)</span>

    <span class="c1"># This is used to direct uploads to a subfolder of the root folder for the resource.</span>
    <span class="c1"># See get_path and get_resource_file_path above.</span>
    <span class="n">file_folder</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># This pair of FileFields deals with the fact that there are two kinds of storage</span>
    <span class="n">resource_file</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="n">get_path</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                     <span class="n">storage</span><span class="o">=</span><span class="n">S3Storage</span><span class="p">())</span>

    <span class="c1"># we are using GenericForeignKey to allow resource file to be associated with any</span>
    <span class="c1"># HydroShare defined LogicalFile types (e.g., GeoRasterFile, NetCdfFile etc)</span>
    <span class="n">logical_file_object_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">logical_file_content_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ContentType</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                                                  <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                  <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;files&quot;</span><span class="p">)</span>
    <span class="n">logical_file_content_object</span> <span class="o">=</span> <span class="n">GenericForeignKey</span><span class="p">(</span><span class="s1">&#39;logical_file_content_type&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;logical_file_object_id&#39;</span><span class="p">)</span>

    <span class="c1"># these file metadata (size, modified_time, and checksum) values are retrieved from S3 and stored in db</span>
    <span class="c1"># for performance reason so that we don&#39;t have to query S3 for these values every time we need them</span>
    <span class="n">_size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BigIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_modified_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_checksum</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># for tracking when size was last compared with S3</span>
    <span class="n">filesize_cache_updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">banned_symbols</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns a list of banned characters for file/folder name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;\/:*?&quot;&lt;&gt;|&#39;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">system_meta_fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns a list of system metadata fields&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;_size&#39;</span><span class="p">,</span> <span class="s1">&#39;_modified_time&#39;</span><span class="p">,</span> <span class="s1">&#39;_checksum&#39;</span><span class="p">,</span> <span class="s1">&#39;filesize_cache_updated&#39;</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create custom create method for ResourceFile model.</span>

<span class="sd">        Create takes arguments that are invariant of storage medium.</span>
<span class="sd">        These are turned into a path that is suitable for the medium.</span>
<span class="sd">        Federation must be initialized first at the resource level.</span>

<span class="sd">        :param resource: resource that contains the file.</span>
<span class="sd">        :param file: a File or a S3 path to an existing file already copied.</span>
<span class="sd">        :param folder: the folder in which to store the file.</span>
<span class="sd">        :param source: an S3 path in the same zone from which to copy the file.</span>

<span class="sd">        There are two main usages to this constructor:</span>

<span class="sd">        * uploading a file from a form or REST call:</span>

<span class="sd">                ResourceFile.create(r, File(...something...), folder=d)</span>

<span class="sd">        * copying a file internally from S3:</span>

<span class="sd">                ResourceFile.create(r, file_name, folder=d, source=s)</span>

<span class="sd">        In this case, source is a full S3 pathname of the place from which to copy</span>
<span class="sd">        the file.</span>

<span class="sd">        A third form is less common and presumes that the file already exists in S3</span>
<span class="sd">        in the proper place:</span>

<span class="sd">        * pointing to an existing file:</span>

<span class="sd">                ResourceFile.create(r, file_name, folder=d)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># bind to appropriate resource</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">BaseResource</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder</span>

        <span class="n">istorage</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>

        <span class="c1"># if file is an open file, use native copy by setting appropriate variables</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">File</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">is_filename_valid</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="s2">&quot;Filename is not compliant with Hydroshare requirements&quot;</span><span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;resource_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if file is not an open file, then it&#39;s a basename (string)</span>
            <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
                <span class="c1"># source is a path to an S3 file to be copied here.</span>
                <span class="n">root</span><span class="p">,</span> <span class="n">newfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>  <span class="c1"># take file from source path</span>
                <span class="c1"># newfile is where it should be copied to.</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">newfile</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;ResourceFile.create: source </span><span class="si">{}</span><span class="s2"> of copy not found&quot;</span>
                                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
                <span class="n">istorage</span><span class="o">.</span><span class="n">copyFiles</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;ResourceFile.create: copy to target </span><span class="si">{}</span><span class="s2"> failed&quot;</span>
                                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># file points to an existing S3 file</span>
                <span class="c1"># no need to verify whether the file exists in S3 since the file</span>
                <span class="c1"># name is returned from S3 ils list dir command which already</span>
                <span class="c1"># confirmed the file exists already in S3</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                    <span class="s2">&quot;ResourceFile.create: exactly one of source or file must be specified&quot;</span><span class="p">)</span>

            <span class="c1"># we&#39;ve copied or moved if necessary; now set the paths</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;resource_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_file</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;resource_file&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;ResourceFile.create: file </span><span class="si">{}</span><span class="s2"> already exists&quot;</span>
                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;resource_file&#39;</span><span class="p">]))</span>

        <span class="c1"># Actually create the file record</span>
        <span class="c1"># when file is a File, the file is copied to storage in this step</span>
        <span class="c1"># otherwise, the copy must precede this step.</span>

        <span class="k">return</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># TODO: automagically handle orphaned logical files</span>
    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delete_logical_file</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a resource file record and the file contents.</span>
<span class="sd">        :param  delete_logical_file: if True deletes logical file associated with resource file</span>

<span class="sd">        model.delete does not cascade to delete files themselves,</span>
<span class="sd">        and these must be explicitly deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">delete_logical_file</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># deleting logical file metadata deletes the logical file as well</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logical_file</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResourceFile</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return content_object representing the resource from a resource file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_object</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return file size of the file.</span>
<span class="sd">        Calculates the size first if it has not been calculated yet.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_size</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modified_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return modified time of the file.</span>
<span class="sd">        If the modified time is not already set, then it is first retrieved from S3 and stored in db.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self._size != 0 -&gt; file exists, or we have not set the size yet</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modified_time</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_modified_time</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modified_time</span>

    <span class="k">def</span> <span class="nf">calculate_modified_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates modified time of the file in db.</span>
<span class="sd">        Retrieves the modified time from S3 and stores it in db.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_modified_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_modified_time</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">SessionException</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;file </span><span class="si">{}</span><span class="s2"> not found in S3&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_modified_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_modified_time&quot;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return checksum of the file.</span>
<span class="sd">        If the checksum is not already set, then it is first retrieved from S3 and stored in db.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self._size != 0 -&gt; file exists, or we have not set the size yet</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_checksum</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span>

    <span class="k">def</span> <span class="nf">calculate_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates checksum of the file in db.</span>
<span class="sd">        Retrieves the checksum from S3 and stores it in db.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">checksum</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">SessionException</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;file </span><span class="si">{}</span><span class="s2"> not found in S3&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_checksum&quot;</span><span class="p">])</span>

    <span class="c1"># TODO: write unit test</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">istorage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># TODO: write unit test</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">storage_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the qualified name for a file in the storage hierarchy.</span>

<span class="sd">        This is a valid input to S3Storage for manipulating the file.</span>
<span class="sd">        The output depends upon whether the S3Storage instance is running</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># instance.content_object can be stale after changes.</span>
        <span class="c1"># Re-fetch based upon key; bypass type system; it is not relevant</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_path</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_storage_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the qualified name for a file in the storage hierarchy.</span>
<span class="sd">        Note: This is the preferred way to get the storage path for a file when we are trying to find</span>
<span class="sd">        the storage path for more than one file in a resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">calculate_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads the file size and saves to the DB&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filesize_cache_updated</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">SessionException</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">):</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;file </span><span class="si">{}</span><span class="s2"> not found in S3&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_size&quot;</span><span class="p">,</span> <span class="s2">&quot;filesize_cache_updated&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving file size for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_size&quot;</span><span class="p">,</span> <span class="s2">&quot;filesize_cache_updated&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">set_system_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set system metadata (size, modified time, and checksum) for a file.</span>
<span class="sd">        This method should be called after a file is uploaded to S3 and registered with Django.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_size</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># file exists in S3 - get modified time and checksum</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_modified_time</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_checksum</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># file was not found in S3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_modified_time</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">system_meta_fields</span><span class="p">())</span>

    <span class="c1"># ResourceFile API handles file operations</span>
    <span class="k">def</span> <span class="nf">set_storage_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Bind this ResourceFile instance to an existing file.</span>

<span class="sd">        :param path: the path of the object.</span>
<span class="sd">        :param test_exists: if True, test for path existence in S3</span>

<span class="sd">        Path can be absolute or relative.</span>

<span class="sd">            * relative paths start with anything else and can start with optional folder</span>

<span class="sd">        :raises ValidationError: if the pathname is inconsistent with resource configuration.</span>
<span class="sd">        It is rather important that applications call this rather than simply calling</span>
<span class="sd">        resource_file = &quot;text path&quot; because it takes the trouble of making that path</span>
<span class="sd">        fully qualified so that S3Storage will work properly.</span>

<span class="sd">        This records file_folder for future possible uploads and searches.</span>

<span class="sd">        The heavy lifting in this routine is accomplished via path_is_acceptable and get_path,</span>
<span class="sd">        which together normalize the file name.  Regardless of whether the internal file name</span>
<span class="sd">        is qualified or not, this makes it fully qualified from the point of view of the</span>
<span class="sd">        S3Storage module.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_is_acceptable</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="n">test_exists</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_folder</span> <span class="o">=</span> <span class="n">folder</span>

        <span class="c1"># switch FileFields based upon federation path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">short_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the unqualified path to the file object.</span>

<span class="sd">        * This path is invariant of where the object is stored.</span>

<span class="sd">        * Thus, it does not change if the resource is moved.</span>

<span class="sd">        This is the path that should be used as a key to index things such as file type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># use of self.resource generates a query</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_short_path</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_short_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the unqualified path to the file object.</span>

<span class="sd">        * This path is invariant of where the object is stored.</span>

<span class="sd">        * Thus, it does not change if the resource is moved.</span>

<span class="sd">        This is the path that should be used as a key to index things such as file type.</span>
<span class="sd">        Note: This is the preferred way to get the short path for a file when we are trying to find short path</span>
<span class="sd">        for more than one file in a resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_is_acceptable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base</span>

    <span class="k">def</span> <span class="nf">set_short_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a path to a given path, relative to resource root.</span>

<span class="sd">        There is some question as to whether the short path should be stored explicitly or</span>
<span class="sd">        derived as in short_path above. The latter is computationally expensive but results</span>
<span class="sd">        in a single point of truth.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_folder</span> <span class="o">=</span> <span class="n">folder</span>  <span class="c1"># must precede call to get_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a path into folder and basename.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_is_acceptable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">path_is_acceptable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether a path is acceptable for this resource file.</span>

<span class="sd">        Called inside ResourceFile objects to check paths</span>

<span class="sd">        :param path: path to test</span>
<span class="sd">        :param test_exists: if True, test for path existence in S3</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">resource_path_is_acceptable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">resource_path_is_acceptable</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine whether a path is acceptable for this resource file.</span>

<span class="sd">        Called outside ResourceFile objects or before such an object exists</span>

<span class="sd">        :param path: path to test</span>
<span class="sd">        :param test_exists: if True, test for path existence in S3</span>

<span class="sd">        This has the side effect of returning the short path for the resource</span>
<span class="sd">        as a folder/filename pair.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">test_exists</span><span class="p">:</span>
            <span class="n">storage</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="n">locpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;contents&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
        <span class="n">relpath</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">locpath</span><span class="p">):</span>
            <span class="c1"># strip optional local path prefix</span>
            <span class="k">if</span> <span class="n">test_exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Local path (</span><span class="si">{}</span><span class="s2">) does not exist in S3&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="n">plen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locpath</span><span class="p">)</span>
            <span class="n">relpath</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">[</span><span class="n">plen</span><span class="p">:]</span>  <span class="c1"># strip local prefix, omit /</span>

        <span class="c1"># now we have folder/file. We could have gotten this from the input, or</span>
        <span class="c1"># from stripping qualification folders. Note that this can contain</span>
        <span class="c1"># misnamed header content misinterpreted as a folder unless one tests</span>
        <span class="c1"># for existence</span>
        <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">relpath</span><span class="p">:</span>
            <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">relpath</span><span class="p">)</span>
            <span class="n">abspath</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">test_exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">abspath</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Local path does not exist in S3&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">relpath</span>
            <span class="n">abspath</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">test_exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">abspath</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Local path does not exist in S3&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">folder</span><span class="p">,</span> <span class="n">base</span>

    <span class="c1"># classmethods do things that query or affect all files.</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">check_for_preferred_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_folder_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the file or folder name meets the preferred name requirements&quot;&quot;&quot;</span>

        <span class="c1"># remove anything that is not an alphanumeric, dash, underscore, or dot</span>
        <span class="n">sanitized_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?u)[^-\w.]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_folder_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_folder_name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sanitized_name</span><span class="p">):</span>
            <span class="c1"># one or more symbols that are not allowed was found</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="s1">&#39;..&#39;</span> <span class="ow">in</span> <span class="n">file_folder_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_filename_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the uploaded file has filename that complies to the hydroshare requirements</span>
<span class="sd">        :param  filename: Name of the file to check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_is_folder_file_name_valid</span><span class="p">(</span><span class="n">name_to_check</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_folder_name_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the folder name complies to the hydroshare requirements</span>
<span class="sd">        :param  folder_name: Name of the folder to check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_is_folder_file_name_valid</span><span class="p">(</span><span class="n">name_to_check</span><span class="o">=</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_is_folder_file_name_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name_to_check</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to check if a file/folder name is compliant with hydroshare requirements</span>
<span class="sd">        :param  name_to_check: Name of the file or folder to check</span>
<span class="sd">        :param  file: A flag to indicate if name_to_check is the filename</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># space at the start or at the end is not allowed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_to_check</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_to_check</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># check for banned symbols</span>
        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">banned_symbols</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">name_to_check</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">name_to_check</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="c1"># these represents special meaning in linux - current (.) dir, parent dir (..) and dir separator</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">folders</span> <span class="o">=</span> <span class="n">name_to_check</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">folder</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">):</span>
                    <span class="c1"># these represents special meaning in linux - current (.) dir and parent dir (..)</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_new_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates a new file/folder path that will be created for a resource</span>
<span class="sd">        :param  new_path: a file/folder path that is relative to the [res short_id]/data/contents</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># strip trailing slashes (if any)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="s1">&#39;Path cannot be empty&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path (</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">) must not start with &#39;/&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path (</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">) must not be &#39;.&#39; or &#39;..&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="s2">&quot;./&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;../&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot; /&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;/ &quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/.&quot;</span><span class="p">),</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/..&quot;</span><span class="p">)]):</span>
            <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path (</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">) must not contain &#39;./&#39;, &#39;../&#39;, &#39;/.&#39;, or &#39;/..&#39;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">path</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a ResourceFile record via its short path.&quot;&quot;&quot;</span>
        <span class="n">resource_file_path</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">resource_file</span><span class="o">=</span><span class="n">resource_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ResourceFile </span><span class="si">{</span><span class="n">resource_file_path</span><span class="si">}</span><span class="s1"> does not exist.&#39;</span><span class="p">)</span>

    <span class="c1"># TODO: move to BaseResource as instance method</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_folder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">sub_folders</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List files (instances of ResourceFile) in a given folder.</span>

<span class="sd">        :param resource: resource for which to list the folder</span>
<span class="sd">        :param folder: folder listed as either short_path or fully qualified path</span>
<span class="sd">        :param sub_folders: if true files from sub folders of *folder* will be included in the list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_folder_to_match</span> <span class="o">=</span> <span class="n">folder</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">file_path</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_folder_to_match</span> <span class="o">=</span> <span class="n">folder</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">sub_folders</span><span class="p">:</span>
            <span class="c1"># append trailing slash to match only this folder</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
                <span class="n">folder</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
            <span class="k">return</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">resource_file__startswith</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">file_folder</span><span class="o">=</span><span class="n">file_folder_to_match</span><span class="p">)</span>

    <span class="c1"># TODO: move to BaseResource as instance method</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_folder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">migrating_resource</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a folder for a resource.&quot;&quot;&quot;</span>
        <span class="c1"># avoid import loop</span>
        <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">create_folder</span>
        <span class="n">path_is_allowed</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="c1"># TODO: move code from location used below to here</span>
        <span class="n">create_folder</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="p">),</span>
                      <span class="n">migrating_resource</span><span class="o">=</span><span class="n">migrating_resource</span><span class="p">)</span>

    <span class="c1"># TODO: move to BaseResource as instance method</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove_folder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a folder for a resource.&quot;&quot;&quot;</span>
        <span class="c1"># avoid import loop</span>
        <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">remove_folder</span>
        <span class="n">path_is_allowed</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="c1"># TODO: move code from location used below to here</span>
        <span class="n">remove_folder</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_logical_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check existence of logical file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_file_object_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logical_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return content_object of logical file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_file_content_object</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logical_file_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return class name of logical file&#39;s content object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_file_content_object</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aggregation_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a name for the logical file type (aggregation)- used in UI&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_file</span><span class="o">.</span><span class="n">get_aggregation_display_name</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_generic_logical_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True of logical file type&#39;s classname is &#39;GenericLogicalFile&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_file_type_name</span> <span class="o">==</span> <span class="s2">&quot;GenericLogicalFile&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return logical file metadata.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_logical_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_file</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mime_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return MIME type of represented file.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.hydroshare.utils</span> <span class="kn">import</span> <span class="n">get_file_mime_type</span>
        <span class="k">return</span> <span class="n">get_file_mime_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return extension of resource file.&quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file_ext</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dir_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return directory path of resource file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return full path of resource file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return filename of resource file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the URL of the file contained in this ResourceFile.</span>

<span class="sd">        A GET of this URL simply returns the file. This URL is independent of federation.</span>
<span class="sd">        PUT, POST, and DELETE are not supported.</span>

<span class="sd">        This choice for a URL is dependent mainly upon conformance to DataOne URL standards</span>
<span class="sd">        that are also conformant to the format in resourcemap.xml. This url does not contain</span>
<span class="sd">        the site URL, which is prefixed when needed.</span>

<span class="sd">        This is based upon the resourcemap_urls.py entry:</span>

<span class="sd">            url(r&#39;^resource/(?P&lt;shortkey&gt;[0-9a-f-]+)/data/contents/(?.+)/$&#39;,</span>
<span class="sd">                views.file_download_url_mapper,</span>
<span class="sd">                name=&#39;get_resource_file&#39;)</span>

<span class="sd">        This url does NOT depend upon federation status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_encoded_file_path</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">public_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="n">url_encoded_file_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">public_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; return the public path (unqualified S3 path) for a resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s3_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the S3 path for accessing a file, including possible federation information.</span>
<span class="sd">            This consists of the resource id, /data/contents/, and the file path.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_path</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.aggregation_display_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregation_display_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return a name for the logical file type (aggregation)- used in UI</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.checksum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">checksum</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return checksum of the file.
If the checksum is not already set, then it is first retrieved from S3 and stored in db.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.dir_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dir_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return directory path of resource file.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.extension" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extension</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return extension of resource file.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.file_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">file_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return filename of resource file.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.full_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">full_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return full path of resource file.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.has_generic_logical_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_generic_logical_file</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return True of logical file type's classname is 'GenericLogicalFile'.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.has_logical_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">has_logical_file</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Check existence of logical file.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.logical_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logical_file</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return content_object of logical file.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.logical_file_type_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logical_file_type_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return class name of logical file's content object.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metadata</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return logical file metadata.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.mime_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mime_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return MIME type of represented file.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.modified_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modified_time</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return modified time of the file.
If the modified time is not already set, then it is first retrieved from S3 and stored in db.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.public_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">public_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>return the public path (unqualified S3 path) for a resource.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.resource" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resource</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return content_object representing the resource from a resource file.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.s3_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">s3_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the S3 path for accessing a file, including possible federation information.
This consists of the resource id, /data/contents/, and the file path.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.short_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">short_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the unqualified path to the file object.</p>
<ul>
<li>
<p>This path is invariant of where the object is stored.</p>
</li>
<li>
<p>Thus, it does not change if the resource is moved.</p>
</li>
</ul>
<p>This is the path that should be used as a key to index things such as file type.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">size</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return file size of the file.
Calculates the size first if it has not been calculated yet.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.storage_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">storage_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the qualified name for a file in the storage hierarchy.</p>
<p>This is a valid input to S3Storage for manipulating the file.
The output depends upon whether the S3Storage instance is running</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourceFile.url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">url</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Return the URL of the file contained in this ResourceFile.</p>
<p>A GET of this URL simply returns the file. This URL is independent of federation.
PUT, POST, and DELETE are not supported.</p>
<p>This choice for a URL is dependent mainly upon conformance to DataOne URL standards
that are also conformant to the format in resourcemap.xml. This url does not contain
the site URL, which is prefixed when needed.</p>
<p>This is based upon the resourcemap_urls.py entry:</p>
<pre><code>url(r'^resource/(?P&lt;shortkey&gt;[0-9a-f-]+)/data/contents/(?.+)/$',
    views.file_download_url_mapper,
    name='get_resource_file')
</code></pre>
<p>This url does NOT depend upon federation status.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.banned_symbols" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">banned_symbols</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>returns a list of banned characters for file/folder name</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3468</span>
<span class="normal">3469</span>
<span class="normal">3470</span>
<span class="normal">3471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">banned_symbols</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns a list of banned characters for file/folder name&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;\/:*?&quot;&lt;&gt;|&#39;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.calculate_checksum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_checksum</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Updates checksum of the file in db.
Retrieves the checksum from S3 and stores it in db.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3634</span>
<span class="normal">3635</span>
<span class="normal">3636</span>
<span class="normal">3637</span>
<span class="normal">3638</span>
<span class="normal">3639</span>
<span class="normal">3640</span>
<span class="normal">3641</span>
<span class="normal">3642</span>
<span class="normal">3643</span>
<span class="normal">3644</span>
<span class="normal">3645</span>
<span class="normal">3646</span>
<span class="normal">3647</span>
<span class="normal">3648</span>
<span class="normal">3649</span>
<span class="normal">3650</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates checksum of the file in db.</span>
<span class="sd">    Retrieves the checksum from S3 and stores it in db.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">checksum</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">SessionException</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;file </span><span class="si">{}</span><span class="s2"> not found in S3&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_checksum&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.calculate_modified_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_modified_time</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Updates modified time of the file in db.
Retrieves the modified time from S3 and stores it in db.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3606</span>
<span class="normal">3607</span>
<span class="normal">3608</span>
<span class="normal">3609</span>
<span class="normal">3610</span>
<span class="normal">3611</span>
<span class="normal">3612</span>
<span class="normal">3613</span>
<span class="normal">3614</span>
<span class="normal">3615</span>
<span class="normal">3616</span>
<span class="normal">3617</span>
<span class="normal">3618</span>
<span class="normal">3619</span>
<span class="normal">3620</span>
<span class="normal">3621</span>
<span class="normal">3622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_modified_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates modified time of the file in db.</span>
<span class="sd">    Retrieves the modified time from S3 and stores it in db.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modified_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_modified_time</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">SessionException</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;file </span><span class="si">{}</span><span class="s2"> not found in S3&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modified_time</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_modified_time&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.calculate_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_size</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reads the file size and saves to the DB</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3682</span>
<span class="normal">3683</span>
<span class="normal">3684</span>
<span class="normal">3685</span>
<span class="normal">3686</span>
<span class="normal">3687</span>
<span class="normal">3688</span>
<span class="normal">3689</span>
<span class="normal">3690</span>
<span class="normal">3691</span>
<span class="normal">3692</span>
<span class="normal">3693</span>
<span class="normal">3694</span>
<span class="normal">3695</span>
<span class="normal">3696</span>
<span class="normal">3697</span>
<span class="normal">3698</span>
<span class="normal">3699</span>
<span class="normal">3700</span>
<span class="normal">3701</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads the file size and saves to the DB&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesize_cache_updated</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">SessionException</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">):</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;file </span><span class="si">{}</span><span class="s2"> not found in S3&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_size&quot;</span><span class="p">,</span> <span class="s2">&quot;filesize_cache_updated&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving file size for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_size&quot;</span><span class="p">,</span> <span class="s2">&quot;filesize_cache_updated&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.check_for_preferred_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_for_preferred_name</span><span class="p">(</span><span class="n">file_folder_name</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if the file or folder name meets the preferred name requirements</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3854</span>
<span class="normal">3855</span>
<span class="normal">3856</span>
<span class="normal">3857</span>
<span class="normal">3858</span>
<span class="normal">3859</span>
<span class="normal">3860</span>
<span class="normal">3861</span>
<span class="normal">3862</span>
<span class="normal">3863</span>
<span class="normal">3864</span>
<span class="normal">3865</span>
<span class="normal">3866</span>
<span class="normal">3867</span>
<span class="normal">3868</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">check_for_preferred_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_folder_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the file or folder name meets the preferred name requirements&quot;&quot;&quot;</span>

    <span class="c1"># remove anything that is not an alphanumeric, dash, underscore, or dot</span>
    <span class="n">sanitized_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?u)[^-\w.]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">file_folder_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_folder_name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sanitized_name</span><span class="p">):</span>
        <span class="c1"># one or more symbols that are not allowed was found</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s1">&#39;..&#39;</span> <span class="ow">in</span> <span class="n">file_folder_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create custom create method for ResourceFile model.</p>
<p>Create takes arguments that are invariant of storage medium.
These are turned into a path that is suitable for the medium.
Federation must be initialized first at the resource level.</p>
<p>:param resource: resource that contains the file.
:param file: a File or a S3 path to an existing file already copied.
:param folder: the folder in which to store the file.
:param source: an S3 path in the same zone from which to copy the file.</p>
<p>There are two main usages to this constructor:</p>
<ul>
<li>
<p>uploading a file from a form or REST call:</p>
<pre><code>ResourceFile.create(r, File(...something...), folder=d)
</code></pre>
</li>
<li>
<p>copying a file internally from S3:</p>
<pre><code>ResourceFile.create(r, file_name, folder=d, source=s)
</code></pre>
</li>
</ul>
<p>In this case, source is a full S3 pathname of the place from which to copy
the file.</p>
<p>A third form is less common and presumes that the file already exists in S3
in the proper place:</p>
<ul>
<li>pointing to an existing file:<pre><code>ResourceFile.create(r, file_name, folder=d)
</code></pre>
</li>
</ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3478</span>
<span class="normal">3479</span>
<span class="normal">3480</span>
<span class="normal">3481</span>
<span class="normal">3482</span>
<span class="normal">3483</span>
<span class="normal">3484</span>
<span class="normal">3485</span>
<span class="normal">3486</span>
<span class="normal">3487</span>
<span class="normal">3488</span>
<span class="normal">3489</span>
<span class="normal">3490</span>
<span class="normal">3491</span>
<span class="normal">3492</span>
<span class="normal">3493</span>
<span class="normal">3494</span>
<span class="normal">3495</span>
<span class="normal">3496</span>
<span class="normal">3497</span>
<span class="normal">3498</span>
<span class="normal">3499</span>
<span class="normal">3500</span>
<span class="normal">3501</span>
<span class="normal">3502</span>
<span class="normal">3503</span>
<span class="normal">3504</span>
<span class="normal">3505</span>
<span class="normal">3506</span>
<span class="normal">3507</span>
<span class="normal">3508</span>
<span class="normal">3509</span>
<span class="normal">3510</span>
<span class="normal">3511</span>
<span class="normal">3512</span>
<span class="normal">3513</span>
<span class="normal">3514</span>
<span class="normal">3515</span>
<span class="normal">3516</span>
<span class="normal">3517</span>
<span class="normal">3518</span>
<span class="normal">3519</span>
<span class="normal">3520</span>
<span class="normal">3521</span>
<span class="normal">3522</span>
<span class="normal">3523</span>
<span class="normal">3524</span>
<span class="normal">3525</span>
<span class="normal">3526</span>
<span class="normal">3527</span>
<span class="normal">3528</span>
<span class="normal">3529</span>
<span class="normal">3530</span>
<span class="normal">3531</span>
<span class="normal">3532</span>
<span class="normal">3533</span>
<span class="normal">3534</span>
<span class="normal">3535</span>
<span class="normal">3536</span>
<span class="normal">3537</span>
<span class="normal">3538</span>
<span class="normal">3539</span>
<span class="normal">3540</span>
<span class="normal">3541</span>
<span class="normal">3542</span>
<span class="normal">3543</span>
<span class="normal">3544</span>
<span class="normal">3545</span>
<span class="normal">3546</span>
<span class="normal">3547</span>
<span class="normal">3548</span>
<span class="normal">3549</span>
<span class="normal">3550</span>
<span class="normal">3551</span>
<span class="normal">3552</span>
<span class="normal">3553</span>
<span class="normal">3554</span>
<span class="normal">3555</span>
<span class="normal">3556</span>
<span class="normal">3557</span>
<span class="normal">3558</span>
<span class="normal">3559</span>
<span class="normal">3560</span>
<span class="normal">3561</span>
<span class="normal">3562</span>
<span class="normal">3563</span>
<span class="normal">3564</span>
<span class="normal">3565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create custom create method for ResourceFile model.</span>

<span class="sd">    Create takes arguments that are invariant of storage medium.</span>
<span class="sd">    These are turned into a path that is suitable for the medium.</span>
<span class="sd">    Federation must be initialized first at the resource level.</span>

<span class="sd">    :param resource: resource that contains the file.</span>
<span class="sd">    :param file: a File or a S3 path to an existing file already copied.</span>
<span class="sd">    :param folder: the folder in which to store the file.</span>
<span class="sd">    :param source: an S3 path in the same zone from which to copy the file.</span>

<span class="sd">    There are two main usages to this constructor:</span>

<span class="sd">    * uploading a file from a form or REST call:</span>

<span class="sd">            ResourceFile.create(r, File(...something...), folder=d)</span>

<span class="sd">    * copying a file internally from S3:</span>

<span class="sd">            ResourceFile.create(r, file_name, folder=d, source=s)</span>

<span class="sd">    In this case, source is a full S3 pathname of the place from which to copy</span>
<span class="sd">    the file.</span>

<span class="sd">    A third form is less common and presumes that the file already exists in S3</span>
<span class="sd">    in the proper place:</span>

<span class="sd">    * pointing to an existing file:</span>

<span class="sd">            ResourceFile.create(r, file_name, folder=d)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># bind to appropriate resource</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">BaseResource</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource</span>

    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_folder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder</span>

    <span class="n">istorage</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>

    <span class="c1"># if file is an open file, use native copy by setting appropriate variables</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">File</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">is_filename_valid</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="s2">&quot;Filename is not compliant with Hydroshare requirements&quot;</span><span class="p">)</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;resource_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># if file is not an open file, then it&#39;s a basename (string)</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
            <span class="c1"># source is a path to an S3 file to be copied here.</span>
            <span class="n">root</span><span class="p">,</span> <span class="n">newfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>  <span class="c1"># take file from source path</span>
            <span class="c1"># newfile is where it should be copied to.</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">newfile</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;ResourceFile.create: source </span><span class="si">{}</span><span class="s2"> of copy not found&quot;</span>
                                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
            <span class="n">istorage</span><span class="o">.</span><span class="n">copyFiles</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;ResourceFile.create: copy to target </span><span class="si">{}</span><span class="s2"> failed&quot;</span>
                                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># file points to an existing S3 file</span>
            <span class="c1"># no need to verify whether the file exists in S3 since the file</span>
            <span class="c1"># name is returned from S3 ils list dir command which already</span>
            <span class="c1"># confirmed the file exists already in S3</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="s2">&quot;ResourceFile.create: exactly one of source or file must be specified&quot;</span><span class="p">)</span>

        <span class="c1"># we&#39;ve copied or moved if necessary; now set the paths</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;resource_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">if</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_file</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;resource_file&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;ResourceFile.create: file </span><span class="si">{}</span><span class="s2"> already exists&quot;</span>
                              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;resource_file&#39;</span><span class="p">]))</span>

    <span class="c1"># Actually create the file record</span>
    <span class="c1"># when file is a File, the file is copied to storage in this step</span>
    <span class="c1"># otherwise, the copy must precede this step.</span>

    <span class="k">return</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.create_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_folder</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">migrating_resource</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a folder for a resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3978</span>
<span class="normal">3979</span>
<span class="normal">3980</span>
<span class="normal">3981</span>
<span class="normal">3982</span>
<span class="normal">3983</span>
<span class="normal">3984</span>
<span class="normal">3985</span>
<span class="normal">3986</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create_folder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">migrating_resource</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a folder for a resource.&quot;&quot;&quot;</span>
    <span class="c1"># avoid import loop</span>
    <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">create_folder</span>
    <span class="n">path_is_allowed</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="c1"># TODO: move code from location used below to here</span>
    <span class="n">create_folder</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="p">),</span>
                  <span class="n">migrating_resource</span><span class="o">=</span><span class="n">migrating_resource</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">delete_logical_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a resource file record and the file contents.
:param  delete_logical_file: if True deletes logical file associated with resource file</p>
<p>model.delete does not cascade to delete files themselves,
and these must be explicitly deleted.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3568</span>
<span class="normal">3569</span>
<span class="normal">3570</span>
<span class="normal">3571</span>
<span class="normal">3572</span>
<span class="normal">3573</span>
<span class="normal">3574</span>
<span class="normal">3575</span>
<span class="normal">3576</span>
<span class="normal">3577</span>
<span class="normal">3578</span>
<span class="normal">3579</span>
<span class="normal">3580</span>
<span class="normal">3581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delete_logical_file</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a resource file record and the file contents.</span>
<span class="sd">    :param  delete_logical_file: if True deletes logical file associated with resource file</span>

<span class="sd">    model.delete does not cascade to delete files themselves,</span>
<span class="sd">    and these must be explicitly deleted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delete_logical_file</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># deleting logical file metadata deletes the logical file as well</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logical_file</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ResourceFile</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a ResourceFile record via its short path.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3937</span>
<span class="normal">3938</span>
<span class="normal">3939</span>
<span class="normal">3940</span>
<span class="normal">3941</span>
<span class="normal">3942</span>
<span class="normal">3943</span>
<span class="normal">3944</span>
<span class="normal">3945</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a ResourceFile record via its short path.&quot;&quot;&quot;</span>
    <span class="n">resource_file_path</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">resource_file</span><span class="o">=</span><span class="n">resource_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ResourceFile </span><span class="si">{</span><span class="n">resource_file_path</span><span class="si">}</span><span class="s1"> does not exist.&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.get_short_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_short_path</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the unqualified path to the file object.</p>
<ul>
<li>
<p>This path is invariant of where the object is stored.</p>
</li>
<li>
<p>Thus, it does not change if the resource is moved.</p>
</li>
</ul>
<p>This is the path that should be used as a key to index things such as file type.
Note: This is the preferred way to get the short path for a file when we are trying to find short path
for more than one file in a resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3766</span>
<span class="normal">3767</span>
<span class="normal">3768</span>
<span class="normal">3769</span>
<span class="normal">3770</span>
<span class="normal">3771</span>
<span class="normal">3772</span>
<span class="normal">3773</span>
<span class="normal">3774</span>
<span class="normal">3775</span>
<span class="normal">3776</span>
<span class="normal">3777</span>
<span class="normal">3778</span>
<span class="normal">3779</span>
<span class="normal">3780</span>
<span class="normal">3781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_short_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the unqualified path to the file object.</span>

<span class="sd">    * This path is invariant of where the object is stored.</span>

<span class="sd">    * Thus, it does not change if the resource is moved.</span>

<span class="sd">    This is the path that should be used as a key to index things such as file type.</span>
<span class="sd">    Note: This is the preferred way to get the short path for a file when we are trying to find short path</span>
<span class="sd">    for more than one file in a resource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_is_acceptable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">base</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.get_storage_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_storage_path</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the qualified name for a file in the storage hierarchy.
Note: This is the preferred way to get the storage path for a file when we are trying to find
the storage path for more than one file in a resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3675</span>
<span class="normal">3676</span>
<span class="normal">3677</span>
<span class="normal">3678</span>
<span class="normal">3679</span>
<span class="normal">3680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_storage_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the qualified name for a file in the storage hierarchy.</span>
<span class="sd">    Note: This is the preferred way to get the storage path for a file when we are trying to find</span>
<span class="sd">    the storage path for more than one file in a resource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span><span class="o">.</span><span class="n">name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.is_filename_valid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_filename_valid</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if the uploaded file has filename that complies to the hydroshare requirements
:param  filename: Name of the file to check</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3870</span>
<span class="normal">3871</span>
<span class="normal">3872</span>
<span class="normal">3873</span>
<span class="normal">3874</span>
<span class="normal">3875</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_filename_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the uploaded file has filename that complies to the hydroshare requirements</span>
<span class="sd">    :param  filename: Name of the file to check</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_is_folder_file_name_valid</span><span class="p">(</span><span class="n">name_to_check</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.is_folder_name_valid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_folder_name_valid</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if the folder name complies to the hydroshare requirements
:param  folder_name: Name of the folder to check</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3877</span>
<span class="normal">3878</span>
<span class="normal">3879</span>
<span class="normal">3880</span>
<span class="normal">3881</span>
<span class="normal">3882</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_folder_name_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the folder name complies to the hydroshare requirements</span>
<span class="sd">    :param  folder_name: Name of the folder to check</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_is_folder_file_name_valid</span><span class="p">(</span><span class="n">name_to_check</span><span class="o">=</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.list_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_folder</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">sub_folders</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>List files (instances of ResourceFile) in a given folder.</p>
<p>:param resource: resource for which to list the folder
:param folder: folder listed as either short_path or fully qualified path
:param sub_folders: if true files from sub folders of <em>folder</em> will be included in the list</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3948</span>
<span class="normal">3949</span>
<span class="normal">3950</span>
<span class="normal">3951</span>
<span class="normal">3952</span>
<span class="normal">3953</span>
<span class="normal">3954</span>
<span class="normal">3955</span>
<span class="normal">3956</span>
<span class="normal">3957</span>
<span class="normal">3958</span>
<span class="normal">3959</span>
<span class="normal">3960</span>
<span class="normal">3961</span>
<span class="normal">3962</span>
<span class="normal">3963</span>
<span class="normal">3964</span>
<span class="normal">3965</span>
<span class="normal">3966</span>
<span class="normal">3967</span>
<span class="normal">3968</span>
<span class="normal">3969</span>
<span class="normal">3970</span>
<span class="normal">3971</span>
<span class="normal">3972</span>
<span class="normal">3973</span>
<span class="normal">3974</span>
<span class="normal">3975</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">list_folder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">sub_folders</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List files (instances of ResourceFile) in a given folder.</span>

<span class="sd">    :param resource: resource for which to list the folder</span>
<span class="sd">    :param folder: folder listed as either short_path or fully qualified path</span>
<span class="sd">    :param sub_folders: if true files from sub folders of *folder* will be included in the list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_folder_to_match</span> <span class="o">=</span> <span class="n">folder</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="p">:</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">file_path</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_folder_to_match</span> <span class="o">=</span> <span class="n">folder</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>

    <span class="k">if</span> <span class="n">sub_folders</span><span class="p">:</span>
        <span class="c1"># append trailing slash to match only this folder</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="n">folder</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
        <span class="k">return</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">resource_file__startswith</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">file_folder</span><span class="o">=</span><span class="n">file_folder_to_match</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.parse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Parse a path into folder and basename.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3796</span>
<span class="normal">3797</span>
<span class="normal">3798</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a path into folder and basename.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_is_acceptable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.path_is_acceptable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">path_is_acceptable</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine whether a path is acceptable for this resource file.</p>
<p>Called inside ResourceFile objects to check paths</p>
<p>:param path: path to test
:param test_exists: if True, test for path existence in S3</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3800</span>
<span class="normal">3801</span>
<span class="normal">3802</span>
<span class="normal">3803</span>
<span class="normal">3804</span>
<span class="normal">3805</span>
<span class="normal">3806</span>
<span class="normal">3807</span>
<span class="normal">3808</span>
<span class="normal">3809</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">path_is_acceptable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine whether a path is acceptable for this resource file.</span>

<span class="sd">    Called inside ResourceFile objects to check paths</span>

<span class="sd">    :param path: path to test</span>
<span class="sd">    :param test_exists: if True, test for path existence in S3</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ResourceFile</span><span class="o">.</span><span class="n">resource_path_is_acceptable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.remove_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_folder</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Remove a folder for a resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3989</span>
<span class="normal">3990</span>
<span class="normal">3991</span>
<span class="normal">3992</span>
<span class="normal">3993</span>
<span class="normal">3994</span>
<span class="normal">3995</span>
<span class="normal">3996</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove_folder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a folder for a resource.&quot;&quot;&quot;</span>
    <span class="c1"># avoid import loop</span>
    <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">remove_folder</span>
    <span class="n">path_is_allowed</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="c1"># TODO: move code from location used below to here</span>
    <span class="n">remove_folder</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.resource_path_is_acceptable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resource_path_is_acceptable</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Determine whether a path is acceptable for this resource file.</p>
<p>Called outside ResourceFile objects or before such an object exists</p>
<p>:param path: path to test
:param test_exists: if True, test for path existence in S3</p>
<p>This has the side effect of returning the short path for the resource
as a folder/filename pair.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3811</span>
<span class="normal">3812</span>
<span class="normal">3813</span>
<span class="normal">3814</span>
<span class="normal">3815</span>
<span class="normal">3816</span>
<span class="normal">3817</span>
<span class="normal">3818</span>
<span class="normal">3819</span>
<span class="normal">3820</span>
<span class="normal">3821</span>
<span class="normal">3822</span>
<span class="normal">3823</span>
<span class="normal">3824</span>
<span class="normal">3825</span>
<span class="normal">3826</span>
<span class="normal">3827</span>
<span class="normal">3828</span>
<span class="normal">3829</span>
<span class="normal">3830</span>
<span class="normal">3831</span>
<span class="normal">3832</span>
<span class="normal">3833</span>
<span class="normal">3834</span>
<span class="normal">3835</span>
<span class="normal">3836</span>
<span class="normal">3837</span>
<span class="normal">3838</span>
<span class="normal">3839</span>
<span class="normal">3840</span>
<span class="normal">3841</span>
<span class="normal">3842</span>
<span class="normal">3843</span>
<span class="normal">3844</span>
<span class="normal">3845</span>
<span class="normal">3846</span>
<span class="normal">3847</span>
<span class="normal">3848</span>
<span class="normal">3849</span>
<span class="normal">3850</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">resource_path_is_acceptable</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine whether a path is acceptable for this resource file.</span>

<span class="sd">    Called outside ResourceFile objects or before such an object exists</span>

<span class="sd">    :param path: path to test</span>
<span class="sd">    :param test_exists: if True, test for path existence in S3</span>

<span class="sd">    This has the side effect of returning the short path for the resource</span>
<span class="sd">    as a folder/filename pair.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">test_exists</span><span class="p">:</span>
        <span class="n">storage</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
    <span class="n">locpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">short_id</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;contents&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
    <span class="n">relpath</span> <span class="o">=</span> <span class="n">path</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">locpath</span><span class="p">):</span>
        <span class="c1"># strip optional local path prefix</span>
        <span class="k">if</span> <span class="n">test_exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Local path (</span><span class="si">{}</span><span class="s2">) does not exist in S3&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="n">plen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locpath</span><span class="p">)</span>
        <span class="n">relpath</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">[</span><span class="n">plen</span><span class="p">:]</span>  <span class="c1"># strip local prefix, omit /</span>

    <span class="c1"># now we have folder/file. We could have gotten this from the input, or</span>
    <span class="c1"># from stripping qualification folders. Note that this can contain</span>
    <span class="c1"># misnamed header content misinterpreted as a folder unless one tests</span>
    <span class="c1"># for existence</span>
    <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">relpath</span><span class="p">:</span>
        <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">relpath</span><span class="p">)</span>
        <span class="n">abspath</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test_exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">abspath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Local path does not exist in S3&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">relpath</span>
        <span class="n">abspath</span> <span class="o">=</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test_exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">abspath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Local path does not exist in S3&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">folder</span><span class="p">,</span> <span class="n">base</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.set_short_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_short_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set a path to a given path, relative to resource root.</p>
<p>There is some question as to whether the short path should be stored explicitly or
derived as in short_path above. The latter is computationally expensive but results
in a single point of truth.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3783</span>
<span class="normal">3784</span>
<span class="normal">3785</span>
<span class="normal">3786</span>
<span class="normal">3787</span>
<span class="normal">3788</span>
<span class="normal">3789</span>
<span class="normal">3790</span>
<span class="normal">3791</span>
<span class="normal">3792</span>
<span class="normal">3793</span>
<span class="normal">3794</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_short_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a path to a given path, relative to resource root.</span>

<span class="sd">    There is some question as to whether the short path should be stored explicitly or</span>
<span class="sd">    derived as in short_path above. The latter is computationally expensive but results</span>
<span class="sd">    in a single point of truth.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_folder</span> <span class="o">=</span> <span class="n">folder</span>  <span class="c1"># must precede call to get_path</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.set_storage_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_storage_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Bind this ResourceFile instance to an existing file.</p>
<p>:param path: the path of the object.
:param test_exists: if True, test for path existence in S3</p>
<p>Path can be absolute or relative.</p>
<pre><code>* relative paths start with anything else and can start with optional folder
</code></pre>
<p>:raises ValidationError: if the pathname is inconsistent with resource configuration.
It is rather important that applications call this rather than simply calling
resource_file = "text path" because it takes the trouble of making that path
fully qualified so that S3Storage will work properly.</p>
<p>This records file_folder for future possible uploads and searches.</p>
<p>The heavy lifting in this routine is accomplished via path_is_acceptable and get_path,
which together normalize the file name.  Regardless of whether the internal file name
is qualified or not, this makes it fully qualified from the point of view of the
S3Storage module.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3722</span>
<span class="normal">3723</span>
<span class="normal">3724</span>
<span class="normal">3725</span>
<span class="normal">3726</span>
<span class="normal">3727</span>
<span class="normal">3728</span>
<span class="normal">3729</span>
<span class="normal">3730</span>
<span class="normal">3731</span>
<span class="normal">3732</span>
<span class="normal">3733</span>
<span class="normal">3734</span>
<span class="normal">3735</span>
<span class="normal">3736</span>
<span class="normal">3737</span>
<span class="normal">3738</span>
<span class="normal">3739</span>
<span class="normal">3740</span>
<span class="normal">3741</span>
<span class="normal">3742</span>
<span class="normal">3743</span>
<span class="normal">3744</span>
<span class="normal">3745</span>
<span class="normal">3746</span>
<span class="normal">3747</span>
<span class="normal">3748</span>
<span class="normal">3749</span>
<span class="normal">3750</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_storage_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bind this ResourceFile instance to an existing file.</span>

<span class="sd">    :param path: the path of the object.</span>
<span class="sd">    :param test_exists: if True, test for path existence in S3</span>

<span class="sd">    Path can be absolute or relative.</span>

<span class="sd">        * relative paths start with anything else and can start with optional folder</span>

<span class="sd">    :raises ValidationError: if the pathname is inconsistent with resource configuration.</span>
<span class="sd">    It is rather important that applications call this rather than simply calling</span>
<span class="sd">    resource_file = &quot;text path&quot; because it takes the trouble of making that path</span>
<span class="sd">    fully qualified so that S3Storage will work properly.</span>

<span class="sd">    This records file_folder for future possible uploads and searches.</span>

<span class="sd">    The heavy lifting in this routine is accomplished via path_is_acceptable and get_path,</span>
<span class="sd">    which together normalize the file name.  Regardless of whether the internal file name</span>
<span class="sd">    is qualified or not, this makes it fully qualified from the point of view of the</span>
<span class="sd">    S3Storage module.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">folder</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_is_acceptable</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">test_exists</span><span class="o">=</span><span class="n">test_exists</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_folder</span> <span class="o">=</span> <span class="n">folder</span>

    <span class="c1"># switch FileFields based upon federation path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource_file</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.set_system_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_system_metadata</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set system metadata (size, modified time, and checksum) for a file.
This method should be called after a file is uploaded to S3 and registered with Django.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3703</span>
<span class="normal">3704</span>
<span class="normal">3705</span>
<span class="normal">3706</span>
<span class="normal">3707</span>
<span class="normal">3708</span>
<span class="normal">3709</span>
<span class="normal">3710</span>
<span class="normal">3711</span>
<span class="normal">3712</span>
<span class="normal">3713</span>
<span class="normal">3714</span>
<span class="normal">3715</span>
<span class="normal">3716</span>
<span class="normal">3717</span>
<span class="normal">3718</span>
<span class="normal">3719</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_system_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set system metadata (size, modified time, and checksum) for a file.</span>
<span class="sd">    This method should be called after a file is uploaded to S3 and registered with Django.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_size</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># file exists in S3 - get modified time and checksum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_modified_time</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_checksum</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># file was not found in S3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modified_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">system_meta_fields</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.system_meta_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_meta_fields</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>returns a list of system metadata fields</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3473</span>
<span class="normal">3474</span>
<span class="normal">3475</span>
<span class="normal">3476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">system_meta_fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns a list of system metadata fields&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;_size&#39;</span><span class="p">,</span> <span class="s1">&#39;_modified_time&#39;</span><span class="p">,</span> <span class="s1">&#39;_checksum&#39;</span><span class="p">,</span> <span class="s1">&#39;filesize_cache_updated&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceFile.validate_new_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_new_path</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Validates a new file/folder path that will be created for a resource
:param  new_path: a file/folder path that is relative to the [res short_id]/data/contents</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3915</span>
<span class="normal">3916</span>
<span class="normal">3917</span>
<span class="normal">3918</span>
<span class="normal">3919</span>
<span class="normal">3920</span>
<span class="normal">3921</span>
<span class="normal">3922</span>
<span class="normal">3923</span>
<span class="normal">3924</span>
<span class="normal">3925</span>
<span class="normal">3926</span>
<span class="normal">3927</span>
<span class="normal">3928</span>
<span class="normal">3929</span>
<span class="normal">3930</span>
<span class="normal">3931</span>
<span class="normal">3932</span>
<span class="normal">3933</span>
<span class="normal">3934</span>
<span class="normal">3935</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">validate_new_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates a new file/folder path that will be created for a resource</span>
<span class="sd">    :param  new_path: a file/folder path that is relative to the [res short_id]/data/contents</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># strip trailing slashes (if any)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="s1">&#39;Path cannot be empty&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path (</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">) must not start with &#39;/&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path (</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">) must not be &#39;.&#39; or &#39;..&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="s2">&quot;./&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;../&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot; /&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;/ &quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/.&quot;</span><span class="p">),</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/..&quot;</span><span class="p">)]):</span>
        <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path (</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">) must not contain &#39;./&#39;, &#39;../&#39;, &#39;/.&#39;, or &#39;/..&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.ResourceManager" class="doc doc-heading">
            <code>ResourceManager</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="mezzanine.pages.managers.PageManager">PageManager</span></code></p>



        <p>Extend mezzanine PageManager to manage Resource pages.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ResourceManager</span><span class="p">(</span><span class="n">PageManager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend mezzanine PageManager to manage Resource pages.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extend mezzanine PageManager to manage Resource pages based on resource_type.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span> <span class="o">=</span> <span class="n">resource_type</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new mezzanine page based on resource_type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resource_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get mezzanine-like queryset based on resource_type.&quot;&quot;&quot;</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span><span class="p">:</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qs</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceManager.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">resource_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extend mezzanine PageManager to manage Resource pages based on resource_type.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extend mezzanine PageManager to manage Resource pages based on resource_type.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span> <span class="o">=</span> <span class="n">resource_type</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceManager.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create new mezzanine page based on resource_type.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create new mezzanine page based on resource_type.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resource_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourceManager.get_queryset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_queryset</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get mezzanine-like queryset based on resource_type.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get mezzanine-like queryset based on resource_type.&quot;&quot;&quot;</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ResourceManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span><span class="p">:</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.ResourcePermissionsMixin" class="doc doc-heading">
            <code>ResourcePermissionsMixin</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="mezzanine.core.models.Ownable">Ownable</span></code></p>



        <p>Mix in can_* permission helper functions between users and resources.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ResourcePermissionsMixin</span><span class="p">(</span><span class="n">Ownable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mix in can_* permission helper functions between users and resources.&quot;&quot;&quot;</span>

    <span class="n">creator</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                                <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;creator_of_</span><span class="si">%(app_label)s</span><span class="s1">_</span><span class="si">%(class)s</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;This is the person who first uploaded the resource&#39;</span><span class="p">,</span>
                                <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for ResourcePermissionsMixin, make abstract.&quot;&quot;&quot;</span>

        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">permissions_store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use PERMISSIONS_DB constant. Unsure what &#39;s&#39; is here.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">PERMISSIONS_DB</span>

    <span class="k">def</span> <span class="nf">can_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass through can_change to determine if user can make changes to a resource.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_change</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">can_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use utils.authorize method to determine if user can delete a resource.&quot;&quot;&quot;</span>
        <span class="c1"># have to do import locally to avoid circular import</span>
        <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">ACTION_TO_AUTHORIZE</span><span class="p">,</span> <span class="n">authorize</span>
        <span class="k">return</span> <span class="n">authorize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                         <span class="n">needed_permission</span><span class="o">=</span><span class="n">ACTION_TO_AUTHORIZE</span><span class="o">.</span><span class="n">DELETE_RESOURCE</span><span class="p">,</span>
                         <span class="n">raises_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">can_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use utils.authorize method to determine if user can change a resource.&quot;&quot;&quot;</span>
        <span class="c1"># have to do import locally to avoid circular import</span>
        <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">ACTION_TO_AUTHORIZE</span><span class="p">,</span> <span class="n">authorize</span>
        <span class="k">return</span> <span class="n">authorize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                         <span class="n">needed_permission</span><span class="o">=</span><span class="n">ACTION_TO_AUTHORIZE</span><span class="o">.</span><span class="n">EDIT_RESOURCE</span><span class="p">,</span>
                         <span class="n">raises_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">can_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use utils.authorize method to determine if user can view a resource.&quot;&quot;&quot;</span>
        <span class="c1"># have to do import locally to avoid circular import</span>
        <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">ACTION_TO_AUTHORIZE</span><span class="p">,</span> <span class="n">authorize</span>
        <span class="k">return</span> <span class="n">authorize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                         <span class="n">needed_permission</span><span class="o">=</span><span class="n">ACTION_TO_AUTHORIZE</span><span class="o">.</span><span class="n">VIEW_METADATA</span><span class="p">,</span>
                         <span class="n">raises_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="hs_core.models.ResourcePermissionsMixin.permissions_store" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">permissions_store</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Use PERMISSIONS_DB constant. Unsure what 's' is here.</p>

    </div>

</div>



<div class="doc doc-object doc-class">



<h3 id="hs_core.models.ResourcePermissionsMixin.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for ResourcePermissionsMixin, make abstract.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for ResourcePermissionsMixin, make abstract.&quot;&quot;&quot;</span>

    <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourcePermissionsMixin.can_add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_add</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pass through can_change to determine if user can make changes to a resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pass through can_change to determine if user can make changes to a resource.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_change</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourcePermissionsMixin.can_change" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_change</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Use utils.authorize method to determine if user can change a resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use utils.authorize method to determine if user can change a resource.&quot;&quot;&quot;</span>
    <span class="c1"># have to do import locally to avoid circular import</span>
    <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">ACTION_TO_AUTHORIZE</span><span class="p">,</span> <span class="n">authorize</span>
    <span class="k">return</span> <span class="n">authorize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                     <span class="n">needed_permission</span><span class="o">=</span><span class="n">ACTION_TO_AUTHORIZE</span><span class="o">.</span><span class="n">EDIT_RESOURCE</span><span class="p">,</span>
                     <span class="n">raises_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourcePermissionsMixin.can_delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_delete</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Use utils.authorize method to determine if user can delete a resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use utils.authorize method to determine if user can delete a resource.&quot;&quot;&quot;</span>
    <span class="c1"># have to do import locally to avoid circular import</span>
    <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">ACTION_TO_AUTHORIZE</span><span class="p">,</span> <span class="n">authorize</span>
    <span class="k">return</span> <span class="n">authorize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                     <span class="n">needed_permission</span><span class="o">=</span><span class="n">ACTION_TO_AUTHORIZE</span><span class="o">.</span><span class="n">DELETE_RESOURCE</span><span class="p">,</span>
                     <span class="n">raises_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.ResourcePermissionsMixin.can_view" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_view</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Use utils.authorize method to determine if user can view a resource.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use utils.authorize method to determine if user can view a resource.&quot;&quot;&quot;</span>
    <span class="c1"># have to do import locally to avoid circular import</span>
    <span class="kn">from</span> <span class="nn">hs_core.views.utils</span> <span class="kn">import</span> <span class="n">ACTION_TO_AUTHORIZE</span><span class="p">,</span> <span class="n">authorize</span>
    <span class="k">return</span> <span class="n">authorize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                     <span class="n">needed_permission</span><span class="o">=</span><span class="n">ACTION_TO_AUTHORIZE</span><span class="o">.</span><span class="n">VIEW_METADATA</span><span class="p">,</span>
                     <span class="n">raises_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Rights" class="doc doc-heading">
            <code>Rights</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Rights custom metadata element model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">rights</span><span class="p">,</span> <span class="n">statement</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">rightsStatement</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">HSTERMS</span><span class="o">.</span><span class="n">URL</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Rights</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Rights custom metadata element model.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Rights&#39;</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return either statement or statement + url for unicode representation.&quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statement</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statement</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>

        <span class="k">return</span> <span class="n">value</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Rights model.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Rights model.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Rights element of a resource can&#39;t be deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Rights.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Rights model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Rights model.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Rights.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return either statement or statement + url for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return either statement or statement + url for unicode representation.&quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statement</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statement</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>

    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Rights.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom remove method for Rights model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Rights model.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Rights element of a resource can&#39;t be deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Subject" class="doc doc-heading">
            <code>Subject</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Subject custom metadata element model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Subject</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Subject custom metadata element model.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Subject&#39;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Subject model.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return value field for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom create method for Subject model.&quot;&quot;&quot;</span>
        <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metadata_obj</span><span class="o">.</span><span class="n">subjects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">value__iexact</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Subject element already exists.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Subject model.&quot;&quot;&quot;</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">Subject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Subject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">sub</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
                                  <span class="n">content_type__pk</span><span class="o">=</span><span class="n">sub</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;The only subject element of the resource can&#39;t be deleted.&quot;</span><span class="p">)</span>
        <span class="n">sub</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">triples</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="n">Subject</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Subject.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Subject model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Subject model.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Subject.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return value field for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return value field for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Subject.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom create method for Subject model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom create method for Subject model.&quot;&quot;&quot;</span>
    <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;content_object&#39;</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">metadata_obj</span><span class="o">.</span><span class="n">subjects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">value__iexact</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Subject element already exists.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Subject.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom remove method for Subject model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom remove method for Subject model.&quot;&quot;&quot;</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="n">Subject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">element_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Subject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">sub</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
                              <span class="n">content_type__pk</span><span class="o">=</span><span class="n">sub</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;The only subject element of the resource can&#39;t be deleted.&quot;</span><span class="p">)</span>
    <span class="n">sub</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Title" class="doc doc-heading">
            <code>Title</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Title metadata element model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Title</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Title metadata element model.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Title&#39;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return value field for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Title class.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom remove function for Title class.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Title element of a resource can&#39;t be deleted.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="n">Literal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">Title</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">title</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Title.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Title class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Title class.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Title.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return value field for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return value field for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Title.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom remove function for Title class.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom remove function for Title class.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Title element of a resource can&#39;t be deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hs_core.models.Type" class="doc doc-heading">
            <code>Type</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AbstractMetaDataElement (hs_core.models.AbstractMetaDataElement)" href="#hs_core.models.AbstractMetaDataElement">AbstractMetaDataElement</a></code></p>



        <p>Define Type metadata element model.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@rdf_terms</span><span class="p">(</span><span class="n">DC</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Type</span><span class="p">(</span><span class="n">AbstractMetaDataElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define Type metadata element model.&quot;&quot;&quot;</span>

    <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;Type&#39;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return url field for unicode representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define meta properties for Type class.&quot;&quot;&quot;</span>

        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define custom remove function for Type model.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type element of a resource can&#39;t be deleted.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rdf_triples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">(),</span> <span class="n">URIRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">ingest_rdf</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content_object</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_class_term</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">Type</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="n">content_object</span><span class="o">=</span><span class="n">content_object</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="hs_core.models.Type.Meta" class="doc doc-heading">
            <code>Meta</code>


</h3>


    <div class="doc doc-contents ">



        <p>Define meta properties for Type class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>hs_core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define meta properties for Type class.&quot;&quot;&quot;</span>

    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;content_type&quot;</span><span class="p">,</span> <span class="s2">&quot;object_id&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Type.__unicode__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__unicode__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return url field for unicode representation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return url field for unicode representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hs_core.models.Type.remove" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="n">element_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define custom remove function for Type model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">element_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define custom remove function for Type model.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Type element of a resource can&#39;t be deleted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="hs_core.models.clean_abstract" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_abstract</span><span class="p">(</span><span class="n">original_string</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Clean abstract for XML inclusion.</p>
<p>This function takes an original string and removes any illegal XML characters
from it. It uses regular expressions to identify and remove the illegal characters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_string</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The original string to be cleaned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cleaned string with illegal XML characters removed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="django.core.exceptions.ValidationError">ValidationError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is an error cleaning the abstract.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_abstract</span><span class="p">(</span><span class="n">original_string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean abstract for XML inclusion.</span>

<span class="sd">    This function takes an original string and removes any illegal XML characters</span>
<span class="sd">    from it. It uses regular expressions to identify and remove the illegal characters.</span>

<span class="sd">    Args:</span>
<span class="sd">        original_string (str): The original string to be cleaned.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The cleaned string with illegal XML characters removed.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If there is an error cleaning the abstract.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># https://stackoverflow.com/a/64570125</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">illegal_unichrs</span> <span class="o">=</span> <span class="p">[(</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x0E</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">),</span>
                           <span class="p">(</span><span class="mh">0x7F</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x9F</span><span class="p">),</span>
                           <span class="p">(</span><span class="mh">0xFDD0</span><span class="p">,</span> <span class="mh">0xFDDF</span><span class="p">),</span> <span class="p">(</span><span class="mh">0xFFFE</span><span class="p">,</span> <span class="mh">0xFFFF</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxunicode</span> <span class="o">&gt;=</span> <span class="mh">0x10000</span><span class="p">:</span>  <span class="c1"># not narrow build</span>
            <span class="n">illegal_unichrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="mh">0x1FFFE</span><span class="p">,</span> <span class="mh">0x1FFFF</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x2FFFE</span><span class="p">,</span> <span class="mh">0x2FFFF</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mh">0x3FFFE</span><span class="p">,</span> <span class="mh">0x3FFFF</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x4FFFE</span><span class="p">,</span> <span class="mh">0x4FFFF</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mh">0x5FFFE</span><span class="p">,</span> <span class="mh">0x5FFFF</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x6FFFE</span><span class="p">,</span> <span class="mh">0x6FFFF</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mh">0x7FFFE</span><span class="p">,</span> <span class="mh">0x7FFFF</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x8FFFE</span><span class="p">,</span> <span class="mh">0x8FFFF</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mh">0x9FFFE</span><span class="p">,</span> <span class="mh">0x9FFFF</span><span class="p">),</span> <span class="p">(</span><span class="mh">0xAFFFE</span><span class="p">,</span> <span class="mh">0xAFFFF</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mh">0xBFFFE</span><span class="p">,</span> <span class="mh">0xBFFFF</span><span class="p">),</span> <span class="p">(</span><span class="mh">0xCFFFE</span><span class="p">,</span> <span class="mh">0xCFFFF</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mh">0xDFFFE</span><span class="p">,</span> <span class="mh">0xDFFFF</span><span class="p">),</span> <span class="p">(</span><span class="mh">0xEFFFE</span><span class="p">,</span> <span class="mh">0xEFFFF</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mh">0xFFFFE</span><span class="p">,</span> <span class="mh">0xFFFFF</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x10FFFE</span><span class="p">,</span> <span class="mh">0x10FFFF</span><span class="p">)])</span>

        <span class="n">illegal_ranges</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="n">low</span><span class="p">)</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="n">high</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span> <span class="ow">in</span> <span class="n">illegal_unichrs</span><span class="p">]</span>
        <span class="n">xml_illegal_character_regex</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">illegal_ranges</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
        <span class="n">illegal_xml_chars_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">xml_illegal_character_regex</span><span class="p">)</span>
        <span class="n">filtered_string</span> <span class="o">=</span> <span class="n">illegal_xml_chars_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">original_string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filtered_string</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error cleaning abstract: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.clean_for_xml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_for_xml</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <pre><code>Remove all control characters from a unicode string in preparation for XML inclusion

* Convert
</code></pre>
<ul>
<li>to unicode paragraph<ul>
<li>Convert 
 alone to unicode RETURN (return SYMBOL)</li>
<li>Convert control characters to spaces if last character is not space.</li>
<li>Space-pad paragraph and NL symbols as necessary</li>
</ul>
</li>
</ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_for_xml</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove all control characters from a unicode string in preparation for XML inclusion</span>

<span class="sd">    * Convert \n\n+ to unicode paragraph</span>
<span class="sd">    * Convert \n alone to unicode RETURN (return SYMBOL)</span>
<span class="sd">    * Convert control characters to spaces if last character is not space.</span>
<span class="sd">    * Space-pad paragraph and NL symbols as necessary</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># https://www.w3.org/TR/REC-xml/#sec-line-ends</span>
    <span class="n">CR</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x23CE</span><span class="p">)</span>  <span class="c1"># carriage return unicode SYMBOL</span>
    <span class="n">PARA</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0xB6</span><span class="p">)</span>  <span class="c1"># paragraph mark unicode SYMBOL</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="nb">next</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
        <span class="n">ISCONTROL</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span>
        <span class="n">ISSPACE</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span>
        <span class="n">ISNEWLINE</span> <span class="o">=</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">next</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ISNEWLINE</span><span class="p">:</span>  <span class="c1"># linux &#39;\n&#39;</span>
                <span class="nb">next</span> <span class="o">=</span> <span class="n">PARA</span>  <span class="c1"># upgrade to two+ returns</span>
            <span class="k">elif</span> <span class="n">ISSPACE</span> <span class="ow">or</span> <span class="n">ISCONTROL</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># ignore spaces in newline sequence</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="nb">next</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">ch</span>
                <span class="nb">next</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">ch</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ISNEWLINE</span><span class="p">:</span>
                <span class="nb">next</span> <span class="o">=</span> <span class="n">CR</span>
            <span class="k">elif</span> <span class="n">ISSPACE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">+=</span> <span class="n">ch</span>
                    <span class="n">last</span> <span class="o">=</span> <span class="n">ch</span>
            <span class="k">elif</span> <span class="n">ISCONTROL</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
                    <span class="n">last</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="n">ch</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">ch</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.get_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_path</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get a path from a ResourceFile, filename, and folder.</p>
<p>:param instance: instance of ResourceFile to use
:param filename: file name to use (without folder)
:param folder: can override folder for ResourceFile instance</p>
<p>The filename is only a single name. This routine converts it to an absolute
which contains the federation path. The folder in the instance will be used unless
overridden.</p>
<p>Note: this does not change the default behavior.
Thus it can be used to compute a new path for file that
one wishes to move.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3351</span>
<span class="normal">3352</span>
<span class="normal">3353</span>
<span class="normal">3354</span>
<span class="normal">3355</span>
<span class="normal">3356</span>
<span class="normal">3357</span>
<span class="normal">3358</span>
<span class="normal">3359</span>
<span class="normal">3360</span>
<span class="normal">3361</span>
<span class="normal">3362</span>
<span class="normal">3363</span>
<span class="normal">3364</span>
<span class="normal">3365</span>
<span class="normal">3366</span>
<span class="normal">3367</span>
<span class="normal">3368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a path from a ResourceFile, filename, and folder.</span>

<span class="sd">    :param instance: instance of ResourceFile to use</span>
<span class="sd">    :param filename: file name to use (without folder)</span>
<span class="sd">    :param folder: can override folder for ResourceFile instance</span>

<span class="sd">    The filename is only a single name. This routine converts it to an absolute</span>
<span class="sd">    which contains the federation path. The folder in the instance will be used unless</span>
<span class="sd">    overridden.</span>

<span class="sd">    Note: this does not change the default behavior.</span>
<span class="sd">    Thus it can be used to compute a new path for file that</span>
<span class="sd">    one wishes to move.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="p">:</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">file_folder</span>
    <span class="k">return</span> <span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.get_resource_file_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Determine storage path for a FileField</p>
<p>:param resource: resource containing the file.
:param filename: name of file without folder.
:param folder: folder of file</p>
<p>The filename is only a single name. This routine converts it to an absolute
to do this.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3372</span>
<span class="normal">3373</span>
<span class="normal">3374</span>
<span class="normal">3375</span>
<span class="normal">3376</span>
<span class="normal">3377</span>
<span class="normal">3378</span>
<span class="normal">3379</span>
<span class="normal">3380</span>
<span class="normal">3381</span>
<span class="normal">3382</span>
<span class="normal">3383</span>
<span class="normal">3384</span>
<span class="normal">3385</span>
<span class="normal">3386</span>
<span class="normal">3387</span>
<span class="normal">3388</span>
<span class="normal">3389</span>
<span class="normal">3390</span>
<span class="normal">3391</span>
<span class="normal">3392</span>
<span class="normal">3393</span>
<span class="normal">3394</span>
<span class="normal">3395</span>
<span class="normal">3396</span>
<span class="normal">3397</span>
<span class="normal">3398</span>
<span class="normal">3399</span>
<span class="normal">3400</span>
<span class="normal">3401</span>
<span class="normal">3402</span>
<span class="normal">3403</span>
<span class="normal">3404</span>
<span class="normal">3405</span>
<span class="normal">3406</span>
<span class="normal">3407</span>
<span class="normal">3408</span>
<span class="normal">3409</span>
<span class="normal">3410</span>
<span class="normal">3411</span>
<span class="normal">3412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_resource_file_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine storage path for a FileField</span>

<span class="sd">    :param resource: resource containing the file.</span>
<span class="sd">    :param filename: name of file without folder.</span>
<span class="sd">    :param folder: folder of file</span>

<span class="sd">    The filename is only a single name. This routine converts it to an absolute</span>
<span class="sd">    to do this.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># folder can be absolute pathname; strip qualifications off of folder if necessary</span>
    <span class="c1"># cannot only test folder string to start with resource.root_path, since a relative folder path</span>
    <span class="c1"># may start with the resource&#39;s uuid if the same resource bag is added into the same resource and unzipped</span>
    <span class="c1"># into the resource as in the bug reported in this issue: https://github.com/hydroshare/hydroshare/issues/2984</span>

    <span class="n">res_data_content_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">folder</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">res_data_content_path</span><span class="p">):</span>
        <span class="c1"># TODO: does this now start with /?</span>
        <span class="c1"># check if the folder is a path relative to the resource data content path, if yes, no need to strip out</span>
        <span class="c1"># resource.root_path</span>
        <span class="n">istorage</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_s3_storage</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">istorage</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res_data_content_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">)):</span>
            <span class="c1"># folder is not a path relative to res_data_content_path, but a path including resource root path,</span>
            <span class="c1"># strip out resource root path to make folder a relative path</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">folder</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">root_path</span><span class="p">):]</span>

    <span class="c1"># retrieve federation path -- if any -- from Resource object containing the file</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">filename</span>

    <span class="c1"># otherwise, it is an unqualified name.</span>
    <span class="k">if</span> <span class="n">folder</span><span class="p">:</span>
        <span class="c1"># use subfolder</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use root folder</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.get_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_user</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Authorize user based on API key if it was passed, otherwise just use the request's user.</p>
<p>NOTE: The API key portion has been removed with TastyPie and will be restored when the
new API is built.</p>
<p>:param request:
:return: django.contrib.auth.User</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Authorize user based on API key if it was passed, otherwise just use the request&#39;s user.</span>

<span class="sd">    NOTE: The API key portion has been removed with TastyPie and will be restored when the</span>
<span class="sd">    new API is built.</span>

<span class="sd">    :param request:</span>
<span class="sd">    :return: django.contrib.auth.User</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PermissionDenied</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.new_get_content_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">new_get_content_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Override mezzanine get_content_model function for pages for resources.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5030</span>
<span class="normal">5031</span>
<span class="normal">5032</span>
<span class="normal">5033</span>
<span class="normal">5034</span>
<span class="normal">5035</span>
<span class="normal">5036</span>
<span class="normal">5037</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">new_get_content_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override mezzanine get_content_model function for pages for resources.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">hs_core.hydroshare.utils</span> <span class="kn">import</span> <span class="n">get_resource_types</span>
    <span class="n">content_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_model</span>
    <span class="k">if</span> <span class="n">content_model</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">):</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="p">[</span><span class="n">rt</span> <span class="k">for</span> <span class="n">rt</span> <span class="ow">in</span> <span class="n">get_resource_types</span><span class="p">()</span> <span class="k">if</span> <span class="n">rt</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span> <span class="o">==</span> <span class="n">content_model</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">rt</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s1">&#39;raccess&#39;</span><span class="p">,</span> <span class="s1">&#39;quota_holder&#39;</span><span class="p">,</span> <span class="s1">&#39;rlabels&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">old_get_content_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.page_permissions_page_processor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">page_permissions_page_processor</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return a dict describing permissions for current user.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">page_permissions_page_processor</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a dict describing permissions for current user.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">hs_access_control.models.privilege</span> <span class="kn">import</span> <span class="n">PrivilegeCodes</span>
    <span class="kn">from</span> <span class="nn">hs_core.hydroshare.utils</span> <span class="kn">import</span> <span class="n">get_remaining_user_quota</span>

    <span class="c1"># Optimized to only fetch minimal data for initial page load.</span>
    <span class="c1"># Full manage access data is fetched on-demand when the manage access modal is opened.</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_content_model</span><span class="p">()</span>
    <span class="n">can_change_resource_flags</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">self_access_level</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_change_resource_flags</span><span class="p">(</span><span class="n">cm</span><span class="p">):</span>
            <span class="n">can_change_resource_flags</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># this will get resource access privilege even for admin user</span>
        <span class="n">user_privilege</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">get_effective_user_privilege</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_privilege</span> <span class="o">==</span> <span class="n">PrivilegeCodes</span><span class="o">.</span><span class="n">OWNER</span><span class="p">:</span>
            <span class="n">self_access_level</span> <span class="o">=</span> <span class="s1">&#39;owner&#39;</span>
        <span class="k">elif</span> <span class="n">user_privilege</span> <span class="o">==</span> <span class="n">PrivilegeCodes</span><span class="o">.</span><span class="n">CHANGE</span><span class="p">:</span>
            <span class="n">self_access_level</span> <span class="o">=</span> <span class="s1">&#39;edit&#39;</span>
        <span class="k">elif</span> <span class="n">user_privilege</span> <span class="o">==</span> <span class="n">PrivilegeCodes</span><span class="o">.</span><span class="n">VIEW</span><span class="p">:</span>
            <span class="n">self_access_level</span> <span class="o">=</span> <span class="s1">&#39;view&#39;</span>

    <span class="c1"># Only fetch owners for left header display - full access list loaded on-demand</span>
    <span class="n">owners</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">owners</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">last_changed_by</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">last_changed_by</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">owner</span> <span class="ow">in</span> <span class="n">owners</span><span class="p">:</span>
            <span class="n">owner</span><span class="o">.</span><span class="n">can_undo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_undo_share_resource_with_user</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>
            <span class="n">owner</span><span class="o">.</span><span class="n">viewable_contributions</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_view_resources_owned_by</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">last_changed_by</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
            <span class="n">last_changed_by</span><span class="o">.</span><span class="n">viewable_contributions</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_view_resources_owned_by</span><span class="p">(</span><span class="n">last_changed_by</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">owner</span> <span class="ow">in</span> <span class="n">owners</span><span class="p">:</span>
            <span class="n">owner</span><span class="o">.</span><span class="n">can_undo</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">last_changed_by</span><span class="o">.</span><span class="n">can_undo</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Only include owners in initial page load JSON</span>
    <span class="n">users_json</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">usr</span> <span class="ow">in</span> <span class="n">owners</span><span class="p">:</span>
        <span class="n">users_json</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_access_object</span><span class="p">(</span><span class="n">usr</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;owner&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">last_changed_by</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
        <span class="n">lcb_access_level</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">get_effective_user_privilege</span><span class="p">(</span><span class="n">last_changed_by</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lcb_access_level</span> <span class="o">==</span> <span class="n">PrivilegeCodes</span><span class="o">.</span><span class="n">OWNER</span><span class="p">:</span>
            <span class="n">lcb_access_level</span> <span class="o">=</span> <span class="s1">&#39;owner&#39;</span>
        <span class="k">elif</span> <span class="n">lcb_access_level</span> <span class="o">==</span> <span class="n">PrivilegeCodes</span><span class="o">.</span><span class="n">CHANGE</span><span class="p">:</span>
            <span class="n">lcb_access_level</span> <span class="o">=</span> <span class="s1">&#39;edit&#39;</span>
        <span class="k">elif</span> <span class="n">lcb_access_level</span> <span class="o">==</span> <span class="n">PrivilegeCodes</span><span class="o">.</span><span class="n">VIEW</span><span class="p">:</span>
            <span class="n">lcb_access_level</span> <span class="o">=</span> <span class="s1">&#39;view&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lcb_access_level</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>

    <span class="n">last_changed_by</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">get_access_object</span><span class="p">(</span><span class="n">last_changed_by</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">lcb_access_level</span><span class="p">))</span>

    <span class="n">users_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">users_json</span><span class="p">)</span>

    <span class="n">is_replaced_by</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_relation_version_res_url</span><span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isReplacedBy</span><span class="p">)</span>
    <span class="n">is_version_of</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_relation_version_res_url</span><span class="p">(</span><span class="n">RelationTypes</span><span class="o">.</span><span class="n">isVersionOf</span><span class="p">)</span>

    <span class="n">permissions_allow_copy</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="n">permissions_allow_copy</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">uaccess</span><span class="o">.</span><span class="n">can_view_resource</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>

    <span class="n">show_manage_access</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">is_owner</span> <span class="o">=</span> <span class="n">self_access_level</span> <span class="o">==</span> <span class="s1">&#39;owner&#39;</span>
    <span class="n">is_edit</span> <span class="o">=</span> <span class="n">self_access_level</span> <span class="o">==</span> <span class="s1">&#39;edit&#39;</span>
    <span class="n">is_view</span> <span class="o">=</span> <span class="n">self_access_level</span> <span class="o">==</span> <span class="s1">&#39;view&#39;</span>
    <span class="k">if</span> <span class="n">is_owner</span> <span class="ow">or</span> <span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">raccess</span><span class="o">.</span><span class="n">shareable</span> <span class="ow">and</span> <span class="p">(</span><span class="n">is_view</span> <span class="ow">or</span> <span class="n">is_edit</span><span class="p">)):</span>
        <span class="n">show_manage_access</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">file_upload_max_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;FILE_UPLOAD_MAX_SIZE&#39;</span><span class="p">,</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">remaining_quota</span> <span class="o">=</span> <span class="n">get_remaining_user_quota</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">quota_holder</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">remaining_quota</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">remaining_quota</span> <span class="o">=</span> <span class="n">remaining_quota</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># https://docs.djangoproject.com/en/3.2/ref/settings/#data-upload-max-memory-size</span>
    <span class="n">max_chunk_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;DATA_UPLOAD_MAX_MEMORY_SIZE&#39;</span><span class="p">,</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">max_number_of_files_in_single_local_upload</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;MAX_NUMBER_OF_FILES_IN_SINGLE_LOCAL_UPLOAD&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">parallel_uploads_limit</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;PARALLEL_UPLOADS_LIMIT&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">companion_url</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;COMPANION_URL&#39;</span><span class="p">,</span> <span class="s1">&#39;https://companion.hydroshare.org/&#39;</span><span class="p">)</span>
    <span class="n">UPPY_UPLOAD_PATH</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;UPPY_UPLOAD_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;https://hydroshare.org/django_s3/tus/&#39;</span><span class="p">)</span>
    <span class="n">google_picker_client_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;GOOGLE_PICKER_CLIENT_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">google_picker_api_key</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;GOOGLE_PICKER_API_KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">google_picker_app_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;GOOGLE_PICKER_APP_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># get the session id for the current user</span>
    <span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session_key</span>
        <span class="k">except</span> <span class="n">SessionException</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;resource_type&#39;</span><span class="p">:</span> <span class="n">cm</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span>
        <span class="s2">&quot;users_json&quot;</span><span class="p">:</span> <span class="n">users_json</span><span class="p">,</span>
        <span class="s2">&quot;owners&quot;</span><span class="p">:</span> <span class="n">owners</span><span class="p">,</span>
        <span class="s2">&quot;self_access_level&quot;</span><span class="p">:</span> <span class="n">self_access_level</span><span class="p">,</span>
        <span class="s2">&quot;permissions_allow_copy&quot;</span><span class="p">:</span> <span class="n">permissions_allow_copy</span><span class="p">,</span>
        <span class="s2">&quot;can_change_resource_flags&quot;</span><span class="p">:</span> <span class="n">can_change_resource_flags</span><span class="p">,</span>
        <span class="s2">&quot;is_replaced_by&quot;</span><span class="p">:</span> <span class="n">is_replaced_by</span><span class="p">,</span>
        <span class="s2">&quot;is_version_of&quot;</span><span class="p">:</span> <span class="n">is_version_of</span><span class="p">,</span>
        <span class="s2">&quot;show_manage_access&quot;</span><span class="p">:</span> <span class="n">show_manage_access</span><span class="p">,</span>
        <span class="s2">&quot;last_changed_by&quot;</span><span class="p">:</span> <span class="n">last_changed_by</span><span class="p">,</span>
        <span class="s2">&quot;remaining_quota&quot;</span><span class="p">:</span> <span class="n">remaining_quota</span><span class="p">,</span>
        <span class="s2">&quot;file_upload_max_size&quot;</span><span class="p">:</span> <span class="n">file_upload_max_size</span><span class="p">,</span>
        <span class="s2">&quot;max_chunk_size&quot;</span><span class="p">:</span> <span class="n">max_chunk_size</span><span class="p">,</span>
        <span class="s2">&quot;max_number_of_files_in_single_local_upload&quot;</span><span class="p">:</span> <span class="n">max_number_of_files_in_single_local_upload</span><span class="p">,</span>
        <span class="s2">&quot;parallel_uploads_limit&quot;</span><span class="p">:</span> <span class="n">parallel_uploads_limit</span><span class="p">,</span>
        <span class="s2">&quot;companion_url&quot;</span><span class="p">:</span> <span class="n">companion_url</span><span class="p">,</span>
        <span class="s2">&quot;UPPY_UPLOAD_PATH&quot;</span><span class="p">:</span> <span class="n">UPPY_UPLOAD_PATH</span><span class="p">,</span>
        <span class="s2">&quot;google_picker_client_id&quot;</span><span class="p">:</span> <span class="n">google_picker_client_id</span><span class="p">,</span>
        <span class="s2">&quot;google_picker_api_key&quot;</span><span class="p">:</span> <span class="n">google_picker_api_key</span><span class="p">,</span>
        <span class="s2">&quot;google_picker_app_id&quot;</span><span class="p">:</span> <span class="n">google_picker_app_id</span><span class="p">,</span>
        <span class="s2">&quot;hs_s_id&quot;</span><span class="p">:</span> <span class="n">session</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.path_is_allowed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">path_is_allowed</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check for suspicious paths containing '/../'.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3415</span>
<span class="normal">3416</span>
<span class="normal">3417</span>
<span class="normal">3418</span>
<span class="normal">3419</span>
<span class="normal">3420</span>
<span class="normal">3421</span>
<span class="normal">3422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">path_is_allowed</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for suspicious paths containing &#39;/../&#39;.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Empty file paths are not allowed&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;/../&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="s2">&quot;File paths cannot contain &#39;/../&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;/./&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SuspiciousFileOperation</span><span class="p">(</span><span class="s2">&quot;File paths cannot contain &#39;/./&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.resource_creation_signal_handler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resource_creation_signal_handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return resource update signal handler for newly created resource.</p>
<p>For now this is just a placeholder for some actions to be taken when a resource gets saved</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5749</span>
<span class="normal">5750</span>
<span class="normal">5751</span>
<span class="normal">5752</span>
<span class="normal">5753</span>
<span class="normal">5754</span>
<span class="normal">5755</span>
<span class="normal">5756</span>
<span class="normal">5757</span>
<span class="normal">5758</span>
<span class="normal">5759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@receiver</span><span class="p">(</span><span class="n">post_save</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">resource_creation_signal_handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return resource update signal handler for newly created resource.</span>

<span class="sd">    For now this is just a placeholder for some actions to be taken when a resource gets saved</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">AbstractResource</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">created</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resource_update_signal_handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.resource_processor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resource_processor</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return mezzanine page processor for resource page.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5743</span>
<span class="normal">5744</span>
<span class="normal">5745</span>
<span class="normal">5746</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">resource_processor</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return mezzanine page processor for resource page.&quot;&quot;&quot;</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="n">page_permissions_page_processor</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">extra</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.resource_update_signal_handler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resource_update_signal_handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Do nothing (noop).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5762</span>
<span class="normal">5763</span>
<span class="normal">5764</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">resource_update_signal_handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Do nothing (noop).&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.short_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">short_id</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate a uuid4 hex to be used as a resource or element short_id.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">short_id</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a uuid4 hex to be used as a resource or element short_id.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.validate_abstract" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_abstract</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Validates the abstract value by ensuring it can serialize as XML.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The abstract value to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="django.core.exceptions.ValidationError">ValidationError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is an error parsing the abstract as XML.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_abstract</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates the abstract value by ensuring it can serialize as XML.</span>

<span class="sd">    Args:</span>
<span class="sd">        value (str): The abstract value to be validated.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If there is an error parsing the abstract as XML.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">err_message</span> <span class="o">=</span> <span class="s1">&#39;Error parsing abstract as XML.&#39;</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ROOT</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
            <span class="n">body_node</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ROOT</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">)</span>
            <span class="n">c_abstract</span> <span class="o">=</span> <span class="n">clean_abstract</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">body_node</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">c_abstract</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">err_message</span><span class="si">}</span><span class="s1">, more info: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.validate_hydroshare_user_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_hydroshare_user_id</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Validate that a hydroshare_user_id is valid for a hydroshare user.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_hydroshare_user_id</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that a hydroshare_user_id is valid for a hydroshare user.&quot;&quot;&quot;</span>
    <span class="n">err_message</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not a valid id for hydroshare user&#39;</span> <span class="o">%</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_message</span><span class="p">)</span>

        <span class="c1"># check the user exists for the provided user id</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">UserValidationError</span><span class="p">(</span><span class="n">err_message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hs_core.models.validate_user_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_user_url</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Validate that a URL is a valid URL for a hydroshare user.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>hs_core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_user_url</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that a URL is a valid URL for a hydroshare user.&quot;&quot;&quot;</span>
    <span class="n">err_message</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not a valid url for hydroshare user&#39;</span> <span class="o">%</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
        <span class="n">url_parts</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_message</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">url_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_message</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">url_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_message</span><span class="p">)</span>

        <span class="c1"># check the user exists for the provided user id</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">err_message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>